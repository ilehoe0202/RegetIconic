/** temp
 * Helps to display the modal
 **/
(function closure(root, factory) {
    if (typeof define === 'function' && define.amd) {
        define('account.modal',[
            'jquery'
        ], function load(jQuery) {
            return factory(root, jQuery);
        });
    } else {
        // For non-AMD module, expose this to global (will also be useful for test cases)
        factory(root, jQuery);
    }
})(this, function factory(root, $) {

    jQuery.fn.makeAccountModalCenter = function() {

        $(this).css("position", "absolute");
        $(this).css("top", Math.max(0, (($(window).height() - $(this).outerHeight()) / 2) +
            $(window).scrollTop()) + "px");
        $(this).css("left", Math.max(0, (($(window).width() - $(this).outerWidth()) / 2) +
            $(window).scrollLeft()) + "px");

        //Adjusting the background overlay in case the modal height becomes more than the document height
        $('.account-modal__overlay').css('height', ($(document).height() + 'px'));

        return $(this);
    };

    /**
     * @Description: Helps to inject the content into the modal holder and displays the modal
     *
     * @Param: $content - Content to be injected into the modal
     * @Param: $header - Header content for the modal
     * @Param: $footer - Footer content for the modal
     **/
    var injectContentsToModalHolder = function($content, $header, $footer, options, isMobileChannel) {

        var $contentDiv,
            $modalOverlay,
            $modalContainer = $('.account-modal__content'),
            $modal,
            $footerDiv = '',
            $headerDiv = '',
            modelHeight = ($(window).height() - 200),
            width,
            margin;

        var defaults = {
            'width': '97%',
            'max-width': width,
            'height': ((modelHeight > 450) ? '450' : modelHeight) + 'px',
            'background': '#fff'
        };

        if (isMobileChannel) {
            width = "auto",
                margin = "20px";
        } else {
            width = "765px";
        }

        if (margin && margin !== "") {
            defaults.margin = margin;
        }

        $.extend(true, defaults, options);

        if ($modalContainer.length > 0) {
            $modalContainer.find('.content').html($content);
        } else {
            // var $closeBtn = $('<button />').addClass('account-modal__content__btn--close').addClass('account-modal__close');
            var $closeBtn = $('<button></button>')
                .addClass('thd-overlay__close--standAlone verification-svg-close account-modal__close')
                .html(
                    '<svg class="" viewBox="0 0 32 32"><path d="M27.229' +
                    ' 8.391l-3.385-3.386-7.843 7.838-7.84-7.84-3.386 3.385 7.609 7.608-7.613 7.612 3.385 3.386' +
                    ' 7.843-7.838 7.84 7.841 3.387-3.386-7.61-7.608z"></path></svg>'
                );

            $contentDiv = $('<div />').addClass('content body__p-all-large')
                .html($content);

            //Check for header footer content and then create it
            if ($header) {
                $headerDiv = $('<div />').addClass('account-modal__header').html($header);
            }

            if ($footer) {
                $footerDiv = $('<div />').addClass('account-modal__footer body__p-all-large u__text-align--right body__border-top--light')
                    .html($footer);
            }

            $modal = $('<div />').addClass('account--global__patch account-modal__content u__text-align--left')
                .html($headerDiv)
                .append($closeBtn)
                .append($contentDiv)
                .append($footerDiv)
                .attr('style', 'width:' + defaults.width + ' !important;');

            var $loaderDiv = $('<div />').addClass('pre-loader');
            $loaderDiv.append($('<div/>').addClass('segment-spinner'));
            var $loaderBackground = $('<div />').addClass('background-overlay');

            $modal.append($loaderDiv);
            $modal.append($loaderBackground);

            var contentHeight = defaults.height;
            defaults.height = 'auto';
            $modal.css(defaults);
            $modal.find('.content').attr('style', 'overflow-x: auto; max-height: ' + contentHeight);

            var documentHeight = $(document).height() + 'px';

            $modalOverlay = $('<div />').addClass('account-modal__overlay').css('height', documentHeight);
            $modalContainer = $('<div />').addClass('account-modal__container account--global__patch')
                .html($modalOverlay)
                .append($modal);

            $('body').append($modalContainer);

            $loaderDiv.hide();
            $loaderBackground.hide();

            $('.thd-overlay__close--standAlone').on('click', function(event) {
                event.preventDefault();

                //Trigger the event while closing the modal
                if ($("#resetpasswordemailentry").length > 0) {
                  $("#resetpasswordemailentry").remove()
                } else {
                  $('.account-modal__close').trigger('accountModalCloseEvent');
                  $modalContainer.remove();
                }
            });

            //The timeout is given for element to get added to the DOM
            // removing set timeout as it causing flickering while opening the pro modal. issue raised by QA team during validations
            $('.account-modal__content').makeAccountModalCenter();


            $(window).resize(function() {
                $('.account-modal__content').makeAccountModalCenter();
            });
        }
    };

    /**
     * @Description: Helps to remove the modal
     **/
    var removeModal = function() {
        $('.account-modal__container').remove();
    };

    var centerModal = function() {
        $('.account-modal__content').makeAccountModalCenter();
    };

    return {
        showModal: injectContentsToModalHolder,
        hideModal: removeModal,
        centerModal: centerModal
    };
});
/* globals cookieManager, define*/
(function closure(root, factory) {
  if (typeof define === 'function' && define.amd) {
    define('cookie-utils', [], function load() {
      return factory(root);
    });
  } else {
    root.cookieUtils = factory(root);
  }
}(this, function factory(root) {
  // @TODO - REMOVE THIS.
  if (typeof cookieUtils !== 'undefined') {
    return cookieUtils;
  }

  // Trim string of whitespaces
  function trim(stringToTrim) {
    return stringToTrim.replace(/^\s+|\s+$/g, '');
  }

  var cookieUtils = (typeof define === 'function' && define.amd) ? {} : root;
  var privateMethods = {};

  cookieUtils.sFULL = 'FULL';
  cookieUtils.iCOOKIE_EXP_SESSION = null;
  cookieUtils.sCOOKIE_NM_USER_AGENT_OVERRIDE = 'THD_USR_AGENT_OVERRIDE';


  // Modified WCS 7Up Code Merge 4.6 on 07/22/2011
  cookieUtils.cookieManager = (typeof cookieManager !== 'undefined') ? cookieManager : null;

  function hasValue(key) {
    if (typeof key === 'undefined' || key === null || key.toString().length === 0) {
      return false;
    }
    return true;
  }

  // escape is deprecated so we must use encode uri,
  // however we cant have a `(` or `)` in the cookie
  // value, which escape used to take care of
  cookieUtils._escapeCookie = function encodeCookie(cookieValue) {
    return encodeURIComponent(cookieValue)
      .replace(/\(/g, '%28')
      .replace(/\)/g, '%29');
  };

  cookieUtils.setMobileCookie = function setMobileCookie(cookieName, cookieValue, expirationDays, domain, _options) {
    var options = (_options) ? _options : {};
    if (typeof options.path === 'undefined') {
      options.path = '/';
    }

    var expirationDate = new Date();
    expirationDate.setDate(expirationDate.getDate() + expirationDays);
    var cookieString = cookieName + '=' + this._escapeCookie(cookieValue) + '; expires=' + ((expirationDays === null) ?
      '' :
      expirationDate.toUTCString()) + '; path=' + options.path + '; domain=' + domain;
    document.cookie = cookieString;
  };
  /* eslint-disable*/
  cookieUtils.fed_CreateCookie = function fed_CreateCookie(name, value, days) {
    /* eslint-enable*/
    var expires;
    if (days) {
      var date = new Date();
      date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
      expires = '; expires=' + date.toGMTString();
    } else {
      expires = '';
    }
    document.cookie = name + '=' + value + expires + '; path=/';
  };
  /* eslint-disable*/
  cookieUtils.fed_ReadCookie = function fed_ReadCookie(name) {
    /* eslint-enable*/
    var nameEQ = name + '=';
    var ca = document.cookie.split(';');
    for (var i = 0; i < ca.length; i++) {
      var c = ca[i];
      while (c.charAt(0) === ' ') {
        c = c.substring(1, c.length);
      }
      if (c.indexOf(nameEQ) === 0) {
        return c.substring(nameEQ.length, c.length);
      }
    }
    return null;
  };
  /* eslint-disable*/
  cookieUtils.fed_EraseCookie = function fed_EraseCookie(name) {
    /* eslint-enable*/
    cookieUtils.fed_CreateCookie(name, '', -1);
  };


  // Return wc user id based on cookie WC_USERACTIVITY_{userid}
  cookieUtils.getUserIdFromUserActivityCookie = function getUserIdFromUserActivityCookie() {
    var startsWithName = 'WC_USERACTIVITY_';
    var ca = document.cookie.split(';');
    var i;
    var c;
    for (i = 0; i < ca.length; i++) {
      c = trim(ca[i]);
      if (c.indexOf(startsWithName) === 0) {
        return c.substring(16, c.indexOf('='));
      }
    }
    return '';
  };


  /*
  Checks to see if cookie exists
  */
  cookieUtils.hasBrowserCookie = function hasBrowserCookie(name) {
    var nameEQ = name;
    var ca = document.cookie.split(';');
    for (var i = 0; i < ca.length; i++) {
      var c = ca[i];
      while (c.charAt(0) === ' ') {
        c = c.substring(1, c.length);
      }
      if (c.indexOf(nameEQ) === 0) {
        return true;
      }
    }
    return false;
  };


  /*
        Returns value of browser cookie
  */
  cookieUtils.readBrowserCookie = function readBrowserCookie(name) {
    var nameEQ = name + '=';
    var ca = document.cookie.split(';');
    for (var i = 0; i < ca.length; i++) {
      var c = ca[i];
      while (c.charAt(0) === ' ') {
        c = c.substring(1, c.length);
      }
      if (c.indexOf(nameEQ) === 0) {
        return decodeURIComponent(c.substring(nameEQ.length, c.length));
      }
    }
    return '';
  };


  // Deletes browser cookie by expiring it
  cookieUtils.deleteBrowserCookie = function deleteBrowserCookie(name, domain) {
    var date = new Date();
    var expires = '; expires=' + date.toString();
    document.cookie = name + '=' + expires + '; path=/; domain=' + domain;
  };

  /*
        This will create either a browser cookie or a cookie crumb
        this exists inside a master cookie
  */
  cookieUtils.createCookie = function createCookie(name, value, days) {
    if (hasValue(cookieUtils.cookieManager)) {
      cookieUtils.cookieManager.createCookie(name, value, days);
    }
  };

  /*
  Don't use the domain value being passed in, just use the default domain
  */
  cookieUtils.createCookieWDomain = function createCookieWDomain(name, value, days /* , domain */ ) {
    cookieUtils.cookieManager.createCookie(name, value, days);
  };

  cookieUtils._getDocumentDomain = function _getDocumentDomain() {
    return document.domain;
  };

  /*
    Determine if the default domain should be used or
    if the domain of the document should be used instead
    It should be noted that the document.domain will return
    the fully qualified hostname, not just the domain name.
    The implication is that the value returned will NOT have
    a leading period.
  */
  cookieUtils.getCurrentDomain = function getCurrentDomain(defaultDomain) {
    var currentDomain = defaultDomain;
    var documentDomain = this._getDocumentDomain();
    var dotDocumentDomain = '.' + documentDomain;
    if (dotDocumentDomain.indexOf(currentDomain) === -1) {
      var domainRegex = /((\.?hd-\w+)?\.?\w+.com)/;
      currentDomain = (currentDomain && currentDomain.indexOf('hd-') !== -1) ?
        domainRegex.exec(currentDomain) :
        domainRegex.exec(dotDocumentDomain);
      if (currentDomain && currentDomain.length) {
        currentDomain = currentDomain[1];
      }
    }
    return currentDomain;
  };

  cookieUtils.setCookieExpireInSeconds = function setCookieExpireInSeconds(cookieName, cookieValue, expInSec, _domain) {
    var domain = (typeof _domain !== 'undefined') ? _domain : null;
    var expDt = new Date();
    expDt.setTime(expDt.getTime() + (expInSec * 1000));
    var expDtString = (expDt === null) ? '' : expDt.toUTCString();
    var cookieString = cookieName + '=' + this._escapeCookie(cookieValue) + '; expires=' + expDtString + '; path=/;';

    if (domain) {
      cookieString += ' domain=' + domain;
    }

    document.cookie = cookieString;
  };

  // Creates a session only cookie
  cookieUtils.setSessionOnlyCookie = function setSessionOnlyCookie(cookieName, cookieValue, domain) {
    var cookieString = cookieName + '=' + cookieValue + '; path=/;';
    if (domain) {
      cookieString += ' domain=' + domain;
    }
    document.cookie = cookieString;
  };

  cookieUtils.initializeMasterCookie = function initializeMasterCookie() {
    cookieUtils.cookieManager.initializeMasterCookie();
  };

  // Initialize the CookieManager
  cookieUtils.initializeCookieManager = function initializeCookieManager(cookieDomain) {
    var xmlString = '';
    xmlString = ['<cookies domain="" path="/" regular_delimiter=":;" cache_delimiter="_~" regular_equals="=" cache_equals="~" expiration_suffix="_EXP">',
      '<cookie type="R" name="THD_PERSIST" expiration="51840000" path="/"></cookie>',
      '<cookie type="R" name="THD_SESSION" expiration="-1" path="/"></cookie>',
      '<cookie type="C" name="THD_CACHE_NAV_SESSION" expiration="-1" path="/"></cookie>',
      '<cookie type="C" name="THD_CACHE_NAV_PERSIST" expiration="51840000" path="/"></cookie>',
      '</cookies>',
      '<crumbs>',
      '<crumb type="R" alias="THD_BROWSESTATUS" name="C1" exp="-1"></crumb>',
      '<crumb type="R" alias="CJInfo" name="C2" exp="2592000"></crumb>',
      '<crumb type="C" alias="THD_KIOSK" name="C3" exp="" cookie="THD_CACHE_NAV_PERSIST"></crumb>',
      '<crumb type="R" alias="THD_LOCSTORE" name="C4" exp="51840000"></crumb>',
      '<crumb type="R" alias="THD_LOCSTOREFILTER" name="C5" exp="51840000"></crumb>',
      '<crumb type="R" alias="THD_MINICART" name="C6" exp="2592000"></crumb>',
      '<crumb type="R" alias="THD_MINILIST" name="C7" exp="51840000"></crumb>',
      '<crumb type="R" alias="THD_REFERRER" name="C8" exp="86400"></crumb>',
      '<crumb type="R" alias="THD_REMEMBERME" name="C9" exp="51840000"></crumb>',
      '<crumb type="C" alias="RPP" name="C10" exp="" cookie="THD_CACHE_NAV_PERSIST"></crumb>',
      '<crumb type="C" alias="THD_SPLASSORT" name="C11" exp="" cookie="THD_CACHE_NAV_SESSION"></crumb>',
      '<crumb type="R" alias="THD_USEREMAIL" name="C12" exp="51840000"></crumb>',
      '<crumb type="R" alias="THD_USERNAME" name="C13" exp="51840000"></crumb>',
      '<crumb type="R" alias="THD_USERSTATUS" name="C14" exp="-1"></crumb>',
      '<crumb type="R" alias="THD_GRMODE" name="C15" exp="-1"></crumb>',
      '<crumb type="R" alias="THD_AOL" name="C16" exp="-1"></crumb>',
      '<crumb type="R" alias="THD_USERREGTYPE" name="C17" exp="86400"></crumb>',
      '<crumb type="R" alias="THD_USERREF" name="C18" exp="86400"></crumb>',
      '<crumb type="R" alias="THD_ZIPCODE" name="C19" exp="86400"></crumb>',
      '<crumb type="C" alias="THD_NAVONLINESTORE" name="C20" exp="" cookie="THD_CACHE_NAV_SESSION"></crumb>',
      '<crumb type="C" alias="THD_NAVLOCALSTORE" name="C22" exp="" cookie="THD_CACHE_NAV_SESSION"></crumb>',
      '<crumb type="R" alias="THD_STRFINDERZIP" name="C24" exp="51840000"></crumb>',
      '<crumb type="R" alias="THD_ADMIN_HOST_INFO" name="C25" exp="51840000"></crumb>',
      '<crumb type="C" alias="THD_USERSORTOPTION" name="C26" exp="" cookie="THD_CACHE_NAV_SESSION"></crumb>',
      '<crumb type="R" alias="THD_AUTOLOCALIZEZIP" name="C27" exp="51840000"></crumb>',
      '<crumb type="R" alias="THD_AUTOLOCINTERCEPT" name="C29" exp="-1"></crumb>',
      '<crumb type="R" alias="THD_CA_USER" name="C30" exp="-1"></crumb>',
      '<crumb type="R" alias="THD_REQUIRED_PARTS_SELECTION" name="C31" exp="-1"></crumb>',
      '<crumb type="R" alias="THD_PASS_TEMP_VAL" name="C32" exp="51840000"></crumb>',
      '<crumb type="R" alias="THD_PREVIOUS_LOCAL_STORE" name="C33" exp="51840000"></crumb>',
      '<crumb type="R" alias="FEATURE_THROTTLE" name="C34" exp="86400"></crumb>',
      '<crumb type="R" alias="THD_LIVEPERSON_ERRORCOUNT" name="C35" exp="86400"></crumb>',
      '<crumb type="R" alias="THD_GEOLOCATION_INFO" name="C36" exp="-1"></crumb>',
      '<crumb type="R" alias="THD_AUTOLOCALIZED_SESSION" name="C37" exp="-1"></crumb>',
      '<crumb type="R" alias="THD_STORE_HOURS" name="C39" exp="3600"></crumb>',
      '<crumb type="R" alias="THD_USER_ID" name="C43" exp="51840000" cookie="THD_PERSIST"></crumb>',
      '<crumb type="R" alias="NONTLS_THD_AUTHORIZATION_TOKEN" name="C44" exp="51840000" cookie="THD_PERSIST"></crumb>',
      '<crumb type="R" alias="THD_AUTHORIZATION_TOKEN" name="C45" exp="51840000" cookie="THD_PERSIST"></crumb>',
      '<crumb type="R" alias="THD_USER_AUTH_STATUS" name="C46" exp="51840000" cookie="THD_PERSIST"></crumb>',
      '<crumb type="R" alias="THD_USERTYPE" name="C40" exp="51840000" cookie="THD_PERSIST"></crumb>',
      '<crumb type="R" alias="THD_BODFS_ZIPCODE" name="C41" exp="-1"/></crumb>',
      '<crumb type="C" alias="PLP_LAYOUTSTYLE" name="C42" exp="" cookie="THD_CACHE_NAV_SESSION"></crumb>',
      '<crumb type="C" alias="THD_DC_REFINEMENT" name="C47" exp="" cookie="THD_CACHE_NAV_PERSIST"></crumb>',
      '<crumb type="R" alias="THD_STORE_BANNER_STATUS" name="C51" exp="51840000"></crumb>',
      '</crumbs>'
    ].join('\n');

    var cookieJar = document.createElement('cookieJar');
    cookieJar.innerHTML = xmlString;
    document.getElementsByTagName('head')[0].appendChild(cookieJar);
    cookieUtils.cookieManager = new cookieUtils.CookieManager();
    cookieUtils.cookieManager.setCookieDomain(cookieUtils.getCurrentDomain(cookieDomain));
    // Initialize all the master cookies in config
    cookieUtils.cookieManager.initializeMasterCookie();
  };


  /*
       Creates a CookieManager object that manages MasterCookie objects
       PARAMETER: xmlId - The id of the XML island used to reference config data
  */
  cookieUtils.CookieManager = function CookieManager() {
    this.masterCookies = {};
    this.masterCookiesLength = 0;
    this.cookieDomain = '';
    this.path = '';
    this.cookieDelimiter = '';
    this.regularDelimiter = '';
    this.cacheDelimiter = '';
    this.regularEquals = '';
    this.cacheEquals = '';
    this.expiration_suffix = '';
  };

  cookieUtils.CookieManager.prototype.getCookiePath = function getCookiePath() {
    return this.path;
  };

  cookieUtils.CookieManager.prototype.setCookiePath = function setCookiePath(path) {
    this.path = path;
  };

  cookieUtils.CookieManager.prototype.getCookieExpirationSuffix = function getCookieExpirationSuffix() {
    return this.expiration_suffix;
  };

  cookieUtils.CookieManager.prototype.setCookieExpirationSuffix = function setCookieExpirationSuffix(suffix) {
    this.expiration_suffix = suffix;
  };

  cookieUtils.CookieManager.prototype.getRegularDelimiter = function getRegularDelimiter() {
    return this.regularDelimiter;
  };

  cookieUtils.CookieManager.prototype.setRegularDelimiter = function setRegularDelimiter(delimiter) {
    this.regularDelimiter = delimiter;
  };

  cookieUtils.CookieManager.prototype.getCacheDelimiter = function getCacheDelimiter() {
    return this.cacheDelimiter;
  };

  cookieUtils.CookieManager.prototype.setCacheDelimiter = function setCacheDelimiter(delimiter) {
    this.cacheDelimiter = delimiter;
  };

  cookieUtils.CookieManager.prototype.getCookieDomain = function getCookieDomain() {
    return this.cookieDomain;
  };

  cookieUtils.CookieManager.prototype.setCookieDomain = function setCookieDomain(domain) {
    this.cookieDomain = domain;
  };


  /*
      Get the crumbType for a given crumb name
  */
  cookieUtils.CookieManager.prototype.getCrumbType = function getCrumbType(crumbName) {
    var crumbList = document.getElementsByTagName('crumb');
    // Iterate through all the crumb entries to find the one
    // that matches the one that the caller wants
    for (var i = 0; i < crumbList.length; i++) {
      var crumbNode = crumbList[i];
      var currentCrumbName = crumbNode.getAttribute('name');

      // Alias name matches what is in config for this cookieName
      if (currentCrumbName === crumbName) {
        return crumbNode.getAttribute('type');
      }
    }

    return null;
  };
  /*
      Get the Cookie name for a cache crumb
  */
  cookieUtils.CookieManager.prototype.getCrumbCookieName = function getCrumbCookieName(crumbName) {
    var crumbList = document.getElementsByTagName('crumb');
    // Iterate through all the crumb entries to find the one
    // that matches the one that the caller want
    for (var i = 0; i < crumbList.length; i++) {
      var crumbNode = crumbList[i];
      var currentCrumbName = crumbNode.getAttribute('name');

      // Alias name matches what is in config for this cookieName
      if (currentCrumbName === crumbName) {
        return crumbNode.getAttribute('cookie');
      }
    }
    return null;
  };


  /*
        This initializes the CookieManager to create the necessary in-memory data structures
        of the cookies and their associated crumbs.
  */
  cookieUtils.CookieManager.prototype.initializeMasterCookie = function initializeMasterCookie() {
    var cookies = document.getElementsByTagName('cookies')[0];
    // Uncomment when the domain is dynamic
    // this.setCookieDomain(cookies.getAttribute('domain'));
    this.setCookieExpirationSuffix(cookies.getAttribute('expiration_suffix'));
    this.cacheDelimiter = cookies.getAttribute('cache_delimiter');
    this.regularDelimiter = cookies.getAttribute('regular_delimiter');
    this.cacheEquals = cookies.getAttribute('cache_equals');
    this.regularEquals = cookies.getAttribute('regular_equals');
    this.setCookiePath(cookies.getAttribute('path'));

    var masterCookieList = document.getElementsByTagName('cookie');

    for (var i = 0; i < masterCookieList.length; i++) {
      var objNode = masterCookieList[i];
      var cookieName = objNode.getAttribute('name');
      var cookieExpiration;
      if (objNode.getAttribute('expiration') !== -1) {
        cookieExpiration = parseInt(objNode.getAttribute('expiration'), 10) * 1000;
      } else {
        cookieExpiration = parseInt(objNode.getAttribute('expiration'), 10);
      }

      var cookiePath = this.getCookiePath();
      var cookieType = objNode.getAttribute('type');

      // Check if the cookie exists already
      // If not, create it
      var cookieValue = cookieUtils.readBrowserCookie(cookieName);
      var delimiter;
      var equals;

      if (cookieType === 'R') {
        delimiter = this.regularDelimiter;
        equals = this.regularEquals;
      } else {
        delimiter = this.cacheDelimiter;
        equals = this.cacheEquals;
      }

      this.masterCookies[cookieName] = new cookieUtils.MasterCookie(cookieName, cookieValue, cookieType, cookiePath, cookieExpiration, this.cookieDomain, equals, delimiter, this.getCookieExpirationSuffix());
      ++this.masterCookiesLength;

      if (!cookieUtils.hasBrowserCookie(cookieName)) {
        document.cookie = this.masterCookies[cookieName].makeCookieString();
      }
    }
  };


  /*
        Retrieves a cookie crumb value
        PARAMETER: cookieName - The alias of a cookie crumb whose value is to be retrieved
  */
  cookieUtils.CookieManager.prototype.readCookie = function readCookie(cookieName) {
    var aliasList = document.getElementsByTagName('crumb');
    var crumbFound = false;
    var cookieCrumb;
    for (var i = 0; i < aliasList.length; i++) {
      var aliasNode = aliasList[i];
      var aliasName = aliasNode.getAttribute('alias');
      var crumbName = aliasNode.getAttribute('name');
      var masterCookieName;
      cookieCrumb = null;
      if (aliasName === cookieName) {
        var crumbType = this.getCrumbType(crumbName);
        if (crumbType === 'R') {
          // Look through all the master cookies and remove the crumb if found
          // then retrieve the crumb.
          var masterCookieList = document.getElementsByTagName('cookie');

          for (var j = 0; j < masterCookieList.length; j++) {
            var objNode = masterCookieList[j];
            masterCookieName = objNode.getAttribute('name');
            // Check if alias name matches any entry in the config
            crumbFound = true;
            if (this.masterCookies[masterCookieName] !== null) {
              cookieCrumb = this.masterCookies[masterCookieName].getCrumb(crumbName);

              // If the crumb is not NULL then we have found it
              // Otherwise continue looking for crumb in based on
              // Additional aliases if they exist in the config
              if (cookieCrumb !== null) {
                return decodeURIComponent(cookieCrumb.getValue());
              }
            }
          }
        } else {
          // Check if alias name matches any entry in the config
          masterCookieName = this.getCrumbCookieName(crumbName);
          cookieCrumb = this.masterCookies[masterCookieName].getCrumb(crumbName);
          crumbFound = true;

          // If the crumb is not NULL then we have found it
          // Otherwise continue looking for crumb in based on
          // Additional aliases if they exist in the config
          if (cookieCrumb !== null) {
            return decodeURIComponent(cookieCrumb.getValue());
          }
        }
      }
    }

    // CookieName parameter doesn't match any alias names in config
    // so it must be a real cookie being requested
    if (crumbFound && cookieCrumb === null) {
      return '';
    }

    if (!crumbFound) {
      return cookieUtils.readBrowserCookie(cookieName);
    }
    return null;
  };

  /*
      This function determines if the expirations are the same length, i.e. they are both
      session or both actual expiration values
      PARAMETER: expirationValue1 - The expiration of the master cookie
      PARAMETER: expirationValue2 - The expiration to the cookie crumb
  */
  cookieUtils.CookieManager.prototype.hasSameExpiration = function hasSameExpiration(expirationValue1, expirationValue2) {
    if (Number(expirationValue1) === -1 && Number(expirationValue2) === -1) {
      return true;
    }
    if (Number(expirationValue1) === -1 && Number(expirationValue2) === 0) {
      return true;
    }
    if (Number(expirationValue1) > 0 && Number(expirationValue2) > 0) {
      return true;
    }

    return false;
  };


  /*
    Create a new cookie based on parameters
    PARAMETER: cookieName - The alias of the cookie crumb to be created
    PARAMETER: cookieValue - The value of the cookie crumb to be created
    PARAMETER: cookieExpiration - The expiration in days of the cookie crumb to be created
  */
  cookieUtils.CookieManager.prototype.createCookie = function createCookie(cookieName, cookieValue, _cookieExpiration) {
    var aliasList = document.getElementsByTagName('crumb');
    var cookieCrumb = null;
    var masterCookieName;
    var cookieExpiration = _cookieExpiration;
    // Iterate through all the alias entries to fins the one
    // that matches the one that the caller wants to add
    for (var i = 0; i < aliasList.length; i++) {
      var aliasNode = aliasList[i];
      var aliasName = aliasNode.getAttribute('alias');
      var crumbName = aliasNode.getAttribute('name');
      // Alias name matches what is in config for this cookieName
      if (aliasName === cookieName) {
        var crumbType = this.getCrumbType(crumbName);
        if (crumbType === 'R') {
          // Convert the expiration to -1 from empty string since the server code is interpreting
          // a session crumb in that manner.
          if (cookieExpiration === '' || cookieExpiration === null) {
            cookieExpiration = -1;
          }

          // Look through all the master cookies and remove the crumb if found
          // then add the crumb to the appropriate cookie.
          var masterCookieList = document.getElementsByTagName('cookie');

          for (var j = 0; j < masterCookieList.length; j++) {
            var objNode = masterCookieList[j];
            masterCookieName = objNode.getAttribute('name');
            // Always attempt to remove crumb
            this.masterCookies[masterCookieName].removeCrumb(cookieName);

            // Check if the expirations are the same.
            // If so, add the new crumb to the master cookie
            if (this.hasSameExpiration(this.masterCookies[masterCookieName].getConfigExpiration(), cookieExpiration)) {
              cookieCrumb = new cookieUtils.CookieCrumb(crumbName, cookieValue, cookieExpiration);

              // console.log(crumbName+' | '+cookieValue+' | '+cookieExpiration);

              this.masterCookies[masterCookieName].addCrumb(cookieCrumb);

              // Recreate the new master cookie in the browser.
              document.cookie = this.masterCookies[masterCookieName].makeCookieString();
              break;
            }
          }
        } else {
          masterCookieName = this.getCrumbCookieName(crumbName);
          cookieCrumb = new cookieUtils.CookieCrumb(crumbName, cookieValue, cookieExpiration);
          this.masterCookies[masterCookieName].addCrumb(cookieCrumb);

          // Recreate the new master cookie in the browser.
          document.cookie = this.masterCookies[masterCookieName].makeCookieString();
        }
        break;
      }
    }
  };


  /*
    Removes a cookie crumb object
    PARAMETER: cookieName - The alias of a cookie crumb to be deleted
  */
  cookieUtils.CookieManager.prototype.removeCookie = function removeCookie(cookieName) {
    var aliasList = document.getElementsByTagName('crumb');
    var crumbFound = false;
    var masterCookieName;
    for (var i = 0; i < aliasList.length; i++) {
      var aliasNode = aliasList[i];
      var aliasName = aliasNode.getAttribute('alias');
      var crumbName = aliasNode.getAttribute('name');

      // Check if alias name matches any entry in the config
      if (aliasName === cookieName) {
        var crumbType = this.getCrumbType(crumbName);
        if (crumbType === 'R') {
          // Look through all the master cookies and remove the crumb if found
          // A crumb should only exist in one master cookie at a time
          var masterCookieList = document.getElementsByTagName('cookie');

          for (var j = 0; j < masterCookieList.length; j++) {
            var objNode = masterCookieList[j];
            masterCookieName = objNode.getAttribute('name');

            crumbFound = true;
            this.masterCookies[masterCookieName].removeCrumb(crumbName);
            break;
          }
        } else {
          masterCookieName = this.getCrumbCookieName(crumbName);
          this.masterCookies[masterCookieName].removeCrumb(crumbName);
          crumbFound = true;
        }
        break;
      }
    }

    // CookieName parameter doesn't match any alias names in config
    // so it must be a real cookie being requested
    if (!crumbFound) {
      return cookieUtils.deleteBrowserCookie(cookieName);
    }
    return null;
  };


  /*
    Creates a MasterCookie object that contains CookieCrumb objects
    Expiration for each master cookie is stored in milliseconds where the value will be
    cookie expiration = expiration(milliseconds) + current time(milliseconds).
    PARAMETER: name - The name of a MasterCookie that should be in configuration
    PARAMETER: value - The unparsed value of a MasterCookie that the  browser contains
                      The value parameter is parsed and CookieCrumb objects are created.
    PARAMETER: type - The type of the MasterCookie, R - Regular, C - Cache
    PARAMETER: path - The path of the MasterCookie which should come from configuration
    PARAMETER: expiration - The number of milliseconds from now the master cookie is set to expire
    PARAMETER: domain - The domain of the cookie
    PARAMETER: equals - The value used to separate the crumb name and its value
    PARAMETER: delimiter - The delimiter used to separate cookie crumbs
    PARAMETER: expSuffix - The expiration suffix used for cookie crumbs
  */
  cookieUtils.MasterCookie = function MasterCookie(name, value, type, path, expiration, domain, equals, delimiter, expSuffix) {
    this.crumbArray = [];
    this.name = name;
    this.value = value;
    this.type = type;
    this.path = path;


    this.expiration = expiration;
    this.configExpiration = expiration;


    this.equals = equals;
    this.delimiter = delimiter;
    this.cookieDomain = domain;
    this.expirationSuffix = expSuffix;
    // This will setup the in-memory data structures for use later
    this.initialize();
  };

  cookieUtils.MasterCookie.prototype.getExpiration = function getExpiration() {
    return this.expiration;
  };

  cookieUtils.MasterCookie.prototype.getConfigExpiration = function getConfigExpiration() {
    return this.configExpiration;
  };

  cookieUtils.MasterCookie.prototype.isRegularType = function isRegularType() {
    if (this.type === 'R') {
      return true;
    }
    return false;
  };

  cookieUtils.MasterCookie.prototype.isCacheType = function isCacheType() {
    if (this.type === 'C') {
      return true;
    }
    return false;
  };


  /*
      Adjust the master cookie expiration to the latest expiration
      of the crumbs contained within it. This only applies to Regular Cookies.
  */
  cookieUtils.MasterCookie.prototype.updateToLatestExpiration = function updateToLatestExpiration() {
    // The master cookie my be a session cookie so check for empty string
    if (Number(this.expiration) !== -1) {
      var date = new Date();
      var currentExpirationValue = this.expiration;

      if (this.isRegularType()) {
        // Get the crumb with the latest expiration
        for (var i = 0; i < this.crumbArray.length; i++) {
          if (currentExpirationValue < (this.crumbArray[i].getExpiration())) {
            currentExpirationValue = this.crumbArray[i].getExpiration();
          }
        }
      }

      if ((parseInt(currentExpirationValue, 10) - date.getTime() > (24 * 60 * 60 * 1000))) {
        // Convert milliseconds back into days
        this.expiration = currentExpirationValue;
      } else {
        // Expire cookies after one day
        this.expiration = date.getTime() + (24 * 60 * 60 * 1000);
      }
    }
  };

  /*
      This function will check if the crumb already exists
      and then attempt to remove it. Then it will add the crumb
      to the master cookie
  */
  cookieUtils.MasterCookie.prototype.addCrumb = function addCrumb(crumb) {
    if (crumb !== null && crumb instanceof cookieUtils.CookieCrumb) {
      var crumbName = crumb.getName();
      for (var i = 0; i < this.crumbArray.length; i++) {
        if (this.crumbArray[i].getName() === crumbName) {
          this.removeCrumb(crumbName);
        }
      }
      this.crumbArray.push(crumb);
      this.updateToLatestExpiration();
    }
  };


  /*
    This function will remove a crumb from the master cookie
    and adjust the expiration date based on the cooies inside of it.
  */
  cookieUtils.MasterCookie.prototype.removeCrumb = function removeCrumb(crumbName) {
    for (var i = 0; i < this.crumbArray.length; i++) {
      if (this.crumbArray[i].getName() === crumbName) {
        this.crumbArray.splice(i, 1);
      }
    }

    if (this.isRegularType()) {
      // Set expiration of master cookie to default value defined in config
      // if there are no crumbs left
      if (this.crumbArray.length === 0) {
        this.expiration = new Date().getTime() + (this.configExpiration * 1000);
      } else {
        this.updateToLatestExpiration();
      }
    }
  };

  /*
      Returns the requested crumb to the caller
      If not found, returns null.
  */
  cookieUtils.MasterCookie.prototype.getCrumb = function getCrumb(crumbName) {
    for (var i = 0; i < this.crumbArray.length; i++) {
      if (this.crumbArray[i].getName() === crumbName) {
        if (this.isRegularType()) {
          // Remove the crumb if it has already expired
          if (Number(this.crumbArray[i].getExpiration()) !== -1) {
            var date = new Date();
            if (this.crumbArray[i].getExpiration() < date.getTime()) {
              this.crumbArray.splice(i, 1);
              break;
            }
          }
        }
        return this.crumbArray[i];
      }
    }
    // Crumb was not found or has expired
    return null;
  };

  /*
      This will convert the string representation of the current
      master cookie instance into a browser cookie
  */
  cookieUtils.MasterCookie.prototype.makeCookieString = function makeCookieString() {
    var expiresValue = '';

    if (this.expiration !== null && String(this.expiration) !== '' && parseInt(this.expiration, 10) > 0) {
      var date = new Date();
      date.setTime(parseInt(this.expiration, 10));
      expiresValue = '; expires=' + date.toGMTString();
    } else if (parseInt(this.expiration, 10) === -1) {
      expiresValue = '; expires=-1';
    } else {
      expiresValue = ';';
    }

    var pathValue;
    if (this.path !== null && this.path !== '') {
      pathValue = '; path=' + this.path;
    } else {
      pathValue = ';';
    }

    var domainValue;
    if (this.cookieDomain !== null && this.cookieDomain !== '') {
      domainValue = '; domain=' + this.cookieDomain;
    } else {
      domainValue = ';';
    }

    return this.name + '=' + cookieUtils._escapeCookie(this.makeCookieCrumbString()) + pathValue + domainValue + expiresValue;
  };


  /*
      Sort the crumbs based on name
  */
  cookieUtils.MasterCookie.prototype.sortCrumbs = function sortCrumbs(a, b) {
    var crumbAName = a.getName();
    var crumbBName = b.getName();
    var sortA = parseInt(crumbAName.substr(1), 10);
    var sortB = parseInt(crumbBName.substr(1), 10);

    if (sortA < sortB) {
      return -1;
    }
    if (sortA === sortB) {
      return 0;
    }
    if (sortA > sortB) {
      return 1;
    }
    return null;
  };


  /*
      This will convert all the cookie crumbs into a string
      that will get set to the value of the containing master cookie
  */
  cookieUtils.MasterCookie.prototype.makeCookieCrumbString = function makeCookieCrumbString() {
    var crumbString = '';
    this.crumbArray.sort(this.sortCrumbs);
    for (var i = 0; i < this.crumbArray.length; i++) {
      if (crumbString !== '') {
        crumbString += this.delimiter;
      }
      crumbString += this.crumbArray[i].getName() + this.equals + this.crumbArray[i].getValue();

      var crumbExp = this.equals;
      if (this.isRegularType()) {
        crumbExp += this.crumbArray[i].getExpirationInSeconds();
      }

      crumbString += this.delimiter + this.crumbArray[i].getName() + this.expirationSuffix + crumbExp;
    }
    return crumbString;
  };


  /*
      Parse the value into crumbs based off of the delimiter
  */
  cookieUtils.MasterCookie.prototype.initialize = function initialize() {
    if (this.value !== null && this.value !== '') {
      var cookieCrumbArray = this.value.split(this.delimiter);

      for (var i = 0; i < cookieCrumbArray.length; i = i + 2) {
        var crumbString = cookieCrumbArray[i];
        var index = crumbString.indexOf(this.equals);
        var name = crumbString.substring(0, index);
        var value = crumbString.substring(index + 1, crumbString.length);

        var crumbObject = null;
        var crumbExpiration = '';

        if (this.isRegularType()) {
          // Parse Expiration info
          crumbString = cookieCrumbArray[i + 1];
          // Defect # 8794
          if (crumbString !== null && typeof crumbString !== 'undefined') {
            index = crumbString.indexOf(this.equals);
            crumbExpiration = crumbString.substring(index + 1, crumbString.length);
          }

          if (Number(crumbExpiration) !== -1) {
            // Convert seconds back into milliseconds since that is what the interface specifies
            crumbExpiration = parseInt(crumbExpiration, 10) * 1000;
            crumbObject = new cookieUtils.CookieCrumb(name, value, null);
            crumbObject.setExpiration(crumbExpiration);
          } else {
            crumbObject = new cookieUtils.CookieCrumb(name, value, crumbExpiration);
          }
        } else {
          crumbObject = new cookieUtils.CookieCrumb(name, value, null);
          crumbObject.setExpiration('');
        }
        this.addCrumb(crumbObject);
      }
    }

    // Initialize the real expiration date of cookie here
    if (Number(this.expiration) !== -1) {
      var date = new Date();
      this.expiration = parseInt(this.configExpiration, 10) + date.getTime();
    }

    this.updateToLatestExpiration();
  };

  /*
    Creates a CookieCrumb object that contains info about a logical cookie
    Expiration for each cookie crumb is stored in milliseconds where the value will be
    cookie crumb expiration = expiration(milliseconds) + current time(milliseconds).
    PARAMETER: name - The name of the crumb.
    PARAMETER: value - The unparsed value of the crumb.
    PARAMETER: expiration - The number of days until the cookie expires
  */
  cookieUtils.CookieCrumb = function CookieCrumb(name, value, expiration) {
    // console.log('CookieCrumb Running');

    this.name = name;
    this.value = value;

    // console.log(this.value)

    // A null expiration means that the expiration value should be set explicitly
    // by calling the setExpiration method
    if (expiration !== null) {
      if (expiration !== '' && expiration > 0) {
        var date = new Date();
        date.setTime(date.getTime() + (parseInt(expiration * 24 * 60, 10) * 60 * 1000));
        this.expiration = date.getTime();
      } else if (expiration < 0 || expiration === '') {
        // This means the cookie is a session crumb
        this.expiration = -1;
      } else {
        // A zero means to expire the crumb
        this.expiration = 0;
      }
    }
  };

  cookieUtils.CookieCrumb.prototype.getName = function getName() {
    return this.name;
  };

  cookieUtils.CookieCrumb.prototype.getValue = function getValue() {
    return this.value;
  };

  cookieUtils.CookieCrumb.prototype.getExpiration = function getExpiration() {
    return this.expiration;
  };

  /*
      PARAMETER: expiration - The number of miliseconds until the cookie expires
  */
  cookieUtils.CookieCrumb.prototype.setExpiration = function setExpiration(expiration) {
    this.expiration = expiration;
  };

  cookieUtils.CookieCrumb.prototype.getExpirationInSeconds = function getExpirationInSeconds() {
    if (this.expiration !== null && String(this.expiration) !== '' && Number(this.expiration) !== -1) {
      return parseInt(this.expiration / 1000, 10);
    }
    return this.expiration;
  };


  // Uses CookieManager to return
  cookieUtils.readCookie = function readCookie(name) {
    if (cookieUtils.cookieManager) {
      return cookieUtils.cookieManager.readCookie(name);
    }
    return null;
  };

  // Returns an object that contains the `E<n>` values from the
  // `THD_ONLINE_CHANNEL cookie
  // {E1:S8,E2:S8}
  cookieUtils.getChannelCookie = function getChannelCookie() {
    var channelCookie = cookieUtils.readCookie('THD_ONLINE_CHANNEL');
    var tmp = {};
    if (channelCookie && channelCookie.length) {
      var parts = channelCookie.split('::');
      // E1=S8::E2=S3...
      for (var i = 0; i < parts.length; i++) {
        var e = parts[i];
        var eParts = e.split('=');
        if (eParts.length) {
          tmp[eParts[0]] = eParts[1];
        }
      }
    }
    return tmp;
  };

  /*
   *   Function: getTHDUserName
   *       This function will get the username from the THD_USERNAME cookie crumb.
   *   Returns:
   *       This function returns the username of the logged in user.
   */
  cookieUtils.getTHDUserName = function getTHDUserName() {
    return cookieUtils.readCookie('THD_USERNAME');
  };

  cookieUtils.getTHDTotalCartAmount = function getTHDTotalCartAmount() {
    // The total dollar amount in the shopping cart
    return cookieUtils.readMiniCartCookie('D1');
  };

  /*
   *  Function: getTHDNumberItemsInCart
   *      This function calls the readMiniCartCookie() to get the I1 attribute of JSON object.
   *  Returns:
   *      This function returns nbrOfItemsInCart.
   */

  cookieUtils.getTHDNumberItemsInCart = function getTHDNumberItemsInCart() {
    // The number of items in the shopping cart
    return cookieUtils.readMiniCartCookie('I1');
  };

  /*
   *  Function: readMiniCartCookie
   *      This is a generic method to get read the THD_MINICART cookie crumb and return the attributes
   *      of the JSON object.
   *  Parameter: param
   *      This parameter defines the attribute of the JSON object.
   *  Returns:
   *      This function returns the attributes of the JSON object based on the input passed.
   */

  cookieUtils.readMiniCartCookie = function readMiniCartCookie(param) {
    var miniCartJsonStr = cookieUtils.readCookie('THD_MINICART');
    if (hasValue(miniCartJsonStr)) {
      var miniCartJsonObj = {};
      /*eslint-disable*/
      eval('miniCartJsonObj = ' + miniCartJsonStr + ';');
      /*eslint-enable*/
      // Get the JSON attribute based on the passed parameter

      if (param === 'D2') {
        return miniCartJsonObj.D2;
      } else if (param === 'I1') {
        return miniCartJsonObj.I1;
      } else if (param === 'F1') {
        return miniCartJsonObj.F1;
      } else if (param === 'D1') {
        return miniCartJsonObj.D1;
      } else if (param === 'F2') {
        return miniCartJsonObj.F2;
      }
    }
    return '';
  };

  cookieUtils.setZipCodeCookies = function setZipCodeCookies(zipcode, expiry, domain) {
    cookieUtils.setMobileCookie('THD_APPLIANCE_ZIPCODE', zipcode, expiry, domain);
    cookieUtils.setMobileCookie('THD_BODFS_ZIPCODE', zipcode, expiry, domain);
  };

  cookieUtils.getURLParameters = function getURLParameters() {
    var s1 = location.search.substring(1, location.search.length).split('&');
    var r = {};
    var s2;
    var i;
    for (i = 0; i < s1.length; i += 1) {
      s2 = s1[i].split('=');
      r[decodeURIComponent(s2[0]).toLowerCase()] = decodeURIComponent(s2[1]);
    }
    return r;
  };

  /* Parses the WC cookie  */

  cookieUtils.getWCSCookieVal = function getWCSCookieVal(cookieAlias) {
    var browserCookies = document.cookie.split('; ');
    var allCookies = browserCookies.length;
    var i;
    var wcsCookie;

    for (i = allCookies - 1; i >= 0; i -= 1) {
      if (browserCookies[i].indexOf(cookieAlias) === 0) {
        wcsCookie = browserCookies[i].split('=')[0];
        wcsCookie = cookieUtils.readBrowserCookie(wcsCookie);

        if (wcsCookie) {
          return wcsCookie.split(',')[0];
        }
      }
    }
    return null;
  };

  // Returns Store number from C4
  cookieUtils.getStoreNum = function getStoreNum() {
    var storeAddress = cookieUtils.readCookie('THD_LOCSTORE');
    var currentStore;

    if (!storeAddress) {
      return '';
    }

    currentStore = storeAddress.split('+')[0] || '';
    return currentStore;
  };

  // method for utf8 decoding used by decodingBase64 method to decode base64 string.
  privateMethods.utf8_decode = function _utf8Decode(utftxt) {
    var outputText = '';
    var index = 0;
    var char1;
    var char2;
    var char3;
    char1 = char2 = char3 = 0;

    while (index < utftxt.length) {
      char1 = utftxt.charCodeAt(index);

      if (char1 < 128) {
        outputText += String.fromCharCode(char1);
        index++;
      } else if ((char1 > 191) && (char1 < 224)) {
        char2 = utftxt.charCodeAt(index + 1);
        outputText += String.fromCharCode(((char1 & 31) << 6) | (char2 & 63));
        index += 2;
      } else {
        char2 = utftxt.charCodeAt(index + 1);
        char3 = utftxt.charCodeAt(index + 2);
        outputText += String.fromCharCode(((char1 & 15) << 12) | ((char2 & 63) << 6) | (char3 & 63));
        index += 3;
      }
    }

    return outputText;
  };

  // method decodingBase64 method to decode base64 string.
  privateMethods.decodeBase64 = function _decodeBase64(cookieString) {
    var _keyStr = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';
    var output = '';
    var char1;
    var char2;
    var char3;
    var encodedChar1;
    var encodedChar2;
    var encodedChar3;
    var encodedChar4;
    var i = 0;

    cookieString = cookieString.replace(/[^A-Za-z0-9\+\/\=]/g, '');

    while (i < cookieString.length) {
      encodedChar1 = _keyStr.indexOf(cookieString.charAt(i++));
      encodedChar2 = _keyStr.indexOf(cookieString.charAt(i++));
      encodedChar3 = _keyStr.indexOf(cookieString.charAt(i++));
      encodedChar4 = _keyStr.indexOf(cookieString.charAt(i++));

      char1 = (encodedChar1 << 2) | (encodedChar2 >> 4);
      char2 = ((encodedChar2 & 15) << 4) | (encodedChar3 >> 2);
      char3 = ((encodedChar3 & 3) << 6) | encodedChar4;

      output = output + String.fromCharCode(char1);

      if (encodedChar3 != 64) {
        output = output + String.fromCharCode(char2);
      }
      if (encodedChar4 != 64) {
        output = output + String.fromCharCode(char3);
      }
    }

    output = privateMethods.utf8_decode(output);

    return output;
  };

  cookieUtils.getSVOCID = function _getSVOCID() {
    var userCookie = cookieUtils.readCookie('THD_USER');
    var getUserID = function _getUserID(val) {
      var SVOCObj = JSON.parse(privateMethods.decodeBase64(val));
      return (typeof SVOCObj === 'object' && typeof SVOCObj.svocCustomerAccountId !== 'undefined') ? SVOCObj.svocCustomerAccountId : '';
    };
    return (userCookie) ? getUserID(userCookie) : '';
  };

  privateMethods.convertCrumbsToJson = function _convertCrumbsToJson(crumbs) {
    var propName = null;
    var crumbData = crumbs.reduce(
      function _reduce(a, b) {
        if (propName) {
          a[propName] = b;
          propName = null;
        } else {
          propName = b;
        }
        return a;
      }, {});

    return crumbData;
  };

  // Returns Adobe Cookie as Json Data
  cookieUtils.getAdobeCrumbs = function _getAdobeCrumbs() {
    var theCookie = cookieUtils.readCookie('AMCV_F6421253512D2C100A490D45%40AdobeOrg');
    var crumbs = (theCookie) ? theCookie.split('|') : [];
    if (crumbs.length > 1) {
      crumbs.shift(); // custom for adobe kill first value
    }

    return privateMethods.convertCrumbsToJson(crumbs);
  };

  return cookieUtils;
}));


//Defining closure to avoid variables and function leakages
(function closure(root, factory) {
  if (typeof define === 'function' && define.amd) {
    define('account.device.utility',[
      'jquery'
    ], function load(jQuery) {
      return factory(root, jQuery);
    });
  } else {
    // For non-AMD module, expose this to global (will also be useful for test cases)
    /*eslint-disable*/
    factory(root, jQuery);
    /*eslint-enable*/
  }
})(this, function factory(root, $) {

  var getHostNameSecure = function() {
	  return ( (THD_GLOBAL && THD_GLOBAL.nonSecureHostName)
			  ? THD_GLOBAL.nonSecureHostName
			  : 'www.homedepot.com');
  };

  return {
    getHostNameSecure : getHostNameSecure
  };
});
/**
 * @Description: Helps to hold the constants for Authentication module
 **/
(function closure(root, factory) {
    if (typeof define === 'function' && define.amd) {
        define('auth.constants',[
            'jquery',
            'account.device.utility'
        ], function load(jQuery, deviceUtility) {
            return factory(root, jQuery, deviceUtility);
        });
    } else {
        // For non-AMD module, expose this to global (will also be useful for test cases)
        /*eslint-disable*/
        factory(root, jQuery, deviceUtility);
        /*eslint-enable*/
    }
})(this, function factory(root, $, deviceUtility) {

    var ERROR = {
        EMAIL_EMPTY_ERR: 'Please provide your email address.',
        EMAIL_FORMAT_ERR: 'Please provide your email address, formatted as you@domain.com.',
        PASSWORD_EMPTY_ERR: 'Please provide your password.',
        SIGNIN_USER_PASS_NOMATCH: 'Your email and password combination didn\'t match our records. Please try again.',
        SIGN_GENERIC_ERROR: 'There was a temporary technical issue. Please try again shortly.', //need to be changed once we get the UX
		SIGNIN_ACCOUNT_TO_BE_LOCKED: 'Your account will be locked after one more unsuccessful log in attempt. If you\'ve forgotten your password, you may change it using the link below.',
		SIGNIN_ACCOUNT__LOCKED: 'For your protection, we\'ve locked your account for a short period of time. You may try logging in again in 15 minutes. If you\'ve forgotten your password, you may change it using the link below.',
        REGISTER_FIRST_NAME_EMPTY_ERR: 'First name is required. Please enter your first name.',
        REGISTER_FIRST_NAME_INVALID_ERR: 'Please enter a first name using only letters A-Z.',
        REGISTER_LAST_NAME_EMPTY_ERR: 'Last name is required. Please enter your last name.',
        REGISTER_LAST_NAME_INVALID_ERR: 'Please enter a last name using only letters A-Z.',
        REGISTER_ZIPCODE_EMPTY_ERR: 'ZIP code is required. Please enter a valid five-digit ZIP code.',
        REGISTER_ZIPCODE_INVALID_ERR: 'Please enter a valid 5-digit ZIP Code.',
        REGISTER_EMAIL_EXISTS_ERR: 'This email address is already registered. <a href="javascript:void(0)" data-myaccountauth="true" onClick="showSignIn(false)" class="u__default-link dual-sign-in-pop-up">Sign in here.</a>',
        REGISTER_PASSWORD_INVALID_ERR: 'Passwords must be a minimum of 8 characters in length and are case sensitive.',
        REGISTER_PASSWORD_WEAK_ERR: 'Weak passwords cannot be saved. Please ensure that your password is more than 8 characters and is not a commonly used password.',
        REGISTER_CONFIRM_EMPTY_ERR: 'Confirming your password is required. Please re-enter your password',
        REGISTER_CONFIRM_MATCH_ERR: 'Your passwords don\'t match. Please enter the same password in both fields.',
        REGISTER_CONFIRM_EMPTY_ERR_IAM: 'Please confirm your password.',
        REGISTER_EMAIL_EXISTS_ERR_IAM: 'This email has already been registered.',
        REGISTER_PASSWORD_WEAK_ERR_IAM: 'Please create a stronger password using the guidelines below.',
        REGISTER_PASSWORDS_MISMATCH: 'These passwords don\'t match. Please try re-entering your password.',
        REGISTER_BLOCKED: 'Due to technical issues we cannot create an account.',

        /*Pro Upgrade errors*/
        PRO_BUSINESS_NAME_EMPTY_ERR: 'Please provide your company name.',
        PRO_BUSINESS_NAME_LENGTH_ERR: 'Please enter a Company Name between 3 and 99 characters.',
        PRO_BUSINESS_NAME_INVALID_CHAR_ERR: 'You have entered an invalid character. Only a-z,.*#().;@/\' are allowed. Please try again.',
        PRO_MANDATORY_CUSTOMER_ADDRESS_ERR: 'Please provide your address.',
        PRO_ADDRESS_SPL_CHARS_ERR: 'You have entered an invalid character as part of your address. Only a-z, 0-9, ! @ # $ % ^ ( ) - _ + = , . ? \" \' \\ : are allowed. Please try again.',
        PRO_MANDATORY_ZIPCODE_ERR: 'Please provide your 5-digit ZIP Code.',
        PRO_INVALID_ZIPCODE_ERR: 'ZIP Code must be 5 digits.',
        PRO_BUSINESS_TRADE_ERR: 'Business or Trade required',
        PRO_ZIP_CODE_BACKEND_ERR: 'Zip Code Error!  Please enter a valid zip code.',
        PRO_MANDATORY_PHONE_NUMBER: 'Please provide your 10-digit phone number.',
        PRO_INVALID_PHONE_NUMBER: 'Phone numbers must be 10 digits.',
        PRO_HOMEDEPOT_MAIL_ERR: 'You can\'t register as a Pro customer with a homedepot.com email address.',
        ERR_PRO_PHONE: 'We\'re sorry. This phone number has already been registered. Please provide a different phone number, or call 1-866-333-3551 for assistance.',
        ERR_USED_PHONE: "Were sorry, This phone number is already registered.",

        ERR_GENERIC_MESSAGE: "We're sorry. There was a temporary technical issue. Please try again shortly.",

		REGISTER_SET_PASSWORD_ERR: 'We\'ve noticed you already have an account but haven\'t set a password.',
        ERR_SET_PASSWORD_SIGNIN: 'We\'ve noticed you haven\'t set a password for this account.'
    };



    var URLS = {
                AUTH_SIGNIN_URL_IAM: 'https://' + deviceUtility.getHostNameSecure() + '/customer/account/v1/login',
                AUTH_SIGNIN_URL_IAM2: 'https://' + deviceUtility.getHostNameSecure() + '/customer/account/v1/signIn',
                AUTH_SECURED_SIGNIN: 'https://' + deviceUtility.getHostNameSecure() + '/customer/account/v1/securedSignIn',
                AUTH_SIGNOUT_URL: 'https://' + deviceUtility.getHostNameSecure() + '/customer/account/v1/session/logout',
                AUTH_SIGNOUT_URL_B2B: 'https://' + deviceUtility.getHostNameSecure() + '/b2b/user/account/session/logout',
                AUTH_NEW_REGISTER_URL_IAM: 'https://' + deviceUtility.getHostNameSecure() + '/customer/account/v1/signUpV2',
                AUTH_REGISTER_URL_IAM: 'https://' + deviceUtility.getHostNameSecure() + '/customer/account/v1/register',
                AUTH_REGISTER_URL_IAM2: 'https://' + deviceUtility.getHostNameSecure() + '/customer/account/v1/signUp',
                RESET_PASSWORD_PATH_IAM: 'https://' + deviceUtility.getHostNameSecure() + '/account/view/forgotpassword',
                EMAIL_VERIFICATION_URL_GCP: 'https://' + deviceUtility.getHostNameSecure() + '/customer/account/v1/checkEmailExists',
                EMAIL_VERIFICATION_URL_GCP2: 'https://' + deviceUtility.getHostNameSecure() + '/customer/account/v1/checkCustomerExists',
                VERA_ZIP_URL: 'https://' + deviceUtility.getHostNameSecure() + '/customer/account/v1/zipCode',
                CUSTOMER_PREFERENCES_URL: 'https://' + deviceUtility.getHostNameSecure() + '/customer/account/v1/',
                ACCOUNT_PROFILE_PATH: 'https://' + deviceUtility.getHostNameSecure() + '/account/view/profile',
    			      SET_PASSWORD_EMAIL_URL: 'https://' + deviceUtility.getHostNameSecure() + '/customer/account/v1/setPasswordEmail',
                REDIRECT_SET_PWD_EMAIL_PAGE: 'https://' + deviceUtility.getHostNameSecure() + '/account/view/setpasswordemail',
                LOGON_PAGE_URL: 'https://' + deviceUtility.getHostNameSecure() + '/account/view/logon',
                REGISTER_PAGE_URL: 'https://' + deviceUtility.getHostNameSecure() + '/account/view/register',

                PAGE_URL: 'https://' + deviceUtility.getHostNameSecure() + '/account/view/dual/srm',
                RESET_PASSWORD_PAGE_URL: 'https://' + deviceUtility.getHostNameSecure() + '/account/view/dual/resetpassword',
                VERIFY_PHONE_PAGE_URL: 'https://' + deviceUtility.getHostNameSecure() + '/account/view/dual/verifyphone',
                AUTH_SIGNIN_URL: 'https://' + deviceUtility.getHostNameSecure() + '/webapp/wcs/stores/servlet/THDAPIController',
                AUTH_REGISTER_URL: 'https://' + deviceUtility.getHostNameSecure() + '/webapp/wcs/stores/servlet/THDAPIUserRegistration',
                AUTH_REGISTER_LITE_URL: 'https://' + deviceUtility.getHostNameSecure() + '/webapp/wcs/stores/servlet/UserRegistrationLite',
                GUEST_AUTH_TOKEN_URL: 'https://' + deviceUtility.getHostNameSecure() + '/webapp/wcs/stores/servlet/THDAPIController?client_id=internal_test&channel=INTERNAL_API&client_type=internal&response_type=activity&businessChannelId=-1&requesttype=ajax',
                EMAIL_VERIFICATION_URL: 'https://' + deviceUtility.getHostNameSecure() + '/webapp/wcs/stores/servlet/THDMemberService?storeId=10051&langId=-1&catalogId=10053&command=isUnique&v=2',
                RESET_PASSWORD_PATH: 'https://' + deviceUtility.getHostNameSecure() + '/webapp/wcs/stores/servlet/ResetPasswordForm?storeId=10051&langId=-1&catalogId=10053',
                REQUEST_OTP_PATH: 'https://' + deviceUtility.getHostNameSecure() + '/customer/account/v1/resetPasswordOTPEmail?email=',
                SET_PASSWORD_PATH: 'https://' + deviceUtility.getHostNameSecure() + '/customer/account/v1/setPasswordOTPEmail?email=',
                VERIFY_OTP_PATH: 'https://' + deviceUtility.getHostNameSecure() + '/customer/account/v1/verifyOTP',
                CHANGE_PASSWORD_PATH: 'https://' + deviceUtility.getHostNameSecure() + '/customer/account/v1/',
                CHECKOUT_SIGNIN_PATH: 'https://' + deviceUtility.getHostNameSecure() + '/mycheckout/signin#/signin',
                CHECKOUT_SIGNIN_PERSISTENT_PATH: 'https://' + deviceUtility.getHostNameSecure() + '/mycheckout/signin#/persistent',
                CHECKOUT_SIGNIN: 'https://' + deviceUtility.getHostNameSecure() + '/mycheckout/signin',
                CHECKOUT_PATH: 'https://' + deviceUtility.getHostNameSecure() + '/mycheckout/checkout',
                MYACCOUNT_CHECKOUT_SIGNIN_PATH: 'https://' + deviceUtility.getHostNameSecure() + '/account/view/checkout-signin',
                B2X_ACCOUNT_PROFILE_PATH: 'https://' + deviceUtility.getHostNameSecure() + '/b2b/account/view/landingpage',
                B2B_ACCOUNT_PROFILE_PATH: 'https://' + deviceUtility.getHostNameSecure() + '/b2b/account/view/homepage',
                B2B_ACCOUNT_SELECTOR_PATH: 'https://' + deviceUtility.getHostNameSecure() + '/b2b/account/view/sas'

    };


    return {
        URLS: URLS,
        ERROR: ERROR,
        COOKIE_NONTLS_THD_AUTHORIZATION_TOKEN: "NONTLS_THD_AUTHORIZATION_TOKEN",
        COOKIE_THD_USER_AUTH_STATUS: "THD_USER_AUTH_STATUS",
        COOKIE_THD_AUTHORIZATION_TOKEN: "THD_AUTHORIZATION_TOKEN",
        COOKIE_MYLIST_THROTTLE: "MYLIST_THROTTLE",
        COOKIE_EXPIRY_ONE_YEAR: 365,
		COOKIE_THD_USER_SESSION: "THD_USER_SESSION",
		COOKIE_THD_USER: "THD_USER",
        COOKIE_USER_EMAIL: "THD_USEREMAIL",
        COOKIE_THD_CUSTOMER: "THD_CUSTOMER"
    }

});
/**
 * @Description: Helps to hold the utility methods for Authentication module
 **/
(function closure(root, factory) {
    if (typeof define === 'function' && define.amd) {
        define('auth.helper',[
            'jquery',
            'account.device.utility',
            'cookie-utils'
        ], function load(jQuery, deviceUtility, cookieUtils) {
            return factory(root, jQuery, deviceUtility, cookieUtils);
        });
    } else {
        // For non-AMD module, expose this to global (will also be useful for test cases)
        /*eslint-disable*/
        factory(root, jQuery, deviceUtility, cookieUtils);
        /*eslint-enable*/
    }
})(this, function factory(root, $, deviceUtility, cookieUtils) {
	
    var isMobileChannel = false,
        channelId = "1",
        clientToken = 'hat_env',
        clientId = 'hat_env_id',
        clientTS = 'hat_env_ts',
        hatFlag = 'hat_env_active';
    
    window.clientTS = null;

    /**
     * @Description: Validate Email Address for proper format
     *
     * @Param: emailAddress - Value to be validated
     **/
    var validateEmpty = function (inputText) {
        return (!inputText || inputText === '');
    }

    var isValidName = function (value) {
        return value.match(/^[\w]+?[ \w]+$/);
    }

    var validateMinLength = function (value, minLength) {
        value = (value) ? '' + value : '';
        return (value.length < Number(minLength));
    }

    var validateZipcode = function (value) {
        return value.match(/^\d{5}(-\d{4})?$/);
    }

    var validateEmailAddress = function (emailAddress) {
        var regex = /^([a-zA-Z0-9_.-])+@((([a-zA-Z0-9-])+\.){1,3})([a-zA-Z]{2,20})$/;
        return regex.test($.trim(emailAddress));
    };
    var checkHomeDepotMail = function (emailAddress) {
        if(emailAddress.indexOf("homedepot.com") >=0){
        	return false;
        }else{
        	return true;
        }
    };
    
    /*Validations for Pro Upgrade fields*/
    var companyNameLengthValidator = function (value) {
       if(value.length<3 || value.length >99){
    	   return false;
       }else{
    	   return true;
       }
    };
    
    var companySplCharValidator = function (value) {
        if(value.match(/^[a-zA-Z.*#().;@/' ]+$/)){
     	   return true;
        }else{
     	   return false;
        }
     };
    
     var addressSplCharValidator = function (value) {
         if(value.match(/^[a-zA-Z\d\-_.,!@#$%^()+=? \"'\\ :\s]+$/)){
      	   return true;
         }else{
      	   return false;
         }
      };
      
      var zipCodeValidator = function (value) {
          if(value.match(/^\d{5}$/)){
       	   return true;
          }else{
       	   return false;
          }
       };
       
       var addressSplCharValidator = function (value) {
           if(value.match(/^[a-zA-Z\d\-_.,!@#$%^()+=? \"'\\ :\s]+$/)){
        	   return true;
           }else{
        	   return false;
           }
        };
       
        var phoneNumberValidator = function(value){
        	var text = value.replace(/[^\d]/g, '');	
        	if((text.length)!=10){
        		return false;
        	}else{
        		return true;
        	}
        }
       
    

    /*Feature Swicth AJAX Call*/
    var triggerFeatureSwitchCall = function () {
        var options = {
            type: 'GET',
            url: 'https://' + deviceUtility.getHostNameSecure() +'/TouchWebServices/v2/util/feature?featureId=RegistrationLiteFeature&featureId=MCMListDesktopFeature&featureId=MCMListMobileFeature&featureId=MCM_SVOC_FEATURE&featureId=MCM_IAM_FEATURE&featureId=MCM_XREF_FEATURE',
            contentType: 'application/json',
            accept: 'application/json',
            dataType: 'json',
            xhrFields: {
                withCredentials: true
            },
            crossDomain: true
        };

       return $.ajax(options);
    };
    
    var getChannelId = function () {
	     if(isMobileChannel) {
	    	 channelId = '2';
	     } else {
	    	 channelId = '1';
	     }
	     return channelId;
    };
    
    var getClientInfo = function() {
    	var elToken = $('div#authenticationDualSignin').find('#' + clientToken),
    		elId = $('div#authenticationDualSignin').find('#' + clientId),
    		elTS = $('div#authenticationDualSignin').find('#' + clientTS),
    		elhatFlag = $('div#authenticationDualSignin').find('#' + hatFlag),
    		$clientInfo = {
    			flag : ( elhatFlag ? (elhatFlag.val() === 'true') : false )
    		};
    	
    	//Element is not there, consider it as off scenario
    	if ( $clientInfo.flag ) {
    		$clientInfo['tHat'] = $.trim(elToken.val()) ? $.trim(elToken.val()) : null;
    		$clientInfo['id'] = $.trim(elId.val()) ? $.trim(elId.val()) : null;
    		$clientInfo['ts'] = $.trim(elTS.val()) ? $.trim(elTS.val()) : null;
    	}
    	return $clientInfo;
    }
    
    var setStartTimestamp = function() {
    	window.clientTS = new Date().getTime();
    }
    
    var getClientDelay = function(startTime) {
    	var $clientInfo = getClientInfo(),
    		delay = 0;
    	if ($clientInfo.flag) {
    		// OR condition to handle null/undefined scenario for client TS
    		var startTime = window.clientTS || (new Date().getTime()),
    			endTime = new Date().getTime();
    		delay = Math.round( ((endTime - startTime)/1000) );
    	}
    	return delay;
    }

    var setIsMobileChannel = function (value) {
	    isMobileChannel = value;
    };

    var businessTrade = [{ "typeEnumeration": "CARPENTER","typeCode": 123,"typeDescription": "Carpenters"},
                        {"typeEnumeration": "CO PR MGRS","typeCode": 121,"typeDescription": "Comm Prop Mgrs"},
                        {"typeEnumeration": "COMM CONST","typeCode": 110,"typeDescription": "Commercial Constr."},
                        {"typeEnumeration": "ELECTR","typeCode": 104,"typeDescription": "Electrician"},
                        {"typeEnumeration": "EXP","typeCode": 127,"typeDescription": "Exporter"},
                        {"typeEnumeration": "FENCE INST","typeCode": 125,"typeDescription": "Fence Installer"},
                        {"typeEnumeration": "GOV","typeCode": 119,"typeDescription": "Government"},
                        {"typeEnumeration": "HANDYMAN","typeCode": 124,"typeDescription": "Handyman"},
                        {"typeEnumeration": "HOSP","typeCode": 111,"typeDescription": "Hospitality"},
                        {"typeEnumeration": "HOUS AUTH","typeCode": 120,"typeDescription": "Housing Authority"},
                        {"typeEnumeration": "INST","typeCode": 116,"typeDescription": "Institutional"},
                        {"typeEnumeration": "LANDSCAPER","typeCode": 122,"typeDescription": "Landscapers"},
                        {"typeEnumeration": "MFG","typeCode": 117,"typeDescription": "Manufacturing"},
                        {"typeEnumeration": "MLTFAMBLDR","typeCode": 118,"typeDescription": "Multi-Family Builder"},
                        {"typeEnumeration": "MOTION PIC","typeCode": 129,"typeDescription": "TV/Movie Productions"},
                        {"typeEnumeration": "NP ORGS","typeCode": 126,"typeDescription": "Non-Profit Orgs"},
                        {"typeEnumeration": "OTHER","typeCode": 99,"typeDescription": "Other"},
                        {"typeEnumeration": "PAINTER","typeCode": 107,"typeDescription": "Painter"},
                        {"typeEnumeration": "PLUMBER","typeCode": 102,"typeDescription": "Plumber"},
                        {"typeEnumeration": "PROP INV","typeCode": 115,"typeDescription": "Property Investor"},
                        {"typeEnumeration": "PROP MGMT","typeCode": 114,"typeDescription": "Property Manager"},
                        {"typeEnumeration": "REMODELER","typeCode": 101,"typeDescription": "Remodeler"},
                        {"typeEnumeration": "ROOFER","typeCode": 106,"typeDescription": "Roofer"},
                        {"typeEnumeration": "SPEC REST","typeCode": 113,"typeDescription": "Spec. Restoration"},
                        {"typeEnumeration": "SF BUILDER","typeCode": 112,"typeDescription": "Single Family Bldr"}]

    return {
        validateEmailAddress: validateEmailAddress,
        checkHomeDepotMail: checkHomeDepotMail,
        isValidName: isValidName,
        validateZipcode: validateZipcode,
        validateEmpty: validateEmpty,
        validateMinLength: validateMinLength,
        companyNameLengthValidator: companyNameLengthValidator,
        companySplCharValidator: companySplCharValidator,
        addressSplCharValidator: addressSplCharValidator,
        zipCodeValidator: zipCodeValidator,
        phoneNumberValidator: phoneNumberValidator,
        triggerFeatureSwitchCall: triggerFeatureSwitchCall,
        businessTrade : businessTrade,
        isFeatureSwitchPresent : function() { return true; /*sessionStorage.hasOwnProperty('MCM_IAM_FEATURE');*/ },
        isIAMThrottled : function(){ return true; /*(  sessionStorage && (sessionStorage.getItem('MCM_IAM_FEATURE') === '1')) */ },
        isSVOCThrottled : function(){ return true; /*(sessionStorage && (sessionStorage.getItem('MCM_SVOC_FEATURE') === '1')) */},
        isXREFThrottled : function() { return true; /*(sessionStorage && (sessionStorage.getItem('MCM_XREF_FEATURE') === '1')) */ },
        getChannelId: getChannelId,
        setIsMobileChannel: setIsMobileChannel,
        getClientInfo: getClientInfo,
        setStartTS : setStartTimestamp,
        getClientDelay : getClientDelay
    };
});
/**
* The JS holds the services that are used across the AMD.
* All http calls, common utility functions etc.. can go into this file
**/

//Defining closure to avoid variables and function leakages
(function closure(root, factory) {
  if (typeof define === 'function' && define.amd) {
    define('account.utility',[
      'jquery',
      'cookie-utils',
      'auth.constants',
      'auth.helper'
    ], function load(jQuery, cookieUtils, Constants, authHelper) {
      return factory(root, jQuery, cookieUtils, Constants, authHelper);
    });
  } else {
    // For non-AMD module, expose this to global (will also be useful for test cases)
    /*eslint-disable*/
    factory(root, jQuery, cookieUtils, Constants, authHelper);
    /*eslint-enable*/
  }
})(this, function factory(root, $, cookieUtils, Constants, authHelper) {
	
	var COOKIE_THD_USER_VALUE = "",
	  SVOC_OBJ = {},
	  SVOC_ID = "",
	  PERSISTED_THD_USER_EMAIL = "";
	  
  function getAnimatePace() {
    return 'fast';
  }

  function getAccountTermsView() {
    return 'https://www.homedepot.com/c/PH_MyAccount';
  }

  function getPrivacyView() {
    return 'https://www.homedepot.com/c/Privacy_Security';
  }
  
  function getProXtraTermsView() {
	    return 'https://hdapps.homedepot.com/CustRecogServices/sec/rs/programservice/registrationGetProgramDocument?programId=7&documentType=TERMS';
	  }

  /**
  * @Description: Helps to get the user id from WC_USERACTIVITY_{userid}
  **/
  var getUserIdFromUserActivityCookie = function() {
    return cookieUtils.getUserIdFromUserActivityCookie();
  };

  /**
  * @Description: Verify the Authorization token
  *               Empty or not
  **/
  var verifyAuthorizationToken = function() {
    return ( (cookieUtils.readCookie(Constants.COOKIE_THD_USER_SESSION) && cookieUtils.readCookie(Constants.COOKIE_THD_USER_SESSION) !== '') 
      || (cookieUtils.readCookie(Constants.COOKIE_THD_AUTHORIZATION_TOKEN) && cookieUtils.readCookie(Constants.COOKIE_THD_AUTHORIZATION_TOKEN) !== '') );
  };

  var getThrottleStatus = function() {
    return (cookieUtils.readCookie(Constants.COOKIE_MYLIST_THROTTLE) === '' || cookieUtils.readCookie(Constants.COOKIE_MYLIST_THROTTLE) === 'true');
  };

  /**
  * @Description: Helps to get the authorization token
  **/
  var getAuthorizationToken = function() {
    if(cookieUtils.readCookie(Constants.COOKIE_THD_USER_SESSION)) {
  	   return encodeURIComponent(cookieUtils.readCookie(Constants.COOKIE_THD_USER_SESSION));
  	} else if(cookieUtils.readCookie(Constants.COOKIE_THD_CUSTOMER)) {
      return JSON.parse(atob(cookieUtils.readCookie(Constants.COOKIE_THD_CUSTOMER).split('.')[0])).i;
  	} else {
         return encodeURIComponent(cookieUtils.readCookie(Constants.COOKIE_THD_AUTHORIZATION_TOKEN));
  	}
  };

  var getWCSAuthorizationToken = function() {
    return encodeURIComponent(cookieUtils.readCookie(Constants.COOKIE_THD_AUTHORIZATION_TOKEN));
  };

  /**
  * @Description: Helps to get the cookie information
  *
  * @Param: cookieName
  **/
  var getCookieInfo = function(cookieName) {
    return cookieUtils.readCookie(cookieName);
  };

  /**
  * @Description: Helps to do the AJAX call
  * @Param: options - Pass the same options that jQuery AJAX supports
  * @Param: isCorsRequired
  **/
  var triggerAJAXCall = function(options, isCorsRequired) {
    //Setting the defaults
    var defaults = {
      type : 'GET'
    };
    //Merging the options with defaults
    $.extend(true, defaults, options);
    //Trigger the AJAX call and return the handler back
    if(isCorsRequired) {
      $.support.cors = true; //Fix for IE8
    }
    return $.ajax(defaults);
  };

  var sortBasedOnModifiedDateInAscOrder = function (a, b) {
    return new Date(a.lastModifiedDate).getTime() - new Date(b.lastModifiedDate).getTime();
  };

  var getRegistrationLite = function () {
    return true; //(Number(sessionStorage.getItem('RegistrationLiteFeature')) === 1);
  };
  
  var getResetPasswordURL = function () {
	  if(authHelper.isIAMThrottled()) {
		  return Constants.URLS.RESET_PASSWORD_PATH_IAM;
	  } else {
		  return Constants.URLS.RESET_PASSWORD_PATH;
	  }
  };

  //Helps to get the svoc ID and persisted email id
  var getSvocIdAndPersistedEmailID = function() {
    if(cookieUtils.readCookie(Constants.COOKIE_THD_USER)) {
    var name = "THD_USER=";
    var decodedCookie = decodeURIComponent(document.cookie);
    var ca = decodedCookie.split(';');
      for(var i = 0; i <ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0) == ' ') {
          c = c.substring(1);
        }
        if (c.indexOf(name) == 0) {
          COOKIE_THD_USER_VALUE = c.substring(name.length, c.length);
          break;
        }
      }
    COOKIE_THD_USER_VALUE = COOKIE_THD_USER_VALUE.replace(/"/g,'');
    SVOC_OBJ = JSON.parse(atob(COOKIE_THD_USER_VALUE));
    SVOC_ID = SVOC_OBJ.svocCustomerAccountId;
    PERSISTED_THD_USER_EMAIL = SVOC_OBJ.logonId;
    return {
      SVOC_ID : SVOC_ID,
      logonEmailId : PERSISTED_THD_USER_EMAIL
      };
  } else {
    return {
      SVOC_ID : null,
      logonEmailId : null
      };
    }
  };
  
  //Helps to get the member ID
  var getMemberId = function() {
	  if(cookieUtils.readCookie(Constants.COOKIE_THD_USER_SESSION) && getSvocIdAndPersistedEmailID().SVOC_ID){
		  return getSvocIdAndPersistedEmailID().SVOC_ID;
	  }else{
		  return cookieUtils.getUserIdFromUserActivityCookie();
	  }	  
	  
   // return getSvocIdAndPersistedEmailID().SVOC_ID || cookieUtils.getUserIdFromUserActivityCookie();
  };
  
  var showLoader = function() {
	  $('.account-modal__content > .pre-loader').show();
    $('.account-modal__content > .background-overlay').show();
  };
  
  var hideLoader = function() {
	  $('.account-modal__content > .pre-loader').hide();
	  $('.account-modal__content > .background-overlay').hide();
  };

  var getTHDUserEmail = function() {
      if(cookieUtils.readCookie(Constants.COOKIE_USER_EMAIL)){
		  return cookieUtils.readCookie(Constants.COOKIE_USER_EMAIL);
	  }
  };

  var catchErrorCode = function(failure) {
    try {
      if (failure.hasOwnProperty('responseJSON')) {
        if (failure.responseJSON.hasOwnProperty('identity')) {
          return failure.responseJSON.identity.errors[0].errorCode;
        }
        return failure.responseJSON.errors[0].errorCode;
      }
      if (failure.hasOwnProperty('responseText')) return $.parseJSON(failure.responseText).errors[0].errorCode;
      if (failure.errorCode) return failure.errorCode;
    } catch (error) {
      console.warn(error);
      return false;
    }
  };

  var catchErrorMessage = function(failure) {
    try {
      if (failure.hasOwnProperty('responseJSON')) return failure.responseJSON.errors[0].errorMessage;
      if (failure.hasOwnProperty('responseText')) return $.parseJSON(failure.responseText).errors[0].errorMessage;
    } catch (error) {
      console.warn(error);
      return false;
    }
  };

  return {
    getAnimatePace: getAnimatePace,
    getAccountTermsView : getAccountTermsView,
    getPrivacyView : getPrivacyView,
    getProXtraTermsView : getProXtraTermsView,
    getThrottleStatus: getThrottleStatus,
    triggerAJAXCall : triggerAJAXCall,
    sort : sortBasedOnModifiedDateInAscOrder,
    verifyAuthorizationToken : verifyAuthorizationToken,
    getCookie : getCookieInfo,
    getUserId : getUserIdFromUserActivityCookie,
    getAuthorizationToken : getAuthorizationToken,
    getRegistrationLite: getRegistrationLite,
    getResetPasswordURL: getResetPasswordURL,
    getSvocIdAndPersistedEmailID: getSvocIdAndPersistedEmailID,
    getMemberId: getMemberId,
    showLoader: showLoader,
    hideLoader: hideLoader,
    getWCSAuthorizationToken : getWCSAuthorizationToken,
	getTHDUserEmail: getTHDUserEmail,
    catchErrorCode: catchErrorCode,
    catchErrorMessage: catchErrorMessage
  };
});
(function closure(root, factory) {
  if (typeof define === 'function' && define.amd) {
    define('password.toggle',[
      'jquery'
    ], function load(jQuery) {
      return factory(root, jQuery);
    });
  } else {
    // For non-AMD module, expose this to global (will also be useful for test cases)
    /*eslint-disable*/
    factory(root, jQuery);
    /*eslint-enable*/
  }
})(this, function factory(root, $) {
  /**
  * @Date - 03/26/2014
  * @Author - vimal_mohan@homedepot.com
  * @Version - 1.0
  * @Description - 
  * The library helps to append the password toggle feature for the password fields
  * For the password fields with the data attribute pwd-toggle = "true", the toggle button will be added
  * The following attributes can be added
  *          1) data-pwd-toggle //This is required for generating the toggle button for password fields
  *                      Accepts true or false value
  *          2) data-pwd-toggle-show-text //Optional attribute. 
  *                    This will help us to customize the label for showing the password. By default it will be Show
  *          3) data-pwd-toggle-hide-text //Optional attribute. 
  *                    This will help us to customize the label for hiding the password. By default it will be Hide
  *          4) data-pwd-toggle-lbl-left //Helps to set the left offset. This is mandatory to position your label. By default it will be 0px
  *          5) data-pwd-toggle-lbl-padding //Optional. Helps to set the padding style for the label to adjust according to the password fields
  *                        By default it will be '5px 10px 5px 10px'
  *          6) data-pwd-toggle-lbl-width //Mandatory attribute. This will help to identify the width of the label. 
  *                      Based on the width, we recreate the width of the input field. This will avoid the overlapping of the password and toggle button
  *
  * Custom event "reset-pwd-toggle" is created for reseting the password field. This event can be triggered for reseting the password
  * $(<password field>).trigger('reset-pwd-toggle');
  **/

  (function($) {
    $.fn.getCursorPosition = function() {
      var input = this.get(0);
      if (!input) return; // No (input) element found
      if ('selectionStart' in input) {
        // Standard-compliant browsers
        return input.selectionStart;
      } else if (document.selection) {
        // IE
        input.focus();
        var sel = document.selection.createRange();
        var selLen = document.selection.createRange().text.length;
        sel.moveStart('character', -input.value.length);
        return sel.text.length - selLen;
      }
    }
    
    $.fn.setCursorPosition = function(pos) {
      var input = this.get(0);
      if (!input) return; // No (input) element found
      if ('selectionStart' in input && 'selectionEnd' in input) {
        // Standard-compliant browsers
        if(pos !== 0) {
          input.selectionStart = input.selectionEnd = pos;
        }
      } 
    };
  })(jQuery);
  
  /**
  * @Function - _enablePasswordToggle
  * @Description
  * Finds the password fields and implement the toggle feature
  * for displaying and hiding password
  *
  **/
  function _enablePasswordToggle() {
    
    /*var isIEBrowser = $.browser.msie;
    var browserVersion = $.browser.version.substring(0,$.browser.version.indexOf("."));

    //Restrict for IE8
    if(isIEBrowser && browserVersion && (parseInt(browserVersion) < 9)) {
      return;
    }*/
    
    var $passwordFields = _getPasswordFields();
    if($passwordFields.length > 0) {
      $passwordFields.each(function(index){
        _generateToggleButton($passwordFields[index]);
      });
    }
  };
  
  /**
  * @Function - _getPasswordFields
  * @Return - All password fields with attribute data-pwd-toggle="true"
  * @Description
  * Helps to get all password fields with attribute
  * data-pwd-toggle="true"
  *
  **/
  function _getPasswordFields() {
    
    //Fetch the passwords fields
    var $passwordFields = $('[data-pwd-toggle="true"]');
    
    return $passwordFields;
  };
  
  /**
  * @Function - _generateToggleButton
  * @Description
  * Generates the Show/Hide button and appends with the password field
  * Also binds the event to toggle the password
  *
  **/
  function _generateToggleButton($eachPwdField) {
    var isToggleFeaturePresent = $($eachPwdField).parent().find('label#toogleBtn').length > 0;

    if($eachPwdField && !isToggleFeaturePresent) {
      
      var showText = $($eachPwdField).data('pwd-toggle-show-text');
      if( !( showText && $.trim(showText) !== "") ) {
        showText = "Show";
      }
      
      var lblRight = $($eachPwdField).data('pwd-toggle-lbl-right');
      if(!lblRight) {
        lblRight = '0';
      }
      
      var lblPadding = $($eachPwdField).data('pwd-toggle-lbl-padding');
      if(!lblPadding) {
        lblPadding = '12px 8px';
      }

      var $label = $('<label/>').attr({'id':'toogleBtn', 'data-text' : 'show'})
              .css({'position' : 'absolute', 'padding' : lblPadding, 'right' : lblRight + 'px'})
              .css({'color':'#777', 'cursor' : 'pointer'})
              .hide()
              .text(showText)
              .on('click',function(event){
                event.preventDefault();
                if(!hasMouseDownHappened) {
                  _bindClickEvent($($eachPwdField), $(this));
                }
                hasMouseDownHappened = false;
              })
              .on('mousedown',function(event){
                event.preventDefault();
                hasMouseDownHappened = true;
                _bindClickEvent($($eachPwdField), $(this));
              })
              .hover(function(){
                $label.css({'opacity' : '0.6'});
              }, function(){
                $label.css({'opacity' : '1'});
              });


      $($eachPwdField).before($label);
      
      $($eachPwdField).on('keyup' , function(){
        var value = $(this).val();
        if(value !== "") {
          $label.show();
        } else {
          $(this).trigger('reset-pwd-toggle');
        }
      }).on('paste', function(event) {
        setTimeout(function() {
          $($eachPwdField).trigger('keyup');
        }, 1);
      });
      
      //Custom event for reseting the password field to normal
      $($eachPwdField).on('reset-pwd-toggle',function(){
        var isShowDisplayed = $label.data('text') === "show";
        if(!isShowDisplayed) {
          $label.trigger('click');
        }
        $label.hide();
      });
      
      $($eachPwdField).css({'padding-right' : /*width of error info icon.*/ 16 + $label.outerWidth() + 'px'});
      
    }
  };
  
  /**
  * @Function - _bindClickEvent
  * @Description
  * Helps to toggle the password and also changes the label
  *
  **/
  function _bindClickEvent($pwdField, currObj) {


    var $label = currObj;
    var isShowDisplayed = $label.data('text') === "show";
    
    //var currentCursorPosition = $pwdField.getCursorPosition();
    //console.log(currentCursorPosition);
    
    //Validating if the show is displayed or not
    if(isShowDisplayed) {

      var hideText = $pwdField.data('pwd-toggle-hide-text');
      if( !( hideText && $.trim(hideText) !== "") ) {
        hideText = "Hide";
      }
      
      currObj.text(hideText);
      //Disabling the copy when the type is changed
      $pwdField.attr('type','text')
        .on('copy',function(event){
          event.preventDefault();
        });
      $label.data('text','hide');
      
    } else {
    
      var showText = $pwdField.data('pwd-toggle-show-text');
      if( !( showText && $.trim(showText) !== "") ) {
        showText = "Show";
      }
      
      currObj.text(showText);
      $pwdField.attr('type','password')
        .off('copy');
      $label.data('text','show');
    }

  //  $pwdField.setCursorPosition(currentCursorPosition);

  };    

  return {
    initToggle : _enablePasswordToggle
  }
});
/**
 * Analytics AMD for pushing the events into the DDO object
 **/
(function closure(root, factory) {
	if (typeof define === 'function' && define.amd) {
		define('auth.analytics',[
			'account.device.utility',
			'account.utility',
		], function load(deviceUtility, accountUtility) {
			return factory(root, deviceUtility, accountUtility);
		});
	} else {
		// For non-AMD module, expose this to global (will also be useful for test cases)
		/*eslint-disable*/
		factory(root, deviceUtility, accountUtility);
		/*eslint-enable*/
	}
})(this, function factory(root, deviceUtility, accountUtility) {

	/**
	 * @Description: Helps to push the events info, when the digital data is present
	 *
	 * @Param: analyticsEventInfo
	 **/
	var pushEventInfo = function (analyticsEventInfo) {
		if (digitalData !== null && digitalData !== undefined && digitalData.event !== undefined) {
			digitalData.event.push(analyticsEventInfo);
		}
	};

	/**
	 * @Description: Helps to push the event object for sign-in tab
	 *
	 **/
	var pushSignInTabEventInfo = function () {
		try {
			var thdAnalyticsEvent = {
				category: {
					primaryCategory: "overlay"
				},
				eventInfo: {
					eventName: "signin register overlay-sign in tab"
				}
			}
			pushEventInfo(thdAnalyticsEvent);
		} catch (err) {
			//Suppress the error, so that functionality is not broken
			console.warn('DDO: Error in pushing the sign-in tab event info');
		}
	};

	/**
	 * @Description: Helps to push the event object for register-in tab
	 *
	 **/
	var pushRegisterTabEventInfo = function () {
		try {
			var thdAnalyticsEvent = {
				category: {
					primaryCategory: "overlay"
				},
				eventInfo: {
					eventName: "signin register overlay-register tab"
				}
			}
			pushEventInfo(thdAnalyticsEvent);
		} catch (err) {
			//Suppress the error, so that functionality is not broken
			console.warn('DDO: Error in pushing the register tab event info');
		}
	};

	/**
	 * @Description: Helps to push the event object for reset password tab
	 *
	 **/
	var pushResetPasswordEventInfo = function () {
		try {
			var thdAnalyticsEvent = {
				category: {
					primaryCategory: "overlay"
				},
				eventInfo: {
					eventName: "reset password"
				}
			}
			pushEventInfo(thdAnalyticsEvent);
		} catch (err) {
			//Suppress the error, so that functionality is not broken
			console.warn('DDO: Error in pushing the reset password tab event info');
		}
	};
	/**
	 * @Description: Helps to push the event object for otp entry tab event info
	 *
	 **/
	var pushOTPEntryEventInfo = function () {
		try {
			var thdAnalyticsEvent = {
				category: {
					primaryCategory: "overlay"
				},
				eventInfo: {
					eventName: "reset password code entry"
				}
			}
			pushEventInfo(thdAnalyticsEvent);
		} catch (err) {
			//Suppress the error, so that functionality is not broken
			console.warn('DDO: Error in pushing the OTP Entry tab event info');
		}
	};
	/**
	 * @Description: Helps to push the event object for otp entry tab event info
	 *
	 **/
	var pushTemporaryPasswordEventInfo = function () {
		try {
			var thdAnalyticsEvent = {
				category: {
					primaryCategory: "overlay"
				},
				eventInfo: {
					eventName: "otp verification code entry - email"
				}
			}
			pushEventInfo(thdAnalyticsEvent);
		} catch (err) {
			//Suppress the error, so that functionality is not broken
			console.warn('DDO: Error in pushing the temporarty password event info');
		}
	};
	/**
	 * @Description: Helps to push the event object for enter new password tab
	 *
	 **/
	var pushEnterNewPasswordEventInfo = function () {
		try {
			var thdAnalyticsEvent = {
				category: {
					primaryCategory: "overlay"
				},
				eventInfo: {
					eventName: "enter new password"
				}
			}
			pushEventInfo(thdAnalyticsEvent);
		} catch (err) {
			//Suppress the error, so that functionality is not broken
			console.warn('DDO: Error in pushing the enter new password tab event info');
		}
	};

	/**
	 * @Description: Helps to push the event object for successful sign in
	 *
	 **/
	var pushSuccessfulSignInEventInfo = function () {
		try {
			var thdAnalyticsEvent = {
				category: {
					primaryCategory: "button submission"
				},
				eventInfo: {
					eventName: "sign in"
				}
			}
			pushEventInfo(thdAnalyticsEvent);
		} catch (err) {
			//Suppress the error, so that functionality is not broken
			console.warn('DDO: Error in pushing the successful sign-in event info');
		}
	};

	/**
	 * @Description: Helps to push the event object for successful register
	 *
	 **/
	var pushSuccessfulRegisterEventInfo = function () {
		try {
			var thdAnalyticsEvent = {
				category: {
					primaryCategory: "button submission"
				},
				eventInfo: {
					eventName: "registration"
				},
				user: {
					profile: {
						action: "register"
					}
				}
			}
			pushEventInfo(thdAnalyticsEvent);
		} catch (err) {
			//Suppress the error, so that functionality is not broken
			console.warn('DDO: Error in pushing the successful register event info');
		}
	};


	/**
	 * @Description: Helps to push the event object for error scenarios
	 *
	 **/
	var pushAuthErrorEventInfo = function (params) {
		try {
			var thdAnalyticsEvent = {
				category: {
					primaryCategory: "error"
				},
				eventInfo: {
					eventName: "error",
					errorMessage: params.errorMessage
				}
			}
			pushEventInfo(thdAnalyticsEvent);
		} catch (err) {
			//Suppress the error, so that functionality is not broken
			console.warn('DDO: Error in pushing the auth error event info');
		}
	};

	/**
	 * @Description: Helps to push the event object for successful sign in IAM
	 *
	 **/
	var pushSuccessfulSignInIAMEventInfo = function () {
		try {
			var thdAnalyticsEvent = {
				category: {
					primaryCategory: "button submission"
				},
				eventInfo: {
					eventName: "sign in success"
				}
			}
			pushEventInfo(thdAnalyticsEvent);
		} catch (err) {
			//Suppress the error, so that functionality is not broken
			console.warn('DDO: Error in pushing the successful sign-in event info');
		}
	};

	/**
	 * @Description: Helps to push the event object for create Pro Xtra Account
	 *
	 **/
	var pushCreateAProXtraAccountOverlayEventInfo = function () {
		try {
			var thdAnalyticsEvent = {
				category: {
					primaryCategory: "overlay"
				},
				eventInfo: {
					eventName: "registration pro xtra account"
				}
			}
			pushEventInfo(thdAnalyticsEvent);
		} catch (err) {
			//Suppress the error, so that functionality is not broken
			console.warn('DDO: Error in pushing the pro Xtra tab event info');
		}
	};

	/**
	 * @Description: Helps to push the event object for create Pro Xtra Account
	 *
	 **/
	var pushIAmAProCustomerBoxCheckedEventInfo = function () {
		try {
			var thdAnalyticsEvent = {
				category: {
					primaryCategory: "button submission"
				},
				eventInfo: {
					eventName: "my account settings"
				},
				myAccount: {
					settings: "register overlay: pro customer box checked"
				}
			}
			pushEventInfo(thdAnalyticsEvent);
		} catch (err) {
			//Suppress the error, so that functionality is not broken
			console.warn('DDO: Error in pushing the pro customer box checked event info');
		}
	};

	/**
	 * @Description: Helps to push the event object for Set Your Password
	 *
	 **/
	var pushSetYourPasswordEventInfo = function (pageName) {
		try {
			var thdAnalyticsEvent = {
				category: {
					primaryCategory: "button submission"
				},
				eventInfo: {
					eventName: "my account settings"
				},
				myAccount: {
					settings: pageName
				}
			}
			pushEventInfo(thdAnalyticsEvent);
		} catch (err) {
			//Suppress the error, so that functionality is not broken
			console.warn('DDO: Error in pushing the Set Your Password event info');
		}
	};

	/**
	 * @Description: Helps to push the event object for Sign In With Different Email
	 *
	 **/

	var pushSignInWithDifferentEmailEventInfo = function (pageName) {
		try {
			var thdAnalyticsEvent = {
				category: {
					primaryCategory: "button submission"
				},
				eventInfo: {
					eventName: "my account settings"
				},
				myAccount: {
					settings: pageName
				}
			}
			pushEventInfo(thdAnalyticsEvent);
		} catch (err) {
			//Suppress the error, so that functionality is not broken
			console.warn('DDO: Error in pushing the Sign In With Different Email event info');
		}
	};

	/**
	 * @Description: Helps to push the event object for Sign In With Different Email
	 *
	 **/

	var pushProXtraAccountCreatedOverlayEventInfo = function () {
		try {
			var thdAnalyticsEvent = {
				category: {
					primaryCategory: "overlay"
				},
				eventInfo: {
					eventName: "pro xtra account created"
				},
				user: {
					customerType: "pro"
				}
			}
			pushEventInfo(thdAnalyticsEvent);
		} catch (err) {
			//Suppress the error, so that functionality is not broken
			console.warn('DDO: Error in pushing the Pro Xtra account created event info');
		}
	};

	/**
	 * Helps to push the error event
	 *
	 * The parameter object should contain the following items
	 * errorType : string, - 'warning/error/info'
	 * displayType : string, - 'inline/page level'
	 * pageSection : string,  - 'add address of view all addresses' etc...
	 * errorMessage : string,  - Error message
	 * errorCode : string - Error code
	 *
	 * @Spec_Section : 6.5.1
	 *
	 */
	var setErrorEvent = function (params) {
		try {
			var thdAnalyticsEvent = {
				category: {
					primaryCategory: "error"
				},
				eventInfo: {
					eventName: "post page error",
					error: [{
						type: params.errorType,
						displayType: params.displayType,
						pageSection: params.pageSection,
						message: params.errorMessage,
						code: params.errorCode ? params.errorCode : "NA"
					}]
				}
			}
			pushEventInfo(thdAnalyticsEvent);
		} catch (err) {
			//Suppress the error, so that functionality is not broken
			console.warn('DDO: Error in pushing the error event info');
		}
	}

	var getLoggerRequest = function (url, request, response, responseCode, http_method, startTime, endTime) {
		return {
			"appname": "account",
			"tablename": "eventlog",
			"rows": [{
				"operation": "INSERT",
				"columns": {
					"global_id": getGlobalID(),
					"user_type": getUserType(),
					"service_request_ts": new Date().toUTCString(),
					"component": window.location.href,
					"serviceURL": setServiceUrl(maskURL(url)),
					"request": maskRequest(request),
					"response": maskResponse(response),
					"responseCode": responseCode.toString(),
					"responseTime": calculateResponseTime(startTime, endTime),
					"http_method": http_method,
					"x_device": response.xDevice ? response.xDevice : "",
					"user_agent": "",
					"miscellaneous": "",
					"featureSwitch": ""
				}
			}]
		};
	}

	var maskRequest = function (request) {
		if (typeof request == "string" && isJsonString(request)) {
			request = JSON.parse(request);
		} else {
			JSON.parse(JSON.stringify(request))
		}

		if (request.identity) {
			maskIdentity(request.identity);
		}
		if (request.user) {
			maskIdentity(request.user);
		}
		if (request.otpRequest) {
			maskIdentity(request.otpRequest)
		}

		maskEmailAddress(request, "emailId")
		maskEmailAddress(request, "loginId")

		if (request.passwordrequest) {
			maskIfExists(request.passwordrequest, "password");
			maskIfExists(request.passwordrequest, "confirmPassword");
		}

		return JSON.stringify(request);

	};

	var isJsonString = function (str) {
		try {
			JSON.parse(str);
		} catch (e) {
			return false;
		}
		return true;
	}

	var maskResponse = function (response) {
		if (typeof response == "string" && isJsonString(response)) {
			response = JSON.parse(response);
		} else {
			JSON.parse(JSON.stringify(response));
		}

		if (response.identity) {
			maskIdentity(response.identity);
		}
		if (response.account) {
			maskIdentity(response.account);

			if (response.account.profile) {
				maskIdentity(response.account.profile);
			}

			if (response.account.profilePhones && response.account.profilePhones.phone.length > 0) {
				response.account.profilePhones.phone[0].number = maskPhone(response.account.profilePhones.phone[0].number);
			}
		}
		if (response.number){
			response.number = maskPhone(response.number);
		}


		maskEmailAddress(response, "emailId");
		maskEmailAddress(response, "logonId");
		if (response.passwordrequest) {
			maskIfExists(request.passwordrequest, "password");
			maskIfExists(request.passwordrequest, "confirmPassword");
		}

		return JSON.stringify(response);

	};

	var maskPhone = function (input) {
		var length = input.length;
		return '()-' + input.substr(length - 3);
	};

	var maskIdentity = function (identity) {
		if (identity.phone) {
			identity.phone.number = maskPhone(identity.phone.number);
		}
		maskEmailAddress(identity, "logonId");
		maskEmailAddress(identity, "loginId");
		maskEmailAddress(identity, "emailId");
		maskEmailAddress(identity, "newLogonId");
		maskIfExists(identity, "password");
		maskIfExists(identity, "confirmPassword");
		maskIfExists(identity, "newPassword");
	};

	var maskEmailAddress = function (parentOfEmail, emailFieldName) {
		if (parentOfEmail && parentOfEmail[emailFieldName]) {
			var email = parentOfEmail[emailFieldName];
			parentOfEmail[emailFieldName] = getMaskedEmailAddress(email);
		}
	}

	var maskURL = function (url) {
		if (url) {
			var indexOfEmail;
			var indexOfPhone;
			var emailKeys = ["email=", "emailId="];
			var phoneKeys = ["phoneNumber="];
			// var substring = getMaskedEmailAddress(substring)
			for (var emailKey in emailKeys) {
				if ((indexOfEmail = url.indexOf(emailKey)) != -1) {
					url = url.replace(/[\w.\-%+]+@([\w\-]+\.)+\w+/, getMaskedEmailAddress);
				}
			}
			for (var phoneKey in phoneKeys) {
				if ((indexOfPhone = url.indexOf(phoneKey)) != -1) {
					url = url.replace(/\(?([0-9]{3})\)?([ .-]?)([0-9]{3})\2([0-9]{4})/, maskPhone);
				}
			}
		}
		return url;
	}

	var maskIfExists = function (parent, potentialChildToMask) {
		if (parent[potentialChildToMask]) {
			parent[potentialChildToMask] = "####";
		}
	}

	var getMaskedEmailAddress = function (email) {
		return email.substring(0, 1) + "####" + email.substring(email.indexOf("@") - 1);
	}

	var executeLoggerService = function (obj) {
		var headers = {
			'Content-Type': 'application/json',
			'Accept': 'application/json'
		};
		//call the service and pass the loggerObj as parameter
		var url = 'https://' + deviceUtility.getHostNameSecure() + "/account/log/servicelog";
		try {

			options = {
				url: url,
				headers: headers,
				type: 'POST',
				crossDomain: true,
				data: JSON.stringify(obj)
			}
			return accountUtility.triggerAJAXCall(options);
		} catch (e) {
			console.log("failed logging service information", e);
		}
	}

	// get from the THD_MCC_ID cookie
	var getGlobalID = function () {
		var globalID = getCookie(document.cookie)['THD_USER'];
		return globalID ? globalID : "";
	}

	// If its a registered user, THD_USER cookie will be there else not.
	var getUserType = function () {
		var cookieVal = getCookie(document.cookie)['THD_USER'];
		// userId for guest user is coming under cart_activity cookie but it's httpOnly, hence not readable by javascript.
		return (cookieVal) ? "registered" : "guest";
	}

	var getCookie = function (cookie) {
		return cookie
			.trim()
			.split(';')
			.map(function (line) {
				return line.split(',');
			})
			.reduce(function (props, line) {
				var cookieElement = line[0].split('=');
				var name = cookieElement[0].trim(); //line[0].slice(0, line[0].search('=')).trim();
				props[name] = cookieElement[1];
				return props;
			}, {});
	}

	var setServiceUrl = function (apiUrl) {
		if (apiUrl === null || apiUrl === undefined) {
			return "Unknown Url/No Url";
		} else {
			return apiUrl;
		}
	}

	// taken this logic from cardinal.service.js
	var calculateResponseTime = function (startTime, endTime) {
		return Math.round(endTime - startTime);
	}

	var pushLoggingInfo = function (url, request, response, responseCode, http_method, startTime, endTime) {
		try {
			executeLoggerService(getLoggerRequest(url, request, response, responseCode, http_method, startTime, endTime));
		}
		catch (e) {
			console.log(e)
		}
	};

	return {
		pushSignInTabEventInfo: pushSignInTabEventInfo,
		pushRegisterTabEventInfo: pushRegisterTabEventInfo,
		pushResetPasswordEventInfo: pushResetPasswordEventInfo,
		pushOTPEntryEventInfo: pushOTPEntryEventInfo,
		pushEnterNewPasswordEventInfo: pushEnterNewPasswordEventInfo,
		pushSuccessfulSignInEventInfo: pushSuccessfulSignInEventInfo,
		pushSuccessfulRegisterEventInfo: pushSuccessfulRegisterEventInfo,
		pushAuthErrorEventInfo: pushAuthErrorEventInfo,
		pushSuccessfulSignInIAMEventInfo: pushSuccessfulSignInIAMEventInfo,
		pushCreateAProXtraAccountOverlayEventInfo: pushCreateAProXtraAccountOverlayEventInfo,
		pushIAmAProCustomerBoxCheckedEventInfo: pushIAmAProCustomerBoxCheckedEventInfo,
		pushSetYourPasswordEventInfo: pushSetYourPasswordEventInfo,
		pushSignInWithDifferentEmailEventInfo: pushSignInWithDifferentEmailEventInfo,
		pushProXtraAccountCreatedOverlayEventInfo: pushProXtraAccountCreatedOverlayEventInfo,
		setErrorEvent: setErrorEvent,
		pushTemporaryPasswordEventInfo: pushTemporaryPasswordEventInfo,
		pushLoggingInfo: pushLoggingInfo
	};
});

/**
 * Helps to generate the Dual Sign In modal.
 **/
(function closure(root, factory) {
    if (typeof define === 'function' && define.amd) {
        define('auth.modal',[
            'jquery',
            'account.modal',
            'account.utility',
            'password.toggle',
            'auth.analytics',
            'auth.helper',
            'auth.constants',
            'cookie-utils'
        ], function load(jQuery, modal, accountUtility, passwordToggle, analytics, authHelper, Constants, cookieUtils) {
            return factory(root, jQuery, modal, accountUtility, passwordToggle, analytics, authHelper, Constants,cookieUtils );
        });
    } else {
        // For non-AMD module, expose this to global (will also be useful for test cases)
        /*eslint-disable*/
        factory(root, jQuery, modal, accountUtility, passwordToggle, analytics, authHelper, Constants,cookieUtils);
        /*eslint-enable*/
    }
})(this, function factory(root, $, modal, accountUtility, passwordToggle, analytics, authHelper, Constants,cookieUtils) {

    window.resetpasswordthroughflag = false;

    var $rowHeader = function (title) {
        var $rowHeaderText = $('<span />', {'id':'dual-signin__headerText'}).addClass('row-header__text').html(title),
            $rowHeaderTitle = $('<div />').addClass('row-header__title').html($rowHeaderText);
        return $('<div />').addClass('row-header').html($rowHeaderTitle);
    };

    var $termsPrivacyContainer = function () {
        var $terms = $('<a />', {
                'href': accountUtility.getAccountTermsView(),
                'target': '_blank'
            }).addClass('u__default-link body__p-right-small body__border-right--light').html('My Account Terms &amp; Conditions'),
            $privacy = $('<a />', {
                'href': accountUtility.getPrivacyView(),
                'target': '_blank'
            }).addClass('u__default-link body__p-left-small ').html('Privacy &amp; Security Statement'),
            $termPrivacy = $('<div />').addClass('u__legal body__m-top-large u__text-align--center').html($terms).append($privacy);
        return $termPrivacy;
    }

    var checkPersistedUser = function() {
        var persistantEmailObject = accountUtility.getSvocIdAndPersistedEmailID();
        if(persistantEmailObject) {
            var persistantEmail = persistantEmailObject.logonEmailId;
        } else {
            var persistantEmail = accountUtility.getTHDUserEmail();
        }
        if(persistantEmail) {
            $(".login-popup__form #email_id").val(persistantEmail);
        }
    }

    /**
     * @Description: Helps to generate the sign in tab for the dual signin modal
     *
     **/
    var generateSignInTab = function () {
        var $setPassword = [
            '<div class="signInSetPwd hide">',
            '<p class="body__m-top-large">Would you like to do this now? If so, we\'ll  send you a link at the email above that you can use to set your password.</p>',
            '<button id="setPasswordButton" class="bttn bttn--primary body__m-top-large">',
            '<span class="bttn__content">Set your password</span>',
            '</button>',
            '<p class="u__text-align--left body__p-top-medium"><a id="signInDiffEmail" class="u__default-link">Sign in with a different email</a></p>',
            '</div>'
        ].join("");
        var _this = this,
            $loginHeader = $rowHeader('My Account Sign In'),

            $emailIdInput = $('<input />', {
                'type': 'text',
                'id': 'email_id',
                'autofocus': 'true',
                'autocomplete': 'off',
                'maxlength': '60',
                'tabindex' : '110'
            }).addClass('form-input__field'),
            $emailIdText = $('<span />').html( (authHelper.isIAMThrottled() ? 'Email' : 'Email Address:') ),
            $emailIdLabel = $('<label />', {'for': 'email_id'}).addClass('form-input__label').html($emailIdText),
            $emailIdHolder = $('<div />', {'id': 'emailholder'}).addClass('form-input body__m-top-small').html($emailIdLabel).append($emailIdInput),

            $passwordInput = $('<input />', {
                'type': 'password',
                'id': 'password',
                'autocomplete': 'off',
                'tabindex' : '111'
            }).addClass('form-input__field'),
            $passwordText = $('<span />').html('Password' + (authHelper.isIAMThrottled() ? '' : ':')),
            $passwordLabel = $('<label />', {'for': 'password'}).addClass('form-input__label').html($passwordText),
            $passwordHolder = $('<div />').addClass('form-input body__m-top-small').html($passwordLabel).append($passwordInput),

            $resetPasswordLink = $('<a />', {'href': accountUtility.getResetPasswordURL()}).addClass('u__default-link').html('Forgot your password?'),
            $resetPassDiv = $('<div />').addClass('u__text-align--right body__m-top-small').html($resetPasswordLink),

            $buttonText = $('<span />').addClass('bttn__content').html((authHelper.isIAMThrottled() ? 'Sign In' : 'SIGN IN')),

            $buttonSignin = $('<button />', {'id': 'accountSignIn'}).addClass('bttn bttn--primary body__m-top-small').html($buttonText),

            $signInModel = $('<div />').addClass('login-popup__model'),
            $content = $('<form />', {
                'method': 'post',
                'name': 'userLogin',
                'id': 'userLogin'
            }).addClass('login-popup__form');

        if(authHelper.isIAMThrottled()) {
            $passwordHolder.addClass("signInType pwdHolder");
            $resetPassDiv.addClass("signInType");
            $buttonSignin.addClass("signInType");
            $buttonSignin.attr('disabled', 'disabled');
            $buttonSignin.addClass('disabled');
        }

        if (!authHelper.isIAMThrottled()) {
            $passwordInput.attr('data-pwd-toggle',true);
            $passwordInput.attr('maxlength', '70');
        } else {
            $passwordInput.attr('maxlength', '70');
        }

        if(authHelper.isIAMThrottled()) {
            $signInModel
                .append($emailIdHolder)
                .append($passwordHolder)
                .append($resetPassDiv)
                .append($setPassword)
                .append($termsPrivacyContainer())
                .append($buttonSignin);
        } else {
            $signInModel
                .append($loginHeader)
                .append($emailIdHolder)
                .append($passwordHolder)
                .append($resetPassDiv)
                .append($termsPrivacyContainer())
                .append($buttonSignin);
        }
        $content.append($signInModel);

        return $content;
    };

    /**
     * @Description: Helps to generate the Register tab
     *
     **/
    var generateRegisterTab = function () {

        if(authHelper.isIAMThrottled()) {
            var $setPassword = ['<div class="setPasswordDiv hide">',
                '<p class="body__p-top-large">Would you like to do this now? If so, we\'ll send you a link at the email above that you can use to set your password.</p>',
                '<button id="setPasswordButton" class="bttn bttn--primary body__m-top-large">',
                '<span class="bttn__content">Set your password</span>',
                '</button>',
                '<p class="u__text-align--left body__p-top-medium"><a id="registerInDiff" class="u__default-link">Register with a different email</a></p>',
                $termsPrivacyContainer().removeClass("u__legal").addClass("u__legalNoBorder").prop('outerHTML'),
                '</div>'].join("");
            var $reqTextdiv = $('<p />').html("Do more with an account."),
                $reqTextdiv2 = $('<p />').html("Keep track of your orders, check out faster, and save <br> products into lists."),

                $firstNameText = $('<span />').html('First Name:'),
                $firstNameLabel = $('<label />', {'for': 'firstName'}).addClass('form-input__label').html($firstNameText),
                $firstNameInput = $('<input />', {
                    'type': 'text',
                    'id': 'firstName',
                    'autofocus': 'true',
                    'autocomplete': 'off'
                }).addClass('form-input__field invalid'),
                $firstNameHolder = $('<div />', {'id': 'firstnameholder'}).addClass('form-input body__m-top-small').html($firstNameLabel).append($firstNameInput),

                $lastNameText = $('<span />').html('Last Name:'),
                $lastNameLabel = $('<label />', {'for': 'lastName'}).addClass('form-input__label').html($lastNameText),
                $lastNameInput = $('<input />', {
                    'type': 'text',
                    'id': 'lastName',
                    'autocomplete': 'off'
                }).addClass('form-input__field invalid'),
                $lastNameHolder = $('<div />', {'id': 'lastnameholder'}).addClass('form-input body__m-top-small').html($lastNameLabel).append($lastNameInput),

                $zipText = $('<span />').html('Zip Code' + (authHelper.isIAMThrottled() ? '' : ':')),
                $zipLabel = $('<label />', {'for': 'zipcode'}).addClass('form-input__label').html($zipText),
                $zipInput = $('<input />', {
                    'type': 'text',
                    'id': 'zipcode',
                    'autocomplete': 'off',
                    'maxlength': '5',
                    'tabindex' : '104'
                }).addClass('form-input__field invalid'),
                $zipHolder = $('<div />', {'id': 'zipholder'}).addClass('form-input body__m-top-small registerSetPwd').html($zipLabel).append($zipInput),

                $emailIdText = $('<span />').html( (authHelper.isIAMThrottled() ? 'Email' : 'Email Address:') ),
                $emailIdLabel = $('<label />', {'for': 'email_id'}).addClass('form-input__label').html($emailIdText),
                $emailIdInput = $('<input />', {
                    'type': 'text',
                    'id': 'email_id',
                    'autofocus': 'true',
                    'autocomplete': 'off',
                    'maxlength': '60',
                    'tabindex' : '101'
                }).addClass('form-input__field invalid'),
                $emailIdHolder = $('<div />', {'id': 'emailholder'}).addClass('form-input body__m-top-small').html($emailIdLabel).append($emailIdInput),

                $passwordText = $('<span />').html('Password' + (authHelper.isIAMThrottled() ? '' : ':')),
                $passwordLabel = $('<label />', {'for': 'password'}).addClass('form-input__label').html($passwordText),
                $passwordInput = $('<input />', {
                    'type': 'password',
                    'id': 'registrationPassword',
                    'autocomplete': 'off',
                    'min-length': '8',
                    'maxlength': '70',
                    'tabindex' : '102'
                }).addClass('form-input__field invalid'),
                $passwordHolder = $('<div />', {'id': 'pwdholder'}).addClass('form-input body__m-top-small registerSetPwd').html($passwordLabel).append($passwordInput),

                //Password Strength Word
                $passwordStrengthWord = $('<div/>').addClass('registerSetPwd').attr('id', 'passwordStrengthWord');

            //Show Password
            $showPasswordCheckbox = $('<input />', {
                'type': 'checkbox',
                'id': 'showPasswordCheck',
                'autocomplete': 'off',
                'name': 'showPasswordCheck'
            }).addClass('checkbox-btn__input'),
                $showPasswordCheckBoxText = $('<span />').addClass('fontWeight-normal').html("Show Password"),
                $showPasswordCheckBoxLabel = $('<label />', {'for': 'showPasswordCheck'}).addClass('checkbox-btn__label').html($showPasswordCheckBoxText),
                $showPasswordCheckboxHolder = $('<div />').addClass('checkbox-btn body__m-top-small registerSetPwd').html($showPasswordCheckbox).append($showPasswordCheckBoxLabel),


                $passwordMeterHolder = $('<div/>').addClass('pwd-meter-required body__m-top-small registerSetPwd').attr('id', 'dualSignIn-password-meter');

            $confirmPasswordText = $('<span />').html('Confirm Password' + (authHelper.isIAMThrottled() ? '' : ':')),
                $confirmPasswordLabel = $('<label />', {'for': 'confirmPassword'}).addClass('form-input__label').html($confirmPasswordText),
                $confirmPasswordInput = $('<input />', {
                    'type': 'password',
                    'id': 'confirmPassword',
                    'autocomplete': 'off',
                    'maxlength': '70',
                    'tabindex' : '103'
                }).addClass('form-input__field invalid'),
                $confirmPasswordHolder = $('<div />').addClass('form-input body__m-top-small registerSetPwd').html($confirmPasswordLabel).append($confirmPasswordInput),

                $proCustomerCheckbox = $('<input />', {
                    'type': 'checkbox',
                    'id': 'proCustomer',
                    'autocomplete': 'off',
                    'name': 'contaractorortradesman'
                }).addClass('checkbox-btn__input'),
                $checkBoxText = $('<span />').addClass('fontWeight-normal').html("I'm a Pro customer (i.e. Making purchase for <br> my business)"),
                $CheckBoxLabel = $('<label />', {'for': 'proCustomer'}).addClass('checkbox-btn__label').html($checkBoxText),
                $proCustomerHolder = $('<div />').addClass('checkbox-btn body__m-top-small registerSetPwd').html($proCustomerCheckbox).append($CheckBoxLabel),

                $buttonText = $('<span />').addClass('bttn__content').html('Register'),
                $buttonRegister = $('<button />', {
                    'id': 'accountRegister',
                    'disabled': 'disabled'
                }).addClass('bttn bttn--primary body__m-top-small disabled registerSetPwd').html($buttonText),

                $createAccountModal = $('<div />').addClass('createAccountModalForm'),
                $content = $('<form />', {'method': 'post', 'name': 'createAccount', 'id': 'createAccount'});

            $reqTextdiv.addClass('reqTextdiv registerSetPwd');
            $reqTextdiv2.addClass('reqTextdiv2 registerSetPwd');

            $createAccountModal.html($reqTextdiv).append($reqTextdiv2);

            /*  if (!accountUtility.getRegistrationLite()) {
                  $createAccountModal.append($firstNameHolder);
                  $createAccountModal.append($lastNameHolder);
                  $createAccountModal.append($zipHolder);
              }*/

            $createAccountModal.append($emailIdHolder);
            $createAccountModal.append($passwordHolder);

            //Added New ShowPassword Checkbox
            $createAccountModal.append($passwordStrengthWord);
            $createAccountModal.append($showPasswordCheckboxHolder);


            $createAccountModal.append($passwordMeterHolder);

            $createAccountModal.append($confirmPasswordHolder);
            $createAccountModal.append($zipHolder);

            $createAccountModal.append($proCustomerHolder);
            $createAccountModal.append($termsPrivacyContainer().addClass('body__m-bottom-small registerSetPwd'));
            $createAccountModal.append($buttonRegister);
            $($setPassword).appendTo($createAccountModal);


            //$content.html($headerDiv).append($createAccountModal);
            $content.append($createAccountModal);

            return $content;
        } else {
            var $headerDiv = $rowHeader('Create My Account'),
                $requiredText = $('<span />').addClass('u__text--brand').html('* '),

                $reqTextdiv = $('<p />').addClass('u__text-align--right u__bold body__m-top-small').html("Required Fields").prepend($requiredText.clone()),

                $firstNameText = $('<span />').html('First Name:').prepend($requiredText.clone()),
                $firstNameLabel = $('<label />', {'for': 'firstName'}).addClass('form-input__label').html($firstNameText),
                $firstNameInput = $('<input />', {
                    'type': 'text',
                    'id': 'firstName',
                    'autofocus': 'true',
                    'autocomplete': 'off'
                }).addClass('form-input__field invalid'),
                $firstNameHolder = $('<div />', {'id': 'firstnameholder'}).addClass('form-input body__m-top-small').html($firstNameLabel).append($firstNameInput),

                $lastNameText = $('<span />').html('Last Name:').prepend($requiredText.clone()),
                $lastNameLabel = $('<label />', {'for': 'lastName'}).addClass('form-input__label').html($lastNameText),
                $lastNameInput = $('<input />', {
                    'type': 'text',
                    'id': 'lastName',
                    'autocomplete': 'off'
                }).addClass('form-input__field invalid'),
                $lastNameHolder = $('<div />', {'id': 'lastnameholder'}).addClass('form-input body__m-top-small').html($lastNameLabel).append($lastNameInput),

                $zipText = $('<span />').html('Zip Code:').prepend($requiredText.clone()),
                $zipLabel = $('<label />', {'for': 'zipcode'}).addClass('form-input__label').html($zipText),
                $zipInput = $('<input />', {
                    'type': 'text',
                    'id': 'zipcode',
                    'autocomplete': 'off',
                    'maxlength': '5'
                }).addClass('form-input__field invalid'),
                $zipHolder = $('<div />', {'id': 'zipholder'}).addClass('form-input body__m-top-small').html($zipLabel).append($zipInput),

                $emailIdText = $('<span />').html('Email Address:').prepend($requiredText.clone()),
                $emailIdLabel = $('<label />', {'for': 'email_id'}).addClass('form-input__label').html($emailIdText),
                $emailIdInput = $('<input />', {
                    'type': 'text',
                    'id': 'email_id',
                    'autofocus': 'true',
                    'autocomplete': 'off',
                    'maxlength': '60'
                }).addClass('form-input__field invalid'),
                $emailIdHolder = $('<div />', {'id': 'emailholder'}).addClass('form-input body__m-top-small').html($emailIdLabel).append($emailIdInput),

                $passwordText = $('<span />').html('Password:').prepend($requiredText.clone()),
                $passwordLabel = $('<label />', {'for': 'password'}).addClass('form-input__label').html($passwordText),
                $passwordInput = $('<input />', {
                    'type': 'password',
                    'id': 'registrationPassword',
                    'autocomplete': 'off',
                    'min-length': '8',
                    'maxlength': '70',
                    'data-pwd-toggle': 'true'
                }).addClass('form-input__field invalid'),
                $passwordHolder = $('<div />').addClass('form-input body__m-top-small').html($passwordLabel).append($passwordInput),

                $passwordMeterHolder = $('<div/>').addClass('pwd-meter-required').attr('id', 'dualSignIn-password-meter');

            $confirmPasswordText = $('<span />').html('Confirm Password:').prepend($requiredText.clone()),
                $confirmPasswordLabel = $('<label />', {'for': 'confirmPassword'}).addClass('form-input__label').html($confirmPasswordText),
                $confirmPasswordInput = $('<input />', {
                    'type': 'password',
                    'id': 'confirmPassword',
                    'autocomplete': 'off',
                    'maxlength': '70',
                    'data-pwd-toggle': 'true'
                }).addClass('form-input__field invalid'),
                $confirmPasswordHolder = $('<div />').addClass('form-input body__m-top-small').html($confirmPasswordLabel).append($confirmPasswordInput),

                $proCustomerCheckbox = $('<input />', {
                    'type': 'checkbox',
                    'id': 'proCustomer',
                    'autocomplete': 'off',
                    'name': 'contaractorortradesman'
                }).addClass('checkbox-btn__input'),
                $checkBoxText = $('<span />').html('I am a professional contractor, tradesman or remodeler. <i>(optional)</i>'),
                $CheckBoxLabel = $('<label />', {'for': 'proCustomer'}).addClass('checkbox-btn__label').html($checkBoxText),
                $proCustomerHolder = $('<div />').addClass('checkbox-btn body__m-top-small').html($proCustomerCheckbox).append($CheckBoxLabel),

                $buttonText = $('<span />').addClass('bttn__content').html('REGISTER'),
                $buttonRegister = $('<button />', {
                    'id': 'accountRegister',
                    'disabled': 'disabled'
                }).addClass('bttn bttn--primary body__m-top-small disabled').html($buttonText),

                $createAccountModal = $('<div />').addClass('createAccountModalForm'),
                $content = $('<form />', {'method': 'post', 'name': 'createAccount', 'id': 'createAccount'});

            $createAccountModal.html($reqTextdiv);

            if (!accountUtility.getRegistrationLite()) {
                $createAccountModal.append($firstNameHolder);
                $createAccountModal.append($lastNameHolder);
                $createAccountModal.append($zipHolder);
            }

            $createAccountModal.append($emailIdHolder);
            $createAccountModal.append($passwordHolder);
            $createAccountModal.append($passwordMeterHolder);

            if (!accountUtility.getRegistrationLite()) {
                $createAccountModal.append($confirmPasswordHolder);
            } else {
                $createAccountModal.append($zipHolder);
            }

            $createAccountModal.append($proCustomerHolder);
            $createAccountModal.append($buttonRegister);
            $createAccountModal.append($termsPrivacyContainer());

            $content.html($headerDiv).append($createAccountModal);

            return $content;
        }

    }

    /**
     * @Description: This will help to generate the pro upgrade modal
     *
     * @Param: successCallback - If not passed, this will refresh the page
     * @Param: errorCallback - If not passed, this will refreesh the page
     **/
    var generateProUpgradeModal = function(){


        var $reqTextdiv2 = $('<h1 />').addClass('body__p-right-large').html("Create a Pro Xtra Account"),
            $reqTextdiv = $('<div />').addClass('body__p-bottom-large u__border--bottom').html($reqTextdiv2),

            $businessData1 = $('<h2 />').html("Let's Get Down to Business"),
            $businessData2 = $('<p />').addClass('body__p-top-large').html("Beyond the everyday services and savings, our professional customers and businesses get Xtra!"),

            $businessDatali1 = $('<li />').addClass('body__p-top-medium').html("Track up to 2 years of purchases through your Pro Xtra account by job, PO, location & date."),
            $businessDatali2 = $('<li />').addClass('body__p-top-medium').html("Get exclusive Pro only savings and incentives in-store"),
            $businessDatali3 = $('<li />').addClass('body__p-top-medium').html("Manage your business from anywhere with a growing list"),
            $businessData3 = $('<ul />').addClass('body__p-left-xlarge').html($businessDatali1).append($businessDatali2).append($businessDatali3),
            $businessHolder = $('<div />').addClass('body__p-updown-large u__border--bottom').html($businessData1).append($businessData2).append($businessData3),

            $headerTextdiv2 = $('<h2 />').html("Enter the information below to create a Pro Xtra Account"),
            $headerTextdiv = $('<div />').addClass('body__p-top-xlarge body__p-bottom-xlarge').html($headerTextdiv2),

            $companyNameText = $('<span />').addClass('form-input__label-content').html('Company Name'),
            $companyNameLabel = $('<label />', {'for': 'companyName'}).addClass('form-input__label').html($companyNameText),
            $companyNameInput = $('<input />', {
                'type': 'text',
                'id': 'companyName',
                'autofocus': 'true',
                'autocomplete': 'off',
                'maxlength': "99"
            }).addClass('form-input__field invalid'),
            $companyNameHolder = $('<div />', {'id': 'companyNameHolder'}).addClass('form-input body__p-bottom-large').html($companyNameLabel).append($companyNameInput),

            $proUpgradePhone = $('<span />').addClass('form-input__label-content').html('Phone'),
            $proUpgradePhoneLabel = $('<label />', {'for': 'proUpgradePhone'}).addClass('form-input__label').html($proUpgradePhone),
            $proUpgradePhoneInput = $('<input />', {
                'type': 'text',
                'id': 'proUpgradePhone',
                'autofocus': 'true',
                'autocomplete': 'off',
                'maxlength': "14"
            }).addClass('form-input__field invalid'),
            $proUpgradePhoneHolder = $('<div />', {'id': 'proUpgradePhoneHolder'}).addClass('form-input body__p-bottom-large').html($proUpgradePhoneLabel).append($proUpgradePhoneInput),

            $addAddress = $('<span />').addClass('form-input__label-content').html('Address'),
            $addAddressLabel = $('<label />', {'for': 'addProAddress'}).addClass('form-input__label').html($addAddress),
            $addAddressInput = $('<input />', {
                'type': 'text',
                'id': 'addProAddress',
                'placeholder': 'Address Line 1',
                'autofocus': 'true',
                'autocomplete': 'off',
                'maxlength': "60"
            }).addClass('form-input__field invalid'),
            $addAddressHolder = $('<div />', {'id': 'addAddressHolder'}).addClass('form-input body__p-bottom-large').html($addAddressLabel).append($addAddressInput),

            $aptLinkdiv2 = $('<a />',  {'id': 'addOptionalAddressLink'}).addClass('u__default-link').html("Add an apartment, suite, building etc."),
            $aptLinkdiv = $('<p />').addClass('body__p-bottom-medium').html($aptLinkdiv2),

            $addOptionalAddress = $('<span />').addClass('form-input__label-content').html('Unit Number (Optional)'),
            $addOptionalAddressLabel = $('<label />', {'for': 'addProOtionalAddress'}).addClass('form-input__label').html($addOptionalAddress),
            $addOptionalAddressInput = $('<input />', {
                'type': 'text',
                'id': 'addProOtionalAddress',
                'placeholder': 'Apartment, suite, building etc',
                'autofocus': 'true',
                'autocomplete': 'off',
                'maxlength': "60"
            }).addClass('form-input__field'),
            $addOptionalAddressHolder = $('<div />', {'id': 'addOptionalAddressHolder'}).addClass('form-input body__p-bottom-large').html($addOptionalAddressLabel).append($addOptionalAddressInput),

            $zipText = $('<span />').addClass('form-input__label-content').html('Zip Code'),
            $zipLabel = $('<label />', {'for': 'zipLabel'}).addClass('form-input__label').html($zipText),
            $zipInput = $('<input />', {
                'type': 'text',
                'id': 'addAddressZipCode',
                'autofocus': 'true',
                'autocomplete': 'off',
                'maxlength': "5"
            }).addClass('form-input__field invalid'),
            $zipHolder = $('<div />', {'id': 'addAddressZipCodeHolder'}).addClass('form-input body__p-bottom-large col__4-12 col__12-12--xs body__p-right-large body__p-left-none').html($zipLabel).append($zipInput),

            $enterCity1 = $('<p />').addClass('body__p-bottom-medium body__m-top-jumbo').html("Enter Zip for City and State"),
            $enterCityDiv = $('<div />', {'id': 'enterZipText'}).addClass('form-input body__p-bottom-large col__8-12 col__12-12--xs body__p-right--none').html($enterCity1),

            //display the city state  dynamically when it is available
            $citystateText = $('<span />').addClass('form-input__label-content').html("City, State"),
            $citystateTextHolder = $('<label />', {'id': 'cityStateText','for':'city'}).addClass('form-input__label').html($citystateText),

            $multipleCitySelect = $('<select />', {'id': 'multipleCitySelect','for':'city'}).addClass('drop-down__select'),
            $multipleCitySelectHolder = $('<span />', {'id': 'multipleCitySelectHolder'}).addClass('drop-down__title drop-down__title--select').html($multipleCitySelect),

            $singleCitySelectHolder = $('<p />', {'id': 'singleCityHolder'}),
            $cityStateHolder = $('<div />', {'id': 'cityStateHolder'}).addClass('form-input body__p-bottom-large col__8-12 col__12-12--xs body__p-right--none').html($citystateTextHolder).append($multipleCitySelectHolder).append($singleCitySelectHolder),

            $zipContainer = $('<div />', {'id': 'zipContainer'}).addClass('u__clearfix body__p-bottom-large').html($zipHolder).append($enterCityDiv).append($cityStateHolder),

            $tradeText = $('<span />').addClass('form-input__label-content').html("Business or Trade"),
            $tradeTextHolder = $('<label />', {'id': 'businessortrade','for':'businessortrade'}).addClass('form-input__label').html($tradeText),
            $tradeOption = $('<option />', {'id': 'tradeSelect1','value':''}).html('Select Business or Trade');
        $tradeSelect = $('<select />', {'id': 'tradeSelect','name':'tradeSelect'}).addClass('drop-down__select invalid body__m-bottom-medium').html($tradeOption),
            $tradeSelectHolder = $('<span />', {'id': 'tradeSelectHolder'}).addClass('drop-down__title drop-down__title--select').html($tradeSelect),
            $businessTradeHolder = $('<div />', {'id': 'businessTradeHolder'}).addClass('form-input body__p-bottom-large u__clearfix').html($tradeTextHolder).append($tradeSelectHolder),

            $otherTradeNameText = $('<span />').addClass('form-input__label-content').html('Enter other Business or Trade'),
            $otherTradeNameLabel = $('<label />', {'for': 'otherTradeName'}).addClass('form-input__label').html($otherTradeNameText),
            $otherTradeNameInput = $('<input />', {
                'type': 'text',
                'id': 'otherTradeName',
                'autofocus': 'true',
                'autocomplete': 'off',
                'maxlength': "99"
            }).addClass('form-input__field'),
            $otherTradeNameHolder = $('<div />', {'id': 'otherTradeNameHolder'}).addClass('form-input body__p-bottom-large').html($otherTradeNameLabel).append($otherTradeNameInput),

            $proXtraTerms = $('<a />', {
                'href': accountUtility.getProXtraTermsView(),
                'target': '_blank'
            }).addClass('u__default-link ').html('ProXtra terms and Conditions'),
            $proXtraTermsHolder = $('<div />').addClass('u__legal u__text-align--center body__p-bottom-medium u__border--bottom').html($proXtraTerms),


            $buttonText = $('<span />').addClass('bttn__content').html('Register for Pro Xtra'),
            $buttonRegister = $('<button />', {
                'id': 'proAccountRegister',
                'disabled': 'disabled'
            }).addClass('bttn bttn--primary body__m-top-small disabled').html($buttonText),




            $createProAccountModal = $('<div />').addClass('createProAccountModalForm'),
            $content = $('<form />', {'method': 'post', 'name': 'createProAccount', 'id': 'createProAccount'});

        $reqTextdiv.addClass('reqTextdiv');
        $reqTextdiv2.addClass('reqTextdiv2');

        $createProAccountModal.html($reqTextdiv);
        $createProAccountModal.append($businessHolder);
        $createProAccountModal.append($headerTextdiv);

        //Added New ShowPassword Checkbox
        $createProAccountModal.append($companyNameHolder);
        $createProAccountModal.append($proUpgradePhoneHolder);
        $createProAccountModal.append($addAddressHolder);
        $createProAccountModal.append($aptLinkdiv);
        $createProAccountModal.append($addOptionalAddressHolder);
        $createProAccountModal.append($zipHolder);
        $createProAccountModal.append($enterCityDiv);
        $createProAccountModal.append($zipContainer);
        $createProAccountModal.append($businessTradeHolder);
        $createProAccountModal.append($otherTradeNameHolder);
        $createProAccountModal.append($termsPrivacyContainer());
        $createProAccountModal.append($proXtraTermsHolder);
        //  $createProAccountModal.append($mainHolder);


        $createProAccountModal.append($buttonRegister);
        $content.addClass('proModalBackground').append($createProAccountModal);

        return $content;
    }

    /**
     * @Description: Helps to switch the tab in Dual Sign-In Tab
     *
     * @Param: $selectedTab
     **/

    var switchTabs = function ($selectedTab, $tabInnerContent) {

        if(authHelper.isIAMThrottled()) {

            var whichTab = $selectedTab.data('tab');

            var headerChildren = $('li.tab--title').children();
            for(var index = 0; index < headerChildren.length; index++) {
                var child = $(headerChildren[index]);
                child.removeClass('tab--selected').addClass('row-header__link fontWeight-normal');
                child.css('border-bottom', '1px solid #ccc !important;');
            };

            var $child = $($selectedTab.children()[0]);
            $child.addClass('tab--selected')
            $child.removeClass('row-header__link fontWeight-normal');
            $child.css('border-bottom', '5px solid #f96302 !important');

            if (whichTab === 'register') {
                $('#dual-signin__headerText').html('Create My Account');
                //$tabInnerContent.html(generateRegisterTab());
                $('form#createAccount').show();
                $('form#userLogin').hide();
                analytics.pushRegisterTabEventInfo();
            } else {
                $('#dual-signin__headerText').html('My Account Sign In');
                //$tabInnerContent.html(generateSignInTab());
                $('form#createAccount').hide();
                $('form#userLogin').show();
                analytics.pushSignInTabEventInfo();
            }
            passwordToggle.initToggle();

        } else {
            var whichTab = $selectedTab.data('tab');
            var headerChildren = $('li.tab--title').children();
            for(var index = 0; index < headerChildren.length; index++) {
              var child = $(headerChildren[index]);
              child.removeClass('tab--selected').addClass('row-header__link fontWeight-normal');
              child.css('border-bottom', '1px solid #ccc !important;');
            };


            var $child = $($selectedTab.children()[0]);
            $child.addClass('tab--selected').removeClass('row-header__link fontWeight-normal');
            $child.css('border-bottom', '5px solid #f96302 !important');
            if (whichTab === 'register') {
                $tabInnerContent.html(generateRegisterTab());
                analytics.pushRegisterTabEventInfo();
            } else {
                $tabInnerContent.html(generateSignInTab());
                analytics.pushSignInTabEventInfo();
            }
            passwordToggle.initToggle();
        }
        checkPersistedUser();
        modal.centerModal();
    }

    /**
     * @Description: This will help to generate the dual sign in modal
     *
     * @Param: successCallback - If not passed, this will refresh the page
     * @Param: errorCallback - If not passed, this will refreesh the page
     **/
    var generateDualSignInContent = function (isRegisterTabSelected, isMobileChannel) {


        if(authHelper.isIAMThrottled()) {

            //This will be used for client delay
            authHelper.setStartTS();

            //Fetch the content from GCP
            var $promise = accountUtility.triggerAJAXCall({
                url : Constants.URLS.PAGE_URL + "?useNewLogin=true",
                type : 'GET',
                crossDomain : true,
                xhrFields: {
                    withCredentials: true
                }
            }, true);

            //Handle the success scenario
            $promise.then(function(data){
                //Display the modal
                if (isMobileChannel) {
                    var width = 'auto',
                        margin = '20px';
                } else {
                    var width = '450px';
                    margin = '';
                }

                modal.showModal(data, undefined, undefined, {
                    'width': width,
                    'height': 'auto',
                    'border-radius': '0px',
                    'background': 'none',
                    'margin': margin
                }, undefined);

                /**
                 * Do not remove the position of this variable declarations. The DOM elements
                 * can be feteched only once the data is appended to the document.
                 */

                var $signinTab =  $('li.tab--title[data-tab="signin"]'),
                    $registerTab = $('li.tab--title[data-tab="register"]'),
                    $resetPasswordLink = $('#reset-password-link'),
                    $setPasswordButton = $('#setPasswordButton'),
                    $selectedTab = (isRegisterTabSelected) ? $registerTab : $signinTab,
                    $tabContent = $('div#authenticationDualSignin div.tabs--content');

                //Select the appropriate tab
                if(isRegisterTabSelected) {
                    var $signinTabChildren = $($signinTab.children()[0]);
                    var $registerTabChildren = $($registerTab.children()[0]);

                                      $signinTabChildren.removeClass('tab--selected');
                    $registerTabChildren.addClass('tab--selected');
                }

                $signinTab.on('click', function () {
                    switchTabs($(this), null);
                });

                $registerTab.on('click', function () {
                    switchTabs($(this), null);
                });

                switchTabs($selectedTab, null);

                $resetPasswordLink.on('click', function(e) {
                    e.preventDefault();

                    if ($("#resetPasswordSwitch").val() === 'true') {
                      var resetPasswordEvoiceSwitch = $("#resetPasswordEvoiceSwitch").val();
                        $("#new-reset-password-link").trigger("click", resetPasswordEvoiceSwitch);
                    } else {
                        generateResetPasswordModalContent($("#authenticationDualSignin #email_id").val());
                    }
                });

                $setPasswordButton.on('click', function(e) {
                    e.preventDefault();
                    accountUtility.hideLoader();
                    if ($("#resetPasswordSwitch").val() === 'true') {
                        var resetPasswordEvoiceSwitch = $("#resetPasswordEvoiceSwitch").val();
                        $("#new-reset-password-link").trigger('click', resetPasswordEvoiceSwitch);
                    } else {
                        var emailIdSetPassword = $("#authenticationDualSignin #email_id").val();
                        modal.hideModal();
                        generateResetPasswordModal(emailIdSetPassword,true);
                    }
                });

                $('div#authenticationDualSignin').parent().attr('style', 'padding: 0px;');
                if (isMobileChannel) {
                    var maxHeightContent = (window.innerHeight - ($("li.tabs--register__title").height() + 60)) + "px";
                    $tabContent.addClass('tabs--content-overflow');
                    $tabContent.attr('style', 'max-height:' + maxHeightContent);
                }

                $('label#toogleBtn').css('display', 'none');
                var enablePhoneNumberRegistrationValue = $('#enablePhoneNumberRegistrationFeature').val();
	              var phoneNumberRegistrationPhase4 = $('#phoneRegistrationPhase4').val();
                if (enablePhoneNumberRegistrationValue !== "true") {
                  // hide the stuff
                  $('#phoneVerifyCheckboxContainer').remove();
                  $('#phoneVerifyLinkContainer').remove();
                  $('#phoneNumberContainer').remove();
                }
	            if (phoneNumberRegistrationPhase4 ==="true") {
		            // Hide the checkbox container for users to verify themselves.
		            $('#phoneVerifyCheckboxContainer').removeClass('u--hide');
	            }

                if (phoneNumberRegistrationPhase4 !=="true") {
                	// Hide the checkbox container for users to verify themselves.
	                $('#phoneVerifyCheckboxContainer').remove();
                }

                        }, function() {
                if(isRegisterTabSelected) {
                    window.location.href = Constants.URLS.REGISTER_PAGE_URL;
                } else {
                    window.location.href = Constants.URLS.LOGON_PAGE_URL;
                }
            });

        } else {
            var $tabContent = $('<div/>', {'id': 'authenticationDualSignin'}).addClass('authentication--dualsignin'),
                $tabs = $('<ul/>').addClass('authentication--dualsignin__tabs'),
                $signInTabHeader = $('<li/>').addClass('tabs--signin__title tab--title').attr('data-tab', 'signin').html('Sign In'),
                $registerTabHeader = $('<li/>').addClass('tabs--register__title tab--title').attr('data-tab', 'register').html('Register'),
                $tabInnerContent = $('<div/>').addClass('body__p-sides-large body__p-bottom-large body__border-top--light tabs--content'),
                $selectTab = (isRegisterTabSelected) ? $registerTabHeader : $signInTabHeader;

            $tabs.append($signInTabHeader).append($registerTabHeader);
            $tabContent.append($tabs).append($tabInnerContent);

            $signInTabHeader.on('click', function () {
                switchTabs($(this), $tabInnerContent);
            });

            $registerTabHeader.on('click', function () {
                switchTabs($(this), $tabInnerContent);
            });

            //Display the modal
            if (isMobileChannel) {
                var width = 'auto',
                    margin = '20px';
            } else {
                var width = '450px';
                margin = '';
            }

            modal.showModal($tabContent, undefined, undefined, {
                'width': width,
                'height': 'auto',
                'border-radius': '8px',
                'background': 'none',
                'margin': margin
            }, undefined);

            switchTabs($selectTab, $tabInnerContent);

            $tabContent.parent().attr('style', 'padding: 0px;');
            if (isMobileChannel) {
                var maxHeightContent = (window.innerHeight - ($("li.tabs--register__title").height() + 60)) + "px";
                $tabInnerContent.addClass('tabs--content-overflow');
                $tabInnerContent.attr('style', 'max-height:' + maxHeightContent);
            }
        }

    };

    /**
     * @Description: This will help generate the reset password modal
     */
    var generateResetPasswordModal = function(emailFromSignIn,triggerSetPasswordFlow, options) {
        //This will be used for client delay
        authHelper.setStartTS();

        options = options || {
            disableEmailAddress : false
        };


        //Fetch the content from GCP
        var $promise = accountUtility.triggerAJAXCall({
            url : Constants.URLS.RESET_PASSWORD_PAGE_URL,
            type : 'GET',
            crossDomain : true,
            xhrFields: {
                withCredentials: true
            }
        }, true);

        //Handle the success scenario
        $promise.then(function(data) {

            modal.showModal(data, undefined, undefined, {
                'width': '635px',
                'height': 'auto',
                'border-radius': '0px',
                'background': 'white',
                'margin': '',
                'max-height': '100%',
                'overflow': 'auto',
            }, undefined);

            analytics.pushResetPasswordEventInfo();

            if(triggerSetPasswordFlow){
                var flow = $("#resetemailsubmit").val();
                setPasswordRequestOTPCode(emailFromSignIn, flow);
            }else{
                $(".title_for_reset_password").html("Reset Password");
            }

            if(options.disableEmailAddress) {
                $('#emailidforreset').attr('disabled', true);
            }

            //Validate Email Id Submit
            $("#emailidforreset").off('change keyup').on('change keyup', function (e) {
                var emailIdForReset = $("#emailidforreset").val();
                if (authHelper.validateEmailAddress(emailIdForReset)) {
                    if (e.keyCode == 13 && $("#resetemailsubmit").prop("disabled") == false) {
                        $("#resetemailsubmit").trigger("click");
                    } else if (e.keyCode != 13){
                        $("#resetemailiderrormessage").hide();
                        $("#resetemailsubmit").removeClass("disabled");
                        $("#resetemailsubmit").prop("disabled", false);
                        $("#temporarycodesubmit").prop("disabled", false);
                        $("#emailidforreset").parent().removeClass("form-input--error");
                        $("#resetnoemailerrormessage").hide();
                    }
                } else {
                    $("#emailidforreset").parent().removeClass("form-input--success");
                    $("#resetemailsubmit").addClass("disabled");
                    $("#resetemailiderrormessage").hide();
                    $("#resetnoemailerrormessage").hide();
                    $("#emailidforreset").parent().removeClass("form-input--error");
                }
            });
            $("#emailidforreset").val(emailFromSignIn);
            $("#emailidforreset").trigger("change");
            $("#otptextfieldentered").val("");
            $("#resetnewpasswordentered").val("");
            //Handle Email Id Submit
            $("#resetemailsubmit").off('click').on('click', function () {
                var flow = $("#resetemailsubmit").val();
                var emailIdForReset = $("#emailidforreset").val();
                $("#update_your_password").removeClass("hide");
                $("#get_you_signed_in").addClass("hide");
                if(authHelper.validateEmailAddress(emailIdForReset)){
                    requestOTPCode(emailIdForReset, flow);
                } else {
                    $("#emailidforreset").parent().removeClass("form-input--success").addClass("form-input--error");
                    $("#resetemailsubmit").addClass("disabled");
                    $("#resetemailsubmit").prop("disabled", true);
                    $("#temporarycodesubmit").addClass("disabled");
                }

            });
            // Handle Temporary Verification Code
            $("#temporarycodesubmit").on('click', function () {
                $("#resetnoemailerrormessage").hide();
                $("#resetnoemailerrormessage").parent().removeClass("form-input--error");
                $("#resetnoemailerrormessage").parent().parent().removeClass("form-input--error");

                var flow = document.getElementById("temporarycodesubmit").getAttribute('value');
                document.getElementById("flow").setAttribute("value", flow);

                var emailIdForReset = $("#emailidforreset").val();
                $("#get_you_signed_in").removeClass("hide");
                $("#update_your_password").addClass("hide");
                analytics.pushTemporaryPasswordEventInfo();
                if(authHelper.validateEmailAddress(emailIdForReset)){
                    requestOTPCode(emailIdForReset, flow);
                } else {
                    $("#emailidforreset").parent().removeClass("form-input--success").addClass("form-input--error");
                    // $("#temporarycodesubmit").addClass("disabled");
                    $("#resetemailsubmit").addClass("disabled");
                    $("#resetnoemailerrormessage").show();
                    $("#resetemailiderrormessage").hide();
                    $("#temporarycodesubmit").prop("disabled", true);
                }

            });

            //Validate OTP Code


            $("#otptextfieldentered").on('change keyup', function (e) {
                var otpCode = $("#otptextfieldentered").val();
                if (otpCode.length == 6) {
                    if (e.keyCode == 13 && $("#otpVerifySubmit").prop("disabled") == false) {
                        $("#otpVerifySubmit").trigger("click");
                    }else if (e.keyCode != 13){
                        $("#invalidOTPCodeErrorMessage").hide();
                        $("#invalidOTPFormatMessage").hide();
                        $("#otptextfieldentered").parent().removeClass("form-input--error");
                        $("#otpVerifySubmit").removeClass("disabled");
                        $("#otpVerifySubmit").prop("disabled", false);
                    }
                } else {
                    //Show Error
                    $("#otptextfieldentered").parent().removeClass("form-input--success");
                    $("#otpVerifySubmit").addClass("disabled");
                }
            });
            //Handle OTP Submit
            $("#otpVerifySubmit").off('click').on('click', function () {
                var otpCode = $("#otptextfieldentered").val();
                if(otpCode.length == 6 && !isNaN(otpCode)){
                    validateOTPCode($("#emailidforreset").val(),otpCode);
                } else{
                    //Show Error
                    $("#invalidOTPFormatMessage").show();
                    $("#otptextfieldentered").parent().removeClass("form-input--success").addClass("form-input--error");
                    $("#otpVerifySubmit").addClass("disabled");
                    $("#otpVerifySubmit").prop("disabled", true);
                }
            });
            submitNewPassword = function () {
                $(".pre-loader").show();
                setTimeout(function(){
                    var newResetPassword = $("#resetnewpasswordentered").val();
                    var passwordStrength = checkPassWordStrength($("#emailidforreset").val(), $("#resetnewpasswordentered").val());
                    if (newResetPassword && passwordStrength > 0) {
                        changePassword();
                    } else {
                        //Show Error
                        $("#resetnewpasswordentered").parent().removeClass("form-input--success").addClass("form-input--error");
                        $("#resetpasswordsubmit").addClass("disabled");
                        $(".pre-loader").hide();
                    }
                }, 400);
            }
            //Validate Password Strength
            $("#resetnewpasswordentered").on('change keyup', function (e) {
                passwordStrength = checkPassWordStrength($("#emailidforreset").val(),$("#resetnewpasswordentered").val());
                if (passwordStrength > 0) {
                    $("#resetnewpasswordentered").parent().addClass("form-input--success");
                    $("#resetpasswordsubmit").removeClass("disabled");
                    if(e.keyCode == 13){
                        submitNewPassword();
                    }

                } else {
                    $("#resetnewpasswordentered").parent().removeClass("form-input--success").addClass("form-input--error");
                    $("#resetpasswordsubmit").addClass("disabled");

                }
            });
            //Handle Reset Pasword Submit

            $("#resetpasswordsubmit").click(function(){
                submitNewPassword()
            });
            //Handle change Email
            $("#correctYourEmailAddress").on('click', function() {
                $("#resetpasswordcodeentry").hide();
                $("#resetemailiderrormessage").hide();
                $("#resetpasswordemailentry").show();
                $(".resendcodeclass").show();
                $("#newCodeSentMessage").hide();
                $("#otpverificationcount").val(0);

            });
            //Handle resend Code
            $("#resendCode").off('click').on('click', function() {
                //Code for resending Code
                var emailIdForReset = $("#emailidforreset").val();
                $("#codeResent").val("true");
                var flow = $("#flow").val();
                if(authHelper.validateEmailAddress(emailIdForReset) &&  parseInt($("#otpverificationcount").val()) < 2){
                    if($("#otpverificationcount").val() == 1){
                        $("#newCodeSentMessage").show();
                        $(".resendcodeclass").hide();
                    }
                    $("#otptextfieldentered").parent().removeClass("form-input--error");
                    $("#otptextfieldentered").val("");


                    requestOTPCode(emailIdForReset, flow);
                } else {
                    $("#emailidforreset").parent().removeClass("form-input--success").addClass("form-input--error");
                    $("#resetemailsubmit").addClass("disabled");

                }
            });

            //Handle Show Hide of Password
            $(".passowrd-button-show.link").on('click', function() {
                if($(".passowrd-button-show.link").html() == "Hide"){
                    $(".passowrd-button-show.link").html("Show");
                    $(".passowrd-button-show.link").next().next().attr("type","password");
                } else {
                    $(".passowrd-button-show.link").html("Hide");
                    $(".passowrd-button-show.link").next().next().attr("type","text");
                }
            });
            //Modal Close
            $(".account-modal__close").on('click', function () {
                if( window.resetpasswordthroughflag == true && (document.location.href == Constants.URLS.CHECKOUT_SIGNIN_PATH ||
                    document.location.href == Constants.URLS.CHECKOUT_SIGNIN_PERSISTENT_PATH || document.location.href == Constants.URLS.MYACCOUNT_CHECKOUT_SIGNIN_PATH)) {
                    document.location = Constants.URLS.CHECKOUT_PATH;
                } else {
                    window.location.reload();
                }
            });


        });
    }
    //Method to request OTP Code
    var requestOTPCode = function (emailId, flow) {
        accountUtility.showLoader();
        $("#invalidOTPCodeErrorMessage").hide();
        //Code for request OTP Code
        var url = Constants.URLS.REQUEST_OTP_PATH + emailId,
            headers =  {
                'Content-Type': 'application/json',
                'Accept': 'application/json',
                'channelId': 1

            };

        headers['Cust-Acct-Client-Token'] =  $("#reset_hat_env").val();
        headers['Cust-Acct-Client-Timestamp'] =  $("#reset_hat_env_ts").val();
        headers['Cust-Acct-Client-ID'] =  $("#reset_hat_env_id").val();
        headers['Cust-Acct-Client-Delay-Token-Validation'] =  "100000";
        var jsonPayload = {};
        // $("#flow").val(flow).change();
        document.getElementById("flow").setAttribute("value", flow);
        var flowElement = document.getElementById("flow");
        flowElement.value = flow;
        if(parseInt($("#otpverificationcount").val()) <= 2) {
            $("#otpverificationcount").val(parseInt($("#otpverificationcount").val()) + 1);
            var startTime = new Date();
            accountUtility.triggerAJAXCall({
                url: url,
                headers: headers,
                type: 'GET',
                crossDomain : true,
                              xhrFields: {
                                  withCredentials: true
                              }
            }).done(function (data, statusText, xhr) {
                var endTime = new Date();
                  var loggingData = $.extend(true, {}, data);

                try {
                    analytics.pushLoggingInfo(url, jsonPayload, loggingData, xhr.status, "GET", startTime, endTime);
                }
                catch (err) {
                    console.log(err)
                }

                accountUtility.hideLoader();
                $("#resetAuthId").val(data.authId);
                $("#resetBackEndHostName").val(data.backendHostName);
                $("#resetCustomerId").val(data.custId);
                $("#resetpasswordemailentry").hide();
                $("#useremailentered").html($("#emailidforreset").val());
                $("#resetpasswordcodeentry").show();
                analytics.pushOTPEntryEventInfo();
                $("#otptextfieldentered").val("");
                $("#otptextfieldentered").parent().removeClass("form-input--success").removeClass("form-input--error");


            }).fail(function (xhr) {
                $("#otpverificationcount").val(0);
                //For checking set password flow
                if(xhr && xhr.responseText) {
                    var endTime = new Date();
                    try {
                        analytics.pushLoggingInfo(url, jsonPayload, xhr, xhr.status, "GET", startTime, endTime);
                    }
                    catch (err) {
                        console.log(err)
                    }

                    var responseData = JSON.parse(xhr.responseText);
                    if(responseData.errors[0].errorCode == "UREG_ERR_159") {
                        //Do set password method
                        setPasswordRequestOTPCode($("#emailidforreset").val());
                    } else {
                        accountUtility.hideLoader();
                        $("#emailidforreset").parent().removeClass("form-input--success").addClass("form-input--error");
                        $("#resetemailsubmit").addClass("disabled");
                        $("#resetemailsubmit").prop("disabled", true);
                        $("#temporarycodesubmit").prop("disabled", true);
                        $("#resetemailiderrormessage").show();
                        var errorObject =  {
                            "errorType" : "error",
                            "displayType" :"inline",
                            "pageSection" : "reset password",
                            "errorMessage" : $("#resetemailiderrormessage").html()
                        };
                        analytics.setErrorEvent(errorObject);
                    }
                } else {
                    accountUtility.hideLoader();
                    $("#emailidforreset").parent().removeClass("form-input--success").addClass("form-input--error");
                    $("#resetemailsubmit").addClass("disabled");
                    $("#resetemailsubmit").prop("disabled", true);
                    $("#temporarycodesubmit").prop("disabled", true);
                    $("#resetemailiderrormessage").show();
                    var errorObject =  {
                        "errorType" : "error",
                        "displayType" :"inline",
                        "pageSection" : "reset password",
                        "errorMessage" : $("#resetemailiderrormessage").html()
                    };
                    analytics.setErrorEvent(errorObject);
                }

            });
        }
    }
    //Method to Set Password OTP Code
    var setPasswordRequestOTPCode = function (emailId, flow) {
        accountUtility.showLoader();
        $(".title_for_reset_password").html("Set Password")
        $("#invalidOTPCodeErrorMessage").hide();
        document.getElementById("flow").setAttribute("value", flow);
        var flowElement = document.getElementById("flow");
        flowElement.value = flow;
        
        // Hiding the One time code login for set password... We will likely allow them to do this later but for now the link will be hidden for set password.
        if($("#temporarycodesubmit")){
            $("#temporarycodesubmit").addClass("hide");
        };

        //Code for request OTP Code
        var url = Constants.URLS.SET_PASSWORD_PATH + emailId,
            headers =  {
                'Content-Type': 'application/json',
                'Accept': 'application/json',
                'channelId': 1

            };

        headers['Cust-Acct-Client-Token'] =  $("#reset_hat_env").val();
        headers['Cust-Acct-Client-Timestamp'] =  $("#reset_hat_env_ts").val();
        headers['Cust-Acct-Client-ID'] =  $("#reset_hat_env_id").val();
        headers['Cust-Acct-Client-Delay-Token-Validation'] =  "100000";
        var jsonPayload = {};
        if(parseInt($("#otpverificationcount").val()) <= 2) {
            $("#otpverificationcount").val(parseInt($("#otpverificationcount").val()) + 1);
            var startTime = new Date();
            accountUtility.triggerAJAXCall({
                url: url,
                headers: headers,
                type: 'GET',
                crossDomain : true,
                              xhrFields: {
                                  withCredentials: true
                              }
            }).done(function (data, statusText, xhr) {
                var endTime = new Date();
                  var loggingData = $.extend(true, {}, data);

                try {
                    analytics.pushLoggingInfo(url, jsonPayload, loggingData, xhr.status, "GET", startTime, endTime);
                }
                catch (err) {
                    console.log(err)
                }
                accountUtility.hideLoader();
                $("#resetAuthId").val(data.authId);
                $("#resetBackEndHostName").val(data.backendHostName);
                $("#resetCustomerId").val(data.custId);
                $("#resetpasswordemailentry").hide();
                $("#useremailentered").html($("#emailidforreset").val());
                $("#resetpasswordcodeentry").show();
                analytics.pushOTPEntryEventInfo();
                $("#otptextfieldentered").val("");
                $("#otptextfieldentered").parent().removeClass("form-input--success").removeClass("form-input--error");

            }).fail(function (xhr) {
                $("#otpverificationcount").val(0);
                var endTime = new Date();
                try {
                    analytics.pushLoggingInfo(url, jsonPayload, xhr, xhr.status, "GET", startTime, endTime);
                }
                catch (err) {
                    console.log(err)
                }
                accountUtility.hideLoader();
                $("#emailidforreset").parent().removeClass("form-input--success").addClass("form-input--error");
                $("#resetemailsubmit").addClass("disabled");
                $("#resetemailiderrormessage").show();
                var errorObject =  {
                    "errorType" : "error",
                    "displayType" :"inline",
                    "pageSection" : "reset password",
                    "errorMessage" : $("#resetemailiderrormessage").html()
                };
                analytics.setErrorEvent(errorObject);

            });
        }
    }
    //Method to validate OTP Code
    var validateOTPCode = function (emailId, OTP) {
        //Code to validate OTP Code
        accountUtility.showLoader();
        var url = Constants.URLS.VERIFY_OTP_PATH,
            headers =  {
                'Content-Type': 'application/json',
                'Accept': 'application/json',
                'channelId': 1

            },
            optPostData = {
                "otpRequest": {
                    "authId": $("#resetAuthId").val(),
                    "backendHost": $("#resetBackEndHostName").val(),
                    "customerId": $("#resetCustomerId").val(),
                    "loginId": $("#emailidforreset").val(),
                    "otp": $("#otptextfieldentered").val(),
                    "origin": "Reset Password -- " + $("#flow").val()
                }
            };

        headers['Cust-Acct-Client-Token'] =  $("#reset_hat_env").val();
        headers['Cust-Acct-Client-Timestamp'] =  $("#reset_hat_env_ts").val();
        headers['Cust-Acct-Client-ID'] =  $("#reset_hat_env_id").val();
        headers['Cust-Acct-Client-Delay-Token-Validation'] =  "100000";
        var startTime = new Date();

        accountUtility.triggerAJAXCall({
            url: url,
            headers: headers,
            type: 'POST',
            data: JSON.stringify(optPostData),
            crossDomain : true,
            xhrFields: {
                withCredentials: true
            }
        }).done(function (data, statusText, xhr) {
            var endTime = new Date();
            var loggingData = $.extend(true, {}, data);
            var loggingPayload = $.extend(true, {}, optPostData);
            analytics.pushSuccessfulSignInIAMEventInfo();

            // loggingData = Object.assign({}, data)
            // loggingPayload = Object.assign({}, optPostData)
            try {
                analytics.pushLoggingInfo(url, loggingPayload, loggingData, xhr.status, "POST", startTime, endTime);
            }
            catch (err) {
                console.log(err)
            }
            var flow = $("#flow").val();
            var customerType = data.customerType;
            document.getElementById("customerType").setAttribute("value", customerType);
            accountUtility.hideLoader();
            if(flow === "resetPassword"){
                $("#resetpasswordtokenId").val(data.tokenId);
                $("#resetpasswordcodeentry").hide();
                $("#resetpasswordnewpasswordentry").show();
                window.resetpasswordthroughflag = true;
                analytics.pushEnterNewPasswordEventInfo();
                setTimeout(function(){
                    $("#resetnewpasswordentered").val("");
                    $("#resetnewpasswordentered").parent().removeClass("form-input--success");
                }, 2000);
            }else if (flow == "temporaryPassword"){
                modal.hideModal();
                if (customerType == "B2B"){
                    document.location.href = Constants.URLS.B2B_ACCOUNT_PROFILE_PATH;
                } else if (customerType === "B2X"){
                    document.location.href = Constants.URLS.B2X_ACCOUNT_PROFILE_PATH;
                } else if (customerType == "MULTIPLE"){
                    document.location.href = Constants.URLS.B2B_ACCOUNT_SELECTOR_PATH;
                } else if (document.location.href == Constants.URLS.CHECKOUT_SIGNIN_PATH || document.location.href == Constants.URLS.CHECKOUT_SIGNIN_PERSISTENT_PATH || document.location.href == Constants.URLS.MYACCOUNT_CHECKOUT_SIGNIN_PATH){
                    document.location.href = Constants.URLS.CHECKOUT_PATH;
                } else {
                    document.location.reload();
                }
            } else {
                modal.hideModal();
                if (document.location.href == Constants.URLS.CHECKOUT_SIGNIN_PATH || document.location.href == Constants.URLS.CHECKOUT_SIGNIN_PERSISTENT_PATH || document.location.href == Constants.URLS.MYACCOUNT_CHECKOUT_SIGNIN_PATH){
                    document.location.href = Constants.URLS.CHECKOUT_PATH;
                } else {
                    document.location.reload();
                }
            }
        }).fail(function (xhr) {
            var endTime = new Date();
            try {
                analytics.pushLoggingInfo(url, JSON.stringify(optPostData), xhr, xhr.status, "POST", startTime, endTime);
            }
            catch (err) {
                console.log(err)
            }
            var errorCode = accountUtility.catchErrorCode(xhr);
            if (errorCode && errorCode === "AUTH_ERR_125" && $("#codeResent").val() === "false") {
                $("#invalidOTPCodeErrorMessage").html("Looks like this code isn't working. Click the link below to resend your code and try a new one.")
            }else if(errorCode === "PASS_ERR_018") {
                $("#invalidOTPCodeErrorMessage").html("We're sorry, we cannot currently process your password reset request")
            }else{
                $("#invalidOTPCodeErrorMessage").html("We're sorry, your code is incorrect. Please check to make sure the code you entered matches the one sent.")
            }
            accountUtility.hideLoader();
            $("#invalidOTPCodeErrorMessage").show();
            $("#otptextfieldentered").parent().removeClass("form-input--success").addClass("form-input--error");
            $("#otpVerifySubmit").addClass("disabled");
            $("#otpVerifySubmit").prop("disabled", true);
            var errorObject =  {
                "errorType" : "error",
                "displayType" :"inline",
                "pageSection" : "reset password code entry",
                "errorMessage" : $("#invalidOTPCodeErrorMessage").html()
            };
            analytics.setErrorEvent(errorObject);
        });


    }
    //Method to change password
    var changePassword = function () {
        accountUtility.showLoader();
        $("#resetnewpasswordentered").parent().removeClass("form-input--error");
        $("#password_error_previous").hide();
        $("#password_error_email").hide();
        $("#password_error_duplicate").hide();
        $("#password_error_common").hide();
        var customerType = $("#customerType").val();
        passwordStrength = checkPassWordStrength($("#emailidforreset").val(),$("#resetnewpasswordentered").val());
        if(passwordStrength > 0){
            var url = Constants.URLS.CHANGE_PASSWORD_PATH + $("#resetCustomerId").val() + '/profile/identity',
                headers =  {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json',
                    'channelId': 1,
                    'authorization' : $("#resetpasswordtokenId").val()

                };

            headers['Cust-Acct-Client-Token'] =  $("#reset_hat_env").val();
            headers['Cust-Acct-Client-Timestamp'] =  $("#reset_hat_env_ts").val();
            headers['Cust-Acct-Client-ID'] =  $("#reset_hat_env_id").val();
            headers['Cust-Acct-Client-Delay-Token-Validation'] =  "100000";
            optPutData = {
                "identity": {
                    "logonId": $("#emailidforreset").val(),
                    "newPassword": $("#resetnewpasswordentered").val()
                }
            };
            var startTime = new Date();

            accountUtility.triggerAJAXCall({
                url: url,
                headers: headers,
                crossDomain: true,
                type : 'PUT',
                data : JSON.stringify(optPutData),
                xhrFields: {
                    withCredentials: true
                }
            }).done(function (data, statusText, xhr) {
              var endTime = new Date ();


                var loggingData = $.extend(true, {}, data);
                var loggingPayload = $.extend(true, {}, optPutData);

                try {
                    analytics.pushLoggingInfo(url, loggingPayload, loggingData, xhr.status, "PUT", startTime, endTime);
                }
                catch (err) {
                    console.log(err)
                }
                accountUtility.hideLoader();
                modal.hideModal();
                if (customerType == "B2B"){
                    document.location.href = Constants.URLS.B2B_ACCOUNT_PROFILE_PATH;
                } else if (customerType === "B2X"){
                    document.location.href = Constants.URLS.B2X_ACCOUNT_PROFILE_PATH;
                } else if (customerType == "MULTIPLE"){
                    document.location.href = Constants.URLS.B2B_ACCOUNT_SELECTOR_PATH;
                } else if (document.location.href == Constants.URLS.CHECKOUT_SIGNIN_PATH || document.location.href == Constants.URLS.CHECKOUT_SIGNIN_PERSISTENT_PATH || window.location.href == Constants.URLS.MYACCOUNT_CHECKOUT_SIGNIN_PATH){
                    document.location.href = Constants.URLS.CHECKOUT_PATH;
                } else {
                    document.location.reload();
                }
            }).fail(function (xhr) {
                accountUtility.hideLoader();
                if(xhr && xhr.responseText) {
                    var endTime = new Date();
                    try {
                        analytics.pushLoggingInfo(url, JSON.stringify(optPutData), xhr, xhr.status, "PUT", startTime, endTime);
                    }
                    catch (err) {
                        console.log(err)
                    }
                    var responseData = JSON.parse(xhr.responseText);
                    if(responseData.identity.errors[0].errorCode == "AUTH_ERR_116") {
                        $("#resetnewpasswordentered").parent().removeClass("form-input--success").addClass("form-input--error");
                        $("#password_error_previous").show();

                    } else if(responseData.identity.errors[0].errorCode == "GEN_ERR_500"){
                        $("#resetnewpasswordentered").parent().removeClass("form-input--success").addClass("form-input--error");
                        $("#password_generic_error").show();
                    }
                    var errorObject =  {
                        "errorType" : "error",
                        "displayType" :"inline",
                        "pageSection" : "enter new password",
                        "errorMessage" : $("#password_error_previous").html(),
                        "code" : responseData.identity.errors[0].errorCode
                    };
                    analytics.setErrorEvent(errorObject);
                }
            });

        }
        accountUtility.hideLoader();
        //Code for request OTP Code

    }
    //Method to check pasword strength
    var checkPassWordStrength = function(email, password) {
        $("#password_error_previous").hide();
        $("#password_error_email").hide();
        $("#password_error_duplicate").hide();
        $("#password_error_common").hide();
        $("#password_generic_error").hide();
        if(password.length > 0) {
            var regexPat = /(.)\1{4,}/;
            var commonPasswords = ['111111', '11111111', '112233', '121212', '123123', '123456', '1234567', '12345678', '131313', '232323', '654321', '666666', '696969',
                '777777', '7777777', '8675309', '987654', 'aaaaaa', 'abc123', 'abcdef', 'abgrtyu', 'access', 'access14', 'action', 'albert', 'alexis', 'amanda', 'amateur', 'andrea', 'andrew',  'angela', 'angels',
                'animal', 'anthony', 'apollo', 'apples', 'arsenal', 'arthur', 'asdfgh', 'ashley', 'august', 'austin', 'badboy', 'bailey', 'banana', 'barney', 'baseball', 'batman', 'beaver', 'beavis', 'bigdaddy', 'bigdog', 'birdie',
                'bitches', 'biteme', 'blazer', 'blonde', 'blondes', 'bond007', 'bonnie', 'booboo', 'booger', 'boomer', 'boston', 'brandon', 'brandy', 'braves', 'brazil', 'bronco', 'broncos', 'bulldog', 'buster', 'butter', 'butthead',
                'calvin', 'camaro', 'cameron', 'canada', 'captain', 'carlos', 'carter', 'casper', 'charles', 'charlie', 'cheese', 'chelsea', 'chester', 'chicago', 'chicken', 'cocacola', 'coffee', 'college', 'compaq', 'computer',
                'cookie', 'cooper', 'corvette', 'cowboy', 'cowboys', 'crystal', 'dakota', 'dallas', 'daniel', 'danielle', 'debbie', 'dennis', 'diablo', 'diamond', 'doctor', 'doggie', 'dolphin', 'dolphins', 'donald', 'dragon', 'dreams',
                'driver', 'eagle1', 'eagles', 'edward', 'einstein', 'erotic', 'extreme', 'falcon', 'fender', 'ferrari', 'firebird', 'fishing', 'florida', 'flower', 'flyers', 'football', 'forever', 'freddy', 'freedom', 'gandalf',
                'gateway', 'gators', 'gemini', 'george', 'giants', 'ginger', 'golden', 'golfer', 'gordon', 'gregory', 'guitar', 'gunner', 'hammer', 'hannah', 'hardcore', 'harley', 'heather', 'helpme', 'hockey', 'hooters', 'horney',
                'hotdog', 'hunter', 'hunting', 'iceman', 'iloveyou', 'internet', 'iwantu', 'jackie', 'jackson', 'jaguar', 'jasmine', 'jasper', 'jennifer', 'jeremy', 'jessica', 'johnny', 'johnson', 'jordan', 'joseph', 'joshua', 'junior',
                'justin', 'killer', 'knight', 'ladies', 'lakers', 'lauren', 'leather', 'legend', 'letmein', 'little', 'london', 'lovers', 'maddog', 'madison', 'maggie', 'magnum', 'marine', 'marlboro', 'martin', 'marvin', 'master', 'matrix',
                'matthew', 'maverick', 'maxwell', 'melissa', 'member', 'mercedes', 'merlin', 'michael', 'michelle', 'mickey', 'midnight', 'miller', 'mistress', 'monica', 'monkey', 'monster', 'morgan', 'mother', 'mountain', 'muffin',
                'murphy', 'mustang', 'naked', 'nascar', 'nathan', 'naughty', 'ncc1701', 'newyork', 'nicholas', 'nicole', 'nipple', 'nipples', 'oliver', 'orange', 'packers', 'panther', 'panties', 'parker', 'password', 'password1',
                'password12', 'password123', 'patrick', 'peaches', 'peanut', 'pepper', 'phantom', 'phoenix', 'player', 'please', 'pookie', 'porsche', 'prince', 'princess', 'private', 'purple', 'pussies', 'qazwsx', 'qwerty',
                'qwertyui', 'rabbit', 'rachel', 'racing', 'raiders', 'rainbow', 'ranger', 'rangers', 'rebecca', 'redskins', 'redsox', 'redwings', 'richard', 'robert', 'rocket', 'rosebud', 'runner', 'rush2112', 'russia', 'samantha',
                'sammy', 'samson', 'sandra', 'saturn', 'scooby', 'scooter', 'scorpio', 'scorpion', 'secret', 'sexsex', 'shadow', 'shannon', 'shaved', 'sierra', 'silver', 'skippy', 'slayer', 'smokey', 'snoopy', 'soccer', 'sophie', 'spanky',
                'sparky', 'spider', 'squirt', 'srinivas', 'startrek', 'starwars', 'steelers', 'steven', 'sticky', 'stupid', 'success', 'summer', 'sunshine', 'superman', 'surfer', 'swimming', 'sydney', 'taylor', 'tennis', 'teresa',
                'tester', 'testing', 'theman', 'thomas', 'thunder', 'thx1138', 'tiffany', 'tigers', 'tigger', 'tomcat', 'topgun', 'toyota', 'travis', 'trouble', 'trustno1', 'tucker', 'turtle', 'twitter', 'united', 'vagina', 'victor',
                'victoria', 'viking', 'voodoo', 'voyager', 'walter', 'warrior', 'welcome', 'whatever', 'william', 'willie', 'wilson', 'winner', 'winston', 'winter', 'wizard', 'xavier', 'xxxxxx', 'xxxxxxxx', 'yamaha', 'yankee', 'yankees',
                'yellow', 'zxcvbn', 'zxcvbnm', 'zzzzzz'];


            if(regexPat.test(password)){
                $("#password_error_duplicate").show();
                return 0;
            }
            if(password.length > 7){
                if(password.toLowerCase() === email.toLowerCase()) {
                    $("#password_error_email").show();
                    return 0;
                }
                if(commonPasswords.indexOf(password) > -1) {
                    $("#password_error_common").show();
                    return 0;
                }
            }

            if ((password.length < 8) || commonPasswords.indexOf(password) > -1 || password.toLowerCase() === email.toLowerCase() || regexPat.test(password) ) {
                var score = 0;
                return 0; //weak password
            }
            var score = 0;
            if (/[a-z]/.test(password)) { //Check lowercase
                score++;
            }
            if (/[A-Z]/.test(password)) { //Check uppercase
                score++;
            }
            if (/\d/.test(password)) { //Check Numbers
                score++;
            }
            if (/^[a-zA-Z0-9- ]*$/.test(password) == false) { //Check Special Characters
                score++;
            }
            if ((score > 1 && (password.length > 12)) || (score > 2 && (password.length > 8))) {
                return 2; //strong password
            }
            return 1; //good password
        }
    }

    /**
     * @Description: This will help to generate the customer preferences modal
     *
     * @Param: successCallback - If not passed, this will refresh the page
     * @Param: errorCallback - If not passed, this will refresh the page
     **/
    var generateCustomerPreferencesModal = function () {

        var $reqTextdiv2 = $('<h1 />').addClass('body__p-right-large').html("You're Registered!"),
            $reqTextdiv = $('<div />').addClass('body__p-bottom-small u__border--bottom').html($reqTextdiv2),

            $header1 = $('<h2 />').html("Now Choose Your Subscriptions"),
            $header2 = $('<p />').addClass('body__m-top-large').html("Let us know which emails you'd like to receive for great deals and project ideas. Not sure? You can update your choices anytime from your <b>My Account</b> page."),
            $headerDiv = $('<div />').addClass('body__p-updown-xlarge').html($header1).append($header2),

            $checkboxInput = $('<input />', {
                'type': 'checkbox',
                'id': 'THDCheckbox',
                'name': 'THDCheckbox'
            }).addClass('checkbox-btn__input').prop( "checked", true ),
            $checkBoxBottomText = $('<span />').html("Sneak peaks and exclusive savings."),
            $checkBoxText = $('<span />').html("<b>The Home Depot </b></br>").append($checkBoxBottomText),
            $CheckBoxLabel = $('<label />', {'for': 'THDCheckbox'}).addClass('checkbox-btn__label').html($checkBoxText),
            $THDCheckboxHolder = $('<div />').addClass('checkbox-btn body__m-top-small').html($checkboxInput).append($CheckBoxLabel),

            $checkboxInput = $('<input />', {
                'type': 'checkbox',
                'id': 'localAdCheckbox',
                'name': 'localAdCheckbox'
            }).addClass('checkbox-btn__input'),
            $checkBoxBottomText = $('<span />').html("First-looks at specials from your store."),
            $checkBoxText = $('<span />').html("<b>Local Ad</b></br>").append($checkBoxBottomText),
            $CheckBoxLabel = $('<label />', {'for': 'localAdCheckbox'}).addClass('checkbox-btn__label').html($checkBoxText),
            $localAdCheckboxHolder = $('<div />').addClass('checkbox-btn body__m-top-small').html($checkboxInput).append($CheckBoxLabel),

            $checkboxInput = $('<input />', {
                'type': 'checkbox',
                'id': 'PROCheckbox',
                'name': 'PROCheckbox'
            }).addClass('checkbox-btn__input'),
            $checkBoxBottomText = $('<span />').html("Deals designed to make your job easier."),
            $checkBoxText = $('<span />').html("<b>PRO</b></br>").append($checkBoxBottomText),
            $CheckBoxLabel = $('<label />', {'for': 'PROCheckbox'}).addClass('checkbox-btn__label').html($checkBoxText),
            $PROCheckboxHolder = $('<div />').addClass('checkbox-btn body__m-top-small').html($checkboxInput).append($CheckBoxLabel),

            $checkboxInput = $('<input />', {
                'type': 'checkbox',
                'id': 'specialBuyCheckbox',
                'name': 'specialBuyCheckbox'
            }).addClass('checkbox-btn__input'),
            $checkBoxBottomText = $('<span />').html("The name says it all. Daily deals, delivered."),
            $checkBoxText = $('<span />').html("<b>Special Buy of the Day</b></br>").append($checkBoxBottomText),
            $CheckBoxLabel = $('<label />', {'for': 'specialBuyCheckbox'}).addClass('checkbox-btn__label').html($checkBoxText),
            $SpecialBuyCheckboxHolder = $('<div />').addClass('checkbox-btn body__m-top-small').html($checkboxInput).append($CheckBoxLabel),

            $checkboxInput = $('<input />', {
                'type': 'checkbox',
                'id': 'gardenClubCheckbox',
                'name': 'gardenClubCheckbox'
            }).addClass('checkbox-btn__input'),
            $checkBoxBottomText = $('<span />').html("All the news that's fit to pot, plus email-only offers."),
            $checkBoxText = $('<span />').html("<b>The Garden Club</b></br>").append($checkBoxBottomText),
            $CheckBoxLabel = $('<label />', {'for': 'gardenClubCheckbox'}).addClass('checkbox-btn__label').html($checkBoxText),
            $gardenClubCheckboxHolder = $('<div />').addClass('checkbox-btn body__m-top-small').html($checkboxInput).append($CheckBoxLabel),

            $checkboxInput = $('<input />', {
                'type': 'checkbox',
                'id': 'decorAndDesignCheckbox',
                'name': 'decorAndDesignCheckbox'
            }).addClass('checkbox-btn__input'),
            $checkBoxBottomText = $('<span />').html("Room and style ideas plus design tips and more."),
            $checkBoxText = $('<span />').html("<b>Style &amp; Decor</b></br>").append($checkBoxBottomText),
            $CheckBoxLabel = $('<label />', {'for': 'decorAndDesignCheckbox'}).addClass('checkbox-btn__label').html($checkBoxText),
            $decorAndDesignCheckboxHolder = $('<div />').addClass('checkbox-btn body__m-top-small u__border--bottom body__p-bottom-xlarge').html($checkboxInput).append($CheckBoxLabel),

            $buttonText = $('<span />').addClass('bttn__content submitButtonText').html("Subscribe"),
            $buttonRegister = $('<button />', {
                'id': 'customerPreferencesSubmit'
            }).addClass('bttn bttn--primary body__m-top-large').html($buttonText),

            $createCustomerPreferencesModal = $('<div />').addClass('createProAccountModalForm'),
            $content = $('<form />', {'method': 'post', 'name': 'saveCustomerPreferences', 'id': 'saveCustomerPreferences'});




        $reqTextdiv.addClass('reqTextdiv');
        $reqTextdiv2.addClass('reqTextdiv2');

        $createCustomerPreferencesModal.html($reqTextdiv);

        $createCustomerPreferencesModal.append($headerDiv);
        $createCustomerPreferencesModal.append($THDCheckboxHolder);
        $createCustomerPreferencesModal.append($localAdCheckboxHolder);
        $createCustomerPreferencesModal.append($PROCheckboxHolder);
        $createCustomerPreferencesModal.append($SpecialBuyCheckboxHolder);
        $createCustomerPreferencesModal.append($gardenClubCheckboxHolder);
        $createCustomerPreferencesModal.append($decorAndDesignCheckboxHolder);

        $createCustomerPreferencesModal.append($buttonRegister);
        $content.addClass('proModalBackground').append($createCustomerPreferencesModal);

        return $content;

    }

    var generateProModalContent= function(){
        var $proModalContent = generateProUpgradeModal();
        modal.showModal($proModalContent, undefined, undefined, {
            'width': '450px',
            'height': 'auto',
            'border-radius': '0px',
            'background': 'none',
            'margin': '',
            'max-height': '100%',
            'overflow': 'auto',
        },undefined);
        $proModalContent.parent().attr('style', 'padding: 0px;');
        analytics.pushCreateAProXtraAccountOverlayEventInfo();
    }

    var generateCustomerPreferencesModalContent= function(){
        accountUtility.hideLoader();
        var $customerPreferencesModalContent = generateCustomerPreferencesModal();
        modal.showModal($customerPreferencesModalContent, undefined, undefined, {
            'width': '450px',
            'height': 'auto',
            'border-radius': '0px',
            'background': 'none',
            'margin': '',
            'max-height': '100%',
            'overflow': 'auto',
        },undefined);
        $customerPreferencesModalContent.parent().attr('style', 'padding: 0px;');
    }

    var generateResetPasswordModalContent = function(emailFromSignIn){
        modal.hideModal();
        accountUtility.hideLoader();

        generateResetPasswordModal(emailFromSignIn);
    }

    var generateResetPasswordModalContentFromPage = function(emailAddress, options){
        modal.hideModal();
        accountUtility.hideLoader();
        if (document.location.href == Constants.URLS.CHECKOUT_SIGNIN_PATH || document.location.href == Constants.URLS.CHECKOUT_SIGNIN_PERSISTENT_PATH){
            emailAddress = $("#loginValue").val();
        } else if(!emailAddress) {
            emailAddress = $("#signinEmail").val();
        }
        generateResetPasswordModal(emailAddress, false, options);
    }

    var generateSetPasswordModalFromPage = function() {
        accountUtility.hideLoader();
      $("#new-set-password-link").trigger("click");
        if ($("#resetPasswordSwitch").val() === 'true') {
          $("#new-set-password-link").trigger("click");
        } else {
            var emailIdSetPassword = $("#authenticationDualSignin #email_id").val();
            if (emailIdSetPassword && emailIdSetPassword.length && emailIdSetPassword.length === 0) {
	            var emailFormField = document.querySelector("form#createAccount input#email_id");
                emailIdSetPassword = emailFormField.value
            }
            modal.hideModal();
            generateResetPasswordModal(emailIdSetPassword,true);
        }
    }

    var generateSetPasswordModalFromRegistrationPage = function(){
        var emailIdSetPassword = $("#createAccount #email_id").val();
        if (emailIdSetPassword && emailIdSetPassword.length && emailIdSetPassword.length === 0) {
            var emailFormField = document.querySelector("form#createAccount input#email_id");
                emailIdSetPassword = emailFormField.value
            }
        modal.hideModal();
        accountUtility.hideLoader();
        generateResetPasswordModal(emailIdSetPassword,true);
    }

    var generateSetPasswordModalFromLoginPage = function(){
        var emailIdSetPassword = $("#signinEmail").val();
        modal.hideModal();
        accountUtility.hideLoader();
        generateResetPasswordModal(emailIdSetPassword,true);
    }

    $(document).on('change', '.checkbox-btn__input', function() {
        if(!$('#THDCheckbox').is(':checked') && !$('#localAdCheckbox').is(':checked') && !$('#PROCheckbox').is(':checked') && !$('#specialBuyCheckbox').is(':checked') && !$('#gardenClubCheckbox').is(':checked') && !$('#decorAndDesignCheckbox').is(':checked')) {
            $(".submitButtonText").html("Save");
        } else {
            $(".submitButtonText").html("Subscribe");
        }
    });


    return {
        showModal: generateDualSignInContent,
        showProModal: generateProModalContent,
        showForgotPasswordModal: generateResetPasswordModalContentFromPage,
        showSetPasswordModal: generateSetPasswordModalFromPage,
        showSetPasswordRegistrationModal: generateSetPasswordModalFromRegistrationPage,
        showSetPasswordLoginModal: generateSetPasswordModalFromLoginPage,
        showCustomerPreferencesModal: generateCustomerPreferencesModalContent,
        hideModal : function() {
            modal.hideModal();
        }
    };
});

/**
 * @Description: Helps to do the validation in registration modal
 **/
(function closure(root, factory) {
	if (typeof define === 'function' && define.amd) {
		define('auth.reg.validation',[
			'jquery',
			'auth.constants',
			'auth.helper',
			'account.utility',
			'auth.modal',
			'auth.analytics',
			'auth.helper'
		], function load(jQuery, Constants, helper, accountUtility, authenticationModal, analytics, authHelper) {
			return factory(root, jQuery, Constants, helper, accountUtility, authenticationModal, analytics, authHelper);
		});
	} else {
		// For non-AMD module, expose this to global (will also be useful for test cases)
		/*eslint-disable*/
		factory(root, jQuery, Constants, helper, accountUtility, authenticationModal, analytics, authHelper);
		/*eslint-enable*/
	}
})(this, function factory(root, $, Constants, helper, accountUtility, authenticationModal, analytics, authHelper) {

	/**
	 * @Description: Helps to check if the field is empty
	 *
	 * @Param: value
	 * @Return: returns the true or false
	 **/

	var callInProgress = false,
		doCheckEmailExistCall = true;

	var $errorFormInput = function (errorText) {
		if (authHelper.isIAMThrottled()) {
			var errorObject = {
				"errorType": "error",
				"displayType": "inline",
				"pageSection": "Registration",
				"errorMessage": errorText
				// "errorCode":msg[0].id
			};
		} else {
			analytics.pushAuthErrorEventInfo({
				errorMessage: errorText
			});
		}

		return $('<span />').addClass('form-input-error__message body__p-top-xsmall u__block').html(errorText);
	};

	var $removeFormError = function ($inputElement) {
		$inputElement.removeClass('invalid');
		$inputElement.next('.form-input-error__message').remove();
		$inputElement.parents('.form-input').removeClass('form-input--error');
	};

	var $errorContainer = function (errorText, errorCode) {
		var $errorContent = $('<span />').addClass('alert-inline__tilte').html(errorText),
			$errorContainer = $('<span />').addClass('alert-inline__message').html($errorContent),
			$errorBlock = $('<div />').addClass('alert-inline alert-inline--danger body__p-top-small').html($errorContainer);


		if (authHelper.isIAMThrottled()) {
			var errorObject = {
				"errorType": "error",
				"displayType": "inline",
				"pageSection": "Registration",
				"errorMessage": errorText,
				"errorCode": errorCode
			};
			analytics.setErrorEvent(errorObject);
		} else {
			analytics.pushAuthErrorEventInfo({
				errorMessage: errorText
			});
		}

		return $errorBlock;
	};

	var $removeError = function ($inputElement) {
		$inputElement.prev('.alert-inline').remove();
	};

	var checkRegisterEnable = function () {
		var $parent = $('div#authenticationDualSignin').find('form#createAccount'),
			$btn = $parent.find('#accountRegister');
		if ($parent.find('.invalid').length === 0) {
			$btn.removeClass('disabled').removeAttr('disabled');
		} else {
			$btn.addClass('disabled').attr('disabled');
		}
	};

	var showErrorText = function ($input, errText) {
		if (errText !== '') {
			$input.addClass('invalid').parents('.form-input').addClass('form-input--error');
			$errorFormInput(errText).insertAfter($input);
		}
		checkRegisterEnable();
		return (errText === '');
	};


	var checkForRegularPhoneNumberErrors = function ($input) {
		$removeFormError($input);
		var errText = '',
			inputVal = $input.val();
		if (helper.validateEmpty(inputVal)) {
			errText = Constants.ERROR.PRO_MANDATORY_PHONE_NUMBER;
		} else if (!helper.phoneNumberValidator(inputVal)) {
			errText = Constants.ERROR.PRO_INVALID_PHONE_NUMBER;
		}
		return showErrorText($input, errText);
	};

	var checkForFirstNameErrors = function ($input) {
		$removeFormError($input);
		var errText = '',
			inputVal = $input.val();
		if (helper.validateEmpty(inputVal)) {
			errText = Constants.ERROR.REGISTER_FIRST_NAME_EMPTY_ERR;
		} else if (!helper.isValidName(inputVal)) {
			errText = Constants.ERROR.REGISTER_FIRST_NAME_INVALID_ERR;
		}
		return showErrorText($input, errText);
	}

	var checkForLastNameErrors = function ($input) {
		$removeFormError($input);
		var errText = '',
			inputVal = $input.val();
		if (helper.validateEmpty(inputVal)) {
			errText = Constants.ERROR.REGISTER_LAST_NAME_EMPTY_ERR;
		} else if (!helper.isValidName(inputVal)) {
			errText = Constants.ERROR.REGISTER_LAST_NAME_INVALID_ERR;
		}
		return showErrorText($input, errText);
	}

	var checkForZipCodeErrors = function ($input) {
		$removeFormError($input);
		var errText = '',
			inputVal = $input.val();
		if (helper.validateEmpty(inputVal)) {
			errText = authHelper.isIAMThrottled() ? Constants.ERROR.PRO_MANDATORY_ZIPCODE_ERR : Constants.ERROR.REGISTER_ZIPCODE_EMPTY_ERR;
		} else if (!helper.validateZipcode(inputVal)) {
			errText = Constants.ERROR.REGISTER_ZIPCODE_INVALID_ERR;
		}
		return showErrorText($input, errText);
	}


	var doEmailValidation = function (logonId) {
		var channelId = authHelper.getChannelId();
		$.support.cors = true;
		if (authHelper.isIAMThrottled()) {
			var clientInfo = authHelper.getClientInfo() || {},
				url = Constants.URLS.EMAIL_VERIFICATION_URL_GCP,
				headers = {
					'Content-Type': 'application/json',
					'Accept': 'application/json',
					'channelId': channelId,

				};

			if (clientInfo.flag) {
				url = Constants.URLS.EMAIL_VERIFICATION_URL_GCP2;
				headers['Cust-Acct-Client-Token'] = clientInfo['tHat'];
				headers['Cust-Acct-Client-Timestamp'] = clientInfo['ts'];
				headers['Cust-Acct-Client-ID'] = clientInfo['id'];
				headers['Cust-Acct-Client-Delay-Token-Validation'] = authHelper.getClientDelay();
			}
			return accountUtility.triggerAJAXCall({
				url: url + '?emailId=' + logonId,
				type: 'GET',
				headers: headers,
				xhrFields: {
					withCredentials: true
				},
				crossDomain: true
			});
		} else {
			return accountUtility.triggerAJAXCall({
				url: Constants.URLS.EMAIL_VERIFICATION_URL,
				type: 'POST',
				data: 'email=' + logonId,
				dataType: 'jsonp',
				jsonpCallback: 'parseResponse',
				async: false,
				crossDomain : true,
				xhrFields: {
					withCredentials: true
				}
			});

		}
	};
	var hideSetPassword = function () {
		$('.registerSetPwd').hide();
		$('.setPasswordDiv').removeClass('hide');
		$('.setPasswordDiv').show();

	}

	var checkForEmailErrors = function ($input, doCheckEmailExistCall) {
		if (authHelper.isIAMThrottled()) {
			$removeFormError($input);
			var errText = '',
				inputVal = $input.val();
			if (helper.validateEmpty(inputVal)) {
				errText = Constants.ERROR.EMAIL_FORMAT_ERR;
				showErrorText($input, errText);
			} else if (!helper.validateEmailAddress(inputVal)) {
				errText = Constants.ERROR.EMAIL_FORMAT_ERR;
				showErrorText($input, errText);
			} else {
				if (doCheckEmailExistCall) {
					if (!callInProgress) {
						callInProgress = true;
						doEmailValidation(inputVal)
							.done(function (data) {
								callInProgress = false;
								if (data === false) {  // if data is false doesn't exist.
									return true;
								}
							})
							.fail(function (error) {
								//@TODO: Enable register button
								callInProgress = false;
								if (error.status === 400 && error.responseJSON && error.responseJSON.errors && error.responseJSON.errors[0].errorCode == "UREG_ERR_158") {
									window.showSignIn = authenticationModal.showModal;
									errText = Constants.ERROR.REGISTER_EMAIL_EXISTS_ERR_IAM;
									showErrorText($input, errText);
								} else if (error.responseJSON && error.responseJSON.errors && error.responseJSON.errors[0].errorCode == "UREG_ERR_159") {
									window.showSignIn = authenticationModal.showModal;
									errText = Constants.ERROR.REGISTER_SET_PASSWORD_ERR;
									showErrorText($input, errText);
									hideSetPassword();
								}

							});
					}
				}
			}
			return (errText === '');

		} else {
			$removeFormError($input);
			var errText = '',
				inputVal = $input.val();
			if (helper.validateEmpty(inputVal)) {
				errText = Constants.ERROR.EMAIL_EMPTY_ERR;
			} else if (!helper.validateEmailAddress(inputVal)) {
				errText = Constants.ERROR.EMAIL_FORMAT_ERR;
			} else {
				doEmailValidation(inputVal)
					.done(function (data) {
						if (data) {
							if (data.response.result === false && !data.response.proCrtAcct) {
								window.showSignIn = authenticationModal.showModal;
								errText = Constants.ERROR.REGISTER_EMAIL_EXISTS_ERR;
							} else if (data.error === true && !data.response.proCrtAcct) {
							} else if (data.response.proCrtAcct) {
							}
							return showErrorText($input, errText);
						}
					})
					.fail(function (xhr) {
						//@TODO: Enable register button
						return true;
					});
			}
			return showErrorText($input, errText);
		}
	}

	var checkHomeDepotMail = function ($input) {
		$removeFormError($input);
		var errText = '',
			inputVal = $input.val();
		if (!helper.checkHomeDepotMail(inputVal)) {
			errText = Constants.ERROR.PRO_HOMEDEPOT_MAIL_ERR;
		}
		return showErrorText($input, errText);
	}

	var validatePassword = function ($input, $confirmInput) {
		$removeFormError($input);
		var errText = '',
			inputVal = $input.val();
		if (helper.validateEmpty(inputVal)) {
			errText = Constants.ERROR.PASSWORD_EMPTY_ERR;
		} else if (helper.validateMinLength(inputVal, $input.attr('min-length'))) {
			errText = authHelper.isIAMThrottled() ? Constants.ERROR.REGISTER_PASSWORD_WEAK_ERR_IAM : Constants.ERROR.REGISTER_PASSWORD_INVALID_ERR;
		} else if ($input.data('strength') < 1) {
			errText = authHelper.isIAMThrottled() ? Constants.ERROR.REGISTER_PASSWORD_WEAK_ERR_IAM : Constants.ERROR.REGISTER_PASSWORD_WEAK_ERR;
		} else if ($confirmInput.length > 0 && !helper.validateEmpty($confirmInput.val())) {
			validateConfirmPassword($input, $confirmInput);
		}
		return showErrorText($input, errText);
	}

	var validateSinglePassword = function ($input, $container) {
		$removeFormError($container);
		var errText = '',
			inputVal = $input.val();
		if (helper.validateEmpty(inputVal)) {
			errText = Constants.ERROR.PASSWORD_EMPTY_ERR;
		} else if (helper.validateMinLength(inputVal, $input.attr('min-length'))) {
			errText = authHelper.isIAMThrottled() ? Constants.ERROR.REGISTER_PASSWORD_WEAK_ERR_IAM : Constants.ERROR.REGISTER_PASSWORD_INVALID_ERR;
		} else if ($input.data('strength') < 1) {
			errText = authHelper.isIAMThrottled() ? Constants.ERROR.REGISTER_PASSWORD_WEAK_ERR_IAM : Constants.ERROR.REGISTER_PASSWORD_WEAK_ERR;
		}
		return showErrorText($container, errText);
	};

	var validateConfirmPassword = function ($input, $confirmInput) {
		$removeFormError($confirmInput);
		var errText = '',
			inputVal = $confirmInput.val();
		if (helper.validateEmpty(inputVal)) {
			errText = authHelper.isIAMThrottled() ? Constants.ERROR.REGISTER_CONFIRM_EMPTY_ERR_IAM : Constants.ERROR.REGISTER_CONFIRM_EMPTY_ERR;
		} else if ($input.val() !== inputVal) {
			errText = Constants.ERROR.REGISTER_CONFIRM_MATCH_ERR;
		}
		return showErrorText($confirmInput, errText);
	};

	var showAPIErrors = function () {
		return true;
	};

	/**
	 * @Description: Helps to validate the phonenumber field if the feature switch is enabled
	 */
	var validatePhoneNumber = function ($inputObject) {
		var enablePhoneNumberRegistrationValue = $('#enablePhoneNumberRegistrationFeature').val();
		if (enablePhoneNumberRegistrationValue === 'true') {
			return checkForPhoneNumberErrors($inputObject.$phoneNumber);
		} else {
			return true;
		}
	};

	/**
	 * @Description: Helps to validate for Pro
	 */
	var validatePro = function (proValue, $inputObject) {
		if (proValue) {
			return checkHomeDepotMail($inputObject.$emailAddress)
		} else {
			return true;
		}
	};

	/**
	 * @Description: Helps to validate the registration inputs
	 *
	 **/
	var validateRegisterInputs = function ($inputObject, proValue) {
		var isValid = false;
		if (authHelper.isIAMThrottled()) {
			if (checkForZipCodeErrors($inputObject.$zipCode) && checkForEmailErrors($inputObject.$emailAddress, false) && validatePassword($inputObject.$password, $inputObject.$confirmPassword)) {
				isValid = validatePhoneNumber($inputObject) && validatePro(proValue, $inputObject);
			}
		} else {
			if (!accountUtility.getRegistrationLite()) {
				if (checkForFirstNameErrors($inputObject.$firstName) && checkForLastNameErrors($inputObject.$lastName) &&
					checkForZipCodeErrors($inputObject.$zipCode) && checkForEmailErrors($inputObject.$emailAddress, true) &&
					validatePassword($inputObject.$password, $inputObject.$confirmPassword) && validateConfirmPassword($inputObject.$password, $inputObject.$confirmPassword)) {
					isValid = validatePhoneNumber($inputObject) && validatePro(proValue, $inputObject);
				}
			} else {
				if (checkForZipCodeErrors($inputObject.$zipCode) && checkForEmailErrors($inputObject.$emailAddress, true) &&
					validatePassword($inputObject.$password, $inputObject.$confirmPassword)) {
					isValid = validatePhoneNumber($inputObject) && validatePro(proValue, $inputObject);
				}
			}
		}
		return isValid;
	};

	/**
	 * @Description: Helps to validate the pro registration inputs
	 *
	 **/
	var removeErrors = function ($input) {
		$removeFormError($input);
	}

	var checkProRegisterEnable = function () {
		var $parent = $('form#createProAccount'),
			$btn = $parent.find('#proAccountRegister');
		if ($parent.find('.invalid').length === 0) {
			$btn.removeClass('disabled').removeAttr('disabled');
		} else {
			$btn.addClass('disabled').attr('disabled');
		}
	}

	var showProErrorText = function ($input, errText) {
		if (errText !== '') {
			$input.addClass('invalid').parents('.form-input').addClass('form-input--error');
			$errorFormInput(errText).insertAfter($input);
		}
		checkProRegisterEnable();
		return (errText === '');
	}

	var isEmpty = function ($input) {
		var inputVal = $input.val();
		if (helper.validateEmpty(inputVal)) {
			return true;
		} else {
			return false;
		}
	}

	var checkForBusinessNameErrors = function ($input) {
		$removeFormError($input);
		var errText = '',
			inputVal = $input.val();
		if (helper.validateEmpty(inputVal)) {
			errText = Constants.ERROR.PRO_BUSINESS_NAME_EMPTY_ERR;
		} else if (!helper.companyNameLengthValidator(inputVal)) {
			errText = Constants.ERROR.PRO_BUSINESS_NAME_LENGTH_ERR;
		} else if (!helper.companySplCharValidator(inputVal)) {
			errText = Constants.ERROR.PRO_BUSINESS_NAME_INVALID_CHAR_ERR;
		}
		return showProErrorText($input, errText);
	}

	var checkForPhoneNumberErrors = function ($input) {
		$removeFormError($input);
		var errText = '',
			inputVal = $input.val();
		if (helper.validateEmpty(inputVal)) {
			errText = Constants.ERROR.PRO_MANDATORY_PHONE_NUMBER;
		} else if (!helper.phoneNumberValidator(inputVal)) {
			errText = Constants.ERROR.PRO_INVALID_PHONE_NUMBER;
		}
		return showProErrorText($input, errText);
	}

	var checkForAddrLine1Error = function ($input) {
		$removeFormError($input);
		var errText = '',
			inputVal = $input.val();
		if (helper.validateEmpty(inputVal)) {
			errText = Constants.ERROR.PRO_MANDATORY_CUSTOMER_ADDRESS_ERR;
		} else if (!helper.addressSplCharValidator(inputVal)) {
			errText = Constants.ERROR.PRO_ADDRESS_SPL_CHARS_ERR;
		}
		return showProErrorText($input, errText);
	}
	var checkForAddrLine2Error = function ($input) {
		$removeFormError($input);
		var errText = '',
			inputVal = $input.val();
		if (helper.validateEmpty(inputVal)) {
			errText = '';
		} else if (!helper.addressSplCharValidator(inputVal)) {
			errText = Constants.ERROR.PRO_ADDRESS_SPL_CHARS_ERR;
		}
		return showProErrorText($input, errText);
	}

	var zipCodeError = function ($input) {
		$removeFormError($input);
		var errText = '',
			inputVal = $input.val();
		if (helper.validateEmpty(inputVal)) {
			errText = Constants.ERROR.PRO_MANDATORY_ZIPCODE_ERR;
		} else if (!helper.zipCodeValidator(inputVal)) {
			errText = Constants.ERROR.PRO_INVALID_ZIPCODE_ERR;
		}
		return showProErrorText($input, errText);
	};

	var validatePhoneFormat = function ($input, event) {
		var textPhone = $input.val();

		var text = textPhone.replace(/[^\d]/g, '');
		if (text.length === 10) {
			text = text.replace(/(\d{3})(\d{3})(\d{4})/, "($1) $2-$3");
			$input.val(text);
		}
		return textPhone;
	};

	var validateZipCode = function ($input, event) {
		$removeFormError($input);
		var inputVal = $input.val();
		var keycode = event.keycode || event.charCode;
		if (keycode > 31) {
			if (keycode === 32) {
				return false;
			} else {
				var keyValue = Number(String.fromCharCode(keycode));
			}
			if (isNaN(keyValue)) {
				return false;
			} else {
				return true;
			}
		}
		return true;
	}

	var businessOrTradeError = function ($select) {
		$removeFormError($select);
		var errText = '';
		if ($select.val() == "") {
			errText = Constants.ERROR.PRO_BUSINESS_TRADE_ERR;
		}
		return showProErrorText($select, errText);
	}

	var otherTradeError = function ($input) {
		$removeFormError($input);
		var errText = '',
			inputVal = $input.val();
		if (helper.validateEmpty(inputVal)) {
			errText = Constants.ERROR.PRO_BUSINESS_TRADE_ERR;
		}
		return showProErrorText($input, errText);
	}

	var showProAPIErrors = function ($input, errorText, errorCode) {
		$removeError($input);
		if (errorText !== '') {
			$errorContainer(errorText, errorCode).insertBefore($input);
		}
		return (errorText === '');
	}

	/**
	 * @Description: Helps to validate the ProXtra registration inputs
	 *
	 **/
	var validateProRegisterInputs = function ($inputObject) {
		var isValid = false;
		if (checkForBusinessNameErrors($inputObject.$companyName) && checkForPhoneNumberErrors($inputObject.$proUpgradePhone) && checkForAddrLine1Error($inputObject.$addProAddress) &&
			businessOrTradeError($inputObject.$businessName) &&
			zipCodeError($inputObject.$zipCode)) {
			isValid = true;
			if ($inputObject.$addProOtionalAddressExist) {
				if (checkForAddrLine2Error($inputObject.$addProOtionalAddress)) {
					isValid = true;
				} else {
					isValid = false;
				}
			}
			if ($inputObject.$otherTradeDescriptionExist) {
				if (otherTradeError($inputObject.$otherTradeDescription)) {
					isValid = true;
				} else {
					isValid = false;
				}
			}
		}

		return isValid;
	};


	return {

		showErrorText: showErrorText,
		validateRegister: validateRegisterInputs,
		showErrorMessage: showAPIErrors,
		checkForFirstNameErrors: checkForFirstNameErrors,
		checkForLastNameErrors: checkForLastNameErrors,
		checkForZipCodeErrors: checkForZipCodeErrors,
		checkForEmailErrors: checkForEmailErrors,
		checkHomeDepotMail: checkHomeDepotMail,
		validatePassword: validatePassword,
		validateSinglePassword: validateSinglePassword,
		validateConfirmPassword: validateConfirmPassword,

		/*Pro register validation*/
		validateProRegister: validateProRegisterInputs,
		showProErrorMessage: showProAPIErrors,
		removeErrors: removeErrors,
		isEmpty: isEmpty,
		checkForBusinessNameErrors: checkForBusinessNameErrors,
		checkForPhoneNumberErrors: checkForPhoneNumberErrors,
		checkForRegularPhoneNumberErrors: checkForRegularPhoneNumberErrors,
		checkForAddrLine1Error: checkForAddrLine1Error,
		checkForAddrLine2Error: checkForAddrLine2Error,
		zipCodeError: zipCodeError,
		validatePhoneFormat: validatePhoneFormat,
		validateZipCode: validateZipCode,
		businessOrTradeError: businessOrTradeError,
		otherTradeError: otherTradeError,
		doEmailValidation: doEmailValidation
	}

});
/**
* @Description: Helps to do the validation in signin modal
**/
(function closure(root, factory) {
  if (typeof define === 'function' && define.amd) {
    define('auth.signin.validation',[
      'jquery',
      'auth.constants',
      'auth.helper',
      'auth.analytics',
	  'auth.helper',
	  'account.utility',
	  'auth.reg.validation',
    ], function load(jQuery, Constants, helper, analytics, authHelper, accountUtility, regValidation) {
      return factory(root, jQuery, Constants, helper, analytics, authHelper, accountUtility, regValidation);
    });
  } else {
    // For non-AMD module, expose this to global (will also be useful for test cases)
    /*eslint-disable*/
    factory(root, jQuery, Constants, helper, analytics, authHelper, accountUtility, regValidation);
    /*eslint-enable*/
  }
})(this, function factory(root, $, Constants, helper, analytics, authHelper, accountUtility, regValidation) {

  /**
  * @Description: Helps to check if the field is empty
  *
  * @Param: value
  * @Return: returns the true or false
  **/
  var callInProgress = false;
  
  var $errorFormInput = function(errorText) {
	  if (authHelper.isIAMThrottled()) {
		  var errorObject =  {
                  "errorType" : "error",
                  "displayType" :"inline",
                  "pageSection" : "Sign In",
                  "errorMessage" : errorText
                  // "errorCode":msg[0].id
               };  
			analytics.setErrorEvent(errorObject);
	  } else {
		  analytics.pushAuthErrorEventInfo({
		      errorMessage : errorText
		    });
	  }

    return $('<span />').addClass('form-input-error__message body__p-top-xsmall u__block').html(errorText);
  };

  var $removeFormError = function($inputElement) {
    $inputElement.removeClass('invalid');
    $inputElement.next('.form-input-error__message').remove();
    $inputElement.parents('.form-input').removeClass('form-input--error');
  };

  var $errorContainer = function(errorText, errorCode) {
    var $errorContent = $('<span />').addClass('alert-inline__tilte').html(errorText),
        $errorContainer = $('<span />').addClass('alert-inline__message').html($errorContent),
        $errorBlock = $('<div />').addClass('alert-inline alert-inline--danger body__p-top-small').html($errorContainer);
    if (authHelper.isIAMThrottled()) {
		  var errorObject =  {
                "errorType" : "error",
                "displayType" :"inline",
                "pageSection" : "Sign In",
                "errorMessage" : errorText,
                 "errorCode": errorCode
             };  
			analytics.setErrorEvent(errorObject);
	  } else {
	    analytics.pushAuthErrorEventInfo({
	      errorMessage : errorText
	    });
    }

    return $errorBlock;
  };

  var $removeError = function($inputElement) {
    $inputElement.prev('.alert-inline').remove();
  };

  /**
  * @Description: Helps to validate the signin inputs
  *
  * @Param: logonId
  * @Param: password
  **/
  var validateSignInInputs = function($logon, $password) {
    var isValid = false;

    if(checkForEmailErrors($logon, false) && checkForPasswordErrors($password)) {
      isValid = true;
    }

    return isValid;
  };
  
  var checkSigninEnable = function() {
    var $parent = $('div#authenticationDualSignin').find('form#userLogin'),
        $btn = $parent.find('#accountSignIn'),
        empty = false;
    $parent.find('.form-input__field').each(function() {
            if ($(this).val().length == 0) {
                empty = true;
            } else {
			    empty = false;
			}
        });
    if($parent.find('.invalid').length === 0 && !empty) {
      $btn.removeClass('disabled').removeAttr('disabled');
    } else if($parent.find('.invalid').length !== 0 || empty) {
      $btn.addClass('disabled').attr('disabled', 'disabled');
    }
  }
  
  var showErrorText = function($input, errText) {
    if (errText !== '') {
      $input.addClass('invalid').parents('.form-input').addClass('form-input--error');
      $errorFormInput(errText).insertAfter($input);
    }
	checkSigninEnable();
    return (errText === '');
  }

  var checkForEmailErrors = function($input, submitEmailExist) {
   var errText = '',
	   inputVal = $input.val();
   var loggingRequest ={};
   if (authHelper.isIAMThrottled()) {
      $removeFormError($input);
      var errText = '',
      inputVal = $input.val();
		if (helper.validateEmpty(inputVal)) {
		  errText = Constants.ERROR.EMAIL_EMPTY_ERR;
		  showErrorText($input, errText);
		} else if (!helper.validateEmailAddress(inputVal)) {
		  errText = Constants.ERROR.EMAIL_FORMAT_ERR;
		  showErrorText($input, errText);
	    } else if(submitEmailExist) {
		      if(!callInProgress) {
			      callInProgress = true;
            var startTime = new Date();
		    	  regValidation.doEmailValidation(inputVal)
					.done(function(data, statusText, xhr) {
            var loggingUrl = Constants.URLS.EMAIL_VERIFICATION_URL_GCP2;
            var endTime = new Date();
						var loggingData = $.extend(true, {}, data);

						try {
                loggingRequest  = {"emailId":inputVal};
                analytics.pushLoggingInfo(loggingUrl, loggingRequest, loggingData, xhr.status, "GET", startTime, endTime);
            }
            catch (err) {
                console.log(err)
            }
					  callInProgress = false;
            var loggingUrl = Constants.URLS.EMAIL_VERIFICATION_URL_GCP2;
            var endTime = new Date();
            var loggingData = data;
            try {
              analytics.pushLoggingInfo(loggingUrl, inputVal, loggingData, xhr.status, "GET", startTime, endTime);  
            }
            catch (err) {
                console.log(err)
            }
            
					  if (data === false) {  // if data is false doesn't exist.
						  return true;
					  }
					})
					.fail(function(error) {
					  //@TODO: Enable register button
					    callInProgress = false;
              var loggingUrl = Constants.URLS.EMAIL_VERIFICATION_URL_GCP2;
              var endTime = new Date();
              try {
                  loggingRequest  = {"emailId":inputVal};
                  analytics.pushLoggingInfo(loggingUrl, loggingRequest, error.responseJSON, error.status, "GET", startTime, endTime);
              }
              catch (err) {
                  console.log(err)
              }
						if(error.responseJSON && error.responseJSON.errors && error.responseJSON.errors[0].errorCode == "UREG_ERR_159") {
							errText = Constants.ERROR.ERR_SET_PASSWORD_SIGNIN;
							showErrorText($input, errText);
							$(".signInType").addClass("hide");
							$(".signInSetPwd").removeClass("hide");
							$(".u__legal").addClass("u__legalNoBorder").removeClass("u__legal");
						}
					});
				}
		    }
		checkSigninEnable();
		return (errText === '');
   } else {
		$removeFormError($input);
		var errText = '',
			inputVal = $input.val();
		if (helper.validateEmpty(inputVal)) {
		  errText = Constants.ERROR.EMAIL_EMPTY_ERR;
		} else if (!helper.validateEmailAddress(inputVal)) {
		  errText = Constants.ERROR.EMAIL_FORMAT_ERR;
		}
		if (errText !== '') {
		  $input.parents('.form-input').addClass('form-input--error');
		  $errorFormInput(errText).insertAfter($input);
		}
		return (errText === '');
	}
  }

  var checkForPasswordErrors = function($input) {
    $removeFormError($input);
    var errText = '',
        inputVal = $input.val();
    if (helper.validateEmpty(inputVal)) {
      errText = Constants.ERROR.PASSWORD_EMPTY_ERR;
    }
    if (errText !== '') {
      $input.parents('.form-input').addClass('form-input--error');
      $errorFormInput(errText).insertAfter($input);
    }
	if (authHelper.isIAMThrottled()) {
	   checkSigninEnable();
	 }
    return (errText === '');
  }

  var showAPIErrors = function($input, errorText, errorCode) {
    $removeError($input);
    if (errorText !== '') {
      $errorContainer(errorText, errorCode).insertBefore($input);
    }
    return (errorText === '');
  }
  /**
  * @Description: Invokes all the validation tighted to the sign in tab
  **/
  var initializeSignInValidation = function() {

  };

  return {
    validateSignIn : validateSignInInputs,
    showErrorMessage : showAPIErrors,
    checkForEmailErrors: checkForEmailErrors,
    checkForPasswordErrors: checkForPasswordErrors
  }

});
(function closure(root, factory) {
	if (typeof define === 'function' && define.amd) {
		define('auth.signin',[
			'jquery',
			'account.utility',
			'auth.modal',
			'auth.constants',
			'cookie-utils',
			'auth.signin.validation',
			'auth.analytics',
			'auth.helper'
		], function load(jQuery, accountUtility, authModal, Constants, cookieUtils, signInValidation, analytics, authHelper) {
			return factory(root, jQuery, accountUtility, authModal, Constants, cookieUtils, signInValidation, analytics, authHelper);
		});
	} else {
		// For non-AMD module, expose this to global (will also be useful for test cases)
		/*eslint-disable*/
		factory(root, jQuery, accountUtility, authModal, Constants, cookieUtils, signInValidation, analytics, authHelper);
		/*eslint-enable*/
	}
})(this, function factory(root, $, accountUtility, authModal, Constants, cookieUtils, signInValidation, analytics, authHelper) {

	/**
	 * @Description: Helps to make the AJAX call and get the response
	 *
	 * @Param: logonId
	 * @Param: password
	 * @Return: ajax handler to handle the success and failure scenarios
	 **/
	var doSignIn = function (jsonPayload) {
		var useSecuredSignin = (document.getElementById('securedSigninFeatureSwitch').value === "true");
		var channelId = authHelper.getChannelId();
		accountUtility.showLoader();
		$("#accountSignIn").addClass("disabled").attr("disabled", "disabled");
		var options = {};


		if (authHelper.isIAMThrottled()) {

			var clientInfo = authHelper.getClientInfo() || {},
				url = useSecuredSignin ? Constants.URLS.AUTH_SECURED_SIGNIN : Constants.URLS.AUTH_SIGNIN_URL_IAM,
				headers = {
					'Content-Type': 'application/json',
					'Accept': 'application/json',
					'channelId': channelId
				};

			//If it is not null trigger the new call
			if (clientInfo.flag) {
				url = useSecuredSignin ? Constants.URLS.AUTH_SECURED_SIGNIN : Constants.URLS.AUTH_SIGNIN_URL_IAM2;
				headers['Cust-Acct-Client-Token'] = clientInfo['tHat'];
				headers['Cust-Acct-Client-Timestamp'] = clientInfo['ts'];
				headers['Cust-Acct-Client-ID'] = clientInfo['id'];
				headers['Cust-Acct-Client-Delay-Token-Validation'] = authHelper.getClientDelay();
			}

			options = {
				url: url,
				headers: headers,
				type: 'POST',
				crossDomain: true,
				xhrFields: {
					withCredentials: true
				},
				data: JSON.stringify(jsonPayload)

			}
		} else {
			options = {
				url: Constants.URLS.AUTH_SIGNIN_URL,
				type: 'POST',
				contentType: "application/x-www-form-urlencoded",
				data: 'action=logon&client_id=internal_test&response_type=activity&client_type=internal&logonId=' + encodeURIComponent(jsonPayload.identity.logonId) + '&password=' + encodeURIComponent(jsonPayload.identity.password) + '&businessChannelId=-1&channel=INTERNAL_API&rememberMe=true',
				crossDomain: true,
				dataType: 'json',
				xhrFields: {
					withCredentials: true
				}
			}
		}

		return accountUtility.triggerAJAXCall(options);
	};

	var gotoComponent = function(pathURL) {
        window.location.href = decodeURIComponent(pathURL);
    }


	var successSignInCallback = function (data, callback) {
		var customerType2FA;
		if(document.getElementById("customerType2FA") != null) {
			customerType2FA = document.getElementById("customerType2FA").innerText;
		}
		var customerType = data.identity.customerType;
		analytics.pushSuccessfulSignInIAMEventInfo();
		//Update the header with user info from the cookies (for unsecured signin)
		$(document).trigger('updateUserStatus');
		$.event.trigger("CART_RELOAD_CART_CONTENT");

		if (customerType === "B2B" || customerType2FA == "B2B") {
			gotoComponent("/b2b/account/view/homepage");
		} else if (customerType === "MULTIPLE" || customerType2FA == "MULTIPLE"){
			gotoComponent("/b2b/account/view/sas");
		} else if ((customerType === "B2X" || customerType2FA == "B2X") && window.location.pathname === "/account/view/logon"){
			gotoComponent("/b2b/account/view/landingpage");
		} else if (typeof callback === 'function') {
			callback();
		} else {
			window.location.reload();
		}
	};

	/**
	 * @Description: Trigger the sign in flow
	 *
	 * @Param: successCallback
	 * @Param: errorCallback
	 **/
	var triggerSignIn = function (successCallback, errorCallback) {

		var $frmUserLogin = $(document),
			$btn = $('#accountSignIn');

		$frmUserLogin.on('blur', 'form#userLogin input#email_id', function () {
			signInValidation.checkForEmailErrors($(this), true);
		});

		$frmUserLogin.on('keyup', 'form#userLogin input#email_id', function () {
			if (!$(this).hasClass("invalid")) {
				$btn.removeClass('disabled').removeAttr('disabled');
			}
		});

		if (authHelper.isIAMThrottled()) {
			$frmUserLogin.on('keyup', 'form#userLogin input#email_id', function () {
				$(".signInType").removeClass("hide");
				$(".signInSetPwd").addClass("hide");

				if (event.keyCode == 8 || event.keyCode == 46 || (event.keyCode == 17 && event.keyCode == 67)) {
					$('#emailholder, .pwdHolder').find('.form-input-error__message').hide();
					$('#emailholder').find('.invalid').removeClass('invalid');
					$('#emailholder, .pwdHolder').removeClass('form-input--error');
					$(".u__legalNoBorder").addClass("u__legal").removeClass("u__legalNoBorder");

				}
			});

			$frmUserLogin.on('click', 'form#userLogin #signInDiffEmail', function (event) {
				analytics.pushSignInWithDifferentEmailEventInfo("sign in: sign in with different email");
				$(".signInType").removeClass("hide");
				$(".signInSetPwd").addClass("hide");
				$('#emailholder, .pwdHolder').find('.form-input-error__message').hide();
				$('#emailholder').find('.invalid').removeClass('invalid');
				$('#emailholder, .pwdHolder').removeClass('form-input--error');
				$('#emailholder').find('.form-input__field').val('').focus();
				$(".u__legalNoBorder").addClass("u__legal").removeClass("u__legalNoBorder");
			});

			// $frmUserLogin.on('click', 'form#userLogin #setPasswordButton', function (event) {
       //  $("#setPasswordButton").addClass("disabled").attr("disabled", "disabled");
       //  analytics.pushSetYourPasswordEventInfo("sign in: set your password");
       //  $setPwdButton = $('form#userLogin button#setPasswordButton');
       //  var setPasswordEmailUrl = Constants.URLS.SET_PASSWORD_EMAIL_URL + '?email=' + $('#email_id').val();
       //  var channelId = authHelper.getChannelId();
       //  authModal.showSetPasswordModal();
			// });
		}

		$frmUserLogin.on('blur keyup', 'form#userLogin input#password', function () {
			signInValidation.checkForPasswordErrors($(this));
		});

		$frmUserLogin.off('click', 'form#userLogin button#accountSignIn').on('click', 'form#userLogin button#accountSignIn', function (event) {
			event.preventDefault();
			var $parentButton = $(this),
				$emailInput = $frmUserLogin.find('input#email_id'),
				$passwordInput = $('form#userLogin input#password');


			if (signInValidation.validateSignIn($emailInput, $passwordInput)) {

				var logonId = $emailInput.val(),
					password = $passwordInput.val();
				var jsonPayload = {
					"identity": {
						"logonId": logonId,
						"password": password,
						"sessionId": window.tmxprofilesessionid,
                        "origin": window.location.pathname
					}
				};
				var useSecuredSignin = (document.getElementById('securedSigninFeatureSwitch').value === "true");
				var loggingUrl = useSecuredSignin ? Constants.URLS.AUTH_SECURED_SIGNIN : Constants.URLS.AUTH_SIGNIN_URL_IAM;
				var startTime = new Date();
				var loggingPayload = $.extend(true, {}, jsonPayload);


				doSignIn(jsonPayload).done(function (data, statusText, xhr) {
					var env = document.getElementById('hat_env').value;
					var envTS = document.getElementById('hat_env_ts').value;
					var envID = document.getElementById('hat_env_id').value;
                    var evoiceSwitch = document.getElementById('signinEvoiceSwitch').value;
					$('.account-modal__container').remove();
					$("#accountSignIn").removeClass("disabled").removeAttr("disabled");
					cookieUtils.initializeCookieManager();
					cookieUtils.initializeMasterCookie();

					var identity = (data && data.identity) || false;
					var endTime = new Date();

					var loggingData = $.extend(true, {}, data);
					try {
						analytics.pushLoggingInfo(loggingUrl, loggingPayload, loggingData, xhr.status, "POST", startTime, endTime);
					}
					catch (err) {
						console.log(err)
					}

					if (identity && identity.isTwoFactorAuthRequired) {
						var payload = {
							email: identity.logonId,
							isMobile: authHelper.getChannelId() !== '1',
							authID: identity.generatedOTPResponse.authId,
							backendHost: identity.generatedOTPResponse.backendHostName,
							customerID: identity.svocCustomerAccountId,
							phoneNumber: null,
							sentViaText: false,
							deviceId: identity.deviceId ? identity.deviceId : null,
							requestId: identity.requestId ? identity.requestId : null,
                            signinEvoiceSwitch : evoiceSwitch === "true",
							hat: {
								env: env,
								envTS: envTS,
								envID: envID
							},
							successCallback: function () {
								successSignInCallback(data, successCallback)
							}
						};
						if (identity.isPhoneVerified && identity.phoneNumber) {
							payload.sentViaText = true;
							payload.phoneNumber = identity.phoneNumber;
						}
						var event = new CustomEvent('triggerTwoFactorVerification', {detail: payload});
						document.dispatchEvent(event);
					} else {
						successSignInCallback(data, successCallback)
					}
				}).fail(function (xhr) {
					$('#authenticationDualSignin input#password').val("");
					accountUtility.hideLoader();
					$("#accountSignIn").removeClass("disabled").removeAttr("disabled");
					if (typeof errorCallback === 'function') {
						errorCallback();
					} else {

						var errorDescription = Constants.ERROR.SIGN_GENERIC_ERROR;
						var errorCode = null;
						if (xhr && xhr.responseText) {

							var responseData = JSON.parse(xhr.responseText);
							if (authHelper.isIAMThrottled()) {
								if (responseData.identity.errors[0].errorCode == "AUTH_ERR_102") {
									errorDescription = Constants.ERROR.SIGNIN_USER_PASS_NOMATCH;
									errorCode = "AUTH_ERR_102";
								} else if (responseData.identity.errors[0].errorCode == "AUTH_ERR_110") {
									errorDescription = Constants.ERROR.SIGNIN_ACCOUNT_TO_BE_LOCKED;
									errorCode = "AUTH_ERR_110";
								} else if (responseData.identity.errors[0].errorCode == "AUTH_ERR_103") {
									errorDescription = Constants.ERROR.SIGNIN_ACCOUNT__LOCKED;
									errorCode = "AUTH_ERR_103";
								} else if (responseData.identity.errors[0].errorCode == "AUTH_ERR_PWD_RESET_120") {
									errorDescription = responseData.identity.errors[0].errorMessage;
									errorCode = "AUTH_ERR_PWD_RESET_120";
									$btn.addClass('disabled').attr('disabled', 'disabled');
								} else if (responseData.identity.errors[0].errorCode === "AUTH_ERR_107") {
									errorDescription = Constants.ERROR.EMAIL_FORMAT_ERR;
									errorCode = "AUTH_ERR_107";
									$btn.addClass('disabled').attr('disabled', 'disabled');
								} else if (responseData.identity.errors[0].errorCode === "AUTH_ERR_108") {
									errorDescription = Constants.ERROR.PASSWORD_EMPTY_ERR;
									errorCode = "AUTH_ERR_108";
									$btn.addClass('disabled').attr('disabled', 'disabled');
								} else {
									errorDescription = Constants.ERROR.SIGN_GENERIC_ERROR;
								}
							} else {
								errorDescription = responseData.errorDescription;
							}
						}
						var endTime = new Date();
						try {
                    		analytics.pushLoggingInfo(loggingUrl, loggingPayload, xhr.responseJSON, xhr.status, "POST", startTime, endTime);
			            }
			            catch (err) {
			                console.log(err)
			            }
						signInValidation.showErrorMessage($parentButton, errorDescription, errorCode);
					}
				});
			}
		});
		accountUtility.hideLoader();
	};

	return {
		initiateSignIn: triggerSignIn
	}
});

(function closure(root, factory) {
    if (typeof define === 'function' && define.amd) {
        define('password.meter',[
            'jquery',
            'auth.helper'
        ], function load(jQuery, authHelper) {
            return factory(root, jQuery, authHelper);
        });
    } else {
        factory(root, root.jQuery, authHelper);
    }
})(this, function factory(root, $, authHelper) {

        /**
         * @Function - validatePassword
         * @Return - level; Password level is returned
         * @Description -
         * Password Meter Configuration helps to assign the configurations required for
         * the password meter to be generated
         *
         * options parameter in the set function will hold JSON object with some key value pairs.
         * Supported keys are as follows :-
         * 1) passwordMeterDivId - Specifies the DIV in which password meter should come. If the DIV ID is not mentioned
         *             the password meter will not be created. But, the level will be calculated and returned to the calling enviorment.
         * 2) emailAddress - Email Address to validate against password. It should not be same as password
         * 3) overrideDefaultStyle - Overrides the default style of the password meter and then the callback function can be used
         *               apply the user defined styles
         * 4) passwordMeterCallback - this should be a function to apply user defined styles for the password meter
         * 5) passwordMeterLabel - Supports user defined label, by default it will be 'Password Strength'. If we are passing the label
         *             as 'no_label', then the label will not be displayed along with the password meter
         * 6) passwordMeterConfig - Configuration for color coding and labels for different strength. This configuration is of JSON format
         *             There can be three keys for the configuration 'weakConfig', 'goodConfig' and 'strongConfig'.
         *             Each of this keys accept a JSON with 'text' and 'color' as keys.
         *             (Refer the defaults section in the passwordValidator function)
         * 7) passwordHints - Helps to specify the hints to be shown for password. The parameter accepts array of values
         *
         **/
	
            // Defining the default values

		var defaults = {
	                overrideDefaultStyle: false,
	                passwordMeterLabel: 'Password&nbsp;Strength:',
	                passwordMeterConfig: {
	                    weakConfig: {
	                        text: 'weak',
	                        color: '#ED1C24'
	                    },
	                    goodConfig: {
	                        text: authHelper.isIAMThrottled() ? 'fair' : 'good',
	                        color: '#FFC20E'
	                    },
	                    strongConfig: {
	                        text: 'strong',
	                        color: '#00AE4D'
	                    }
	                },
	                passwordHints: authHelper.isIAMThrottled() ? [
	                          	                  'Including numbers or symbols',
	                        	                    'Mixing upper/lowercase'
	                          	                    ] : [
								                    'Minimum of 8 characters',
								                    'Cannot be a commonly used password',
								                    'Passwords are case sensitive'
								                    ]
	    };

        /**
         * @Function _setPasswordMeterConfiguration
         * @Description - Helps to set the configuration for password meter
         **/
        function _setPasswordMeterConfiguration(options) {
        	
        	defaults.passwordMeterConfig.goodConfig.text = authHelper.isIAMThrottled() ? 'fair' : 'good';
	                      
        	defaults.passwordHints = authHelper.isIAMThrottled() ? [
	                          	                  'Including numbers or symbols',
	                        	                    'Mixing upper/lowercase'
	                          	                    ] : [
								                    'Minimum of 8 characters',
								                    'Cannot be a commonly used password',
								                    'Passwords are case sensitive'
								                    ];
					
            // Merging the options with defaults
            $.extend(true, defaults, options);
        }

        /**
         * @Function _getPasswordMeterConfiguration
         * @Description - Helps to get the configuration
         **/
        function _getPasswordMeterConfiguration() {
            return defaults;
        }

        /**
         * @Date - 10/28/2014
         * @Author - vimal_mohan@homedepot.com
         * @Version - 1.0
         * @Description -
         * Library helps to validate the password on a scale of weak(0), good(1) or strong(2). The library returns the level to the calling environment.
         * The library also helps to generate the password meter, with the color coding. The meter will be placed in the DIV ID provided.
         *
         * The default style can be overriden and the custom style can applied using the callback function.
         * Custom password meter can be used for showing the password level.
         *
         * -----------------------------------------------------------------------
         * The default password meter will have the following DOM struncture
         * -----------------------------------------------------------------------
         * <div class="l-control-group" id="l-passwordMeter" style="font-family: 'Helvetica Neue', ',Helvetica,sans-serif'; color: rgb(119, 119, 119); font-size: 12px; font-weight: bold;">
         * <label style="float: left; margin-top: 1px;">Password&nbsp;Strength:</label>
         * <div style="float: left; margin-right: 10px; margin-left: 10px;">
         *   <table cellpadding="0" cellspacing="0" uid="l-pwd-meter" style="width: 291px; height: 16px; border: 1px solid rgb(204, 204, 204);">
         *     <tbody>
         *       <tr>
         *         <td style="border-right-width: 1px; border-right-style: solid; border-right-color: rgb(204, 204, 204); background-color: rgb(0, 174, 77);"></td>
         *         <td style="border-right-width: 1px; border-right-style: solid; border-right-color: rgb(204, 204, 204); background-color: rgb(0, 174, 77);"></td>
         *         <td style="border-right-width: 1px; border-right-style: solid; border-right-color: rgb(204, 204, 204); background-color: rgb(0, 174, 77);"></td>
         *       </tr>
         *     </tbody>
         *   </table>
         * </div>
         * <span uid="l-pwd-strength-msg" style="text-transform: uppercase; display: inline-block; font-weight: bolder; color: rgb(0, 174, 77);">strong</span>
         * </div>
         * -----------------------------------------------------------------------
         *
         * While creating a custom password meter the following should be taken care of
         *   1) Enclosing DIV the ID should be 'l-passwordMeter'
         *   2) The TABLE should have an attribute called 'uid' with value 'l-pwd-meter'
         *   3) The strength text holder, i.e SPAN, should have an attribute with 'uid' with value 'l-pwd-strength-msg'
         *
         * --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
         *
         * @Usage -
         * //Set the configuration
         * PasswordMeterConfiguration.set({
	 * passwordMeterDivId : 'pass_meter',
	 * //overrideDefaultStyle : true, //This will override the default style
	 * //passwordMeterLabel : 'no_label', //This value will not display the label
	 * passwordMeterCallback : function() { //... Callback function goes here ...}
	 * });
         *
         * //generate the password meter
         * PasswordMeterGenerator.generate();
         *
         * //Validate the password
         * $('#registrationPassword').bind('keyup',function(){
	 *   var email = $('#registrationEmail').val();
	 *   var level = $(this).validatePassword(email);
	 *   console.log(level);
	 * });
         *
         * --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
         **/

        /*
         * Helps to Generate and reset the password meter
         * @Function - _resetPasswordMeter
         * @Return
         * @Description - This function helps to reset the password meter
         */
        function _resetPasswordMeter(configuration) {
            var passwordMeterDiv;
            if (defaults.passwordMeterDivId !== undefined || defaults.passwordMeterDivId !== null) {
                passwordMeterDiv = $('#' + defaults.passwordMeterDivId);
                passwordMeterDiv.find('span[uid=l-pwd-strength-msg]').text(' ');
                passwordMeterDiv.find('table[uid=l-pwd-meter]').find('td').css('background-color', 'transparent');
            }
        }

        function _removePasswordMeter(divIdToHide) {
            if (divIdToHide !== undefined && divIdToHide !== null) {
                $('#' + divIdToHide).attr('style', 'display:none !important');
            } else {
                if (defaults.passwordMeterDivId !== undefined || defaults.passwordMeterDivId !== null) {
                    // Displaying is used as a style. Because there can be places where !important
                    // is given with the style display attribute. This is preventing the jQuery show and hide
                    $('#' + defaults.passwordMeterDivId).attr('style', 'display:none !important');
                }
            }
        }

        /* @Function - _createPasswordMeter
         * @Return
         * @Description - Function helps to generate the password meter **/
        function _createPasswordMeter(divIdToShow) {
            var passwordMeterDiv;
            var passwordMeterControlGroup;
            var controlDiv;
            var passwordMeterLabel;
            var passwordStrengthText;
            var controls;
            var count;
            var table;
            var tBody;
            var tr;
            var td;
            var ul;
            var td1;
            var tr1;
            var td2;
            var tr2;
            // If the DIV ID is empty, then do not construct the password meter
            if (defaults.passwordMeterDivId === undefined || defaults.passwordMeterDivId === null || $.trim(defaults.passwordMeterDivId) === '') {
                return false;
            }
            passwordMeterDiv = $('#' + defaults.passwordMeterDivId);
            passwordMeterControlGroup = passwordMeterDiv.find('div#l-passwordMeter');
            if (passwordMeterControlGroup.length === 0) {
                // Constructing the password meter dynamically
                controlDiv = $('<div/>').attr({
                    'class': 'l-control-group',
                    'id': 'l-passwordMeter'
                });
                if (!defaults.overrideDefaultStyle) {
                    controlDiv.css({
                        'font-family': 'Helvetica Neue",Helvetica,sans-serif',
                        'color': '#777',
                        'font-size': '12px',
                        'font-weight': 'bold'
                    });
                }
                // Do not display the label when it is has a value 'no_label'
                if (defaults.passwordMeterLabel !== 'no_label') {
                    passwordMeterLabel = $('<label>' + defaults.passwordMeterLabel + '</label>');
                    if (!defaults.overrideDefaultStyle) {
                        passwordMeterLabel.css({
                            'float': 'left',
                            'margin-top': '1px'
                        });
                    }
                    passwordMeterLabel.appendTo(controlDiv);
                }
                controls = $('<div/>');
                if (!defaults.overrideDefaultStyle) {
                    controls.css({
                        'float': 'left',
                        'margin-right': '10px',
                        'margin-left': '10px'
                    });
                }
                controls.appendTo(controlDiv);
                table = $('<table/>').attr({
                    'cellpadding': '0',
                    'cellspacing': '0',
                    'uid': 'l-pwd-meter'
                });
                if (!defaults.overrideDefaultStyle) {
                    table.css({
                        'width': '291px',
                        'height': '16px',
                        'border-collapse': 'collapse !important',
                        'border': '1px solid #ccc'
                    });
                }
                table.appendTo(controls);
                tBody = $('<tbody/>').appendTo(table);
                tr = $('<tr/>');
                td = $('<td/>');
                if (!defaults.overrideDefaultStyle) {
                    td.css({
                        'border-collapse': 'collapse !important',
                        'border-right': '1px solid #ccc'
                    });
                }
                td.appendTo(tr);
                td = $('<td/>');
                if (!defaults.overrideDefaultStyle) {
                    td.css({
                        'border-collapse': 'collapse !important',
                        'border-right': '1px solid #ccc'
                    });
                }
                td.appendTo(tr);
                td = $('<td/>');
                if (!defaults.overrideDefaultStyle) {
                    td.css({
                        'border-collapse': 'collapse !important',
                        'border-right': '1px solid #ccc'
                    });
                }
                td.appendTo(tr);
                tBody.append(tr);
                passwordStrengthText = $('<span/>').attr('uid', 'l-pwd-strength-msg');
                if (!defaults.overrideDefaultStyle) {
                    passwordStrengthText.css({
                        'text-transform': 'uppercase',
                        'display': 'inline-block',
                        'font-weight': 'bolder'
                    });
                }
                passwordStrengthText.appendTo(controlDiv);
                
                if(authHelper.isIAMThrottled()) {
                	
	                table = $('<table/>').addClass('tbl-hints');
	                table.appendTo(controlDiv);
	                tBody = $('<tbody/>').appendTo(table);
	                tr1 = $('<tr/>');
	                td1 = $('<td/>').attr('colspan', '3').addClass('hints hintsTd1').text('Passwords are case sensitive and must be at least 8 characters.').appendTo(tr1);
	
	                tr2 = $('<tr/>');
	                td2 = $('<td/>').attr('colspan', '3').addClass('hints hintsTd2 body__p-top-small').text('Create a strong password by:').appendTo(tr2);
	
	                tr = $('<tr/>');
	                td = $('<td/>').attr('colspan', '3').addClass('hints').appendTo(tr);
	                ul = $('<ul/>').css('list-style', 'initial').addClass('body__m-left-large');
	                for (count = 0; count < defaults.passwordHints.length; count++) {
	                    $('<li/>').html(defaults.passwordHints[count]).appendTo(ul);
	                }
	                ul.appendTo(td);
	                tBody.append(tr1);
	                tBody.append(tr2);
	                tBody.append(tr);
	                passwordMeterDiv.append(controlDiv);
	                
                } else {
                	
                	table = $('<table/>').addClass('tbl-hints');
                    table.appendTo(controlDiv);
                    tBody = $('<tbody/>').appendTo(table);
                    tr = $('<tr/>');
                    td = $('<td/>').attr('colspan', '3').addClass('hints').appendTo(tr);
                    ul = $('<ul/>');
                    for (count = 0; count < defaults.passwordHints.length; count++) {
                        $('<li/>').html(defaults.passwordHints[count]).appendTo(ul);
                    }
                    ul.appendTo(td);
                    tBody.append(tr);
                    passwordMeterDiv.append(controlDiv);
                    
                }
                if (typeof defaults.passwordMeterCallback === 'function') {
                    defaults.passwordMeterCallback();
                }
            } else {
                // Displaying is used as a style. Because there can be places where !important
                // is given with the style display attribute. This is preventing the jQuery show and hide
                if (divIdToShow !== undefined && divIdToShow !== null) {
                    $('#' + divIdToShow).attr('style', 'display:block !important');
                } else {
                    passwordMeterDiv.attr('style', 'display:block !important');
                }
            }
        };

        /**
         * @Function - validatePassword
         * @Return - level; Password level is returned
         * @Description -
         * The function returns the level of the password
         * The level will be from 0 to 2. (0 for weak, 1 for good and 2 for strong.)
         **/
        function _validatePassword(currentObj, email) {

            //Validate the current object
            if (currentObj === undefined || currentObj === null) {
                return 0;
            }

            //Get the password to validate
            var value = currentObj.val();
            //Removing the empty spaces and then start validating
            if ($.trim(value) === "") { // Is the password field empty
                _resetPasswordMeter();
                return 0;
            } else {
                //Set the password meter
                return (_setPasswordMeter(value, email, defaults));
            }

            /*The PRIVATE functions goes below*/

            /**
             * @Function - _getPasswordLevel
             * @Return - level; Password level is returned based different conditions
             * @Description
             * Gets the password level based on the basic conditions
             * Lowercase check, Uppercase check, Numbers, Special Characters etc.
             * This function returns a score based on the validation
             * The scores can be 0, 1, 2.
             * The functions also checks for minimum length and validate the password
             * against email
             *
             **/
            function _getPasswordLevel(password, email) {
                var commonPasswordArray = ["111111", "11111111", "112233", "121212", "123123", "123456", "1234567", "12345678", "131313", "232323", "654321", "666666", "696969",
                        "777777", "7777777", "8675309", "987654", "aaaaaa", "abc123", "abcdef", "abgrtyu", "access", "access14", "action", "albert", "alexis", "amanda", "amateur", "andrea", "andrew", "angela", "angels",
                        "animal", "anthony", "apollo", "apples", "arsenal", "arthur", "asdfgh", "ashley", "august", "austin", "badboy", "bailey", "banana", "barney", "baseball", "batman", "beaver", "beavis", "bigdaddy", "bigdog", "birdie",
                        "bitches", "biteme", "blazer", "blonde", "blondes", "bond007", "bonnie", "booboo", "booger", "boomer", "boston", "brandon", "brandy", "braves", "brazil", "bronco", "broncos", "bulldog", "buster", "butter", "butthead",
                        "calvin", "camaro", "cameron", "canada", "captain", "carlos", "carter", "casper", "charles", "charlie", "cheese", "chelsea", "chester", "chicago", "chicken", "cocacola", "coffee", "college", "compaq", "computer",
                        "cookie", "cooper", "corvette", "cowboy", "cowboys", "crystal", "dakota", "dallas", "daniel", "danielle", "debbie", "dennis", "diablo", "diamond", "doctor", "doggie", "dolphin", "dolphins", "donald", "dragon", "dreams",
                        "driver", "eagle1", "eagles", "edward", "einstein", "erotic", "extreme", "falcon", "fender", "ferrari", "firebird", "fishing", "florida", "flower", "flyers", "football", "forever", "freddy", "freedom", "gandalf",
                        "gateway", "gators", "gemini", "george", "giants", "ginger", "golden", "golfer", "gordon", "gregory", "guitar", "gunner", "hammer", "hannah", "hardcore", "harley", "heather", "helpme", "hockey", "hooters", "horney",
                        "hotdog", "hunter", "hunting", "iceman", "iloveyou", "internet", "iwantu", "jackie", "jackson", "jaguar", "jasmine", "jasper", "jennifer", "jeremy", "jessica", "johnny", "johnson", "jordan", "joseph", "joshua", "junior",
                        "justin", "killer", "knight", "ladies", "lakers", "lauren", "leather", "legend", "letmein", "little", "london", "lovers", "maddog", "madison", "maggie", "magnum", "marine", "marlboro", "martin", "marvin", "master", "matrix",
                        "matthew", "maverick", "maxwell", "melissa", "member", "mercedes", "merlin", "michael", "michelle", "mickey", "midnight", "miller", "mistress", "monica", "monkey", "monster", "morgan", "mother", "mountain", "muffin",
                        "murphy", "mustang", "naked", "nascar", "nathan", "naughty", "ncc1701", "newyork", "nicholas", "nicole", "nipple", "nipples", "oliver", "orange", "packers", "panther", "panties", "parker", "password", "password1",
                        "password12", "password123", "patrick", "peaches", "peanut", "pepper", "phantom", "phoenix", "player", "please", "pookie", "porsche", "prince", "princess", "private", "purple", "pussies", "qazwsx", "qwerty",
                        "qwertyui", "rabbit", "rachel", "racing", "raiders", "rainbow", "ranger", "rangers", "rebecca", "redskins", "redsox", "redwings", "richard", "robert", "rocket", "rosebud", "runner", "rush2112", "russia", "samantha",
                        "sammy", "samson", "sandra", "saturn", "scooby", "scooter", "scorpio", "scorpion", "secret", "sexsex", "shadow", "shannon", "shaved", "sierra", "silver", "skippy", "slayer", "smokey", "snoopy", "soccer", "sophie", "spanky",
                        "sparky", "spider", "squirt", "srinivas", "startrek", "starwars", "steelers", "steven", "sticky", "stupid", "success", "summer", "sunshine", "superman", "surfer", "swimming", "sydney", "taylor", "tennis", "teresa",
                        "tester", "testing", "theman", "thomas", "thunder", "thx1138", "tiffany", "tigers", "tigger", "tomcat", "topgun", "toyota", "travis", "trouble", "trustno1", "tucker", "turtle", "twitter", "united", "vagina", "victor",
                        "victoria", "viking", "voodoo", "voyager", "walter", "warrior", "welcome", "whatever", "william", "willie", "wilson", "winner", "winston", "winter", "wizard", "xavier", "xxxxxx", "xxxxxxxx", "yamaha", "yankee", "yankees",
                        "yellow", "zxcvbn", "zxcvbnm", "zzzzzz", "football","77777777","11111111","12345678","123123123","123456789","987654321","1234567890","1q2w3e4r","1qaz2wsx","aaaaaaaa","abcd1234","alexander","asdfasdf","asdfghjkl","baseball","chocolate","computer","66666666","homedepot","homedepot123","iloveyou","internet","jennifer","liverpool","michelle","password","password1","princess","qwertyuiop","sunshine","superman","testpassword","trustno1","welcome1","whatever","abcdefghi","abcdefgh"];
                
                var commonPasswordArrayWCS = ["12345678", "123123123", "123456789", "987654321", "1234567890", "1q2w3e4r", "1qaz2wsx", "abcd1234", "alexander", "asdfasdf", "asdfghjkl", "baseball", "chocolate", "computer", "football", "homedepot", "homedepot123", "iloveyou", "internet", "jennifer", "liverpool", "michelle", "password", "password1", "princess", "qwertyuiop", "sunshine", "superman", "testpassword", "trustno1", "welcome1", "whatever", "abcdefghi", "abcdefgh", "12345678"];


                email = email !== undefined ? email : "";

                var regexPat = /(.)\1{4,}/;
                if(authHelper.isIAMThrottled()) {
	                if ((password.length < 8) || ($.inArray(password.toLowerCase(), commonPasswordArray) > -1) ||
	                    ((password.toLowerCase().split(password[0].toLowerCase()).length - 1) == password.length) || password.toLowerCase() === $.trim(email.toLowerCase()) || regexPat.test(password)) {
	                    return 0;
	                }
                } else {
                	if ((password.length < 8) || ($.inArray(password.toLowerCase(), commonPasswordArrayWCS) > -1) ||
                            ((password.toLowerCase().split(password[0].toLowerCase()).length - 1) == password.length) || password.toLowerCase() === $.trim(email.toLowerCase())) {
                            return 0;
                    }
                }
                
                
                var score = 0;
                if (/[a-z]/.test(password)) { //Check lowercase
                    score++;
                }
                if (/[A-Z]/.test(password)) { //Check uppercase
                    score++;
                }
                if (/\d/.test(password)) { //Check Numbers
                    score++;
                }
                if (/^[a-zA-Z0-9- ]*$/.test(password) == false) { //Check Special Characters
                    score++;
                }
                if ((score > 1 && (password.length > 12)) || (score > 2 && (password.length > 8))) {
                    return 2; //Strong Password
                }
                return 1; // Good Password
            };

            /**
             * @Function - _setPasswordMeter
             * @Return - level; Password level is returned
             * @Description -
             * This function helps to create a password meter in the DIV ID provided.
             * Based on the score from the function _getPasswordLevel, the text and color is set
             * For placing the password meter, the DIV ID is used. If the password meter is
             * present we just set the color and text.
             *
             **/
            function _setPasswordMeter(paramPassword, paramEmail, defaults) {
                paramEmail = paramEmail !== undefined ? paramEmail : "";
                var level = _getPasswordLevel(paramPassword, paramEmail), meterMessage = "weak", meterColor = "#BE081E";
                switch (level) {
                    case 2    :
                        meterMessage = defaults.passwordMeterConfig.strongConfig.text;
                        meterColor = defaults.passwordMeterConfig.strongConfig.color;
                        break;
                    case 1    :
                        meterMessage = defaults.passwordMeterConfig.goodConfig.text;
                        meterColor = defaults.passwordMeterConfig.goodConfig.color;
                        break;
                    default    :
                        meterMessage = defaults.passwordMeterConfig.weakConfig.text;
                        meterColor = defaults.passwordMeterConfig.weakConfig.color;
                }

                if (defaults.passwordMeterDivId !== undefined || defaults.passwordMeterDivId !== null) {
                    var passwordMeterDiv = $('#' + defaults.passwordMeterDivId);

                    //Setting the level in the password meter
                    passwordMeterDiv.find('span[uid=l-pwd-strength-msg]').text(meterMessage);
                    passwordMeterDiv.find('span[uid=l-pwd-strength-msg]').css("color", meterColor);
                    passwordMeterDiv.find('table[uid=l-pwd-meter]').find('td').css('background-color', 'transparent');
                    passwordMeterDiv.find('table[uid=l-pwd-meter]').find('td:lt(' + (level + 1) + ')').css('background-color', meterColor);
                }

                return level;
            };
        };

    return {

        set: _setPasswordMeterConfiguration,
        get: _getPasswordMeterConfiguration,
        reset: _resetPasswordMeter,
        generate: _createPasswordMeter,
        hide: _removePasswordMeter,
        validatePassword: _validatePassword
    };
});
(function closure(root, factory) {
	if (typeof define === 'function' && define.amd) {
		define('auth.registeration',[
			'jquery',
			'account.utility',
			'account.modal',
			'auth.modal',
			'auth.constants',
			'cookie-utils',
			'auth.reg.validation',
			'password.meter',
			'auth.analytics',
			'auth.helper'
		], function load(jQuery, accountUtility, Modal, authenticationModal, Constants, cookieUtils, regValidation, passwordMeter, analytics, authHelper) {
			return factory(root, jQuery, accountUtility, Modal, authenticationModal, Constants, cookieUtils, regValidation, passwordMeter, analytics, authHelper);
		});
	} else {
		// For non-AMD module, expose this to global (will also be useful for test cases)
		/*eslint-disable*/
		factory(root, jQuery, accountUtility, Modal, authenticationModal, Constants, cookieUtils, regValidation, passwordMeter, analytics, authHelper);
		/*eslint-enable*/
	}
})(this, function factory(root, $, accountUtility, Modal, authenticationModal, Constants, cookieUtils, regValidation, passwordMeter, analytics, authHelper) {

	/**
	 * Configuration set for the password meter
	 **/
	passwordMeter.set({
		passwordMeterDivId: 'dualSignIn-password-meter',
		passwordMeterLabel: 'no_label',
		overrideDefaultStyle: true,
		passwordMeterCallback: function () {
		}
	});


	/**
	 * @Description: Helps to get the authorization token for guest
	 *
	 * @Param: fnCallBack - This is invoked for a valid authorization token
	 *                      and the function accepts a parameter as authorization token
	 **/
	var getGuestAuthorizationToken = function (fnCallBack) {

		var noCache = new Date().getTime();

		if (accountUtility.verifyAuthorizationToken()) {
			fnCallBack(accountUtility.getAuthorizationToken());
		} else {
			var startTime = new Date();
			var jsonPayload = {};
			accountUtility.triggerAJAXCall({
				type: 'GET',
				url: Constants.URLS.GUEST_AUTH_TOKEN_URL + '&cache=' + noCache,
				cache: false,
				dataType: 'json',
				async: true,
				crossDomain: true,
				xhrFields: {
					withCredentials: true
				}
			}, true).done(function (response, statusText, xhr) {
				var endTime = new Date();
				var loggingData = $.extend(true, {}, response);
				try {
					analytics.pushLoggingInfo(Constants.URLS.GUEST_AUTH_TOKEN_URL, jsonPayload, loggingData, xhr.status, "GET", startTime, endTime);
				}
				catch (err) {
					console.log(err)
				}
				if (response && response.hasOwnProperty('encodedActivityToken') && response.logonId == "guest") {
					authorizationToken = response.encodedActivityToken;
					fnCallBack(authorizationToken);
				}
			}).fail(function (xhr) {
				var endTime = new Date();
				try {
					analytics.pushLoggingInfo(Constants.URLS.GUEST_AUTH_TOKEN_URL, jsonPayload, xhr, xhr.errorCode, "GET", startTime, endTime);
				}
				catch (err) {
					console.log(err)
				}
				console.error("In error block", JSON.stringify(xhr));
			});
		}
	};

	/**
	 * @Description: Helps to make the AJAX call and get the response
	 *
	 * @Param: data - Request parameter data
	 * @Param: successCallback
	 * @Param: errorCallback
	 **/
	var doRegisteration = function (jsonPayload, successCallback, errorCallback, clickProregister, parentRegisterButtonInput) {
		var isPro = clickProregister !== "";
		accountUtility.showLoader();

		var enablePhoneNumberRegistrationValue = $('#enablePhoneNumberRegistrationFeature').val();
		var phoneNumberRegistrationPhase4 = $('#phoneRegistrationPhase4').val();
		var enableEvoiceRegistration = $('#registrationEvoiceSwitch').val(); // get the switch value
		var userOptedIn = false;
		if (enablePhoneNumberRegistrationValue === 'true' && phoneNumberRegistrationPhase4 === 'true') {
			userOptedIn = $('#phoneVerifyCheckbox').is(':checked');
		}
		jsonPayload.user.verifyPhoneCheck = userOptedIn;

		// if user has opted in to verify the phone and the switch is ON then get the value of OTP medium.
        if(userOptedIn && enableEvoiceRegistration === 'true') {
            var otpChannelForOptedinUser = $("input[name='selectPhoneOTPMedium']:checked").val();
        }

		if (isPro) {
			$("#proAccountRegister").addClass("disabled").attr("disabled", "disabled");
		} else {
			$("#accountRegister").addClass("disabled").attr("disabled", "disabled");
		}
		$.support.cors = true;

		var registerUrl = (enablePhoneNumberRegistrationValue === "true" && !isPro) ? Constants.URLS.AUTH_NEW_REGISTER_URL_IAM : Constants.URLS.AUTH_REGISTER_URL_IAM;
		var channelId = authHelper.getChannelId();

		var clientInfo = authHelper.getClientInfo() || {},
			headers = {
				'Content-Type': 'application/json',
				'Accept': 'application/json',
				'channelId': channelId,
			};

		if (clientInfo.flag) {
			registerUrl = (enablePhoneNumberRegistrationValue === "true" && !isPro) ? Constants.URLS.AUTH_NEW_REGISTER_URL_IAM : Constants.URLS.AUTH_REGISTER_URL_IAM2;
			headers['Cust-Acct-Client-Token'] = clientInfo['tHat'];
			headers['Cust-Acct-Client-Timestamp'] = clientInfo['ts'];
			headers['Cust-Acct-Client-ID'] = clientInfo['id'];
			headers['Cust-Acct-Client-Delay-Token-Validation'] = authHelper.getClientDelay();
		}
		var startTime = new Date();
		jsonPayload.user.verifyPhoneCheck = !(jsonPayload.user.verifyPhoneCheck);
		accountUtility.triggerAJAXCall({
			url: registerUrl,
			crossDomain: true,
			cache: false,
			headers: headers,
			type: 'POST',
			xhrFields: {withCredentials: true},
			data: JSON.stringify(jsonPayload)
		}).done(function (data, xhr, statusText) {
			var endTime = new Date();
			var loggingData = $.extend(true, {}, data);
			var loggingPayload = $.extend(true, {}, jsonPayload);

			try {
				analytics.pushLoggingInfo(registerUrl, loggingPayload, loggingData, statusText.status, "POST", startTime, endTime);
			}
			catch (err) {
				console.log(err)
			}

			//Update the header with user info from the cookies
			//$(document).trigger('updateUserStatus');

			var jsonResponse = (statusText && statusText.responseText) ? JSON.parse(statusText.responseText) : null;
			if (jsonResponse && statusText.status == 200) {
				var isDuplicatePhone = !(jsonResponse.account.hasOwnProperty('profilePhones'));
				cookieUtils.initializeCookieManager();
				cookieUtils.initializeMasterCookie();
				Modal.hideModal();

				if ((isDuplicatePhone || userOptedIn) && !isPro && enablePhoneNumberRegistrationValue === "true") {

					var payload = {
						successCallback: function() {
							analytics.pushSuccessfulRegisterEventInfo();
							authenticationModal.showCustomerPreferencesModal();
							saveCustomerPreferences(successCallback, errorCallback, jsonPayload.user.emailId, jsonPayload.user.zipCode);
						}.bind(this),
						channelId: channelId,
						userOptedIn: userOptedIn,
						emailId: jsonPayload.user.emailId,
						phoneNumber: jsonPayload.user.phone.number,
                        enableEvoiceRegistration : enableEvoiceRegistration   //send the switch value in the payload
					};
                    // if user has Opted in for verify phone then get the value of otpChannel.
                    if(otpChannelForOptedinUser !== undefined){
                        payload.otpChannel = otpChannelForOptedinUser;
                    }

					var event = new CustomEvent("triggerRegistrationVerifyIdentity", {detail: payload});
					document.dispatchEvent(event);
				} else {
					if (isPro) {
						analytics.pushProXtraAccountCreatedOverlayEventInfo();
					} else {
						analytics.pushSuccessfulRegisterEventInfo();
					}
					authenticationModal.showCustomerPreferencesModal();
					saveCustomerPreferences(successCallback, errorCallback, jsonPayload.user.emailId, jsonPayload.user.zipCode);
				}
			} else {
				accountUtility.hideLoader();
				if (isPro) {
					$("#proAccountRegister").removeClass("disabled").removeAttr("disabled");
				} else {
					$("#accountRegister").removeClass("disabled").removeAttr("disabled");
				}
				regValidation.showProErrorMessage(parentRegisterButtonInput, Constants.ERROR.ERR_GENERIC_MESSAGE, undefined);
			}
		}).fail(function (xhr) {
			var endTime = new Date();
			try {
                analytics.pushLoggingInfo(registerUrl, JSON.stringify(jsonPayload), xhr.responseJSON, xhr.status, "POST", startTime, endTime);
            }
            catch (err) {
                console.log(err)
            }
			accountUtility.hideLoader();
			if (isPro) {
				$("#proAccountRegister").removeClass("disabled").removeAttr("disabled");
			} else {
				$("#accountRegister").removeClass("disabled").removeAttr("disabled");
			}
			if (typeof errorCallback === 'function') {
				errorCallback();
			} else {
				var responseData = (xhr && xhr.responseText) ? JSON.parse(xhr.responseText) : null;
				if (responseData) {
					var whichModalBttn = (isPro) ? clickProregister : parentRegisterButtonInput,
						errorCode = responseData.account.errors[0].errorCode,
						errorMessage = Constants.ERROR.ERR_GENERIC_MESSAGE;

					switch (errorCode) {
						case 'UREG_ERR_100':
						case 'UREG_ERR_101':
							errorMessage = Constants.ERROR.EMAIL_EMPTY_ERR;
							break;
						case 'UREG_ERR_102':
							errorMessage = Constants.ERROR.PASSWORD_EMPTY_ERR;
							break;
						case 'UREG_ERR_104':
							errorMessage = Constants.ERROR.REGISTER_CONFIRM_EMPTY_ERR_IAM;
							break;
						case 'UREG_ERR_106':
							errorMessage = Constants.ERROR.REGISTER_PASSWORDS_MISMATCH;
							break;
						case 'UREG_ERR_107':
							errorMessage = Constants.ERROR.PRO_MANDATORY_ZIPCODE_ERR;
							break;
						case 'UREG_ERR_121':
						case 'UREG_ERR_125':
						case 'UREG_ERR_126':
						case 'UREG_ERR_127':
						case 'UREG_ERR_160':
							errorMessage = Constants.ERROR.PRO_MANDATORY_CUSTOMER_ADDRESS_ERR;
							break;
						case 'UREG_ERR_131':
						case 'UREG_ERR_146':
							errorMessage = Constants.ERROR.ERR_PRO_PHONE;
							break;
						case 'UREG_ERR_149':
						case 'UREG_ERR_158':
							errorMessage = Constants.ERROR.REGISTER_EMAIL_EXISTS_ERR_IAM;
							break;
						case "UREG_ERR_164":
						case "UREG_ERR_165":
						case "UREG_ERR_166":
						case "UREG_ERR_167":
							errorMessage = Constants.ERROR.REGISTER_PASSWORD_WEAK_ERR_IAM;
							break;
						case "UREG_ERR_224":
							errorMessage = Constants.ERROR.ERR_USED_PHONE;
							break;
						case "UREG_ERR_225":
							errorMessage = Constants.ERROR.REGISTER_BLOCKED;
							break;
						default:
							errorMessage = Constants.ERROR.ERR_GENERIC_MESSAGE;
							break;
					}
					regValidation.showProErrorMessage(whichModalBttn, errorMessage, errorCode);
				}
			}
		});
	};

	/**
	 * @Description: Helps to make the AJAX call and get the response
	 *
	 * @Param: data - Request parameter data
	 * @Param: successCallback
	 * @Param: errorCallback
	 **/
	var doWCSRegisteration = function (data, successCallback, errorCallback) {

		getGuestAuthorizationToken(function (authorizationToken) {
			$.support.cors = true;
			var registerUrl = (accountUtility.getRegistrationLite()) ? Constants.URLS.AUTH_REGISTER_LITE_URL : Constants.URLS.AUTH_REGISTER_URL;
			accountUtility.triggerAJAXCall({
				url: registerUrl,
				type: 'POST',
				contentType: "application/x-www-form-urlencoded",
				data: data,
				crossDomain: true,
				cache: false,
				xhrFields: {
					withCredentials: true,
					Authorization: authorizationToken
				}
			}).done(function (data) {
				//Set the required cookies
				if (data.logonId && data.userId) {
					try {
						//Set THD_PERSIST crumbs C44 & C46 - 7.39.2
						var updatedNonTLSValue = data.nonTlsEncodedActivityToken,
							updatedAuthStatusValue = data.logonId,
							updatedAuthTokenValue = data.encodedActivityToken;

						cookieUtils.initializeMasterCookie();
						cookieUtils.createCookie(Constants.COOKIE_NONTLS_THD_AUTHORIZATION_TOKEN, updatedNonTLSValue, Constants.COOKIE_EXPIRY_ONE_YEAR);
						cookieUtils.createCookie(Constants.COOKIE_THD_USER_AUTH_STATUS, updatedAuthStatusValue, Constants.COOKIE_EXPIRY_ONE_YEAR);
						cookieUtils.createCookie(Constants.COOKIE_THD_AUTHORIZATION_TOKEN, updatedAuthTokenValue, Constants.COOKIE_EXPIRY_ONE_YEAR);

					} catch (e) {
						console.error("cookie failed to set", e);
					}
				}

				analytics.pushSuccessfulRegisterEventInfo();

				//@TODO: Show email subscription, add the necessary flags to showing the welcome popup
				//@TODO: Add the flag for PRO

				//Update the header with user info from the cookies
				$(document).trigger('updateUserStatus');

				if (typeof successCallback === 'function') {
					successCallback();
				} else {
					//@TODO: Reload the page after
					window.location.reload();
				}

			}).fail(function (xhr) {
				if (typeof errorCallback === 'function') {
					errorCallback();
				} else {
					var errorDescription = 'Sorry. Try again';
					if (xhr && xhr.responseJSON) {
						errorDescription = xhr.responseJSON.errorDescription;
					}
					regValidation.showErrorMessage(errorDescription);
				}
			});
		});
	};

	/**
	 * @Description: Trigger the registration flow
	 *
	 * @Param: successCallback
	 * @Param: errorCallback
	 **/
	var triggerRegisteration = function (successCallback, errorCallback) {
		var showPhoneVerifyText = false;
		passwordMeter.set({
			passwordMeterDivId: 'dualSignIn-password-meter',
			passwordMeterLabel: 'no_label',
			overrideDefaultStyle: true,
			passwordMeterCallback: function () {
			}
		});

		var clickProregister = false;
		var $frmUserResigration = $(document);
		$('.setPasswordDiv').hide();

		$frmUserResigration.on('blur', 'form#createAccount input#email_id', function (event) {
			var doCheckEmailExistCall = true;
			regValidation.checkForEmailErrors($(this), doCheckEmailExistCall);
		});

		$frmUserResigration.on('keyup', 'form#createAccount input#email_id', function (event) {
			$('.registerSetPwd').show();
			$('.setPasswordDiv').hide();

			if (event.keyCode == 8 || event.keyCode == 46) {
				$('#emailholder').find('.form-input-error__message').hide();
				$('#emailholder').find('.invalid').removeClass('invalid');
				$('#emailholder').removeClass('form-input--error');

			}
		});

		$frmUserResigration.on('input', 'form#createAccount input#phoneNumber', function (event) {
			var value = event.target.value;
			var cursorPosition = event.target.selectionStart;

			event.target.value = value.replace(/\D/g, '') // Captures all non-digits and removes them
				.replace(/^(\d)/, '($1') // Captures all digits
				.replace(/^(\(\d{3})(\d)/, '$1) $2') // Captures ( & first 3 digits in the first grouping and the rest in the second
				.replace(/(\d{3})(\d{1,4})/, '$1-$2') // Captures the set of digits with 4 to 8 and splits them in groups of 3 & (1-4)
				.replace(/(-\d{4})\d+?$/, '$1'); // Captures the set of digits after the - and removes all digits past the 4th one.

			// If replace a character at the end or deleting the space down
			if (event.inputType === "deleteContentBackward" || cursorPosition !== value.length) {
				event.target.setSelectionRange(cursorPosition, cursorPosition);
			}
		});

		$frmUserResigration.on('blur', 'form#createAccount input#phoneNumber', function (event) {
			/**
			 * Validate if the input field has 10 numbers put in.
			 */
			regValidation.checkForRegularPhoneNumberErrors($(this));
		});
		
		$frmUserResigration.on('keyup', 'form#createAccount input#phoneNumber', function (event) {
			/**
			 * Validate if the input field has 10 numbers put in.
			 */
			 if($(this).val().length === 14){
			 	regValidation.checkForRegularPhoneNumberErrors($(this));
			 }
			
		});

		$frmUserResigration.on('click', 'form#createAccount #phoneVerifyLink', function (event) {
			showPhoneVerifyText = !showPhoneVerifyText;
			if (showPhoneVerifyText) {
				$('#phoneVerifyText').removeClass('u--hide').addClass('u--show')
			} else {
				$('#phoneVerifyText').removeClass('u--show').addClass('u--hide')
			}
		});

		$frmUserResigration.on('click', 'form#createAccount #registerInDiff', function (event) {
			analytics.pushSignInWithDifferentEmailEventInfo("registration: register with different email");
			$('.registerSetPwd').show();
			$('.setPasswordDiv').hide();
			$('#email_id').val("");
			$('#registrationPassword').val("");
			$('#emailholder, #pwdholder').find('.form-input-error__message').hide();
			$('#emailholder, #pwdholder').find('.invalid').removeClass('invalid');
			$('#emailholder, #pwdholder').removeClass('form-input--error');
			$('#registrationPassword').removeClass('weakPassword');

		});

		$frmUserResigration.on('click', 'form#createAccount #setPasswordButton', function (event) {
			$("#setPasswordButton").addClass("disabled").attr("disabled", "disabled");
			analytics.pushSetYourPasswordEventInfo("registration: set your password");
			$setPwdButton = $('form#createAccount button#setPasswordButton');
			var emailValue = $('#email_id').val();
			if (emailValue && emailValue.length && emailValue.length === 0) {
	            var emailFormField = document.querySelector("form#createAccount input#email_id");
                emailValue = emailFormField.value
            }
			var setPasswordEmailUrl = Constants.URLS.SET_PASSWORD_EMAIL_URL + '?email=' + emailValue;
			var channelId = authHelper.getChannelId();
			authenticationModal.showSetPasswordRegistrationModal();
			/*
			accountUtility.triggerAJAXCall({
			url: setPasswordEmailUrl,
					crossDomain: true,xhrFields: {
							withCredentials: true
					},
				 // cache: false,
				 headers: {
				 'Content-Type': 'application/json',
					 'Accept': 'application/json',
					 'channelId': channelId
				 },
				 type : 'GET'
				}).done(function (data) {
					window.location.href = Constants.URLS.REDIRECT_SET_PWD_EMAIL_PAGE;
					$("#setPasswordButton").removeClass("disabled").removeAttr("disabled");
				}).fail(function (xhr) {
					console.log("error");
					$("#setPasswordButton").removeClass("disabled").removeAttr("disabled");
					regValidation.showProErrorMessage($setPwdButton, Constants.ERROR.ERR_GENERIC_MESSAGE, undefined);
				});
		 */
		});

		/*---------------------------------------------------------------------------------------------------*/

		$frmUserResigration.on('keyup', 'form#createAccount input#registrationPassword', function (event) {
			regValidation.removeErrors($("#registrationPasswordContainerOverlay"));
			var emailText = $('form#createAccount input#email_id').val();
			if (emailText && emailText.length && emailText.length === 0) {
	            var emailFormField = document.querySelector("form#createAccount input#email_id");
                emailText = emailFormField.value
            }
			$(this).data('strength', passwordMeter.validatePassword($(this), emailText));

			if ($('form#createAccount input#registrationPassword').val().length > 0) {
				$('#passwordStrengthWord').show();
			} else {
				$('#passwordStrengthWord').hide();
			}

			if ($('form#createAccount #l-passwordMeter').text().indexOf('strong') === 0) {
				$('#passwordStrengthWord').css('display', 'block').html('Strong').removeClass('weakWord').removeClass('goodWord').addClass('strongWord');
				$('#registrationPasswordContainerOverlay').removeClass('weakPassword').removeClass('goodPassword').addClass('strongPassword');
			} else if ($('form#createAccount #l-passwordMeter').text().indexOf('fair') === 0) {
				$('#passwordStrengthWord').css('display', 'block').html('Fair').removeClass('weakWord').removeClass('strongWord').addClass('goodWord');
				$('#registrationPasswordContainerOverlay').removeClass('strongPassword').removeClass('weakPassword').addClass('goodPassword');
			} else if ($('form#createAccount #l-passwordMeter').text().indexOf('weak') === 0) {
				$('#passwordStrengthWord').css('display', 'block').html('Weak').removeClass('goodWord').removeClass('strongWord').addClass('weakWord');
				$('#registrationPasswordContainerOverlay').removeClass('strongPassword').removeClass('goodPassword').addClass('weakPassword');
			} else {
				$('#passwordStrengthWord').css('display', 'none').html('').removeClass('weakWord').removeClass('goodWord').removeClass('strongWord');
				$('#registrationPasswordContainerOverlay').removeClass('strongPassword').removeClass('goodPassword').removeClass('weakPassword');
			}

			$('#dualSignIn-password-meter .l-control-group span').css('display', 'none');
		});

		/*----------------------------------------------------------------------------------------------------*/

		$frmUserResigration.on('focusin', '#registrationPasswordContainerOverlay', function (event) {
			$('#registrationPasswordContainerOverlay').addClass('createAccountModalForm__input-field--focused')
		});

		$frmUserResigration.on('blur', 'form#createAccount input#registrationPassword', function (event) {
			var $password = $('form#createAccount input#registrationPassword');
			regValidation.validateSinglePassword($password, $("#registrationPasswordContainerOverlay"));

			passwordMeter.hide();
			$('#passwordStrengthWord').hide();
		}).on('focus', 'form#createAccount input#registrationPassword', function (event) {
			passwordMeter.generate();

			// Hide the meter
			$('form#createAccount #l-passwordMeter').children('div').hide();

			// show the weak fair strong
			if ($('form#createAccount input#registrationPassword').val().length > 0) {
				$('#passwordStrengthWord').show();
			} else {
				$('#passwordStrengthWord').hide();
			}

		});

		$frmUserResigration.on('blur', 'form#createAccount input#zipcode', function (event) {
			regValidation.checkForZipCodeErrors($(this));
		});
		$frmUserResigration.on('keyup', 'form#createAccount input#zipcode', function (event) {
			if($(this).val().length === 5){
				regValidation.checkForZipCodeErrors($(this));
			}
		});


		$frmUserResigration.on('click', 'form#createAccount #showPasswordCheck', function (event) {
			if ($('#registrationPassword').attr("type") !== 'text') {
				$(this).text('Hide');
				$('#registrationPassword').removeAttr('type', 'password');
				$('#confirmPassword').removeAttr('type', 'password');
				$('#registrationPassword').attr('type', 'text');
				$('#confirmPassword').attr('type', 'text');
			} else {
				$(this).text('Show');
				$('#registrationPassword').removeAttr('type', 'text');
				$('#confirmPassword').removeAttr('type', 'text');
				$('#registrationPassword').attr('type', 'password');
				$('#confirmPassword').attr('type', 'password');
			}

		});

		$frmUserResigration.on('change', 'form#createAccount input[name=contaractorortradesman]', function (event) {
			event.preventDefault();
			if ($('#proCustomer').is(':checked')) {
				analytics.pushIAmAProCustomerBoxCheckedEventInfo();
			}
		});

        // When user checks the "verify my phone" checkbox, the below function is triggered.
        $frmUserResigration.on('change', 'form#createAccount input[id=phoneVerifyCheckbox]', function (event) {
            event.preventDefault();
            // show the section if the switch is ON and the checkbox was checked.
            if ($('#phoneVerifyCheckbox').is(':checked')  && $('#registrationEvoiceSwitch').val() === 'true') {
                $("#evoiceSectionInRegistration").removeClass('hide').show();
            }
            else{
                // hide the section
                $("#evoiceSectionInRegistration").hide();
            }
        });

		$frmUserResigration.on('click', 'form#createAccount button#accountRegister', function (event) {
			event.preventDefault();
			var $parentButton = $(this);
			clickProregister = false;

			var isContractorOrTradesman = $frmUserResigration.find('form#createAccount input[name=contaractorortradesman]').is(':checked');

			if (isContractorOrTradesman) {
				var $inputObject = {};
				$inputObject['$firstName'] = $('form#createAccount input#firstName');
				$inputObject['$lastName'] = $('form#createAccount input#lastName');
				$inputObject['$zipCode'] = $('form#createAccount input#zipcode');
				$inputObject['$emailAddress'] = ($('form#createAccount #email_id').length && $('form#createAccount #email_id').length > 0) ? $('#createAccount #email_id') : $(document.querySelector("form#createAccount input#email_id"));
				$inputObject['$password'] = $('form#createAccount input#registrationPassword');
				$inputObject['$confirmPassword'] = $('form#createAccount input#registrationPassword');
				var enablePhoneNumberRegistrationValue = $('#enablePhoneNumberRegistrationFeature').val();
				if (enablePhoneNumberRegistrationValue) {
					$inputObject['$phoneNumber'] = $('form#createAccount input#phoneNumber');
				}

				if (regValidation.validateRegister($inputObject, true)) {
					var jsonPayload = {
						"user": {
							"emailId": $inputObject['$emailAddress'].val(),
							"password": $inputObject['$password'].val(),
							"confirmPassword": $inputObject['$password'].val(),
							"zipCode": $inputObject['$zipCode'].val()
						}
					};

					Modal.hideModal();
					authenticationModal.showProModal();
					if (enablePhoneNumberRegistrationValue === 'true') {
						$('#proUpgradePhone').val($inputObject['$phoneNumber'].val());
						$('#proUpgradePhone').removeClass('invalid');
					}
				}
				var $proRegisterButton;
				var singleCity = false;
				var $frmUserProRegistration = $(document);
				$.each(authHelper.businessTrade, function (key, value) {
					$('#tradeSelect').append($("<option></option>")
						.attr("value", authHelper.businessTrade[key].typeEnumeration)
						.text(authHelper.businessTrade[key].typeDescription));
				});

				$('#addOptionalAddressHolder').hide();
				$('#addAddressZipCodeHolder').hide();
				$('#enterZipText').hide();
				$('#cityStateHolder').hide();
				$('#addOptionalAddressLink').show();
				$('#cityStateText').show();
				$('#multipleCitySelectHolder').hide();
				$('#singleCityHolder').hide();
				$('#otherTradeNameHolder').hide();

				$frmUserProRegistration.on('blur', 'form#createProAccount input#companyName', function (event) {
					regValidation.checkForBusinessNameErrors($(this));
				});

				$frmUserProRegistration.on('blur', 'form#createProAccount input#addProAddress', function (event) {
					regValidation.checkForAddrLine1Error($(this));
				});

				$('form#createProAccount input#addProAddress').keyup(function () {
					if (!regValidation.isEmpty($(this))) {
						$('#addAddressZipCode').val('');
						$('#addAddressZipCodeHolder').show();
						$('#enterZipText').show();
						$('#cityStateHolder').hide();
					} else {
						$('#addAddressZipCodeHolder').hide();
						$('#enterZipText').hide();
						$('#cityStateHolder').hide();
					}
				});

				$('form#createProAccount input#addAddressZipCode').keypress(function (event) {
					return regValidation.validateZipCode($(this), event);
				});

				$('form#createProAccount input#proUpgradePhone').keydown(function (event) {
					//Allow the backspace if given
					if (event.keyCode === 8 || event.keyCode === 46) {
						return;
					}

					if ($.inArray(event.keyCode, [9, 27, 110, 190]) !== -1 ||
						// Allow: Ctrl/cmd+A
						(event.keyCode === 65 && (event.ctrlKey === true || event.metaKey === true)) ||
						// Allow: Ctrl/cmd+C
						(event.keyCode === 67 && (event.ctrlKey === true || event.metaKey === true)) ||
						// Allow: Ctrl/cmd+X
						(event.keyCode === 88 && (event.ctrlKey === true || event.metaKey === true)) ||
						// Allow: Ctrl/cmd+V
						(event.keyCode === 86 && (event.ctrlKey === true || event.metaKey === true)) ||
						// Allow: home, end, left, right
						(event.keyCode >= 35 && event.keyCode <= 39)) {
						// Let the above scenarios occur otherwise don't.
						return;
					}
					// Ensure that it is a number and stop the key event from bubbling up.
					if ((event.shiftKey || (event.keyCode < 48 || event.keyCode > 57)) && (event.keyCode < 96 || event.keyCode > 105)) {
						// keyCode is not a number, so prevent the key event.
						event.preventDefault();
						return;
					}

					var value = event.target.value;
					event.target.value = value.replace(/\D/g, '') // Captures all non-digits and removes them
						.replace(/^(\d)/, '($1') // Captures all digits
						.replace(/^(\(\d{3})(\d)/, '$1) $2') // Captures ( & first 3 digits in the first grouping and the rest in the second
						.replace(/(\d{3})(\d{1,4})/, '$1-$2') // Captures the set of digits with 4 to 8 and splits them in groups of 3 & (1-4)
						.replace(/(-\d{4})\d+?$/, '$1'); // Captures the set of digits after the - and removes all digits past the 4th one.
				});

				$('form#createProAccount input#proUpgradePhone').blur(function (event) {
					return regValidation.checkForPhoneNumberErrors($(this), event);
				});


				$('form#createProAccount input#addAddressZipCode').keyup(function (event) {
					if (($('#addAddressZipCode').val() != "") && ($('#addAddressZipCode').val().length == 5)) {
						$proRegisterButton = $('form#createProAccount button#proAccountRegister');
						var zipdata = $('#addAddressZipCode').val();
						var registerUrl = Constants.URLS.VERA_ZIP_URL + '/' + zipdata;
						var channelId = authHelper.getChannelId();

						accountUtility.triggerAJAXCall({
							url: registerUrl,
							crossDomain: true,
							xhrFields: {
								withCredentials: true
							},
							// cache: false,
							headers: {
								'Content-Type': 'application/json',
								'Accept': 'application/json',
								'channelId': channelId
							},
							type: 'GET'
						}).done(function (data) {
							//Set the required cookies
							if (data) {
								regValidation.showProErrorMessage($proRegisterButton, "", undefined);
								var cities = data.postalDetailsList;
								if (cities.length > 1) {
									singleCity = false;
									$('form#createProAccount select#multipleCitySelect').html('');
									var options = $('form#createProAccount select#multipleCitySelect');
									$.each(cities, function (key, value) {
										options.append($("<option />").val(cities[key].city).text(cities[key].city + ',' + cities[key].state));
									});
									$('#multipleCitySelectHolder').show();
									$('#singleCityHolder').hide();
									$('#cityStateHolder').show();
								} else {
									singleCity = true;
									$('form#createProAccount #singleCityHolder').text(cities[0].city + ',' + cities[0].state);
									$('#singleCityHolder').show();
									$('#multipleCitySelectHolder').hide();
									$('#cityStateHolder').show();
								}
								$('#enterZipText').hide();
							}
						}).fail(function (xhr) {
							$('#cityStateHolder').hide();
							$('#enterZipText').show();
							var responseData = JSON.parse(xhr.responseText);
							if (responseData.errors[0].errorCode == "PSTL_ERR_001") {
								regValidation.showProErrorMessage($proRegisterButton, Constants.ERROR.PRO_ZIP_CODE_BACKEND_ERR, "PSTL_ERR_001");
							} else {
								$('#addAddressZipCode').val("");
								regValidation.showProErrorMessage($proRegisterButton, Constants.ERROR.ERR_GENERIC_MESSAGE, undefined);
							}

						});
					} else {
						regValidation.zipCodeError($(this));
						$('#singleCityHolder').hide();
						$('#multipleCitySelectHolder').hide();
						$('#cityStateHolder').hide();
						$('#enterZipText').show();
					}
				});

				$frmUserProRegistration.on('blur', 'form#createProAccount input#addAddressZipCode', function (event) {
					regValidation.zipCodeError($(this));
				});


				$frmUserProRegistration.on('click', 'form#createProAccount #addOptionalAddressLink', function (event) {
					$('#addOptionalAddressHolder').show();
					$('#addOptionalAddressLink').hide();

					$frmUserProRegistration.on('keyup', 'form#createProAccount input#addProOtionalAddress', function (event) {
						regValidation.checkForAddrLine2Error($(this));
					});

				});
				$('form#createProAccount select#tradeSelect').change(function () {
					if (this.value == 'OTHER') {
						$('#otherTradeName').val('');
						$(this).removeClass('invalid');
						$('#otherTradeName').addClass('invalid');
						$('#otherTradeNameHolder').show();
					} else {
						$('#otherTradeNameHolder').hide();
						$('#otherTradeName').removeClass('invalid');
						$(this).removeClass('invalid');
					}
					regValidation.businessOrTradeError($(this));
				})
				$frmUserProRegistration.on('blur', 'form#createProAccount input#otherTradeName', function (event) {
					regValidation.otherTradeError($(this));
				});

				$frmUserProRegistration.on('click', 'form#createProAccount button#proAccountRegister', function (event) {
					clickProregister = true;
					event.preventDefault();
					var city;
					var state;
					var $inputObjectPro = {};
					$inputObjectPro['$companyName'] = $('form#createProAccount input#companyName');
					$inputObjectPro['$proUpgradePhone'] = $('form#createProAccount input#proUpgradePhone');
					var primaryNumberReplace = $('form#createProAccount input#proUpgradePhone').val().replace("(", "").replace(")", "").replace(" ", "");
					var primaryNumberSplit = primaryNumberReplace.split('-');
					var proPrimaryNumber = primaryNumberSplit.join("");
					$inputObjectPro['$addProAddress'] = $('form#createProAccount input#addProAddress');
					if ($('#addOptionalAddressHolder').is(":visible") && $('form#createProAccount input#addProAddress').val() != "") {
						$inputObjectPro['$addProOtionalAddressExist'] = true;
						$inputObjectPro['$addProOtionalAddress'] = $('form#createProAccount input#addProOtionalAddress');
					} else {
						$inputObjectPro['$addProOtionalAddressExist'] = false;
					}
					$inputObjectPro['$businessName'] = $('form#createProAccount select#tradeSelect');
					if ($('form#createProAccount select#tradeSelect option:selected').val() == "OTHER") {
						$inputObjectPro['$otherTradeDescriptionExist'] = true;
						$inputObjectPro['$otherTradeDescription'] = $('form#createProAccount input#otherTradeName');
					} else {
						$inputObjectPro['$otherTradeDescriptionExist'] = false;
					}
					$inputObjectPro['$zipCode'] = $('form#createProAccount input#addAddressZipCode');

					if (regValidation.validateProRegister($inputObjectPro)) {
						jsonPayload.user.businessName = $inputObjectPro['$companyName'].val();
						jsonPayload.user.phone = {};
						jsonPayload.user.phone.number = proPrimaryNumber;
						jsonPayload.user.phone.primaryFlag = "Y";
						jsonPayload.user.phone.type = "UNKNOWN";
						jsonPayload.user.loyaltyEnrollmentIndicator = "Y";
						jsonPayload.user.tradeType = $inputObjectPro['$businessName'].val();

						if ($('form#createProAccount select#tradeSelect').val() == "OTHER") {
							jsonPayload.user.otherTradeDescription = $inputObjectPro['$otherTradeDescription'].val();
						}
						jsonPayload.user.address = {};
						jsonPayload.user.address.postalDetails = {"addressLine1": $inputObjectPro['$addProAddress'].val()};
						if ($('#addOptionalAddressHolder').is(":visible")) {
							jsonPayload.user.address.postalDetails.addressLine2 = $inputObjectPro['$addProOtionalAddress'].val();
						}
						jsonPayload.user.address.postalDetails.country = "US";
						jsonPayload.user.address.postalDetails.zipCode = $inputObjectPro['$zipCode'].val();
						if (singleCity) {
							var cityStateVar = $('form#createProAccount #singleCityHolder').text();
							var cityStateArr = cityStateVar.split(',');
							for (var i = 0; i < cityStateArr.length; i++) {
								cityStateArr[i] = cityStateArr[i].trim();
							}
							jsonPayload.user.address.postalDetails.city = cityStateArr[0];
							jsonPayload.user.address.postalDetails.state = cityStateArr[1];
						} else {
							var cityStateVar = $('form#createProAccount select#multipleCitySelect option:selected').text();
							var cityStateArr = cityStateVar.split(',');
							for (var i = 0; i < cityStateArr.length; i++) {
								cityStateArr[i] = cityStateArr[i].trim();
							}
							jsonPayload.user.address.postalDetails.city = cityStateArr[0];
							jsonPayload.user.address.postalDetails.state = cityStateArr[1];
						}
					}
					doRegisteration(jsonPayload, successCallback, errorCallback, $proRegisterButton, $parentButton);
				});


			} else {
				var $inputObject = {};
				var enablePhoneNumberRegistrationValue = $('#enablePhoneNumberRegistrationFeature').val();
				if (enablePhoneNumberRegistrationValue === 'true') {
					$inputObject['$phoneNumber'] = $('form#createAccount input#phoneNumber')
				}
				$inputObject['$firstName'] = $('form#createAccount input#firstName');
				$inputObject['$lastName'] = $('form#createAccount input#lastName');
				$inputObject['$zipCode'] = $('form#createAccount input#zipcode');
				$inputObject['$emailAddress'] =  ($('form#createAccount #email_id').length && $('form#createAccount #email_id').length > 0) ? $('form#createAccount #email_id') : $(document.querySelector("form#createAccount #email_id"));
				$inputObject['$password'] = $('form#createAccount input#registrationPassword');
				$inputObject['$confirmPassword'] = $('form#createAccount input#registrationPassword');
				if (regValidation.validateRegister($inputObject, false)) {
					var jsonPayload = {
						"user": {
							"emailId": $inputObject['$emailAddress'].val(),
							"password": $inputObject['$password'].val(),
							"confirmPassword": $inputObject['$password'].val(),
							"zipCode": $inputObject['$zipCode'].val(),
							"sessionId": window.tmxprofilesessionid,
							"origin": window.location.pathname
						}
					};

					if (enablePhoneNumberRegistrationValue === 'true') {
						jsonPayload.user['phone'] = {
							"number": $inputObject['$phoneNumber'].val().replace(/[- )(]/g, '').slice(0, 10),
							"primaryFlag": "Y",
							"type": "MOBILE"
						}
					}
					// new flow pilot param
					doRegisteration(jsonPayload, successCallback, errorCallback, '', $parentButton);
				}
			}
		});
	};

	/**
	 * @Description: Trigger the registration flow
	 *
	 * @Param: successCallback
	 * @Param: errorCallback
	 **/
	var triggerWCSRegisteration = function (successCallback, errorCallback) {
		var $frmUserResigration = $(document);

		$frmUserResigration.on('blur', 'form#createAccount input#email_id', function (event) {
			regValidation.checkForEmailErrors($(this), true);
		});

		$frmUserResigration.on('keyup', 'form#createAccount input#registrationPassword', function (event) {
			var emailText = $('form#createAccount input#email_id').val();
			if (emailText && emailText.length && emailText.length === 0) {
	            var emailFormField = document.querySelector("form#createAccount input#email_id");
                emailText = emailFormField.value
            }
			$(this).data('strength', passwordMeter.validatePassword($(this), emailText));
		});

		$frmUserResigration.on('blur', 'form#createAccount input#registrationPassword', function (event) {
			var $confirmPassword = $('form#createAccount input#confirmPassword');
			regValidation.validatePassword($(this), $confirmPassword);
			passwordMeter.hide();
		}).on('focus', 'form#createAccount input#registrationPassword', function (event) {
			passwordMeter.generate();
		});

		$frmUserResigration.on('blur', 'form#createAccount input#zipcode', function (event) {
			regValidation.checkForZipCodeErrors($(this));
		});

		if (!accountUtility.getRegistrationLite()) {
			$frmUserResigration.on('blur', 'form#createAccount input#firstName', function (event) {
				regValidation.checkForFirstNameErrors($(this));
			});

			$frmUserResigration.on('blur', 'form#createAccount input#lastName', function (event) {
				regValidation.checkForLastNameErrors($(this));
			});

			$frmUserResigration.on('blur', 'form#createAccount input#confirmPassword', function (event) {
				var $password = $('form#createAccount input#registrationPassword');
				regValidation.validateConfirmPassword($password, $(this));
			});
		}

		$frmUserResigration.on('click', 'form#createAccount button#accountRegister', function (event) {
			event.preventDefault();

			var $inputObject = {};
			$inputObject['$firstName'] = $('form#createAccount input#firstName');
			$inputObject['$lastName'] = $('form#createAccount input#lastName');
			$inputObject['$zipCode'] = $('form#createAccount input#zipcode');
			$inputObject['$emailAddress'] =  ($('form#createAccount input#email_id').length && $('form#createAccount input#email_id').length > 0) ? $('form#createAccount input#email_id') : document.querySelector("form#createAccount input#email_id");
			$inputObject['$password'] = $('form#createAccount input#registrationPassword');
			if (regValidation.validateRegister($inputObject, false)) {
				var firstName = $inputObject['$firstName'].val() || "Self",
					lastName = $inputObject['$lastName'].val() || "Self",
					zipCode = $inputObject['$zipCode'].val(),
					emailAddress = $inputObject['$emailAddress'].val(),
					password = $inputObject['$password'].val(),
					confirmPassword = $inputObject['$password'].val(),
					isContractorOrTradesman = $frmUserResigration.find('form#createAccount input[name=contaractorortradesman]').is(':checked');

				var data = "firstName=" + encodeURIComponent(firstName) +
					"&lastName=" + encodeURIComponent(lastName) +
					"&zipCode=" + encodeURIComponent(zipCode) +
					"&emailId=" + encodeURIComponent(emailAddress) +
					"&password=" + encodeURIComponent(password) +
					"&confirmPassword=" + encodeURIComponent(confirmPassword) +
					"&channel=INTERNAL_API" +
					"&client_type=internal" +
					"&response_type=activity" +
					"&client_id=internal_test" +
					"&businessChannelId=-1" +
					"&rememberMe=true" +
					"&registrationLite=true" +
					"&isContractorOrTradesman=" + isContractorOrTradesman;
				doWCSRegisteration(data, successCallback, errorCallback);
			}
		});
	};

	var saveCustomerPreferences = function (successCallback, errorCallback, emailId, zipcode) {
		accountUtility.hideLoader();
		var $frmUserProRegistration = $(document);
		$frmUserProRegistration.on('click', 'form#saveCustomerPreferences button#customerPreferencesSubmit', function (event) {

			accountUtility.showLoader();
			$("#customerPreferencesSubmit").addClass("disabled").attr("disabled", "disabled");
			event.preventDefault();

			var theHomeDepotCheckBoxValue = $('#THDCheckbox').is(':checked');
			var localAdCheckBoxValue = $('#localAdCheckbox').is(':checked');
			var PROCheckBoxValue = $('#PROCheckbox').is(':checked');
			var specialBuyCheckBoxValue = $('#specialBuyCheckbox').is(':checked');
			var gardenClubCheckBoxValue = $('#gardenClubCheckbox').is(':checked');
			var decorAndDesignCheckboxValue = $('#decorAndDesignCheckbox').is(':checked');
			var requestPayload = {
				"preferences": {
					"preference": [{"isSubscribed": theHomeDepotCheckBoxValue, "code": "PROMOTIONS"},
						{"isSubscribed": localAdCheckBoxValue, "code": "CATALOGS"},
						{"isSubscribed": PROCheckBoxValue, "code": "PRO"},
						{"isSubscribed": specialBuyCheckBoxValue, "code": "SPECIAL_BUY_OF_THE_DAY"},
						{"isSubscribed": gardenClubCheckBoxValue, "code": "GARDEN_CLUB_NEWSLETTER"},
						{"isSubscribed": decorAndDesignCheckboxValue, "code": "DECOR_AND_DESIGN"}]
				}
			};
			submitCustomerPreferences(requestPayload, successCallback, errorCallback, emailId, zipcode);
		});

		//Event triggered when you close the modal. This will help to trigger the callbacks
		$('.account-modal__close').on('accountModalCloseEvent', function () {
			if (typeof successCallback === 'function') {
				successCallback();
			} else {
				window.location.reload();
			}
		});
	};

	var submitCustomerPreferences = function (requestPayload, successCallback, errorCallback, emailId, zipcode) {

		var authorizationToken = "",
			memberID = accountUtility.getSvocIdAndPersistedEmailID().SVOC_ID || accountUtility.getMemberId(),
			customerPreferencesUrl = Constants.URLS.CUSTOMER_PREFERENCES_URL + memberID + '/preferences?email=' + emailId + '&zipCode=' + zipcode;

		authorizationToken = accountUtility.getAuthorizationToken();
		var channelId = authHelper.getChannelId();
		var startTime = new Date();

		accountUtility.triggerAJAXCall({
			url: customerPreferencesUrl,
			cache: false,
			headers: {
				'Content-Type': 'application/json',
				'Accept': 'application/json',
				'channelId': channelId,
				'Authorization': authorizationToken
			},
			type: 'PUT',
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,
			data: JSON.stringify(requestPayload)
		}).done(function (data, statusText, xhr) {
			var endTime = new Date();
			var loggingData = $.extend(true, {}, data);
			var loggingPayload = $.extend(true, {}, requestPayload);

			try {
				analytics.pushLoggingInfo(customerPreferencesUrl, loggingPayload, loggingData, xhr.status, "PUT", startTime, endTime);
			}
			catch (err) {
				console.log(err)
			}
			$("#customerPreferencesSubmit").removeClass("disabled").removeAttr("disabled");
			if (typeof successCallback === 'function') {
				successCallback();
			} else {
				window.location.reload();
			}
		}).fail(function (xhr) {
			var endTime = new Date();
			try {
                analytics.pushLoggingInfo(customerPreferencesUrl, JSON.stringify(requestPayload), xhr.responseJSON, xhr.status, "PUT", startTime, endTime);
            }
            catch (err) {
                console.log(err)
            }
			$("#customerPreferencesSubmit").removeClass("disabled").removeAttr("disabled");
			if (typeof errorCallback === 'function') {
				errorCallback();
			} else {
				window.location.reload();
			}

		});
	};

	return {
		initiateRegisteration: function (successCallback, errorCallback) {
			if (authHelper.isIAMThrottled()) {
				triggerRegisteration(successCallback, errorCallback);
			} else {
				triggerWCSRegisteration(successCallback, errorCallback);
			}
		}
	};
});

(function closure(root, factory) {
	if (typeof define === 'function' && define.amd) {
		define('auth.service',[
			'jquery',
			'auth.modal',
			'auth.signin',
			'auth.registeration',
			'auth.helper',
			'account.device.utility',
			'cookie-utils',
			'account.utility',
			'auth.constants'
		], function load(jQuery, authenticationModal, signIn, register, authHelper, deviceUtility, cookieUtils, accountUtility, Constants) {
			return factory(root, jQuery, authenticationModal, signIn, register, authHelper, deviceUtility, cookieUtils, accountUtility, Constants);
		});
	} else {
		// For non-AMD module, expose this to global (will also be useful for test cases)
		/*eslint-disable*/
		factory(root, jQuery, authenticationModal, signIn, register, authHelper, deviceUtility, cookieUtils, accountUtility, Constants);
		/*eslint-enable*/
	}
})(this, function factory(root, $, authenticationModal, signIn, register, authHelper, deviceUtility, cookieUtils, accountUtility, Constants) {
	/**
	 * Function to hide the header drop down
	 **/
	var hideHeaderDropDowns = function () {
		$(document).trigger({
			type: 'hideHeaderDropdowns'
		});
	};

	/**
	 * Function helps to display the dual sign-in modal
	 * 1) isRegisterTabSelected - Help to default the tab selection to register or sign-in
	 *                         By default, it will sign-in tab selected
	 * 2) successCallback - Callback function to execute on the success of sign-in or register.
	 *                     This is an optional parameter
	 * 3) errorCallback - Callback function to handle the error scenario of sign-in or register
	 *                     This is an optional parameter
	 **/
	var showDualSignInModal = function (isRegisterTabSelected, successCallback, errorCallback, isMobileChannel) {

		authHelper.setIsMobileChannel(isMobileChannel);  // setting mobile channel boolean to pass in GCP services.

		//Check if the flag is there
		checkSvocFeatureSwitch(function () {
			authenticationModal.showModal(isRegisterTabSelected, isMobileChannel);
			signIn.initiateSignIn(successCallback, errorCallback);
			register.initiateRegisteration(successCallback, errorCallback);
		});
	};


	/**
	 * Helps to get the SVOC feature switch flag
	 * If we pass the callback, it is executed on the success of the feature switch call
	 * and the case where feature switch is already available
	 **/
	var checkSvocFeatureSwitch = function (callBackFn) {

		//Validating if the flag is already present in the session storage
		if (!authHelper.isFeatureSwitchPresent()) {
			//Get the required feature switch value and show the dual sign in modal
			authHelper.triggerFeatureSwitchCall().done(function (response) {
				var featureSwitch = [];
				if (response && response.FeatureResponse && response.FeatureResponse.featureSwitch) {
					featureSwitch = response.FeatureResponse.featureSwitch;
					$.each(featureSwitch, function (index, value) {
						//Add the feature switches to the sessionStorage for using across HD.com
						sessionStorage.setItem(value.featureName, value.intValue);
					});
				}
			}).always(function () {
				if (typeof callBackFn === 'function') {
					callBackFn();
				}
			});
		} else {
			if (typeof callBackFn === 'function') {
				callBackFn();
			}
		}
	};

	/**
	 * Bind the click event for the header drop down
	 **/
	var bindEvents = function () {
		generateProfilingforTMX();
		//Event to show the dual sign-in modal
		$(document).on('click', '[data-myaccountauth="true"]', function click(event) {
			event.preventDefault();

			var URL = generateRedirectionLink($(this));

			if (isUserLoggedIn()) {
				validateRedirectURL(URL);
			} else {
				//Function helps to hide the header drop down
				hideHeaderDropDowns();

				//Display the dual sign-in modal
				showDualSignInModal(($(this).attr('isregisterlink') == "true"), function () {
					validateRedirectURL(URL);
				});
			}
		});

		$(document).on('click', '#reset-password-link-page', function click(event) {
			event.preventDefault();
			authenticationModal.showForgotPasswordModal();
		});

		$(document).on('click', '#setPasswordDesktop', function click(event) {
			event.preventDefault();
			authenticationModal.showSetPasswordLoginModal();
		});

		//Event binding for the Order and Purchases link
		$(document).on('click', '[data-action="orders"]', function click(event) {
			var nonRegisteredURL = 'https://' + deviceUtility.getHostNameSecure() + '/account/view/order/tracking';
			var registeredURL = 'https://' + deviceUtility.getHostNameSecure() + '/account/view/order/summary';
			var url = nonRegisteredURL;
			event.preventDefault();

			//Validate if the user is logged in or not.
			if (isUserLoggedIn()) {
				//If logged in, redirect to the registered link(Order summary page)
				url = registeredURL;
			}
			document.location.href = url;
		});

		$(document).on('click', '[data-action="signOut"]', function click(event) {
			var customerType = $(this).attr('data-customertype');
			var signOutEndpoint = Constants.URLS.AUTH_SIGNOUT_URL;
			if (customerType === 'b2b' || customerType === 'b2x') {
				signOutEndpoint = Constants.URLS.AUTH_SIGNOUT_URL_B2B;
			}
			logOut(signOutEndpoint)
				.then(reloadPage)
				.fail(redirectOnReloadError);
		});

		//Overriding the header dropdown URL based on the flag
		$('[data-action="myLists"]').attr('href', 'https://' + deviceUtility.getHostNameSecure() + '/account/view/list/summary');
		$('[data-action="findList"]').attr('href', 'https://' + deviceUtility.getHostNameSecure() + '/account/view/list/search');

		if (authHelper.isSVOCThrottled()) {
			$('[data-action="accountProfile"]').attr('href', 'https://' + deviceUtility.getHostNameSecure() + '/account/view/profile');
		}

		if (authHelper.isIAMThrottled()) {
			$('[data-action="register"]').attr('href', 'https://' + deviceUtility.getHostNameSecure() + '/account/view/register');
			$('[data-action="signIn"]').attr('href', 'https://' + deviceUtility.getHostNameSecure() + '/account/view/logon');
			$('#headerMyAccount').attr('href', 'https://' + deviceUtility.getHostNameSecure() + '/account/view/logon');
			$('[data-action="signOut"]').attr('href', 'javascript:void(0)');
		}
	};

	/**
	 * @Description: This will help generate profiling for threat metrix under head and body tags as soon as this overlay loads.
	 */
	var generateProfilingforTMX = function () {
		try {
			var profileID, org_id;
			var tmDomain = "customer.homedepot.com/fp/tags.js";
			profileID = generateRandomID();
			window.tmxprofilesessionid = "";
			window.tmxprofilesessionid = profileID;
			if (window.location.href.indexOf("homedepotdev") !== -1) {
				org_id = "dv833nte"; // LLC org_id
			}
			else {
				org_id = "23o27znc"; // prod and beta org_id
			}
			// below code will add the profiling script inside head tag
			var script = document.createElement('script');
			script.type = 'text/javascript';
			script.src = 'https://' + tmDomain + '?org_id=' + org_id + '&session_id=' + profileID;
			script.id = "threatMetrix";
			document.getElementsByTagName('head')[0].appendChild(script);
		}
		catch (e) {
			console.log(e);
		}
	};

	/**
	 * @Description: This will help generate a random number for session ID if the cookie doesn't exist.
	 */
	var generateRandomID = function () {
		var text = "";
		var possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_-";
		for (var i = 0; i < 33; i++) {
			text += possible.charAt(Math.floor(Math.random() * possible.length));
		}
		return text;
	}

	/**
	 * Validate Redirect URL - validates for undefined and null
	 * If the URL is specified, reload the same page
	 **/
	var validateRedirectURL = function (url) {
		if (!url && url === null) {
			window.location.reload();
		} else {
			document.location.href = url;
		}
	};

	/**
	 * Function helps to find out, if the user is logged in or not
	 **/
	var isUserLoggedIn = function () {

		if (cookieUtils.readCookie(Constants.COOKIE_THD_USER_SESSION)) {
			return true;
		} else {
			return cookieUtils.readCookie('THD_USERSTATUS') === '1' && cookieUtils.readCookie('THD_USERNAME');
		}
	};

	/**
	 * Generate the URL for deep drop down for redirection
	 * The link is identified based on the data-action attribute of the link
	 **/
	var generateRedirectionLink = function (linkObj) {

		var URL = null;
		var appURL = window.location.href;
		if (linkObj) {
			var dataAction = linkObj.data('action');
			if (dataAction) {
				if (dataAction === "accountProfile") {
					if (authHelper.isSVOCThrottled()) {
						URL = 'https://' + deviceUtility.getHostNameSecure() + '/account/view/profile';
					} else {
						URL = 'https://' + deviceUtility.getHostNameSecure() + '/webapp/wcs/stores/servlet/UserRegistrationUpdateForm?storeId=10051&langId=-1&catalogId=10053';
					}
				} else if (dataAction === "myLists") {
					URL = 'https://' + deviceUtility.getHostNameSecure() + '/account/view/list/summary';
				} else if (dataAction === "findList") {
					URL = 'https://' + deviceUtility.getHostNameSecure() + '/account/view/list/search';
				} else if ((appURL.indexOf("account/view/logon") > -1) || (appURL.indexOf("account/view/register") > -1)) {
					URL = 'https://' + deviceUtility.getHostNameSecure() + '/account/view/profile';
				}
			}
		}
		return URL;
	};

	/**
	 * LogOut function
	 **/
	var logOut = function (url) {
		$.support.cors = true;
		var authorizationToken = accountUtility.getAuthorizationToken();
		var channelId = authHelper.getChannelId();
		return accountUtility.triggerAJAXCall({
			url: url,
			type: 'GET',
			headers: {
				'Content-Type': 'application/json',
				'Accept': 'application/json',
				'channelId': channelId
			},
			crossDomain: true,
			xhrFields: {
				withCredentials: true
			},
			beforeSend: function (xhr) {
				xhr.setRequestHeader('Authorization', authorizationToken);
			},
		});
	};

	/**
	 * ReloadPage function
	 **/
	var reloadPage = function (data) {
		// #165451027: fix to make sure we redirect to www and not secure2 when we sign out from Order confirmation page.
		window.location.href = "https://"+window.location.hostname.replace("secure.","").replace("secure2.","");
	}

	/**
	 * RedirectOnReloadError function
	 **/
	var redirectOnReloadError = function (xhr) {
		if (xhr && xhr.status === 401) {
			window.location.reload();
		}
	}

	/**
	 * Initialize function
	 **/
	var init = function () {
		checkSvocFeatureSwitch(function () {
			bindEvents();
		});
	};

	var hideDualSignInModal = function () {
		authenticationModal.hideModal();
	};


	return {
		showDualSignInModal: showDualSignInModal,
		hideDualSignInModal: hideDualSignInModal,
		init: init,
		throttleMCMAuthorization: checkSvocFeatureSwitch,
		isMCMAuthThrottleEnabled: function () { return authHelper.isIAMThrottled(); },
		showForgotPasswordModal: authenticationModal.showForgotPasswordModal
	};
});

/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */

/*global define: false Mustache: true*/

(function defineMustache (global, factory) {
  if (typeof exports === 'object' && exports && typeof exports.nodeName !== 'string') {
    factory(exports); // CommonJS
  } else if (typeof define === 'function' && define.amd) {
    define('mustache',['exports'], factory); // AMD
  } else {
    global.Mustache = {};
    factory(global.Mustache); // script, wsh, asp
  }
}(this, function mustacheFactory (mustache) {

  var objectToString = Object.prototype.toString;
  var isArray = Array.isArray || function isArrayPolyfill (object) {
    return objectToString.call(object) === '[object Array]';
  };

  function isFunction (object) {
    return typeof object === 'function';
  }

  /**
   * More correct typeof string handling array
   * which normally returns typeof 'object'
   */
  function typeStr (obj) {
    return isArray(obj) ? 'array' : typeof obj;
  }

  function escapeRegExp (string) {
    return string.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g, '\\$&');
  }

  /**
   * Null safe way of checking whether or not an object,
   * including its prototype, has a given property
   */
  function hasProperty (obj, propName) {
    return obj != null && typeof obj === 'object' && (propName in obj);
  }

  // Workaround for https://issues.apache.org/jira/browse/COUCHDB-577
  // See https://github.com/janl/mustache.js/issues/189
  var regExpTest = RegExp.prototype.test;
  function testRegExp (re, string) {
    return regExpTest.call(re, string);
  }

  var nonSpaceRe = /\S/;
  function isWhitespace (string) {
    return !testRegExp(nonSpaceRe, string);
  }

  var entityMap = {
    '&': '&amp;',
    '<': '&lt;',
    '>': '&gt;',
    '"': '&quot;',
    "'": '&#39;',
    '/': '&#x2F;',
    '`': '&#x60;',
    '=': '&#x3D;'
  };

  function escapeHtml (string) {
    return String(string).replace(/[&<>"'`=\/]/g, function fromEntityMap (s) {
      return entityMap[s];
    });
  }

  var whiteRe = /\s*/;
  var spaceRe = /\s+/;
  var equalsRe = /\s*=/;
  var curlyRe = /\s*\}/;
  var tagRe = /#|\^|\/|>|\{|&|=|!/;

  /**
   * Breaks up the given `template` string into a tree of tokens. If the `tags`
   * argument is given here it must be an array with two string values: the
   * opening and closing tags used in the template (e.g. [ "<%", "%>" ]). Of
   * course, the default is to use mustaches (i.e. mustache.tags).
   *
   * A token is an array with at least 4 elements. The first element is the
   * mustache symbol that was used inside the tag, e.g. "#" or "&". If the tag
   * did not contain a symbol (i.e. {{myValue}}) this element is "name". For
   * all text that appears outside a symbol this element is "text".
   *
   * The second element of a token is its "value". For mustache tags this is
   * whatever else was inside the tag besides the opening symbol. For text tokens
   * this is the text itself.
   *
   * The third and fourth elements of the token are the start and end indices,
   * respectively, of the token in the original template.
   *
   * Tokens that are the root node of a subtree contain two more elements: 1) an
   * array of tokens in the subtree and 2) the index in the original template at
   * which the closing tag for that section begins.
   */
  function parseTemplate (template, tags) {
    if (!template)
      return [];

    var sections = [];     // Stack to hold section tokens
    var tokens = [];       // Buffer to hold the tokens
    var spaces = [];       // Indices of whitespace tokens on the current line
    var hasTag = false;    // Is there a {{tag}} on the current line?
    var nonSpace = false;  // Is there a non-space char on the current line?

    // Strips all whitespace tokens array for the current line
    // if there was a {{#tag}} on it and otherwise only space.
    function stripSpace () {
      if (hasTag && !nonSpace) {
        while (spaces.length)
          delete tokens[spaces.pop()];
      } else {
        spaces = [];
      }

      hasTag = false;
      nonSpace = false;
    }

    var openingTagRe, closingTagRe, closingCurlyRe;
    function compileTags (tagsToCompile) {
      if (typeof tagsToCompile === 'string')
        tagsToCompile = tagsToCompile.split(spaceRe, 2);

      if (!isArray(tagsToCompile) || tagsToCompile.length !== 2)
        throw new Error('Invalid tags: ' + tagsToCompile);

      openingTagRe = new RegExp(escapeRegExp(tagsToCompile[0]) + '\\s*');
      closingTagRe = new RegExp('\\s*' + escapeRegExp(tagsToCompile[1]));
      closingCurlyRe = new RegExp('\\s*' + escapeRegExp('}' + tagsToCompile[1]));
    }

    compileTags(tags || mustache.tags);

    var scanner = new Scanner(template);

    var start, type, value, chr, token, openSection;
    while (!scanner.eos()) {
      start = scanner.pos;

      // Match any text between tags.
      value = scanner.scanUntil(openingTagRe);

      if (value) {
        for (var i = 0, valueLength = value.length; i < valueLength; ++i) {
          chr = value.charAt(i);

          if (isWhitespace(chr)) {
            spaces.push(tokens.length);
          } else {
            nonSpace = true;
          }

          tokens.push([ 'text', chr, start, start + 1 ]);
          start += 1;

          // Check for whitespace on the current line.
          if (chr === '\n')
            stripSpace();
        }
      }

      // Match the opening tag.
      if (!scanner.scan(openingTagRe))
        break;

      hasTag = true;

      // Get the tag type.
      type = scanner.scan(tagRe) || 'name';
      scanner.scan(whiteRe);

      // Get the tag value.
      if (type === '=') {
        value = scanner.scanUntil(equalsRe);
        scanner.scan(equalsRe);
        scanner.scanUntil(closingTagRe);
      } else if (type === '{') {
        value = scanner.scanUntil(closingCurlyRe);
        scanner.scan(curlyRe);
        scanner.scanUntil(closingTagRe);
        type = '&';
      } else {
        value = scanner.scanUntil(closingTagRe);
      }

      // Match the closing tag.
      if (!scanner.scan(closingTagRe))
        throw new Error('Unclosed tag at ' + scanner.pos);

      token = [ type, value, start, scanner.pos ];
      tokens.push(token);

      if (type === '#' || type === '^') {
        sections.push(token);
      } else if (type === '/') {
        // Check section nesting.
        openSection = sections.pop();

        if (!openSection)
          throw new Error('Unopened section "' + value + '" at ' + start);

        if (openSection[1] !== value)
          throw new Error('Unclosed section "' + openSection[1] + '" at ' + start);
      } else if (type === 'name' || type === '{' || type === '&') {
        nonSpace = true;
      } else if (type === '=') {
        // Set the tags for the next time around.
        compileTags(value);
      }
    }

    // Make sure there are no open sections when we're done.
    openSection = sections.pop();

    if (openSection)
      throw new Error('Unclosed section "' + openSection[1] + '" at ' + scanner.pos);

    return nestTokens(squashTokens(tokens));
  }

  /**
   * Combines the values of consecutive text tokens in the given `tokens` array
   * to a single token.
   */
  function squashTokens (tokens) {
    var squashedTokens = [];

    var token, lastToken;
    for (var i = 0, numTokens = tokens.length; i < numTokens; ++i) {
      token = tokens[i];

      if (token) {
        if (token[0] === 'text' && lastToken && lastToken[0] === 'text') {
          lastToken[1] += token[1];
          lastToken[3] = token[3];
        } else {
          squashedTokens.push(token);
          lastToken = token;
        }
      }
    }

    return squashedTokens;
  }

  /**
   * Forms the given array of `tokens` into a nested tree structure where
   * tokens that represent a section have two additional items: 1) an array of
   * all tokens that appear in that section and 2) the index in the original
   * template that represents the end of that section.
   */
  function nestTokens (tokens) {
    var nestedTokens = [];
    var collector = nestedTokens;
    var sections = [];

    var token, section;
    for (var i = 0, numTokens = tokens.length; i < numTokens; ++i) {
      token = tokens[i];

      switch (token[0]) {
        case '#':
        case '^':
          collector.push(token);
          sections.push(token);
          collector = token[4] = [];
          break;
        case '/':
          section = sections.pop();
          section[5] = token[2];
          collector = sections.length > 0 ? sections[sections.length - 1][4] : nestedTokens;
          break;
        default:
          collector.push(token);
      }
    }

    return nestedTokens;
  }

  /**
   * A simple string scanner that is used by the template parser to find
   * tokens in template strings.
   */
  function Scanner (string) {
    this.string = string;
    this.tail = string;
    this.pos = 0;
  }

  /**
   * Returns `true` if the tail is empty (end of string).
   */
  Scanner.prototype.eos = function eos () {
    return this.tail === '';
  };

  /**
   * Tries to match the given regular expression at the current position.
   * Returns the matched text if it can match, the empty string otherwise.
   */
  Scanner.prototype.scan = function scan (re) {
    var match = this.tail.match(re);

    if (!match || match.index !== 0)
      return '';

    var string = match[0];

    this.tail = this.tail.substring(string.length);
    this.pos += string.length;

    return string;
  };

  /**
   * Skips all text until the given regular expression can be matched. Returns
   * the skipped string, which is the entire tail if no match can be made.
   */
  Scanner.prototype.scanUntil = function scanUntil (re) {
    var index = this.tail.search(re), match;

    switch (index) {
      case -1:
        match = this.tail;
        this.tail = '';
        break;
      case 0:
        match = '';
        break;
      default:
        match = this.tail.substring(0, index);
        this.tail = this.tail.substring(index);
    }

    this.pos += match.length;

    return match;
  };

  /**
   * Represents a rendering context by wrapping a view object and
   * maintaining a reference to the parent context.
   */
  function Context (view, parentContext) {
    this.view = view;
    this.cache = { '.': this.view };
    this.parent = parentContext;
  }

  /**
   * Creates a new context using the given view with this context
   * as the parent.
   */
  Context.prototype.push = function push (view) {
    return new Context(view, this);
  };

  /**
   * Returns the value of the given name in this context, traversing
   * up the context hierarchy if the value is absent in this context's view.
   */
  Context.prototype.lookup = function lookup (name) {
    var cache = this.cache;

    var value;
    if (cache.hasOwnProperty(name)) {
      value = cache[name];
    } else {
      var context = this, names, index, lookupHit = false;

      while (context) {
        if (name.indexOf('.') > 0) {
          value = context.view;
          names = name.split('.');
          index = 0;

          /**
           * Using the dot notion path in `name`, we descend through the
           * nested objects.
           *
           * To be certain that the lookup has been successful, we have to
           * check if the last object in the path actually has the property
           * we are looking for. We store the result in `lookupHit`.
           *
           * This is specially necessary for when the value has been set to
           * `undefined` and we want to avoid looking up parent contexts.
           **/
          while (value != null && index < names.length) {
            if (index === names.length - 1)
              lookupHit = hasProperty(value, names[index]);

            value = value[names[index++]];
          }
        } else {
          value = context.view[name];
          lookupHit = hasProperty(context.view, name);
        }

        if (lookupHit)
          break;

        context = context.parent;
      }

      cache[name] = value;
    }

    if (isFunction(value))
      value = value.call(this.view);

    return value;
  };

  /**
   * A Writer knows how to take a stream of tokens and render them to a
   * string, given a context. It also maintains a cache of templates to
   * avoid the need to parse the same template twice.
   */
  function Writer () {
    this.cache = {};
  }

  /**
   * Clears all cached templates in this writer.
   */
  Writer.prototype.clearCache = function clearCache () {
    this.cache = {};
  };

  /**
   * Parses and caches the given `template` and returns the array of tokens
   * that is generated from the parse.
   */
  Writer.prototype.parse = function parse (template, tags) {
    var cache = this.cache;
    var tokens = cache[template];

    if (tokens == null)
      tokens = cache[template] = parseTemplate(template, tags);

    return tokens;
  };

  /**
   * High-level method that is used to render the given `template` with
   * the given `view`.
   *
   * The optional `partials` argument may be an object that contains the
   * names and templates of partials that are used in the template. It may
   * also be a function that is used to load partial templates on the fly
   * that takes a single argument: the name of the partial.
   */
  Writer.prototype.render = function render (template, view, partials) {
    var tokens = this.parse(template);
    var context = (view instanceof Context) ? view : new Context(view);
    return this.renderTokens(tokens, context, partials, template);
  };

  /**
   * Low-level method that renders the given array of `tokens` using
   * the given `context` and `partials`.
   *
   * Note: The `originalTemplate` is only ever used to extract the portion
   * of the original template that was contained in a higher-order section.
   * If the template doesn't use higher-order sections, this argument may
   * be omitted.
   */
  Writer.prototype.renderTokens = function renderTokens (tokens, context, partials, originalTemplate) {
    var buffer = '';

    var token, symbol, value;
    for (var i = 0, numTokens = tokens.length; i < numTokens; ++i) {
      value = undefined;
      token = tokens[i];
      symbol = token[0];

      if (symbol === '#') value = this.renderSection(token, context, partials, originalTemplate);
      else if (symbol === '^') value = this.renderInverted(token, context, partials, originalTemplate);
      else if (symbol === '>') value = this.renderPartial(token, context, partials, originalTemplate);
      else if (symbol === '&') value = this.unescapedValue(token, context);
      else if (symbol === 'name') value = this.escapedValue(token, context);
      else if (symbol === 'text') value = this.rawValue(token);

      if (value !== undefined)
        buffer += value;
    }

    return buffer;
  };

  Writer.prototype.renderSection = function renderSection (token, context, partials, originalTemplate) {
    var self = this;
    var buffer = '';
    var value = context.lookup(token[1]);

    // This function is used to render an arbitrary template
    // in the current context by higher-order sections.
    function subRender (template) {
      return self.render(template, context, partials);
    }

    if (!value) return;

    if (isArray(value)) {
      for (var j = 0, valueLength = value.length; j < valueLength; ++j) {
        buffer += this.renderTokens(token[4], context.push(value[j]), partials, originalTemplate);
      }
    } else if (typeof value === 'object' || typeof value === 'string' || typeof value === 'number') {
      buffer += this.renderTokens(token[4], context.push(value), partials, originalTemplate);
    } else if (isFunction(value)) {
      if (typeof originalTemplate !== 'string')
        throw new Error('Cannot use higher-order sections without the original template');

      // Extract the portion of the original template that the section contains.
      value = value.call(context.view, originalTemplate.slice(token[3], token[5]), subRender);

      if (value != null)
        buffer += value;
    } else {
      buffer += this.renderTokens(token[4], context, partials, originalTemplate);
    }
    return buffer;
  };

  Writer.prototype.renderInverted = function renderInverted (token, context, partials, originalTemplate) {
    var value = context.lookup(token[1]);

    // Use JavaScript's definition of falsy. Include empty arrays.
    // See https://github.com/janl/mustache.js/issues/186
    if (!value || (isArray(value) && value.length === 0))
      return this.renderTokens(token[4], context, partials, originalTemplate);
  };

  Writer.prototype.renderPartial = function renderPartial (token, context, partials) {
    if (!partials) return;

    var value = isFunction(partials) ? partials(token[1]) : partials[token[1]];
    if (value != null)
      return this.renderTokens(this.parse(value), context, partials, value);
  };

  Writer.prototype.unescapedValue = function unescapedValue (token, context) {
    var value = context.lookup(token[1]);
    if (value != null)
      return value;
  };

  Writer.prototype.escapedValue = function escapedValue (token, context) {
    var value = context.lookup(token[1]);
    if (value != null)
      return mustache.escape(value);
  };

  Writer.prototype.rawValue = function rawValue (token) {
    return token[1];
  };

  mustache.name = 'mustache.js';
  mustache.version = '2.3.2';
  mustache.tags = [ '{{', '}}' ];

  // All high-level mustache.* functions use this writer.
  var defaultWriter = new Writer();

  /**
   * Clears all cached templates in the default writer.
   */
  mustache.clearCache = function clearCache () {
    return defaultWriter.clearCache();
  };

  /**
   * Parses and caches the given template in the default writer and returns the
   * array of tokens it contains. Doing this ahead of time avoids the need to
   * parse templates on the fly as they are rendered.
   */
  mustache.parse = function parse (template, tags) {
    return defaultWriter.parse(template, tags);
  };

  /**
   * Renders the `template` with the given `view` and `partials` using the
   * default writer.
   */
  mustache.render = function render (template, view, partials) {
    if (typeof template !== 'string') {
      throw new TypeError('Invalid template! Template should be a "string" ' +
                          'but "' + typeStr(template) + '" was given as the first ' +
                          'argument for mustache#render(template, view, partials)');
    }

    return defaultWriter.render(template, view, partials);
  };

  // This is here for backwards compatibility with 0.4.x.,
  /*eslint-disable */ // eslint wants camel cased function name
  mustache.to_html = function to_html (template, view, partials, send) {
    /*eslint-enable*/

    var result = mustache.render(template, view, partials);

    if (isFunction(send)) {
      send(result);
    } else {
      return result;
    }
  };

  // Export the escaping function so that the user may override it.
  // See https://github.com/janl/mustache.js/issues/244
  mustache.escape = escapeHtml;

  // Export these mainly for testing, but also for advanced usage.
  mustache.Scanner = Scanner;
  mustache.Context = Context;
  mustache.Writer = Writer;

  return mustache;
}));

/*-------------------------------------------------------------------
*  Global Namespacing Utility Function
*
*  $Last Updated: 04-07-2015
------------------------------------------------------------------------*/

(function closure(root, factory) {
	if(typeof define === 'function' && define.amd) {
		define('global.namespace',[], function load() {
			return factory(root);
		});
	} else{
		// For non-AMD module, expose this to global (will also be useful for test cases)
		root.THD = factory(root);
	}
})(this, function factory(root) {
	var thd;
	var utils;
	var createNamespace = function createNamespace(nameSpaceString, context) {
		var tokens = nameSpaceString.split('.');
		var current = (context || window);
		var count = tokens.length;
		var token;
		var x;

		for (x = 0; x < count; x++) {
			token = tokens[x];

			if (!current[token]) {
				current[token] = {};
			}

			current = current[token];
		}

		return current;
	};

	if (!root.THD || (root.THD && !root.THD.Global)) {
		/*
			Core Namespace Declaration
		*/
		thd = createNamespace('THD');
		// Global - for THD specific functionality that should be available anywhere on the site
		createNamespace('Global', thd);
		// External - for THD partners
		createNamespace('External', thd);
		// Utility - for general functionality that could be used on any site
		utils = createNamespace('Utility', thd);
		// Widget - Holds implementations for globally usable UI elements
		createNamespace('Widget', thd);
		// PLP Modules (includes Category)
		createNamespace('PLP', thd);
		// PIP Modules
		createNamespace('PIP', thd);
		// Checkout Modules (including Cart)
		createNamespace('Checkout', thd);
		// My Account Modules (includes Calculators)
		createNamespace('MyAccount', thd);
		// Checkout Modules
		createNamespace('Search', thd);
		// Store Finder
		createNamespace('StoreFinder', thd);
		// Analytics
		createNamespace('Analytics', thd);
		/*
			Assign Namespace Utilities
		*/
		// Create Namespace namespace and assign createNamespace. Simple.
		createNamespace('Namespace', utils).createNamespace = createNamespace;
		root.THD = thd;
	}
	return root.THD;
});

/* ------------------------------------------------------------------------------
*	Utils minicart
*	by: Brent Ayers ~ axb1525
*
*	Purpose:
*		- helper functions for minicart
*	To Do:
*		- move this to global. This is not a utility function
*
* ------------------------------------------------------------------------------ */

(function closure(root, factory) {
	if(typeof define === 'function' && define.amd) {
		define('utils.minicart',['global.namespace', 'cookie-utils', 'jquery'], function load(THD, cookieUtils, $) {
			return factory(root, THD, cookieUtils, $);
		});
	} else {
		/*eslint-disable*/
		factory(root, THD, cookieUtils, jQuery);
		/*eslint-enable*/
	}
})(this, function factory(root, THD, cookieUtils, $) {
	var _utils = THD.Utility.Namespace.createNamespace('THD.Utils');
	// @TODO move into thd-utils
	var findArg = function findArg(name) {
		var sArgs = location.search.slice(1).split('&');
		var r = '';
		var i;
		for (i = 0; i < sArgs.length; i++) {
			if (sArgs[i].slice(0, sArgs[i].indexOf('=')) === name) {
				r = sArgs[i].slice(sArgs[i].indexOf('=') + 1);
				break;
			}
		}
		return (r.length > 0 ? unescape(r) : '');
	};

	_utils.MiniCart = {
		getMiniCartInfo: function getMiniCartInfo(freeShipThreshold, hasRunningFreeShipPromo, numberItemsInCart, totalCartAmount, orderQualifiesForFreeShip) {
			var miniCartJsonStr = cookieUtils.readCookie('THD_MINICART');
			// ***********************************************************************************************************************
			// Check to see if the cookie contains part of the expected JSON object.
			//		If it doesn't, build the generic JSON object (0 in cart....)
			// NOTE: This if statement handles
			//        1) cookie is null
			//        2) cookie is present but it's the old style cookie (just a number in the cart) .. NO JSON OBJECT
			// **********************************************************************************************************************

			if (miniCartJsonStr === '' || miniCartJsonStr.indexOf('I1') < 0) {
				miniCartJsonStr = '{"I1":"' + numberItemsInCart + '","F1":"' + hasRunningFreeShipPromo + '","F2":"' + orderQualifiesForFreeShip + '","D1":"' + totalCartAmount + '","D2":"' + freeShipThreshold + '"}';
				cookieUtils.createCookie('THD_MINICART', miniCartJsonStr);
			}
		},


		getMiniListInfo: function getMiniListInfo() {
			var ARG_THD_MINILIST = findArg('THD_MINILIST');
			var isLoggedOn = cookieUtils.readCookie('THD_USERSTATUS') === '1';
			if (isLoggedOn) {
				if (ARG_THD_MINILIST > 0) {
					document.write('(' + ARG_THD_MINILIST + ')');
				} else {
					ARG_THD_MINILIST = cookieUtils.readCookie('THD_MINILIST');
					if (ARG_THD_MINILIST > 0) {
						document.write('(' + ARG_THD_MINILIST + ')');
					}
				}
			}
		},


		/*
		 *	Function: readMiniCartCookie
		 *		This is a generic method to get read the THD_MINICART cookie crumb and return the attributes
		 *		of the JSON object.
		 *	Parameter: param
		 *		This parameter defines the attribute of the JSON object.
		 *	Returns:
		 *		This function returns the attributes of the JSON object based on the input passed.
		 */

		readMiniCartCookie: function readMiniCartCookie(param) {
			var miniCartJsonStr = cookieUtils.readCookie('THD_MINICART');
			var miniCartJsonObj;
			if (miniCartJsonStr) {
				// @TODO remove eval and use JSON.parse
				eval('miniCartJsonObj = ' + miniCartJsonStr + ';');

				// Get the JSON attribute based on the passed parameter

				if (param === 'D2') {
					return miniCartJsonObj.D2;
				} else if (param === 'I1') {
					return miniCartJsonObj.I1;
				} else if (param === 'F1') {
					return miniCartJsonObj.F1;
				} else if (param === 'D1') {
					return miniCartJsonObj.D1;
				} else if (param === 'F2') {
					return miniCartJsonObj.F2;
				}
			} else {
				return '';
			}
			return '';
		},

		/*
		 *	Function: getTHDFreeShippingPromoThreshold
		 *		This function calls the readMiniCartCookie() to get the D2 attribute of JSON object.
		 *	Returns:
		 *		This function returns amtRemainingForFreeShipping.
		 */

		getTHDFreeShippingPromoThreshold: function getTHDFreeShippingPromoThreshold() {
			// The amount remaining (if any) on the order for it to qualify for free shipping
			return this.readMiniCartCookie('D2');
		},

		/*
		 *	Function: getTHDNumberItemsInCart
		 *		This function calls the readMiniCartCookie() to get the I1 attribute of JSON object.
		 *	Returns:
		 *		This function returns nbrOfItemsInCart.
		 */

		getTHDNumberItemsInCart: function getTHDNumberItemsInCart() {
			// The number of items in the shopping cart
			return this.readMiniCartCookie('I1');
		},

		/*
		 *	Function: getTHDHasRunningFreeShippingPromo
		 *		This function calls the readMiniCartCookie() to get the F1 attribute of JSON object.
		 *	Returns:
		 *		This function returns isFreeShipping boolean value.
		 */

		getTHDHasRunningFreeShippingPromo: function getTHDHasRunningFreeShippingPromo() {
			// Is there a running free shipping promotion
			return this.readMiniCartCookie('F1');
		},

		/*
		 *	Function: getTHDTotalCartAmount
		 *		This function calls the readMiniCartCookie() to get the D1 attribute of JSON object.
		 *	Returns:
		 *		This function returns totalCartAmt.
		 */

		getTHDTotalCartAmount: function getTHDTotalCartAmount() {
			// The total dollar amount in the shopping cart
			return this.readMiniCartCookie('D1');
		},

		/*
		 *	Function: getTHDOrderQualifiesForFreeShippingPromo
		 *		This function calls the readMiniCartCookie() to get the F2 attribute of JSON object.
		 *	Returns:
		 *		This function returns orderQualifiesForFreeShippingFlg boolean value.
		 */

		getTHDOrderQualifiesForFreeShippingPromo: function getTHDOrderQualifiesForFreeShippingPromo() {
			// Does the order currently qualify for free shipping.
			return this.readMiniCartCookie('F2');
		},

		refeshMiniCart: function refeshMiniCart() {
			var itemsInCart;
			if (cookieUtils.cookieManager !== undefined || cookieUtils.cookieManager !== null) {
				cookieUtils.cookieManager.initializeMasterCookie();
				itemsInCart = this.getTHDNumberItemsInCart();
				if (itemsInCart !== '0' && itemsInCart !== '') {
					if(itemsInCart > 999) {
						$('#miniCartNum').text('999+');
					}else{
						$('#miniCartNum').text(itemsInCart);
					}
					$('a#cart').addClass('btn-orange');
					$(document).trigger({
						type: 'cartUpdated'
					});
				}
			}
		}
	};

	return _utils.MiniCart;
});


/* ------------------------------------------------------------------------------
*	Utils string
*	by: Brent Ayers ~ axb1525
*
*	Purpose:
*		- Performs utility functions for url string manipulation
*	To Do:
*
*
* ------------------------------------------------------------------------------ */

(function closure(root, factory) {
	if (typeof define === 'function' && define.amd) {
		define('utils.url',['jquery', 'global.namespace', 'cookie-utils'], function load(jQuery, THD, cookieUtils) {
			return factory(root, jQuery, THD, cookieUtils);
		});
	} else {
		/*eslint-disable*/
		factory(root, jQuery, THD, cookieUtils);
		/*eslint-enable*/
	}
})(this, function factory(root, $, THD, cookieUtils) {
	var _utils = THD.Utility.Namespace.createNamespace('THD.Utils');
	var defaults = {
		url: window.location.href,
		lookupParm: false,
		setParms: [],
		addHost: true
	};

	/**
	 * @function - normalizes querystring
	 * @returns {string} querystring in 'bob=val1&name2=val3' format
	 * @param {string} url string to be manipulated
	 */

	var getParamStr = function getParamStr(_url) {
		var url = (typeof _url !== 'undefined')
			? _url
			: defaults.url;
		// remove host name - split may prove more reliable
		if (url.indexOf('?') > -1) {
			url = url.match(/(\?.*)/)[0];
		} else {
			return false;
		}
		// remove ?
		url = url.replace(/^\?/, '');
		// remove hash
		url = url.split('#')[0];

		return url;
	};

	/**
	 * @function - gets url params of string, or current url
	 * @returns {object|string} if nothing passed for lookupParm, returns object list of qeury params or string of requested parameter
	 * @param {string} url default is window.location.href
	 * @param {string} lookupParm paramaters to be returned
	 */
	var getUrlParms = function getUrlParms(args) {
		var queryArr = [];
		var currParam = [];
		var tempObj = {};
		var valFound = false;
		var key;
		var val;
		var i;
		var opts = $.extend({}, defaults, args);

		// remove host name, and hash
		opts.url = getParamStr(opts.url);
		if (opts.url) {
			queryArr = opts.url.split('&');

			for (i = 0; i < queryArr.length; i++) {
				currParam = queryArr[i].split('=');
				if (currParam[0] === opts.lookupParm) {
					// found param
					valFound = currParam[1];
				} else {
					key = currParam[0];
					val = decodeURIComponent(currParam[1]);
					tempObj[key] = val;
				}
			}
		}
		if (opts.lookupParm) {
			// returns either lookup val or false if nothing found
			return valFound;
		}
		return tempObj;
	};

	/**
	 * @function - sets url params of string, or current url
	 * @returns {string} if nothing passed for lookupParm, returns object list of qeury params or string of requested parameter
	 * @param {string} url default is window.location.href
	 * @param {string} setParms paramaters to be added/updated
	 */
	var setUrlParms = function setUrlParms(args) {
		var oldParms = {};
		var tempParms = {};
		var newUrl = '';
		var delim = '';
		var firstParm = true;
		var hash = '';
		var i;
		var opts = $.extend({}, defaults, args);

		newUrl = (opts.addHost) ? opts.url.split('?')[0] + '?' : '';

		newUrl = newUrl.split('#');

		hash = (typeof newUrl[1] !== 'undefined')
			? '#' + newUrl[1].replace('?', '')
			: '';

		newUrl = (newUrl[0].indexOf('?') === -1)
			? newUrl[0] + '?'
			: newUrl[0];

		oldParms = getUrlParms(opts);

		// combine old and new parameters
		tempParms = $.extend({}, oldParms, opts.setParms);


		for (i in tempParms) {
			// sometimes a param is set with no value, need to make sure it doesn't come back as 'undefined'
			if (tempParms.hasOwnProperty(i)) {
				tempParms[i] = (tempParms[i] === 'undefined') ? '' : '=' + encodeURIComponent(tempParms[i]);
				if (tempParms[i] !== '=null') {
					newUrl += delim + i + tempParms[i];

					if (firstParm) {
						delim = '&';
						firstParm = false;
					}
				}
			}
		}
		return newUrl + hash;
	};


	function isLocalStoreTab(defstore, paramLocStore) {
		var startIdx;
		var afterLocStore;
		var endIdx;
		var stopIdx;
		var locStore;

		var url = window.location + '';
		// no local store number in the url
		if (url.indexOf(paramLocStore) === -1) {
			return false;
		} else if (url.indexOf(paramLocStore) > -1) {
			startIdx = url.indexOf(paramLocStore);
			afterLocStore = url.substring(startIdx);
			endIdx = afterLocStore.indexOf('=');
			stopIdx = afterLocStore.indexOf('&');
			locStore;
			if (stopIdx > 0) {
				locStore = afterLocStore.substring(endIdx + 1, stopIdx);
			} else {
				locStore = afterLocStore.substring(endIdx + 1);
			}
			if (defstore !== locStore) {
				return true;
			}
		} else if (cookieUtils.readCookie('THD_BROWSESTATUS') === '1') {
			return true;
		}
		return false;
	}

	_utils.Url = {
		/* naming Strings to prvent any reserved word conflicts */
		get: function get(args) {
			return getUrlParms(args);
		},
		set: function set(args) {
			return setUrlParms(args);
		},
		isLocalStoreTab: isLocalStoreTab

	};

	return _utils.Url;
});

;(function (root, factory) {
  if (typeof define === 'function' && define.amd) {
    //factory;
    define('thd-online-common', [], factory);
  } else {
    root.thdOnlineCommon = factory(root);
  }
}(this, function (root, undef) {
    var thdOnlineCommon = {};

    thdOnlineCommon.cookie = {};

    thdOnlineCommon.cookie.channel = {
            
        cookieexpiry : 1,
        elementAppAlias : "E1",
        elementOSType : "E2",
        elementOSVersion : "E3",
        elementAppType : "E4",
        elementAppVersion : "E5",

        appAlias_Other : "S1",
        appAlias_mobileWeb : "S2",
        appAlias_Tablet : "S3",
        appAlias_WCS : "S4",
        appAlias_kiosk : "S5",
        appAlias_PIP2_APP : "S6",
        appAlias_PLP_APP : "S7",

        elementDelimiter : "::",
        elementKeySeperator : "=",
        channelCookieName : "THD_ONLINE_CHANNEL",
        persistCookieName : "THD_PERSIST",
        persistCookie_Crumb40 : "C40",
        channelCookieValue : "",
        channelValueDelimiter : ":",

        clientApp_proNative : "PNative",
        clientApp_consumerNative : "CNative",
        clientApp_kiosk : "kiosk",

        osAndroid : "Android",
        osIOS : "IOS",
        osWP : "WP",

        proTablet : "PRO_tabletWeb",
        proMobile : "PRO_mobileWeb",
        proDesktop : "PRO_DesktopWeb",
        tabletWeb : "Tablet Web",
        proAndroid : "PRO_Android",
        proIphone : "PRO_iPhone",
        mobileWeb : "Mobile Web",
        mobileWP7 : "Mobile - WP7",
        mobileAndroid : "Mobile - Android",
        mobileIphone : "Mobile - iPhone",
        httpDevice : "Http Device",
        b2bExternal : "B2B External",
        telesales : "telesales",
        kiosk : "kiosk",
        physicalStore : "Physical Store",
        webChannel : "Web Channel",

        HDP : "P",

        CreateChannelCookie: function(appAlias, osType, osVersion, appType, appVersion){
            this.channelCookieValue = this.generateChannelCookieValue(appAlias,osType,osVersion,appType,appVersion);
            var currentChannelCookieValue = this.getCookie(this.channelCookieName);
            if (currentChannelCookieValue === ""){
                this.channelCookieValue = this.channelCookieValue.replace(new RegExp(this.elementDelimiter + '$'), '');
                this.CreateCookie(this.channelCookieName, this.channelCookieValue, this.cookieexpiry, THD_TOUCH_GLOBALS.cookie_domain);
            } else {
                this.channelCookieValue = "";
                var currentAppAlias = null;
                var currentOSType = null;
                var currentOSVersion = null;
                var currentAppType = null;
                var currentAppVersion = null;
                var cookieValues = currentChannelCookieValue.split(this.elementDelimiter);
                for (var i = 0; i < cookieValues.length; i++) {
                    var elements = cookieValues[i].split(this.elementKeySeperator);
                    if(elements[0] == this.elementAppAlias){
                        currentAppAlias = elements[1];
                    }else if(elements[0] == this.elementOSType){
                        currentOSType = elements[1];
                    }else if(elements[0] == this.elementOSVersion){
                        currentOSVersion = elements[1];
                    }else if(elements[0] == this.elementAppType){
                        currentAppType = elements[1];
                    }else if(elements[0] == this.elementAppType){
                        currentAppVersion = elements[1];
                    }
                }
                if((currentAppAlias == null || currentAppAlias != appAlias) && typeof appAlias !== 'undefined' && appAlias !== ""){
                    currentAppAlias = appAlias;
                }
                if((currentOSType == null || currentOSType != osType) && typeof osType !== 'undefined' && osType !== ""){
                    currentOSType = osType;
                }
                if((currentOSVersion == null || currentOSVersion != osVersion) && typeof osVersion != 'undefined' && osVersion !== ""){
                    currentOSVersion = osVersion;
                }
                if((currentAppType == null || currentAppType != appType) && typeof appType != 'undefined' && appType !== ""){
                    currentAppType = appType;
                }
                if((currentAppVersion == null || currentAppVersion != appVersion) && typeof appVersion != 'undefined' && appVersion !== ""){
                    currentAppVersion = appVersion;
                }
                this.channelCookieValue = this.generateChannelCookieValue(currentAppAlias,currentOSType,currentOSVersion,currentAppType,currentAppVersion);
                if(this.channelCookieValue !== ""){
                    this.channelCookieValue = this.channelCookieValue.replace(new RegExp(this.elementDelimiter + '$'), '');
                    this.CreateCookie(this.channelCookieName, this.channelCookieValue, this.cookieexpiry, THD_TOUCH_GLOBALS.cookie_domain);
                }
            }
        },
        generateChannelCookieValue: function(appAlias,osType,osVersion,appType,appVersion){
            this.channelCookieValue = "";
            if(appAlias && appAlias !== 'null'){
                this.channelCookieValue += this.elementAppAlias+this.elementKeySeperator+appAlias+this.elementDelimiter;
            }
            if(osType && osType !== 'null'){
                this.channelCookieValue += this.elementOSType+this.elementKeySeperator+osType+this.elementDelimiter;
            }
            if(osVersion && osVersion !== 'null'){
                this.channelCookieValue += this.elementOSVersion+this.elementKeySeperator+osVersion+this.elementDelimiter;
            }
            if(appType && appType !== 'null'){
                this.channelCookieValue += this.elementAppType+this.elementKeySeperator+appType+this.elementDelimiter;
            }
            if(appVersion && appVersion !== 'null'){
                this.channelCookieValue += this.elementAppVersion+this.elementKeySeperator+appVersion;
            }
            return this.channelCookieValue;
        },
        CreateCookie: function(cookieName, cookieValue, expirationDays, domain){
            var expirationDate = new Date();
            expirationDate.setDate(expirationDate.getDate() + expirationDays);
            var cookieString = cookieName + "=" + encodeURIComponent(cookieValue) + "; expires=" + ((expirationDays == null) ? "" : expirationDate.toUTCString()) + '; path=/; domain=' + domain;
            document.cookie = cookieString;
        },
        getCookie: function(cookieName){
            if (document.cookie.length > 0) {
                var cookieStart = document.cookie.indexOf(cookieName + this.elementKeySeperator);
                if (cookieStart != -1) {
                    cookieStart = cookieStart + cookieName.length + 1;
                    var cookieEnd = document.cookie.indexOf(";", cookieStart);
                    if (cookieEnd == -1) {
                        cookieEnd = document.cookie.length;
                    }
                    var cookieValue = decodeURIComponent(document.cookie.substring(cookieStart, cookieEnd));
                    return cookieValue;
                }
            }
            return "";
        },
        getCookieCrumb: function(cookie, name){
            var nameEquals = name + "=";
            var crumbs=cookie.split(':;');
            for (var i = 0; i<crumbs.length; i++) {
                var crumb = crumbs [i];
                if (crumb.indexOf(nameEquals) === 0) {
                    return decodeURIComponent (crumb.substring(nameEquals.length, crumb.length));
                }
            }
            return null;
        },
        getBusinessChannelName: function() {
            var systemAlias="";
            var osType = "";
            var osVersion = "";
            var clientApp  = "";
            var clientAppVersion = "";
            var currentChannelCookieValue = this.getCookie(this.channelCookieName);
            var persistCookie = this.getCookie(this.persistCookieName);
            var persistCookie_Crumb40_Value = this.getCookieCrumb(persistCookie,this.persistCookie_Crumb40);
            if(currentChannelCookieValue != null)
            {
                var channelCookievalues = currentChannelCookieValue.split(this.elementDelimiter);
                if(channelCookievalues != null)
                {
                    var channelCookieValueMap = {};
                    for(var i=0;i<channelCookievalues.length;i++)
                    {
                        var channelCookieArray = channelCookievalues[i].split(this.elementKeySeperator);
                        if(channelCookieArray[0] !== "" && channelCookieArray[1] !== ""){
                            channelCookieValueMap[channelCookieArray[0]] = channelCookieArray[1];
                        }
                    }
                    if(channelCookieValueMap != null)
                    {
                        if(this.elementAppAlias in channelCookieValueMap)
                        {
                            systemAlias = channelCookieValueMap[this.elementAppAlias];
                        }
                        if(this.elementOSType in channelCookieValueMap)
                        {
                            osType = channelCookieValueMap[this.elementOSType];
                        }
                        if(this.elementOSVersion in channelCookieValueMap)
                        {
                            osVersion = channelCookieValueMap[this.elementOSVersion];
                        }
                        if(this.elementAppType in channelCookieValueMap)
                        {
                            clientApp = channelCookieValueMap[this.elementAppType];
                        }
                        if(this.elementAppVersion in channelCookieValueMap)
                        {
                            clientAppVersion = channelCookieValueMap[this.elementAppVersion];
                        }
                    }
                    if (clientApp.toLowerCase() == this.clientApp_proNative.toLowerCase() && osType.toLowerCase() == this.osAndroid.toLowerCase()) {
                        return this.proAndroid;
                    } else if (clientApp.toLowerCase() == this.clientApp_proNative.toLowerCase() && osType.toLowerCase() == this.osIOS.toLowerCase()) {
                        return this.proIphone;
                    } else if (clientApp.toLowerCase() == this.clientApp_consumerNative.toLowerCase() && osType.toLowerCase() == this.osWP.toLowerCase()) {
                        return this.mobileWP7;
                    } else if (clientApp.toLowerCase() == this.clientApp_consumerNative.toLowerCase() && osType.toLowerCase() == this.osAndroid.toLowerCase()) {
                        return this.mobileAndroid;
                    } else if (clientApp.toLowerCase() == this.clientApp_consumerNative.toLowerCase() && osType.toLowerCase() == this.osIOS.toLowerCase()) {
                        return this.mobileIphone;
                    } else if (clientApp.toLowerCase() == this.clientApp_kiosk.toLowerCase()) {
                        return this.kiosk;
                    } else if (systemAlias.toLowerCase() == this.appAlias_mobileWeb.toLowerCase() && persistCookie_Crumb40_Value != null && persistCookie_Crumb40_Value.toLowerCase() == this.HDP.toLowerCase()) {
                        return this.proMobile;
                    } else if (systemAlias.toLowerCase() == this.appAlias_mobileWeb.toLowerCase()) {
                        return this.mobileWeb;
                    } else if (systemAlias.toLowerCase() == this.appAlias_Tablet.toLowerCase() && persistCookie_Crumb40_Value != null && persistCookie_Crumb40_Value.toLowerCase() == this.HDP.toLowerCase()) {
                        return this.proTablet;
                    } else if (systemAlias == this.appAlias_Tablet) {
                        return this.tabletWeb;
                    } else if (systemAlias !== "" &&
                        systemAlias.toLowerCase() != this.appAlias_mobileWeb.toLowerCase() &&
                        systemAlias.toLowerCase() != this.appAlias_Tablet.toLowerCase()  &&
                        persistCookie_Crumb40_Value != null && persistCookie_Crumb40_Value.toLowerCase() == this.HDP.toLowerCase()) {
                        return this.proDesktop;
                    } else if (systemAlias !== "" &&
                        systemAlias.toLowerCase() != this.appAlias_mobileWeb.toLowerCase() &&
                        systemAlias.toLowerCase() != this.appAlias_Tablet.toLowerCase()){
                        return this.webChannel;
                    } else {
                        return this.physicalStore;
                    }
                }
            }
        }
    };

    return thdOnlineCommon;
}));


/* --------------------------------------------------------------------------------------------------
	New, global utility file to initialize all global
	Config variables and methods.
--------------------------------------------------------------------------------------------------*/

(function closure(root, factory) {
	if(typeof define === 'function' && define.amd) {
		define('global.utility',['jquery', 'global.namespace', 'cookie-utils', 'utils.url', 'thd-online-common', 'utils.minicart'],
			function load($, THD, cookieUtils, utilsUrl, thdOnlineCommon, miniCart) {
				return factory(root, $, THD, cookieUtils, utilsUrl, thdOnlineCommon, miniCart);
			});
	} else{
		// For non-AMD module, expose this to global (will also be useful for test cases)
		/* eslint-disable*/
		root.globalUtility = factory(root, jQuery, THD, cookieUtils, THD.Utils.Url, thdOnlineCommon, THD.Utils.MiniCart);
		/*eslint-enable*/
	}
})(this, function factory(root, $, THD, cookieUtils, utilsUrl, thdOnlineCommon, miniCart) {
	var configObj = THD.Utility.Config = THD.Utility.Config  || {};
	var extend = function extend(obj, src) {
		var key;
		for (key in src) {
			if (src.hasOwnProperty(key)) obj[key] = src[key];
		}
		return obj;
	};

	configObj.getGlobalData = function getGlobalData() {
		// Read the JSON-formatted global data from the DOM
		return THD_GLOBAL;
	};

	configObj.getHostNameNonSecure = function getHostNameNonSecure() {
		var str = '';
		if (configObj.env === 'localhost') {
			str = 'localhost';
		} else if (configObj.instance === 's') {
			str = configObj.nonSecureHostNameStaging;
		} else {
			str = configObj.nonSecureHostName;
		}
		return str;
	};

	configObj.getHostNameSecure = function getHostNameSecure() {
		var str = '';
		if (configObj.env === 'localhost') {
			str = 'localhost';
		} else if(configObj.instance === 's') {
			str = configObj.secureHostNameStaging;
		} else {
			str = configObj.secureHostName;
		}
		return str;
	};

	configObj.initCookieManager = function initCookieManager() {
		var referral;
		var cookieDomain = (configObj.instance === 's')
			? configObj.cookieDomainStaging
			: configObj.cookieDomain;

		// cookieManager is a global variable
		if (!cookieUtils.cookieManager) {
			cookieUtils.initializeCookieManager(cookieDomain, 'desktop');
		}

		referral = utilsUrl.get({
			url: window.location.href,
			lookupParm: 'referral'
		});

		if (referral.length > 0) {
			cookieUtils.createCookie('THD_REFERER_WC', referral, null);
		}
		return this;
	};

	configObj.createChannelCookie = function createChannelCookie() {
		// @TODO understand when `thdOnlineCommon.appAlias` is set
		if (typeof(thdOnlineCommon.appAlias) !== 'undefined' && thdOnlineCommon.appAlias !== null) {
			thdOnlineCommon.cookie.channel.CreateChannelCookie(thdOnlineCommon.appAlias);
		}

		return this;
	};

	configObj.init = function init() {
		configObj
			.initCookieManager()
			.createChannelCookie();

		miniCart.getMiniCartInfo(
				configObj.freeShipThreshold,
				configObj.hasRunningFreeShipPromo,
				configObj.numberItemsInCart,
				configObj.totalCartAmount,
				configObj.orderQualifiesForFreeShip
			);
	};

	configObj.loadGlobals = function loadGlobals() {
		var globalObj = configObj.getGlobalData();
		if (!Object.keys(globalObj).length) {
			globalObj = {
				instance: THD.Utility.Config.instance,
				env: THD.Utility.Config.env,
				secureHostNameStaging: THD.Utility.Config.secureHostNameStaging,
				secureHostName: THD.Utility.Config.secureHostName,
				nonSecureHostNameStaging: THD.Utility.Config.nonSecureHostNameStaging,
				nonSecureHostName: THD.Utility.Config.nonSecureHostName,
			};
		}
		return globalObj;
	};

	configObj.buildConfigObj = function buildConfigObj(globalObj) {
		THD.Utility.Config = extend(configObj, globalObj);
		// Call INIT only when we don't have global INIT in end point.
		if (THD.Utility.Config.hasOwnProperty('cookieDomain')) {
			configObj.init();
		}
	};

	configObj.touch = 'ontouchstart' in window ||
		window.DocumentTouch && document instanceof window.DocumentTouch ||
		navigator.maxTouchPoints > 0 ||
		window.navigator.msMaxTouchPoints > 0;

	if(typeof window['THD_GLOBAL'] !== 'undefined') {
		var globalObj = configObj.loadGlobals();
		configObj.buildConfigObj(globalObj);
	} else {
		// This happens only if global.utility is loaded before footer
		document.addEventListener("DOMContentLoaded", function(event) {
			var globalObj = configObj.loadGlobals();
			configObj.buildConfigObj(globalObj);
		});
	}

	return configObj;
});

/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.5+7f2b526d
 */

(function (global, factory) {
	typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :
	typeof define === 'function' && define.amd ? define('es6-promise',factory) :
	(global.ES6Promise = factory());
}(this, (function () { 'use strict';

function objectOrFunction(x) {
  var type = typeof x;
  return x !== null && (type === 'object' || type === 'function');
}

function isFunction(x) {
  return typeof x === 'function';
}



var _isArray = void 0;
if (Array.isArray) {
  _isArray = Array.isArray;
} else {
  _isArray = function (x) {
    return Object.prototype.toString.call(x) === '[object Array]';
  };
}

var isArray = _isArray;

var len = 0;
var vertxNext = void 0;
var customSchedulerFn = void 0;

var asap = function asap(callback, arg) {
  queue[len] = callback;
  queue[len + 1] = arg;
  len += 2;
  if (len === 2) {
    // If len is 2, that means that we need to schedule an async flush.
    // If additional callbacks are queued before the queue is flushed, they
    // will be processed by this flush that we are scheduling.
    if (customSchedulerFn) {
      customSchedulerFn(flush);
    } else {
      scheduleFlush();
    }
  }
};

function setScheduler(scheduleFn) {
  customSchedulerFn = scheduleFn;
}

function setAsap(asapFn) {
  asap = asapFn;
}

var browserWindow = typeof window !== 'undefined' ? window : undefined;
var browserGlobal = browserWindow || {};
var BrowserMutationObserver = browserGlobal.MutationObserver || browserGlobal.WebKitMutationObserver;
var isNode = typeof self === 'undefined' && typeof process !== 'undefined' && {}.toString.call(process) === '[object process]';

// test for web worker but not in IE10
var isWorker = typeof Uint8ClampedArray !== 'undefined' && typeof importScripts !== 'undefined' && typeof MessageChannel !== 'undefined';

// node
function useNextTick() {
  // node version 0.10.x displays a deprecation warning when nextTick is used recursively
  // see https://github.com/cujojs/when/issues/410 for details
  return function () {
    return process.nextTick(flush);
  };
}

// vertx
function useVertxTimer() {
  if (typeof vertxNext !== 'undefined') {
    return function () {
      vertxNext(flush);
    };
  }

  return useSetTimeout();
}

function useMutationObserver() {
  var iterations = 0;
  var observer = new BrowserMutationObserver(flush);
  var node = document.createTextNode('');
  observer.observe(node, { characterData: true });

  return function () {
    node.data = iterations = ++iterations % 2;
  };
}

// web worker
function useMessageChannel() {
  var channel = new MessageChannel();
  channel.port1.onmessage = flush;
  return function () {
    return channel.port2.postMessage(0);
  };
}

function useSetTimeout() {
  // Store setTimeout reference so es6-promise will be unaffected by
  // other code modifying setTimeout (like sinon.useFakeTimers())
  var globalSetTimeout = setTimeout;
  return function () {
    return globalSetTimeout(flush, 1);
  };
}

var queue = new Array(1000);
function flush() {
  for (var i = 0; i < len; i += 2) {
    var callback = queue[i];
    var arg = queue[i + 1];

    callback(arg);

    queue[i] = undefined;
    queue[i + 1] = undefined;
  }

  len = 0;
}

function attemptVertx() {
  try {
    var vertx = Function('return this')().require('vertx');
    vertxNext = vertx.runOnLoop || vertx.runOnContext;
    return useVertxTimer();
  } catch (e) {
    return useSetTimeout();
  }
}

var scheduleFlush = void 0;
// Decide what async method to use to triggering processing of queued callbacks:
if (isNode) {
  scheduleFlush = useNextTick();
} else if (BrowserMutationObserver) {
  scheduleFlush = useMutationObserver();
} else if (isWorker) {
  scheduleFlush = useMessageChannel();
} else if (browserWindow === undefined && typeof require === 'function') {
  scheduleFlush = attemptVertx();
} else {
  scheduleFlush = useSetTimeout();
}

function then(onFulfillment, onRejection) {
  var parent = this;

  var child = new this.constructor(noop);

  if (child[PROMISE_ID] === undefined) {
    makePromise(child);
  }

  var _state = parent._state;


  if (_state) {
    var callback = arguments[_state - 1];
    asap(function () {
      return invokeCallback(_state, child, callback, parent._result);
    });
  } else {
    subscribe(parent, child, onFulfillment, onRejection);
  }

  return child;
}

/**
  `Promise.resolve` returns a promise that will become resolved with the
  passed `value`. It is shorthand for the following:

  ```javascript
  let promise = new Promise(function(resolve, reject){
    resolve(1);
  });

  promise.then(function(value){
    // value === 1
  });
  ```

  Instead of writing the above, your code now simply becomes the following:

  ```javascript
  let promise = Promise.resolve(1);

  promise.then(function(value){
    // value === 1
  });
  ```

  @method resolve
  @static
  @param {Any} value value that the returned promise will be resolved with
  Useful for tooling.
  @return {Promise} a promise that will become fulfilled with the given
  `value`
*/
function resolve$1(object) {
  /*jshint validthis:true */
  var Constructor = this;

  if (object && typeof object === 'object' && object.constructor === Constructor) {
    return object;
  }

  var promise = new Constructor(noop);
  resolve(promise, object);
  return promise;
}

var PROMISE_ID = Math.random().toString(36).substring(2);

function noop() {}

var PENDING = void 0;
var FULFILLED = 1;
var REJECTED = 2;

var TRY_CATCH_ERROR = { error: null };

function selfFulfillment() {
  return new TypeError("You cannot resolve a promise with itself");
}

function cannotReturnOwn() {
  return new TypeError('A promises callback cannot return that same promise.');
}

function getThen(promise) {
  try {
    return promise.then;
  } catch (error) {
    TRY_CATCH_ERROR.error = error;
    return TRY_CATCH_ERROR;
  }
}

function tryThen(then$$1, value, fulfillmentHandler, rejectionHandler) {
  try {
    then$$1.call(value, fulfillmentHandler, rejectionHandler);
  } catch (e) {
    return e;
  }
}

function handleForeignThenable(promise, thenable, then$$1) {
  asap(function (promise) {
    var sealed = false;
    var error = tryThen(then$$1, thenable, function (value) {
      if (sealed) {
        return;
      }
      sealed = true;
      if (thenable !== value) {
        resolve(promise, value);
      } else {
        fulfill(promise, value);
      }
    }, function (reason) {
      if (sealed) {
        return;
      }
      sealed = true;

      reject(promise, reason);
    }, 'Settle: ' + (promise._label || ' unknown promise'));

    if (!sealed && error) {
      sealed = true;
      reject(promise, error);
    }
  }, promise);
}

function handleOwnThenable(promise, thenable) {
  if (thenable._state === FULFILLED) {
    fulfill(promise, thenable._result);
  } else if (thenable._state === REJECTED) {
    reject(promise, thenable._result);
  } else {
    subscribe(thenable, undefined, function (value) {
      return resolve(promise, value);
    }, function (reason) {
      return reject(promise, reason);
    });
  }
}

function handleMaybeThenable(promise, maybeThenable, then$$1) {
  if (maybeThenable.constructor === promise.constructor && then$$1 === then && maybeThenable.constructor.resolve === resolve$1) {
    handleOwnThenable(promise, maybeThenable);
  } else {
    if (then$$1 === TRY_CATCH_ERROR) {
      reject(promise, TRY_CATCH_ERROR.error);
      TRY_CATCH_ERROR.error = null;
    } else if (then$$1 === undefined) {
      fulfill(promise, maybeThenable);
    } else if (isFunction(then$$1)) {
      handleForeignThenable(promise, maybeThenable, then$$1);
    } else {
      fulfill(promise, maybeThenable);
    }
  }
}

function resolve(promise, value) {
  if (promise === value) {
    reject(promise, selfFulfillment());
  } else if (objectOrFunction(value)) {
    handleMaybeThenable(promise, value, getThen(value));
  } else {
    fulfill(promise, value);
  }
}

function publishRejection(promise) {
  if (promise._onerror) {
    promise._onerror(promise._result);
  }

  publish(promise);
}

function fulfill(promise, value) {
  if (promise._state !== PENDING) {
    return;
  }

  promise._result = value;
  promise._state = FULFILLED;

  if (promise._subscribers.length !== 0) {
    asap(publish, promise);
  }
}

function reject(promise, reason) {
  if (promise._state !== PENDING) {
    return;
  }
  promise._state = REJECTED;
  promise._result = reason;

  asap(publishRejection, promise);
}

function subscribe(parent, child, onFulfillment, onRejection) {
  var _subscribers = parent._subscribers;
  var length = _subscribers.length;


  parent._onerror = null;

  _subscribers[length] = child;
  _subscribers[length + FULFILLED] = onFulfillment;
  _subscribers[length + REJECTED] = onRejection;

  if (length === 0 && parent._state) {
    asap(publish, parent);
  }
}

function publish(promise) {
  var subscribers = promise._subscribers;
  var settled = promise._state;

  if (subscribers.length === 0) {
    return;
  }

  var child = void 0,
      callback = void 0,
      detail = promise._result;

  for (var i = 0; i < subscribers.length; i += 3) {
    child = subscribers[i];
    callback = subscribers[i + settled];

    if (child) {
      invokeCallback(settled, child, callback, detail);
    } else {
      callback(detail);
    }
  }

  promise._subscribers.length = 0;
}

function tryCatch(callback, detail) {
  try {
    return callback(detail);
  } catch (e) {
    TRY_CATCH_ERROR.error = e;
    return TRY_CATCH_ERROR;
  }
}

function invokeCallback(settled, promise, callback, detail) {
  var hasCallback = isFunction(callback),
      value = void 0,
      error = void 0,
      succeeded = void 0,
      failed = void 0;

  if (hasCallback) {
    value = tryCatch(callback, detail);

    if (value === TRY_CATCH_ERROR) {
      failed = true;
      error = value.error;
      value.error = null;
    } else {
      succeeded = true;
    }

    if (promise === value) {
      reject(promise, cannotReturnOwn());
      return;
    }
  } else {
    value = detail;
    succeeded = true;
  }

  if (promise._state !== PENDING) {
    // noop
  } else if (hasCallback && succeeded) {
    resolve(promise, value);
  } else if (failed) {
    reject(promise, error);
  } else if (settled === FULFILLED) {
    fulfill(promise, value);
  } else if (settled === REJECTED) {
    reject(promise, value);
  }
}

function initializePromise(promise, resolver) {
  try {
    resolver(function resolvePromise(value) {
      resolve(promise, value);
    }, function rejectPromise(reason) {
      reject(promise, reason);
    });
  } catch (e) {
    reject(promise, e);
  }
}

var id = 0;
function nextId() {
  return id++;
}

function makePromise(promise) {
  promise[PROMISE_ID] = id++;
  promise._state = undefined;
  promise._result = undefined;
  promise._subscribers = [];
}

function validationError() {
  return new Error('Array Methods must be provided an Array');
}

var Enumerator = function () {
  function Enumerator(Constructor, input) {
    this._instanceConstructor = Constructor;
    this.promise = new Constructor(noop);

    if (!this.promise[PROMISE_ID]) {
      makePromise(this.promise);
    }

    if (isArray(input)) {
      this.length = input.length;
      this._remaining = input.length;

      this._result = new Array(this.length);

      if (this.length === 0) {
        fulfill(this.promise, this._result);
      } else {
        this.length = this.length || 0;
        this._enumerate(input);
        if (this._remaining === 0) {
          fulfill(this.promise, this._result);
        }
      }
    } else {
      reject(this.promise, validationError());
    }
  }

  Enumerator.prototype._enumerate = function _enumerate(input) {
    for (var i = 0; this._state === PENDING && i < input.length; i++) {
      this._eachEntry(input[i], i);
    }
  };

  Enumerator.prototype._eachEntry = function _eachEntry(entry, i) {
    var c = this._instanceConstructor;
    var resolve$$1 = c.resolve;


    if (resolve$$1 === resolve$1) {
      var _then = getThen(entry);

      if (_then === then && entry._state !== PENDING) {
        this._settledAt(entry._state, i, entry._result);
      } else if (typeof _then !== 'function') {
        this._remaining--;
        this._result[i] = entry;
      } else if (c === Promise$1) {
        var promise = new c(noop);
        handleMaybeThenable(promise, entry, _then);
        this._willSettleAt(promise, i);
      } else {
        this._willSettleAt(new c(function (resolve$$1) {
          return resolve$$1(entry);
        }), i);
      }
    } else {
      this._willSettleAt(resolve$$1(entry), i);
    }
  };

  Enumerator.prototype._settledAt = function _settledAt(state, i, value) {
    var promise = this.promise;


    if (promise._state === PENDING) {
      this._remaining--;

      if (state === REJECTED) {
        reject(promise, value);
      } else {
        this._result[i] = value;
      }
    }

    if (this._remaining === 0) {
      fulfill(promise, this._result);
    }
  };

  Enumerator.prototype._willSettleAt = function _willSettleAt(promise, i) {
    var enumerator = this;

    subscribe(promise, undefined, function (value) {
      return enumerator._settledAt(FULFILLED, i, value);
    }, function (reason) {
      return enumerator._settledAt(REJECTED, i, reason);
    });
  };

  return Enumerator;
}();

/**
  `Promise.all` accepts an array of promises, and returns a new promise which
  is fulfilled with an array of fulfillment values for the passed promises, or
  rejected with the reason of the first passed promise to be rejected. It casts all
  elements of the passed iterable to promises as it runs this algorithm.

  Example:

  ```javascript
  let promise1 = resolve(1);
  let promise2 = resolve(2);
  let promise3 = resolve(3);
  let promises = [ promise1, promise2, promise3 ];

  Promise.all(promises).then(function(array){
    // The array here would be [ 1, 2, 3 ];
  });
  ```

  If any of the `promises` given to `all` are rejected, the first promise
  that is rejected will be given as an argument to the returned promises's
  rejection handler. For example:

  Example:

  ```javascript
  let promise1 = resolve(1);
  let promise2 = reject(new Error("2"));
  let promise3 = reject(new Error("3"));
  let promises = [ promise1, promise2, promise3 ];

  Promise.all(promises).then(function(array){
    // Code here never runs because there are rejected promises!
  }, function(error) {
    // error.message === "2"
  });
  ```

  @method all
  @static
  @param {Array} entries array of promises
  @param {String} label optional string for labeling the promise.
  Useful for tooling.
  @return {Promise} promise that is fulfilled when all `promises` have been
  fulfilled, or rejected if any of them become rejected.
  @static
*/
function all(entries) {
  return new Enumerator(this, entries).promise;
}

/**
  `Promise.race` returns a new promise which is settled in the same way as the
  first passed promise to settle.

  Example:

  ```javascript
  let promise1 = new Promise(function(resolve, reject){
    setTimeout(function(){
      resolve('promise 1');
    }, 200);
  });

  let promise2 = new Promise(function(resolve, reject){
    setTimeout(function(){
      resolve('promise 2');
    }, 100);
  });

  Promise.race([promise1, promise2]).then(function(result){
    // result === 'promise 2' because it was resolved before promise1
    // was resolved.
  });
  ```

  `Promise.race` is deterministic in that only the state of the first
  settled promise matters. For example, even if other promises given to the
  `promises` array argument are resolved, but the first settled promise has
  become rejected before the other promises became fulfilled, the returned
  promise will become rejected:

  ```javascript
  let promise1 = new Promise(function(resolve, reject){
    setTimeout(function(){
      resolve('promise 1');
    }, 200);
  });

  let promise2 = new Promise(function(resolve, reject){
    setTimeout(function(){
      reject(new Error('promise 2'));
    }, 100);
  });

  Promise.race([promise1, promise2]).then(function(result){
    // Code here never runs
  }, function(reason){
    // reason.message === 'promise 2' because promise 2 became rejected before
    // promise 1 became fulfilled
  });
  ```

  An example real-world use case is implementing timeouts:

  ```javascript
  Promise.race([ajax('foo.json'), timeout(5000)])
  ```

  @method race
  @static
  @param {Array} promises array of promises to observe
  Useful for tooling.
  @return {Promise} a promise which settles in the same way as the first passed
  promise to settle.
*/
function race(entries) {
  /*jshint validthis:true */
  var Constructor = this;

  if (!isArray(entries)) {
    return new Constructor(function (_, reject) {
      return reject(new TypeError('You must pass an array to race.'));
    });
  } else {
    return new Constructor(function (resolve, reject) {
      var length = entries.length;
      for (var i = 0; i < length; i++) {
        Constructor.resolve(entries[i]).then(resolve, reject);
      }
    });
  }
}

/**
  `Promise.reject` returns a promise rejected with the passed `reason`.
  It is shorthand for the following:

  ```javascript
  let promise = new Promise(function(resolve, reject){
    reject(new Error('WHOOPS'));
  });

  promise.then(function(value){
    // Code here doesn't run because the promise is rejected!
  }, function(reason){
    // reason.message === 'WHOOPS'
  });
  ```

  Instead of writing the above, your code now simply becomes the following:

  ```javascript
  let promise = Promise.reject(new Error('WHOOPS'));

  promise.then(function(value){
    // Code here doesn't run because the promise is rejected!
  }, function(reason){
    // reason.message === 'WHOOPS'
  });
  ```

  @method reject
  @static
  @param {Any} reason value that the returned promise will be rejected with.
  Useful for tooling.
  @return {Promise} a promise rejected with the given `reason`.
*/
function reject$1(reason) {
  /*jshint validthis:true */
  var Constructor = this;
  var promise = new Constructor(noop);
  reject(promise, reason);
  return promise;
}

function needsResolver() {
  throw new TypeError('You must pass a resolver function as the first argument to the promise constructor');
}

function needsNew() {
  throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");
}

/**
  Promise objects represent the eventual result of an asynchronous operation. The
  primary way of interacting with a promise is through its `then` method, which
  registers callbacks to receive either a promise's eventual value or the reason
  why the promise cannot be fulfilled.

  Terminology
  -----------

  - `promise` is an object or function with a `then` method whose behavior conforms to this specification.
  - `thenable` is an object or function that defines a `then` method.
  - `value` is any legal JavaScript value (including undefined, a thenable, or a promise).
  - `exception` is a value that is thrown using the throw statement.
  - `reason` is a value that indicates why a promise was rejected.
  - `settled` the final resting state of a promise, fulfilled or rejected.

  A promise can be in one of three states: pending, fulfilled, or rejected.

  Promises that are fulfilled have a fulfillment value and are in the fulfilled
  state.  Promises that are rejected have a rejection reason and are in the
  rejected state.  A fulfillment value is never a thenable.

  Promises can also be said to *resolve* a value.  If this value is also a
  promise, then the original promise's settled state will match the value's
  settled state.  So a promise that *resolves* a promise that rejects will
  itself reject, and a promise that *resolves* a promise that fulfills will
  itself fulfill.


  Basic Usage:
  ------------

  ```js
  let promise = new Promise(function(resolve, reject) {
    // on success
    resolve(value);

    // on failure
    reject(reason);
  });

  promise.then(function(value) {
    // on fulfillment
  }, function(reason) {
    // on rejection
  });
  ```

  Advanced Usage:
  ---------------

  Promises shine when abstracting away asynchronous interactions such as
  `XMLHttpRequest`s.

  ```js
  function getJSON(url) {
    return new Promise(function(resolve, reject){
      let xhr = new XMLHttpRequest();

      xhr.open('GET', url);
      xhr.onreadystatechange = handler;
      xhr.responseType = 'json';
      xhr.setRequestHeader('Accept', 'application/json');
      xhr.send();

      function handler() {
        if (this.readyState === this.DONE) {
          if (this.status === 200) {
            resolve(this.response);
          } else {
            reject(new Error('getJSON: `' + url + '` failed with status: [' + this.status + ']'));
          }
        }
      };
    });
  }

  getJSON('/posts.json').then(function(json) {
    // on fulfillment
  }, function(reason) {
    // on rejection
  });
  ```

  Unlike callbacks, promises are great composable primitives.

  ```js
  Promise.all([
    getJSON('/posts'),
    getJSON('/comments')
  ]).then(function(values){
    values[0] // => postsJSON
    values[1] // => commentsJSON

    return values;
  });
  ```

  @class Promise
  @param {Function} resolver
  Useful for tooling.
  @constructor
*/

var Promise$1 = function () {
  function Promise(resolver) {
    this[PROMISE_ID] = nextId();
    this._result = this._state = undefined;
    this._subscribers = [];

    if (noop !== resolver) {
      typeof resolver !== 'function' && needsResolver();
      this instanceof Promise ? initializePromise(this, resolver) : needsNew();
    }
  }

  /**
  The primary way of interacting with a promise is through its `then` method,
  which registers callbacks to receive either a promise's eventual value or the
  reason why the promise cannot be fulfilled.
   ```js
  findUser().then(function(user){
    // user is available
  }, function(reason){
    // user is unavailable, and you are given the reason why
  });
  ```
   Chaining
  --------
   The return value of `then` is itself a promise.  This second, 'downstream'
  promise is resolved with the return value of the first promise's fulfillment
  or rejection handler, or rejected if the handler throws an exception.
   ```js
  findUser().then(function (user) {
    return user.name;
  }, function (reason) {
    return 'default name';
  }).then(function (userName) {
    // If `findUser` fulfilled, `userName` will be the user's name, otherwise it
    // will be `'default name'`
  });
   findUser().then(function (user) {
    throw new Error('Found user, but still unhappy');
  }, function (reason) {
    throw new Error('`findUser` rejected and we're unhappy');
  }).then(function (value) {
    // never reached
  }, function (reason) {
    // if `findUser` fulfilled, `reason` will be 'Found user, but still unhappy'.
    // If `findUser` rejected, `reason` will be '`findUser` rejected and we're unhappy'.
  });
  ```
  If the downstream promise does not specify a rejection handler, rejection reasons will be propagated further downstream.
   ```js
  findUser().then(function (user) {
    throw new PedagogicalException('Upstream error');
  }).then(function (value) {
    // never reached
  }).then(function (value) {
    // never reached
  }, function (reason) {
    // The `PedgagocialException` is propagated all the way down to here
  });
  ```
   Assimilation
  ------------
   Sometimes the value you want to propagate to a downstream promise can only be
  retrieved asynchronously. This can be achieved by returning a promise in the
  fulfillment or rejection handler. The downstream promise will then be pending
  until the returned promise is settled. This is called *assimilation*.
   ```js
  findUser().then(function (user) {
    return findCommentsByAuthor(user);
  }).then(function (comments) {
    // The user's comments are now available
  });
  ```
   If the assimliated promise rejects, then the downstream promise will also reject.
   ```js
  findUser().then(function (user) {
    return findCommentsByAuthor(user);
  }).then(function (comments) {
    // If `findCommentsByAuthor` fulfills, we'll have the value here
  }, function (reason) {
    // If `findCommentsByAuthor` rejects, we'll have the reason here
  });
  ```
   Simple Example
  --------------
   Synchronous Example
   ```javascript
  let result;
   try {
    result = findResult();
    // success
  } catch(reason) {
    // failure
  }
  ```
   Errback Example
   ```js
  findResult(function(result, err){
    if (err) {
      // failure
    } else {
      // success
    }
  });
  ```
   Promise Example;
   ```javascript
  findResult().then(function(result){
    // success
  }, function(reason){
    // failure
  });
  ```
   Advanced Example
  --------------
   Synchronous Example
   ```javascript
  let author, books;
   try {
    author = findAuthor();
    books  = findBooksByAuthor(author);
    // success
  } catch(reason) {
    // failure
  }
  ```
   Errback Example
   ```js
   function foundBooks(books) {
   }
   function failure(reason) {
   }
   findAuthor(function(author, err){
    if (err) {
      failure(err);
      // failure
    } else {
      try {
        findBoooksByAuthor(author, function(books, err) {
          if (err) {
            failure(err);
          } else {
            try {
              foundBooks(books);
            } catch(reason) {
              failure(reason);
            }
          }
        });
      } catch(error) {
        failure(err);
      }
      // success
    }
  });
  ```
   Promise Example;
   ```javascript
  findAuthor().
    then(findBooksByAuthor).
    then(function(books){
      // found books
  }).catch(function(reason){
    // something went wrong
  });
  ```
   @method then
  @param {Function} onFulfilled
  @param {Function} onRejected
  Useful for tooling.
  @return {Promise}
  */

  /**
  `catch` is simply sugar for `then(undefined, onRejection)` which makes it the same
  as the catch block of a try/catch statement.
  ```js
  function findAuthor(){
  throw new Error('couldn't find that author');
  }
  // synchronous
  try {
  findAuthor();
  } catch(reason) {
  // something went wrong
  }
  // async with promises
  findAuthor().catch(function(reason){
  // something went wrong
  });
  ```
  @method catch
  @param {Function} onRejection
  Useful for tooling.
  @return {Promise}
  */


  Promise.prototype.catch = function _catch(onRejection) {
    return this.then(null, onRejection);
  };

  /**
    `finally` will be invoked regardless of the promise's fate just as native
    try/catch/finally behaves
  
    Synchronous example:
  
    ```js
    findAuthor() {
      if (Math.random() > 0.5) {
        throw new Error();
      }
      return new Author();
    }
  
    try {
      return findAuthor(); // succeed or fail
    } catch(error) {
      return findOtherAuther();
    } finally {
      // always runs
      // doesn't affect the return value
    }
    ```
  
    Asynchronous example:
  
    ```js
    findAuthor().catch(function(reason){
      return findOtherAuther();
    }).finally(function(){
      // author was either found, or not
    });
    ```
  
    @method finally
    @param {Function} callback
    @return {Promise}
  */


  Promise.prototype.finally = function _finally(callback) {
    var promise = this;
    var constructor = promise.constructor;

    if (isFunction(callback)) {
      return promise.then(function (value) {
        return constructor.resolve(callback()).then(function () {
          return value;
        });
      }, function (reason) {
        return constructor.resolve(callback()).then(function () {
          throw reason;
        });
      });
    }

    return promise.then(callback, callback);
  };

  return Promise;
}();

Promise$1.prototype.then = then;
Promise$1.all = all;
Promise$1.race = race;
Promise$1.resolve = resolve$1;
Promise$1.reject = reject$1;
Promise$1._setScheduler = setScheduler;
Promise$1._setAsap = setAsap;
Promise$1._asap = asap;

/*global self*/
function polyfill() {
  var local = void 0;

  if (typeof global !== 'undefined') {
    local = global;
  } else if (typeof self !== 'undefined') {
    local = self;
  } else {
    try {
      local = Function('return this')();
    } catch (e) {
      throw new Error('polyfill failed because global object is unavailable in this environment');
    }
  }

  var P = local.Promise;

  if (P) {
    var promiseToString = null;
    try {
      promiseToString = Object.prototype.toString.call(P.resolve());
    } catch (e) {
      // silently ignored
    }

    if (promiseToString === '[object Promise]' && !P.cast) {
      return;
    }
  }

  local.Promise = Promise$1;
}

// Strange compat..
Promise$1.polyfill = polyfill;
Promise$1.Promise = Promise$1;

return Promise$1;

})));



//# sourceMappingURL=es6-promise.map
;
(function (root, factory) {
  if (typeof define === 'function' && define.amd) {
    define('thd-event-emitter',[], function(){
      return factory(root);
    });
  } else {
    root.EventEmitter = factory(root);
  }
}(this, function ( root ) {

  var EventEmitter = function EventEmitter(){
    EventEmitter.prototype._EventEmitterEvents = {};
    EventEmitter.prototype._EventEmitterEventsComplete = {};
  };


  EventEmitter.extend = function( ChildClass ) {
    EventEmitter.call(ChildClass);
    for (var method in EventEmitter.prototype) {
      ChildClass.prototype[method] = EventEmitter.prototype[method];
    }
  };

  EventEmitter.prototype.on =  function(key, fn) {
    var parent_key;
    if (key.indexOf('.') === -1) {
     key  = key + '.default';
    }
    parent_key = key.split('.')[0];

    if ( typeof this._EventEmitterEvents[key] === 'undefined' ) {
      this._EventEmitterEvents[key] = [];
    }
    var parents = Object.keys(this._EventEmitterEventsComplete).map(function(k){
      if (!k) {
        return '';
      }
      return k.split('.')[0];
    });
    var keys = Object.keys(this._EventEmitterEventsComplete);
    if (parents.indexOf(parent_key) !== -1 ) {
      for (var i = 0; i < keys.length; i++) {
        var k = keys[i];
        var parts = k.split('.');
        if (parts[0] === parent_key) {
          try {
            fn.apply(this, this._EventEmitterEventsComplete[keys[i]]);
          } catch(e) {
            if (typeof console !== 'undefined' && console.trace) {
              console.trace(e);
            }
          }
        }
       }

      this.off(key, this._EventEmitterEventsComplete[parent_key]);
      if ( typeof this._EventEmitterEvents[key] === 'undefined' ) {
        this._EventEmitterEvents[key] = [];
      }
      this._EventEmitterEvents[key].push(fn);
    } else if (Object.keys(this._EventEmitterEventsComplete).indexOf(key) !== -1 ) {
      try {
        fn.apply(this, this._EventEmitterEventsComplete[key]);
      } catch(e) {
        if (typeof console !== 'undefined' && console.trace) {
          console.trace(e);
        }
      }
      this.off(key, this._EventEmitterEventsComplete[key]);
      if ( typeof this._EventEmitterEvents[key] === 'undefined' ) {
        this._EventEmitterEvents[key] = [];
      }
      this._EventEmitterEvents[key].push(fn);
    } else {
      this._EventEmitterEvents[key].push(fn);
    }
    return this;
  };

  EventEmitter.prototype.off = function( key, fn ){

    if (!key) {
      var eventKeys = Object.keys(this._EventEmitterEvents);
      var n;
      var len = eventKeys.length;
      for (n = 0; n < len; n++) {
        key = eventKeys[n];
        this._EventEmitterEvents[key] = null;
        delete this._EventEmitterEvents[key];
        this._EventEmitterEventsComplete[key] = null;
        delete this._EventEmitterEventsComplete[key];
      }
      return;
    }

    if (key.indexOf('.') === -1) {
     key  = key + '.default';
    }
    // if (!this._EventEmitterEvents[key]) {
    //   return this;
    // }
    if (typeof fn === 'undefined') {
     this._EventEmitterEvents[key] = null;
     delete this._EventEmitterEvents[key];
     this._EventEmitterEventsComplete[key] = null;
     delete this._EventEmitterEventsComplete[key];
     return;
    }

    fn = '' + fn;

    var removeEvent = function removeEvent( store, key, fn ) {
      if (!store[key]) {
        return;
      }

      for ( var i = 0; i < store[key].length; i++ ) {
         var evtFn = '' + store[key][i];
         if (fn === evtFn || evtFn === '[object Object]') {
            store[key].splice(i,1);
            if (store[key].length === 0) {
              delete store[key];
              break;
            }
         }
      }
    };

    removeEvent(this._EventEmitterEvents, key, fn);
    removeEvent(this._EventEmitterEventsComplete, key, fn);
    return this;
  };

  EventEmitter.prototype.trigger = function( key ) {

    var _this = this;
    var fireEvent = function(namespace, args) {

      if (!_this._EventEmitterEvents[namespace]) {
          return;
      }

      var vents = _this._EventEmitterEvents[namespace];

      _this._EventEmitterEventsComplete[namespace] = args;

      args.shift();
      for (var i = 0; i < vents.length; i++) {
        var fn = vents[i];
        try {
          fn.apply(_this, args);
        } catch(e) {
          if (typeof console !== 'undefined' && console.trace) {
            console.trace(e);
          }
        }
        
      }
      return true;
    };
    var fired;
    var args = [].slice.apply(arguments);
    for (var namespace in this._EventEmitterEvents) {
      var re = new RegExp('^'+key +'.');
      if (re.test(namespace)) {
         fired = fireEvent(namespace, args.slice());
      }
    }
    // if the event hasnt been registered yet, save it
    // so when it does it will fire immediately
    if (!fired) {
      args.shift();
      var k;
      if (key.indexOf('.') === -1) {
        k = key + '.default';
      } else {
        k = key;
      }
      this._EventEmitterEventsComplete[k] = args;
    }
  };

  return EventEmitter;
}));

/**
 * @module Localizer
 * @param  {object} root window/node global instance
 * @param  {function} factory Localizer factory
 * @return {RepositoryService} Localizer instance
 */
(function(root, factory) {
  if (typeof define === 'function' && define.amd) {
    define('Localizer', [
      'statusService',
      'storeService',
      'localizationServiceProxy',
      'repositoryService',
      'es6-promise',
      'thd-event-emitter'],
      function(userService, storeService, localizationServiceProxy, repositoryService, ES6PromisePolyfill, EventEmitter) {
        return factory(root, userService, storeService, localizationServiceProxy, repositoryService, ES6PromisePolyfill, EventEmitter);
      });
  } else {
    root.Localizer = factory(root, userService, storeService, localizationServiceProxy, repositoryService, ES6PromisePolyfill, EventEmitter);
  }
})(this, function(root, userService, storeService, localizationServiceProxy, repositoryService, ES6PromisePolyfill, EventEmitter) {

  /**
   * ES6 Promise, pollyfills if browser doesn't support ES6
   * @type {function}
   */
  var Promise = Promise || ES6PromisePolyfill.Promise;

  /**
   * PubSub extends EventEmitter functionalities
   */
  var PubSub = function() {};
  EventEmitter.extend(PubSub);

  /**
   * @private
   * @member LocalizerEventEmitter
   * @description An instance of PubSub. Only events pertaining to localizer are registered here.
   * @type {object}
   */
  var LocalizerEventEmitter = new PubSub();

  /**
   * @private
   * @function subscribe
   * @description Allows consumers to subscribe to Localizer events.
   * @param  {array} events  events to be listened to.
   * @param  {object} eventHandler handler to be invoked upon an event/events.
   */
  var subscribe = function(events, eventHandler) {
    LocalizerEventEmitter.on(events, eventHandler);
  }

  /**
   * @private
   * @function unsubscribe
   * @description Allows consumers to unsubscribe from Localizer events.
   * @param  {array} events  events to be listened to.
   */
  var unSubscribe = function(event) {
    LocalizerEventEmitter.off(event);
  }

  /**
   * @private
   * @function publish
   * @description Allow Localizer to publish events to all listerners
   * @param  {array} event event to be pubslhed.
   */
  var publish = function(events) {
    LocalizerEventEmitter.trigger.apply(LocalizerEventEmitter, arguments);
  }

  /**
   * @constant
   * @description GPS timeout in milliseconds
   * @type {Number}
   */
  var timeout = 5000;

  /**
   * @constant
   * @description GPS position accuracy threshold - in meters
   * @type {Number}
   */
  var ACCURACY_THRESHOLD_LOW = 804.672; // 0.5 miles

  /**
   * @constant
   * @description  GPS position accuracy threshold in meters
   * @type {Number}
   */
  var ACCURACY_THRESHOLD_HIGH = 80467.2; // 50 miles

  /**
   * Events triggered by localizer during the localization process cycle
   * @type {Event}
   */
  var event = {
    // success events
    /** @event */
    LOCALIZED_BY_IP: 'localized_by_ip',
    /** @event */
    LOCALIZED_BY_GPS: 'localized_by_gps',
    /** @event */
    LOCALIZED_BY_DEFAULT: 'localize_default',
    /** @event */
    LOCALIZED_BY_STORE: 'localized_by_store',
    /** @event */
    LOCALIZED_STORE_CHANGED: 'localized_store_changed',
    /** @event */
    LOCALIZED: 'localize_complete',
    // error events
    /** @event */
    LOCALIZE_BY_STORE_FAILED: 'localize_by_store_failed',
    /** @event */
    LOCALIZE_BY_IP_FAILED: 'localize_by_ip_failed',
    /** @event */
    USER_DENIED_GPS: 'user_denied_gps',
    /** @event */
    GPS_ERROR: 'gps_error',
    /** @event */
    GPS_TIMEOUT: 'gps_position_aquisition_timeout'
  }

  var userOperations = userService.operations;
  var userStatus = userService.status;
  var workflowMapper = userService.workflowMapper;


  /**
   * @function GetCurrentLocation
   * @private
   * @description Prompts user to share GPS location if browser supports
   *
   * @return {object} promise - Promise<Position>, Promise to resolve the position (geo-location)
   */
  var getCurrentLocation = function() {
    return new Promise(function(resolve, reject) {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(resolve, reject, { timeout: timeout });
      } else {
        deferred.reject('Geo location is not supported');
      }
    });
  }

  /**
   * @function IsRequestToSelfLocalize
   * @private
   * @description Checks if request from caller is to self localize (localize by store id)
   * @param  {LocalizerRequest}  request LocalizerRequest with store id.
   * @return {Boolean}  True if request is to self localize.
   */
  function isRequestToSelfLocalize(request) {
    return request && request.storeId;
  }

  /**
   * @function isCanadianStore
   * @description  Checks the local store's country and returns true if canada else false.
   * @param  {Store}  localStore store existing either in US or canada
   * @return {Boolean} Returns true if store exists in canada else false.
   */
  function isCanadianStore(localStore) {
    return localStore.address.country === 'CA';
  }

  /**
   * @function ProcessResponse
   * @private
   * @description Run post localization workflow. <br>
   * 1. Persist user's access network - internal/external/unknown. <br>
   * 2. Persist localization workflow - can be either service side/client workflows. Refer StatusService <br>
   * 3. Persist the localized store <br>
   * 4. Update Analytics about the localization workflow <br>
   * 5. Notify consumers of localization lifecycle events.<br>
   *
   * @param  {Store} localStore - Localized store
   * @param  {String} workflow - Refer StatusService for workflows.
   * @param  {Event} localizationEvent - event to be triggered of the localization life-cycle event.
   * @param {string} localizationMethod Localization method passed by the consumer
   */
  var processResponse = function(localStore, workflow, localizationEvent, localizationMethod) {
    var wasLocalized = userStatus.isLocalized();
    userOperations.setLocalizationMode(workflow);
    if (userStatus.isInternal(workflow)) {
      userOperations.markAsInternalUser();
    } else if (userStatus.isExternal(workflow)) {
      userOperations.markAsExternalUser();
    }
    // iff accessed from store
    userOperations.markAsInStoreUser(workflow);
    storeService.setStore(localStore);
    // sets the workflow for digital-data
    localStorage.setItem('localizationMethod', (localizationMethod || workflowMapper[workflow].alias));
    publish(event.LOCALIZED); // generic event
    publish(localizationEvent); // specific event
    if(wasLocalized) {
      publish(event.LOCALIZED_STORE_CHANGED); // store changed.
    }
  }

  /**
   * @function HandleGpsError
   * @private
   * @description Handles GPS error
   * If user didn't consent to share location (code==1)
   * publish consumers that user denied to share location.
   * Otherwise publish as generic GPS error.
   *
   * @param  {Error} error Browser navigator current position error
   */
  var handleGpsError = function(error) {
    var errorEvent;
    if(error.code === 1) {
      errorEvent = event.USER_DENIED_GPS;
      userOperations.setGpsStatus('gps access denied');
    } else if(error.code === 3) {
      errorEvent = event.GPS_TIMEOUT;
      userOperations.setGpsStatus('gps timeout');
    } else {
      errorEvent = event.GPS_ERROR;
      userOperations.setGpsStatus('gps error');
    }
    publish(errorEvent);
  }

  /**
   * @function IsAccuracyBetweenThreshold
   * @private
   * @description Checks if the GPS accuracy falls between LOW and MEDIUM accuracy threshold
   * @param  {Position}  position User's latitude, longitude, accuracy
   * @return {Boolean}   True if GPS accuracy is within the LOW-MEDIUM range.
   */
  var isAccuracyBetweenThreshold = function(position) {
    return position.coords.accuracy > ACCURACY_THRESHOLD_LOW && position.coords.accuracy < ACCURACY_THRESHOLD_HIGH;
  }

  /**
   * @function IsCurrentAccuracyMediumOrLow
   * @private
   * @description checks if currently localized accuracy is Medium or Low
   * @return {Boolean} true if current localization accuracy is Medium/Low.
   */
  var isCurrentAccuracyMediumOrLow = function() {
    return userStatus.getAccuracy() === undefined ||
    userStatus.getAccuracy() === 'LOW' || userStatus.getAccuracy() === 'MEDIUM';
  }

  /**
   * @function LocalizeByGPS
   * @private
   * @description GPS: Geo-localize <br>
   * Attempt to localize the user based on users' latitude, longitude and accuracy. Requests localization-service to localize
   * based on user geo-position.<br>
   * 1. If GPS accuracy is within ACCURACY_THRESHOLD_LOW (<0.5 miles) then classify the workflow as GPS_HIGH<br>
   * 2. If GPS accuracy is between ACCURACY_THRESHOLD_LOW and ACCURACY_THRESHOLD_MEDIUM(<50 miles)
   *   and current localization accuracy is Medium/Low then classify workflow as GPS_MEDIUM. <br>
   * 3. If current localization accuracy is Low and GPS accuracy is beyond ACCURACY_THRESHOLD_MEDIUM (>50 miles)
   *  then classify workflow as GPS_LOW.<br>
   * @param  {Position} position User consent GPS information {lat, long, accuracy}
   */
  var localizeByGPS = function(position) {
    userOperations.setGpsStatus('gps access granted');
    localizationServiceProxy.getLocalStore(position.coords)
      .then(function(localizationResponse) {
        if(isCanadianStore(localizationResponse.localStore)) {
          userOperations.markAsCanadianUser();
          processResponse(storeService.getDefaultStore(), 'LOCALIZED_BY_DEFAULT', event.LOCALIZED_BY_DEFAULT);
        } else {
          var workflow;
          if (position.coords.accuracy <= ACCURACY_THRESHOLD_LOW) {
            workflow = 'LOCALIZED_BY_GPS_HIGH';
          } else if (isAccuracyBetweenThreshold(position) && isCurrentAccuracyMediumOrLow()) {
            workflow = 'LOCALIZED_BY_GPS_MEDIUM';
          } else if (userStatus.getAccuracy() === 'LOW') {
            workflow = 'LOCALIZED_BY_GPS_LOW';
          }
          processResponse(localizationResponse.localStore, workflow, event.LOCALIZED_BY_GPS);
        }
      });
  }

  /**
   * @function LocalizeByIP
   * @private
   * @description AUTO-LOCALIZE: Attempts to localize the user based on IP. Requests localization-service to localize user based on IP.<br>
   *  1. Mark user as auto localized.<br>
   *  2. Mark user as INTERNAL if workflow is among [known,store,default-internal] else External or Unknown user.<br>
   *  3. Set localized store based on the user's past ip history, Akamai's geo guess, subnet or known ip, store ip.<br>
   *  4. Notify consumers that user has been localized by IP.<br>
   * If localization-service fails to respond or localize. Notify of the failure and default localize the user
   *
   * @return {Promise} - A promise wrapper with LocalizerResponse, Promise<LocalizerResponse>
   */
  var localizeByIp = function(resolve, reject) {
    localizationServiceProxy.getLocalStore() // get the closest store near to my location.
      .then(function(localizationResponse) {
        /*
          If there is a race condition, then subsequent request might escape isLocalization condition.
          An additional check eliminates further updates on auto localization.
         */
        if(userStatus.isLocalized()) {
           resolve(localizerResponse);
        } else {
          if(isCanadianStore(localizationResponse.localStore)) {
            userOperations.markAsCanadianUser();
            // default to 121 to all canadian users
            processResponse(storeService.getDefaultStore(), 'LOCALIZED_BY_DEFAULT', event.LOCALIZED_BY_DEFAULT);
          } else {
            processResponse(localizationResponse.localStore, localizationResponse.metadata.workflow, event.LOCALIZED_BY_IP);
          }
          resolve(localizerResponse);
          promptUserToShareGpsLocation(); // Check if user wishes to share his/her location
        }
      }, function(error) {
          publish(event.LOCALIZE_BY_IP_FAILED);
          processResponse(storeService.getDefaultStore(), 'LOCALIZED_BY_DEFAULT', event.LOCALIZED_BY_DEFAULT);
          resolve(localizerResponse);
      });
  }

  /**
   * @function LocalizeByStore
   * @private
   * @description SELF-LOCALIZE: Attempts to localize based on store ID. <br>
   * Requests localization-service for store details for the given store ID.<br>
   * 1. Marks the user as self localized. <br>
   * 2. Set the localized store with retrieved store details.<br>
   * 3. Trigger an event indicating that user has been localized to the store requested.<br>
   *
   * @param  {LocalizationRequest} request - LocalizationRequest with store ID.
   * @param {string} workflow - Default workflow for localize by store
   * @return {Promise} - A promise wrapper with LocalizerResponse, Promise<LocalizerResponse>
   */
  var localizeByStore = function(request, workflow) {
    return new Promise(function(resolve, reject) {
      localizationServiceProxy.getStore(request.storeId)
        .then(function(localizationResponse) {
          processResponse(localizationResponse.localStore, workflow||'LOCALIZED_BY_STORE',
            event.LOCALIZED_BY_STORE, request.localizationMethod);
          resolve(localizerResponse);
        },function(error) {
          publish(event.LOCALIZE_BY_STORE_FAILED);
          reject(localizerResponse);
        });
    });
  }

  /**
   * @function PromptUserToShareGpsLocation
   * @private
   * @description Prompt the user to share his/her geo location (lat,long,accuracy)
   * If user consents then localize by GPS else Notify consumers and take no action.
   */
  var promptUserToShareGpsLocation = function() {
    getCurrentLocation().then(localizeByGPS, handleGpsError);
  }

  /**
   * Localizer Response
   * @type LocalizerResponse
   */
  var localizerResponse = {

    status: userService.status,

    getLocalizedStore: function() {
      return storeService.getStore();
    },

    getUserStore: function() {
      return storeService.getUserStore();
    }
  };

  /**
   ************** REMOVE THIS CLOSURE POST MIGRATION *************
   * This code is relevant only until migration to standardized localizer
   * This closure will be removed once all consumers migrate to new localizer.
   * This is to handle specific scenario like below:
   * Homepage is using old localizer and the user self localizes.
   * User navigates to PIP. PIP is using new localizer. since 'WORKFLOW' will not be present
   * in local storage, PIP reruns the localize again. So a self localized user will be
   * updated with a different store based on auto-localization in PIP page.
   *
   * To avoid this, workflow will be set on loading the new localizer module.
   * Now when PIP loads new localizer module, workflow will be set based on the existing
   * values set by the old localizer.
   *
   */
  (function() {

    /*
     * **** This code should be either in Header header.myaccount.js or MyAccount module ****
     * A work around for My Account. This method listens to updateUserStatus event
     * triggered by MyAccount. Upon user sign in this event is triggered. And user
     * should be updated to User's preferred store configured in his/her profile.
     * @param  {string} event name - updateUserStatus
     * @param {Function} event handler to localize by preferred store.
     */
    document.addEventListener('updateUserStatus', function() {
      var store = storeService.getStore();
      if(!!store) {
        var localizerRequest = { storeId: store.storeId, localizationMethod: 'my account sign-in' };
        localizeByStore(localizerRequest);
      }
    });

    function doWorkflowExists() {
      var workflow = userService.status.getWorkflow();
      return !!workflow;
    }

    var aliasToWorkflow = {
      'IP-DB:Corporate': 'KNOWN_LOCATION',
      'IP-DB:Store': 'THD_STORE_LOCATION',
      'IP-DB:History': 'LOC_HISTORY_BY_IP',
      'Default': 'DEFAULT',
      'IP-DB:Default Internal': 'DEFAULT_INTERNAL',
      'IP-DB:Vendor': 'GEO_LOCATION',
      'IP-DB:Similar History': 'LOC_HISTORY_BY_SUBNET',
      'ESVS:Store': 'THD_STORE_LOCATION',
      'in store access': 'THD_STORE_LOCATION',
      'change store overlay': 'LOCALIZED_BY_STORE'
    };
    // WORKFLOW doesn't exist (will not exist when localizer is loaded for first time
    // & yet to be localized Or consumers are using old localizer)
    if(!doWorkflowExists()
      // THD_FORCE_LOC is set
      && (userService.status.isSelfLocalized()
      || userService.status.isAutoLocalized()
      || userService.status.isDefaultLocalized()
      // THD_LOCSTORE is set
      || storeService.getStore())) {
      // THD_FORCE_LOC or THD_LOCSTORE are set without WORKFLOW, then it is guaranteed
      // that consumers are loading old localizer
      var localizationMethod = userStatus.__getLegacyLocalizationMethod();
      if(localizationMethod) {
        var workflow = aliasToWorkflow[localizationMethod] || 'LOCALIZED_BY_STORE';
        userOperations.setWorkflow(workflow);
        /*
        * There is change in definition of self localization.
        * Only iff user makes decision on store then its treated as self localization.
        * This corrects that definition for those using old localizer.
        */
        userOperations.setLocalizationMode(workflow);
      }
      /* 1. User lands on homepage and new localizer is run. workflow created.
       * 2. User navigates to PLP/PIP (using old localizer), and then self localizes using localization overlay.
       *    Localizer internal state is updated. But workflow is not updated.
       * 3. User navigates back to homepage (using standardized localizer) - WORKFLOW is updated.
       */
      else if(doWorkflowExists() & userService.status.isSelfLocalized()) {
          var workflow = userService.status.getWorkflow();
          var localizationMethod = userStatus.__getLegacyLocalizationMethod();
          if(workflow !== 'LOCALIZED_BY_STORE') {
            if(localizationMethod === 'change store overlay' ) {
              // Self localized on page (using old localizer). Hence updating the workflow
              userOperations.setWorkflow('LOCALIZED_BY_STORE');
            } else {
              // PIP changed localization mode in the backend. Updating in accordance with workflow.
              userOperations.setLocalizationMode(workflow);
            }
          }
      }
    }
  })();


  return {

    /**
     * @member events that localizer triggers
     * @type {Event}
     * @example
     * Localizer.on(Localizer.event.LOCALIZED, function(){})
     */
    event: event,

    /**
     * @member {Status} status - Status instance with methods to check the localization status.
     * Status indicating the mode of localization
     * @example
     * Localizer.status.isSelfLocalized()
     * @type {UserService.Status}
     */
    status: userService.status,

    /**
     * @function localize
     * @description  Allows user to either<br>
     * 1. Set the preferred store. <br>
     * 2. Set the closest store. <br>
     * 3. Set the defaults store #121
     *
     * @param {LocalizerRequest} request - Optional LocalizerRequest with storeId attribute
     * @example
     * 1. Localizer.localize({storeId: 121, localizationMethod:'Store finder'})
     * 2. Localizer.localize()
     * @fires  LOCALIZED
     * @return {Promise} promise - Promise wrapping Localizer Response
     */
    localize: function(request) {
      if (isRequestToSelfLocalize(request)) {
        return localizeByStore(request);
      }
      if (userStatus.isLocalized()) {
        return Promise.resolve(localizerResponse);
      }
      return new Promise(localizeByIp); // auto localize
    },

    /**
     * @function localizeFuzzy
     * @description Localizes user to the store ID passed provided <br>
     * the current existing accuracy is MEDIUM or LOW. It means that <br>
     * if user is auto/self/default localized with MEDIUM or LOW accuracy<br>
     * then override by self localizing the user again with the given store ID.
     * else resolve with the already localized store.<br>
     *
     * Note: This API should be used when caller is fuzzy about localizing
     * the user for the given store ID.
     * @example
     * Localizer.localizeFuzzy({storeId: 154, localizationMethod:'Store finder'});
     * @fires LOCALIZED
     * @param  {LocalizerRequest} request - Mandatory, LocalizerRequest with storeId attribute
     * @return {Promise} promise - Promise wrapping Localizer Response
     */
    localizeFuzzy: function(request) {
      if(isCurrentAccuracyMediumOrLow()) {
        return localizeByStore(request, 'LOCALIZED_BY_FUZZY_STORE');
      }
      return Promise.resolve(localizerResponse);
    },

    /**
     * @function GetLocalizedStore
     * @readOnly
     * @description Returns of the localized store.
     * @return {Store} store Localized Store
     */
    getLocalizedStore: function() {
      return storeService.getStore();
    },


    /**
     * @function getUserStore
     * @description If HD is accessed from one of the store location, this method returns the store
     * from where the user has accessed HD.com
     * @return {object} Store details
     */
    getUserStore: function() {
      return storeService.getUserStore();
    },

    /**
     * @function on
     * @description Allows consumers to subscribe to events from Localizer
     * @param  {array} events  Array of events callee wants to listen to.
     * @param  {object} eventHandler Handler to be invoked upon trigger of the event.
     * @example
     * 1. Localizer.on([Localizer.event.LOCALIZED, Localizer.event.LOCALIZED_BY_GPS], eventHandler(){})
     * 2. Localizer.on(Localizer.event.LOCALIZED, eventHandler(){})
     */
    on: function(events, eventHandler) {
      subscribe(events, eventHandler);
    },

    /**
     * @function off
     * @description Allows consumers to unsubscribe to events from Localizer
     * @param  {string} event event to be unsubscribed
     * @example
     * 1. Localizer.off(Localizer.event.LOCALIZED)
     */
    off: function(event) {
      unSubscribe(event);
    }
  }

});

define("localizer", ["cookie-utils","thd-event-emitter","es6-promise"], function(){});

(function(root, factory) {
  if (typeof define === 'function' && define.amd) {
    define('localizerConfig', [],function() {
        return factory(root);
      });
  } else {
    root.localizerConfig = factory(root);
  }
})(this, function(root) {

	var oneYear = 365*24*60*60*1000; // a year in milliseconds
	var sixHundredDays = 600*24*60*60*1000 // 600 days in milliseconds
	var session = 0;
	var oneHour = 60*60*1000 // an hour in milliseconds

	var localizerConfig = {
				storageConfig : {
					THD_INTERNAL: {
						LOCALIZED_BY_GPS_HIGH: 		{ storage : 'cookie', expiry: session },
						LOCALIZED_BY_STORE: 			{ storage : 'cookie', expiry: oneYear },
						LOCALIZED_BY_FUZZY_STORE: { storage : 'cookie', expiry: session },
						LOCALIZED_BY_DEFAULT: 		{ storage : 'cookie',	expiry: session },
						LOCALIZED_BY_GPS_MEDIUM: 	{ storage : 'cookie', expiry: session },
						LOCALIZED_BY_GPS_LOW: 		{ storage : 'cookie', expiry: session },
						THD_STORE_LOCATION: 			{ storage : 'cookie', expiry: session },
						KNOWN_LOCATION: 					{ storage : 'cookie', expiry: session },
						LOC_HISTORY_BY_IP: 				{ storage : 'cookie', expiry: session },
						LOC_HISTORY_BY_SUBNET: 		{ storage : 'cookie', expiry: session },
						GEO_LOCATION: 						{ storage : 'cookie', expiry: session },
						DEFAULT_INTERNAL: 				{ storage : 'cookie', expiry: session },
						DEFAULT: 									{ storage : 'cookie', expiry: session },
						DEFAULT_STORAGE: 					{ storage : 'cookie', expiry: session }
					},
					THD_FORCE_LOC: {
						LOCALIZED_BY_GPS_HIGH: 		{ storage : 'cookie', expiry: session },
						LOCALIZED_BY_STORE: 			{ storage : 'cookie', expiry: oneYear },
						LOCALIZED_BY_FUZZY_STORE: { storage : 'cookie', expiry: session },
						LOCALIZED_BY_DEFAULT: 		{ storage : 'cookie', expiry: session },
						LOCALIZED_BY_GPS_MEDIUM: 	{ storage : 'cookie', expiry: session },
						LOCALIZED_BY_GPS_LOW: 		{ storage : 'cookie', expiry: session },
						THD_STORE_LOCATION: 			{ storage : 'cookie', expiry: session },
						KNOWN_LOCATION: 					{ storage : 'cookie', expiry: session },
						LOC_HISTORY_BY_IP: 				{ storage : 'cookie', expiry: session },
						LOC_HISTORY_BY_SUBNET: 		{ storage : 'cookie', expiry: session },
						GEO_LOCATION: 						{ storage : 'cookie', expiry: session },
						DEFAULT_INTERNAL: 				{ storage : 'cookie', expiry: session },
						DEFAULT: 									{ storage : 'cookie', expiry: session },
						DEFAULT_STORAGE: 					{ storage : 'cookie', expiry: session }
					},
					THD_LOCSTORE: {
						LOCALIZED_BY_GPS_HIGH:  	{ storage : 'cookieCrumb', expiry: oneYear },
						LOCALIZED_BY_STORE: 			{ storage : 'cookieCrumb', expiry: oneYear },
						LOCALIZED_BY_FUZZY_STORE: { storage : 'cookieCrumb', expiry: oneYear },
						LOCALIZED_BY_DEFAULT: 		{ storage : 'cookieCrumb', expiry: oneYear },
						LOCALIZED_BY_GPS_MEDIUM: 	{ storage : 'cookieCrumb', expiry: oneYear },
						LOCALIZED_BY_GPS_LOW: 		{ storage : 'cookieCrumb', expiry: oneYear },
						THD_STORE_LOCATION: 			{ storage : 'cookieCrumb', expiry: oneYear },
						KNOWN_LOCATION: 					{ storage : 'cookieCrumb', expiry: oneYear },
						LOC_HISTORY_BY_IP: 				{ storage : 'cookieCrumb', expiry: oneYear },
						LOC_HISTORY_BY_SUBNET: 		{ storage : 'cookieCrumb', expiry: oneYear },
						GEO_LOCATION: 						{ storage : 'cookieCrumb', expiry: oneYear },
						DEFAULT_INTERNAL: 				{ storage : 'cookieCrumb', expiry: oneYear },
						DEFAULT: 									{ storage : 'cookieCrumb', expiry: oneYear },
						DEFAULT_STORAGE: 					{ storage : 'cookieCrumb', expiry: oneYear }
					},
					WORKFLOW: 									{ storage : 'cookie', 			 expiry: oneYear   },
					GPS_STATUS: 								{ storage : 'session', 		 expiry: undefined },
					localizationMethod: 				{ storage : 'local', 		 	 expiry: undefined },
					HTTP_URL: 									{ storage : 'http', 			 expiry: undefined },
					DEFAULT_STORAGE: 						{ storage : 'cookie', 		 expiry: session   },
					THD_INSTORE: 								{ storage : 'cookie', 		 expiry: session	 },
					THD_STORE_INFO:{
              LOCALIZED_BY_STORE: 		{ storage : 'cookie',      expiry: oneYear   },
              DEFAULT_STORAGE:        { storage : 'cookie', 		 expiry: session	 }
          },
					THD_STRFINDERZIP: 				  { storage : 'cookieCrumb', expiry: oneYear	 },
					THD_STORE_HOURS: 						{ storage : 'cookieCrumb', expiry: oneHour	 },
					loc_version: 								{ storage : 'session', 		 expiry: undefined },
					THD_CA_USER: 								{ storage : 'cookie', 		 expiry: sixHundredDays },
					THD_AUTOLOCINTERCEPT: 			{ storage : 'cookie', 		 expiry: sixHundredDays },

					// Some of the code is redundent, Added to support the migration. Can be cleaned up
					// once all consumers migrated to standardized localizer.
					get: function(key, workflow) {
						var storageConfig;
						// If key is not among the standard defined here, use cookie as default storage
						if(this[key] === undefined) {
							return this.DEFAULT_STORAGE;
						}
						if(!workflow) {
							/* If worklow is not defined, and the key is among the standard keys defined here
								 then use the default storage for that key.
							 */
							storageConfig = this[key].DEFAULT_STORAGE;
							/* If key is independent of the workflow, then key's value itself is storage config.
								 Eg: WORKFLOW, localization method etc.
							 */
							if(storageConfig === undefined) {
								storageConfig = this[key];
							}
						} else {
              // If key is defined and workflow is not defined (irrespective of any workflow), then use the default storage for that key
              if(this[key] && !this[key][workflow]) {
                storageConfig = this[key]['DEFAULT_STORAGE'];
              } else {
                // If key and workflow are defined and key is among the standard defined here
  							storageConfig = this[key][workflow];
              }
						}
						return storageConfig;
					}
				}
			}
	return localizerConfig;
})
;
/**
 * @module Repository Service
 * @param  {object} root    window/node global instance
 * @param  {function} factory Repository service factory
 * @return {RepositoryService} Repository Service instance
 */
(function(root, factory) {
  if (typeof define === 'function' && define.amd) {
    define('repositoryService', ['cookie-utils','es6-promise','localizerConfig'],
      function(cookieUtils, ES6PromisePolyfill, localizerConfig) {
        return factory(root, cookieUtils, ES6PromisePolyfill, localizerConfig);
      });
  } else {
    root.repositoryService = factory(root, window.cookieManager, ES6PromisePolyfill, localizerConfig);
  }
})(this, function(root, cookieUtils, ES6PromisePolyfill, localizerConfig) {

  var dataAccessStrategy = {};
  var Promise = Promise || ES6PromisePolyfill.Promise;

  /**
   * @function isExpired
   * @private
   * @description Checks if the value persisted in storage has expired or not.
   * @param  {object}  value value persisted in the storage.
   * @return {Boolean} true if the value is expired else false.
   */
  function isExpired(value) {
    var currentTime = new Date();
    return (value.createTime && value.expireTime !== undefined &&
      currentTime.getTime() - new Date(value.createTime).getTime() > value.expireTime);
  }

  /**
   * constant
   * @type {RegExp}
   */
  var urlPattern = /^http[s]{0,1}\:\/\/|^\/\/.+/; // http:// or https:// or //

  /**
   * @function isUrl
   * @private
   * @description Checks if the given key is URL or not.
   * @param  {string}  key key to be checked against URL pattern
   * @return {Boolean} true if the key is URL else false.
   */
  var isUrl = function(key) {
    return urlPattern.test(key);
  }

  /**
   * @private
   * @function cleanUp
   * @description Removes random function generated to receive callback and the script tags<br>
   * added in head tag.
   *
   * @param  {DomElement} script Script tag to be removed from the page.
   * @param  {function} generatedFunction random generated function to be removed from the window object.
   */
  var cleanUp = function(script, generatedFunction) {
    script.parentNode.removeChild(script);
    try {
      delete window[generatedFunction];
    } catch (e) {
      window[generatedFunction] = undefined;
    }
  }

  /**
   * @private
   * @function jsonp
   * @description Allows to invoke cross origin service for a given url.
   * @param  {string} url cross-origin service to be accessed.
   * @return {object} promise Promise, wrapping remote-service response
   */
  var jsonp = function(url) {
    return new Promise(function(resolve, reject) {
      url = url.indexOf('?') === -1 ? url + '?' : url + '&';
      var generatedFunction = 'loc' + Math.round(new Date().getTime() + Math.random() * 9999999);
      var script = document.createElement('script');
      script.src = url + 'callback=' + generatedFunction;
      document.getElementsByTagName("head")[0].appendChild(script);
      script.onerror = function(error) {
        cleanUp(script, generatedFunction);
        reject(error);
      }
      window[generatedFunction] = function(response) {
        cleanUp(script, generatedFunction);
        resolve(response);
      }
    });
  }

  /**
   * @private
   * @function isJson
   * @description Check if the given value is json or not.
   * @param  {object}  value value under test
   * @return {Boolean} true if value is json string else false.
   */
  var isJson = function(value) {
    if(typeof value === 'string') {
      try {
        JSON.parse(value)
      } catch(e) {
        return false;
      }
    }
    return true;
  }

 /**
   * @member
   * @description  Data Access Objects which read/writes to remote storage.
   * @type {Object}
   */
  dataAccessStrategy.httpDAO = {
    get: function(key) {
      return jsonp(key);
    },
    put: function(key, value, expireAfter, domain) {
      // to be implemented
    },
    remove: function(key) {
      // to be implemented
    }
  }

  cookieUtils.initializeCookieManager(window.THD_GLOBAL.cookieDomain);

  /**
   * @member
   * @description Data Access Objects which read/writes to cookie storage.
   * @type {Object}
   */
  dataAccessStrategy.cookieCrumbDAO = {

    get: function(key) {
      return cookieUtils.readCookie(key);
    },
    put: function(key, value, expireAfter, domain) {
      var expiryAfterDays = expireAfter/(24*60*60*1000);
      cookieUtils.createCookie(key, value, expiryAfterDays);
    },
    remove: function(key) {
      cookieUtils.cookieManager.removeCookie(key);
    }
  }

  /**
   * @member
   * @description Data Access Objects which read/writes to cookie storage.
   * @type {Object}
   */
  dataAccessStrategy.cookieDAO = {

    get: function(key) {
      return cookieUtils.readCookie(key);
    },
    put: function(key, value, expireAfter, domain) {
      if(expireAfter === 0) {
        cookieUtils.setSessionOnlyCookie(key, value, domain);
      } else {
        cookieUtils.setCookieExpireInSeconds(key, value, expireAfter/1000, domain);
      }
    },
    remove: function(key) {
      cookieUtils.cookieManager.removeCookie(key);
    }
  }

  /**
   * @member
   * @description Data Access Object which reads/writes to object on page.<br>
   * key/values stored using this strategy would exist only until next page refresh.
   * @type {Object}
   */
  dataAccessStrategy.pageDAO = {
    data : {},
    get: function(key) {
      return this.data[key];
    },
    put: function(key, value, expireTime, domain) {
      this.data[key] = value;
    },
    remove: function(key) {
      try {
        delete this.data[key];
      } catch(e) {
        this.data[key] = undefined;
      }
    }
  }


  /**
   * @member
   * @description Data Access Objects which read/writes to session storage
   * @type {Object}
   */
  dataAccessStrategy.sessionDAO = {
    get: function(key) {
      var value = sessionStorage.getItem(key);
      return isJson(value) ? JSON.parse(value) : value;
    },
    put: function(key, value, expireTime, domain) {
      if(typeof value === 'object') {
        sessionStorage.setItem(key, JSON.stringify(value), domain);
      } else {
        sessionStorage.setItem(key, value, domain);
      }
    },
    remove: function(key) {
      sessionStorage.removeItem(key);
    }
  }


  /**
   * @member
   * @description Data Access Objects which read/writes to local storage.
   * @type {Object}
   */
  dataAccessStrategy.localDAO = {

    get: function(key) {
      var value = localStorage.getItem(key);
      value = value && (isJson(value) && JSON.parse(value)) || value;
      if(value && isJson(value)) {
        return isExpired(value) ? localStorage.removeItem(key) : value.data;
      }
      return value;
    },

    put: function(key, value, expireTime, domain) {
      var wrapperValue = {
        'createTime': new Date()
      };
      wrapperValue.data = value;
      wrapperValue.expireTime = expireTime;
      localStorage.setItem(key, JSON.stringify(wrapperValue));
    },

    remove: function(key) {
      localStorage.removeItem(key);
    }
  }


  /**
   * @member
   * @description Storage strategies.
   * @type {Object}
   */
  var storage = {
    'cookieCrumb': dataAccessStrategy.cookieCrumbDAO,
    'cookie': dataAccessStrategy.cookieDAO,
    'http': dataAccessStrategy.httpDAO,
    'local': dataAccessStrategy.localDAO,
    'session': dataAccessStrategy.sessionDAO,
    'page': dataAccessStrategy.pageDAO
  }


   /**
   * @member
   * @description Key to Storage mapper. Maps a key to storage strategy.<br>
   * Any value to be store should be configured here.
   * @type {Object}
   */
  var workflowToStorageMapper = {
    storageConfig: localizerConfig.storageConfig,

    getDaoConfig: function(key, workflow) {
      return isUrl(key) ? this.storageConfig.get('HTTP_URL') :
         this.storageConfig.get(key, workflow);
    }
  }


  /**
   * @function getDao
   * @private
   * @description Returns the DAO instance. This can be Cookie, Local storage or Http.
   * @param  {String} key - Key whose value to be retrieved or written.
   * @param {string} storageStrategy - storage strategy key, optional, which allows consumer to choose the storage
   * @return {DataAccessObject}   Data Access Object.
   */
  var getDaoConfig = function(key, workflow) {
    return workflowToStorageMapper.getDaoConfig(key, workflow);
  };

  /**
   * @instance
   * @description Data Access Object Interface which chooses the storage strategy
   * based on the configuration.
   *
   * @type {object}
   */
  var dataAccessObject = {

    storageStrategy: storage,
    /**
     * @function get
     * @description Retrieves the value from the storage.
     * @param  {string} key key for the value to be retrieved.
     * @param {string} storageStrategy - storage strategy key, optional, which allows consumer to choose the storage
     * @return {object}   value for the given key.
     */
    get: function(key, workflow) {
      var daoConfig = getDaoConfig(key, workflow)
      var value = storage[daoConfig.storage].get(key);
      if(value === null || value === '' || value === 'undefined') {
        return undefined;
      }
      return value;
    },

    /**
     * @function put
     * @description Persists the value in the storage
     * @param  {string} key   key for the value to be persisted.
     * @param  {object} value  value to be persisted
     * @param  {long} expireAfter lifetime of the value.
     * ExpireAfter = 0  : Store only for a session
     * ExpireAfter = -1 : Store only for a page. Values do not exist between pages.
     * @param  {string} domain  domain under which value to be persisted.
     * @param {string} storageStrategy storage strategy key, optional, which allows consumer to choose the storage
     *
     */
    put: function(key, value, workflow) {
      var daoConfig = getDaoConfig(key, workflow);
      return storage[daoConfig.storage].put(key, value, daoConfig.expiry, window.THD_GLOBAL.cookieDomain);
    },

    /**
     * @function remove
     * @description Removes the value for the given key
     * @param  {string} key key for the value to be removed.
     * @param {string} storageStrategy - storage strategy key, optional, which allows consumer to choose the storage
     * @return {boolean} Returns true if the value successfully removed from storage else false.
     */
    remove: function(key, workflow) {
      var daoConfig = getDaoConfig(key, workflow);
      return storage[daoConfig.storage].remove(key);
    }
  }

  /**
   * Fix corrupted cookies
   */
  function fixLeadingZero() {
    var expireAfterDays = 1;

    try {
      var storeCrumb = cookieUtils.readCookie('THD_LOCSTORE');
      var storeId = storeCrumb.split('+')[0];

      if (storeId.substr(0, 1).indexOf('0') !== -1) {
        try {
          cookieUtils.readCookie('THD_PERSIST').split(':;').forEach(function(el, i){
            if (el.indexOf('C4_EXP') !== -1) {
              cookieUtils.createCookie('THD_LOCSTORE', storeCrumb.substr(1), 365);
              return;
            }
          })
        } catch (e) {}

      }
    } catch (e) {}
  }
  fixLeadingZero(); // Execute once

  /*
    ***************** Can be REMOVED in future ****************
    Pilot rollout of localizer persisted WORKFLOW in local storage.
    Since localstorage is not accessible across domains, this was a problem
    in browse and commerce pages. To mitigate cross domain access, WORKFLOW
    has been moved to cookie.
    Any page that had WORKFLOW in local storage will update the same to cookie.
    Any page that had no WORKFLOW will write to cookie.
  */
  function fixCrossDomainStorage() {
    var workflowCookie = dataAccessObject.get('WORKFLOW');

    if (!workflowCookie) {
      var workflow = dataAccessStrategy.localDAO.get('WORKFLOW');

      if (workflow) {
        dataAccessObject.put('WORKFLOW', workflow);
      }
    }
  };
  fixCrossDomainStorage();

  return dataAccessObject;

});

/**
 * @module LocalizationServiceProxy
 * @param  {object} root    Window/Node
 * @param  {function} factory  LocalizationServiceProxy factory
 * @return {LocalizationServiceProxy}  LocalizationServiceProxy
 */
(function(root, factory) {
  if (typeof define === 'function' && define.amd) {
    define('localizationServiceProxy', ['repositoryService'],
      function(repositoryService) {
        return factory(root, repositoryService);
      });
  } else {
      root.LocalizationServiceProxy = factory(root, repositoryService);
  }
})(this, function(root, repositoryService) {


  /**
   * Proxies localization-service
   * @type {LocalizationServiceProxy}
   */
  var localizationServiceProxy = {
    host: window.THD_GLOBAL.localizationApiHost,
    service: '/LocalizationService/v1/localstore',

    /**
     * @function GetStore
     * @description Call localization-service and get local store requested.
     * @readOnly
     * @param  {string} storeId Store to be retrieved.
     * @return {Promise<LocalizationResponse>} promise - Promise to resolve/reject Localization Response
     */
    getStore: function(storeId) {
      var localizationServiceUrl = this.host + this.service + '/' + storeId + '.jsonp' + '?show=metadata, localstore';
      return repositoryService.get(localizationServiceUrl);
    },

    /**
     * @function GetLocalStore
     * @readOnly
     * @description Call localization-service to get the local store closest to the user. <br>
     * Localization-service uses different mechanisms to localize the user and responds with local store and workflow.
     * 
     * @param  {Position} position - Position, an optional, holds user consent lat, long, accuracy.
     * @return {Promise<LocalizationResponse>} promise - Promise to resolve/reject Localization Response
     */
    getLocalStore: function(coordinates) {
      var localizationServiceUrl = this.host + this.service + '.jsonp?' + (coordinates ? 'latitude=' + coordinates.latitude + '&longitude=' + coordinates.longitude + '&accuracy=' + coordinates.accuracy + '&' : '') + 'show=metadata, localstore';
      return repositoryService.get(localizationServiceUrl);
    },

    /**
     * @function GetMetadata
     * @readOnly
     * @description Call localization-service to get the metadata, Metadata helps to determine if user is internal/external.
     * 
     * @return {Promise<LocalizationResponse>} promise - Promise to resolve/reject localization Response
     */
    getMetadata: function() {
      var localizationServiceUrl = this.host + this.service + '.jsonp?' + 'show=metadata';
      return repositoryService.get(localizationServiceUrl);
    }
  };

  return localizationServiceProxy;

});
/**
 * @module StatusService
 * @param  {object} root    window/node global
 * @param  {function} factory status service factory
 * @return {object}         Status service
 */
(function(root, factory) {
  if (typeof define === 'function' && define.amd) {
    define('statusService', ['repositoryService','localizationServiceProxy'], function(repositoryService, localizationServiceProxy) {
      return factory(root, repositoryService, localizationServiceProxy);
    });
  } else {
    root.StatusService = factory(root, repositoryService, localizationServiceProxy);
  }
})(this, function(root, repositoryService, localizationServiceProxy) {

  /**
   * @constant
   * @type {Array}
   */
  var INTERNAL_USERS = ['KNOWN_LOCATION', 'THD_STORE_LOCATION', 'DEFAULT_INTERNAL'];

  /**
   * @constant
   * @type {Array}
   */
  var EXTERNAL_USERS = ['LOC_HISTORY_BY_IP', 'LOC_HISTORY_BY_SUBNET', 'GEO_LOCATION', 'DEFAULT'];

  /**
   * @constant
   * @type {Array}
   */
  var GPS_WORKFLOW = ['LOCALIZED_BY_GPS_HIGH', 'LOCALIZED_BY_GPS_MEDIUM', 'LOCALIZED_BY_GPS_LOW'];

  var userService = {};

  /**
   * One year in milli seconds
   * @type {long}
   */
  var oneYear = 365*24*60*60*1000;
  var session = 0;
  var page = -1;

  /**
   * @member
   * @description A workflow is mapped to
   *   - Category Eg: Self/Auto/Default localized.<br>
   *   - Accuracy over other workflows.<br>
   *   - Alias name used to store workflow in digital data.
   * @type {WorkflowMapper}
   */
  var workflowMapper = {
    // client workflow
    LOCALIZED_BY_GPS_HIGH:    { category: '1', accuracy: 'HIGH',   alias: 'gps/html5/wi-fi|high'   },
    LOCALIZED_BY_STORE:       { category: '0', accuracy: 'HIGH',   alias: 'IP-DB:Self Localized'   },
    LOCALIZED_BY_FUZZY_STORE: { category: '0', accuracy: 'MEDIUM', alias: 'IP-DB:Self Localized'   },
    LOCALIZED_BY_DEFAULT:     { category: '2', accuracy: 'LOW',    alias: 'Default'                },
    LOCALIZED_BY_GPS_MEDIUM:  { category: '1', accuracy: 'MEDIUM', alias: 'gps/html5/wi-fi|med'    },
    LOCALIZED_BY_GPS_LOW:     { category: '1', accuracy: 'LOW',    alias: 'gps/html5/wi-fi|low'    },
    // service workflow
    THD_STORE_LOCATION:       { category: '1', accuracy: 'HIGH',   alias: 'IP-DB:Store'            },
    KNOWN_LOCATION:           { category: '1', accuracy: 'HIGH',   alias: 'IP-DB:Corporate'        },
    LOC_HISTORY_BY_IP:        { category: '1', accuracy: 'MEDIUM', alias: 'IP-DB:History'          },
    LOC_HISTORY_BY_SUBNET:    { category: '1', accuracy: 'LOW',    alias: 'IP-DB:Similar History'  },
    GEO_LOCATION:             { category: '1', accuracy: 'MEDIUM', alias: 'IP-DB:Vendor'           },
    DEFAULT_INTERNAL:         { category: '2', accuracy: 'LOW',    alias: 'IP-DB:Default Internal' },
    DEFAULT:                  { category: '2', accuracy: 'LOW',    alias: 'Default'                }
  }


  userService.workflowMapper = workflowMapper;

  var LOCALIZATION_VERSION_KEY = 'loc_version';
  var LOCALIZATION_VERSION_VALUE = 1.0;

  /**
   * @member UserService.status
   * @type {Object}
   */
  userService.status = {

    /**
     * @function isInternal
     * @description Returns true if the user localized is Internal else false.
     * Checks if workflow is known_loc/store_loc/customer_reps(default-internal) or
     * THD_INTERNAL cookie for 1.
     * @param  {String}  workflow - workflow, an Optional
     * @return {Boolean}  True if Internal else false
     */
    isInternal: function(workflow) {
      var workflow = userService.status.getWorkflow();
      return (workflow && INTERNAL_USERS.indexOf(workflow) !== -1)
        || repositoryService.get('THD_INTERNAL', workflow) === '1';
    },

    /**
     * @function isInternalAsync
     * @description This is async version of isInternal()
     * Invokes localization service to determine if user is internal or not.
     * Resolves a promise wrapping true if user is internal else rejects promise wrapping false.
     * @example
     * if(Localizer.status.isUnknownUser()) {
     *   Localizer.status.isInternalAsync().then(function(){
     *     // business logic
     *   })
     * }
     *
     * @return {Promise} Promise wrapping a boolean value.
     */
    isInternalAsync: function() {
      return new Promise(function(resolve, reject) {
        localizationServiceProxy.getMetadata().then(function(response) {
          if(INTERNAL_USERS.indexOf(response.metadata.workflow) !== -1) {
            userService.operations.markAsInternalUser();
            resolve(true);
          } else {
            userService.operations.markAsExternalUser();
            reject(false);
          }
        }, function(error) {
          reject(false);
        });
      });
    },

    /**
     * @function isExternal
     * @description Returns true if the user localized is External else false.
     * Checks if workflow is loc_history_ip/loc_history_subnet/geo-location/default or
     * THD_INTERNAL cookie for 0.
     * @param  {String}  [workflow] - localization workflow
     * @return {Boolean}  True if External else false
     */
    isExternal: function(workflow) {
      workflow = workflow || userService.status.getWorkflow();
      return (workflow && EXTERNAL_USERS.indexOf(workflow) !== -1)
        || repositoryService.get('THD_INTERNAL', workflow) === '0';
    },

    /**
     * @function isSelfLocalized
     * @description Returns true if the user self_localized/localized_by_store. Checks THD_FORCE_LOC for 0
     * @return {Boolean} True if user self localized else false.
     */
    isSelfLocalized: function() {
      var workflow = userService.status.getWorkflow();
      var thdForceLoc = repositoryService.get('THD_FORCE_LOC', workflow);
      return thdForceLoc === '0';
    },

    /**
     * @function isAutoLocalized
     * @description Returns true if the user auto_localized. Checks THD_FORCE_LOC for 1
     * @return {Boolean} True if user auto localized else false.
     */
    isAutoLocalized: function() {
      var workflow = userService.status.getWorkflow();
      var thdForceLoc = repositoryService.get('THD_FORCE_LOC', workflow);
      return thdForceLoc === '1';
    },

    /**
     * @function isDefaultLocalized
     * @description Returns true if the user default_localized. Checks THD_FORCE_LOC for 2
     * @return {Boolean} True if user default localized else false.
     */
    isDefaultLocalized: function() {
      var workflow = userService.status.getWorkflow();
      var thdForceLoc = repositoryService.get('THD_FORCE_LOC', workflow);
      return thdForceLoc === '2' || thdForceLoc === '';
    },

    /**
     * @function isUnknownUser
     * @description Returns true if the user neither internal nor external. Checks THD_INTERNAL is undefined or doesn't exist.
     * @return {Boolean} True if user default localized else false.
     */
    isUnknownUser: function() {
      var workflow = userService.status.getWorkflow();
      var value = repositoryService.get('THD_INTERNAL', workflow);
      return value === undefined;
    },

    /**
     * @function isLocalized
     * @description Returns true if user is localized.
     * Following values are verified before deciding on whether user is localized or not.
     * 1. THD_LOC_STORE cookie should be set
     * 2. THD_FORCE_LOC cookie should be set either 0 or 1
     * 3. THD_INTERNAL cookie should be set to either 0 or 1
     *
     * @return {Boolean} Returns true if user is localized else false.
     */
    isLocalized: function() {
      var workflow = userService.status.getWorkflow();
      var localStoreExists = repositoryService.get('THD_LOCSTORE', workflow) ? true : false
      return workflow && localStoreExists &&
      (this.isSelfLocalized() || this.isAutoLocalized() || this.isDefaultLocalized());
    },

    /**
     * @function isNotLocalized
     * @description Checks if the user is localized or not.
     * @see isLocalized
     * @return {Boolean} Returns true if user is not localized.
     */
    isNotLocalized: function() {
      return !this.isLocalized();
    },

    /**
     * @function isUserInStore
     * @description Returns true if user is accessing hd.com from store location else false
     * @todo Definition of InStore user might extend post geo-fencing implementation.
     * @return {Boolean} Returns true if user is in one of the HD stores
     */
    isUserInStore: function() {
      // supporting THD_INSTORE as is it set by Autlocalizer in header. Should be removed in future.
      // checking two source is not good !
      return this.getWorkflow() === 'THD_STORE_LOCATION'
      || repositoryService.get('THD_INSTORE') === 'TRUE';
    },

    /**
     * @function isUserInStoreAsync
     * @description This is async version of isUserInStore()
     * Resolves a promise wrapping true if user is accessing hd.com from store location else
     * a rejects a promise wrapping false
     * @example
     * if(Localizer.status.isSelfLocalized()) {
     *   Localizer.status.isUserInStore().then(function(){
     *     // business logic
     *   })
     * }
     * @return {Promise} Returns Promise wrapping true if user is in one of the HD stores
     */
    isUserInStoreAsync: function() {
      return new Promise(function(resolve, reject) {
        localizationServiceProxy.getMetadata().then(function(response) {
          if('THD_STORE_LOCATION' === response.metadata.workflow) {
            resolve(true);
          } else {
            reject(false);
          }
        }, function(error) {
          reject(false);
        });
      });
    },

    /**
     * @function getAccuracy
     * @description Returns the accuracy of the localization mode.<br>
     * 1. If user is self localized then localization mode is treated as HIGH accuracy.<br>
     * 2. If user is auto localized then localization mode is treated as HIGH, MEDIUM, LOW accuracy.<br>
     * 3. If user is default localized then localization mode is treated as LOW accuracy
     * @see workflowMapper
     * @return {string} Returns HIGH|MEDIUM|LOW accuracy of the current localization mode.
     */
    getAccuracy: function() {
      var workflow = repositoryService.get('WORKFLOW');
      return workflow && workflowMapper[workflow].accuracy;
    },

    /**
     * @function getWorkflow
     * @description Returns the workflow by which localization was resolved.
     * @return {string} Returns workflow
     */
    getWorkflow: function() {
      return repositoryService.get('WORKFLOW');
    },

    /**
     * @function getGpsStatus
     * @description Reads GPS_STATUS from storage.
     * @return {string} Returns GPS status Eg: gps access granted, gps access denied, gps timeout
     */
    getGpsStatus : function() {
      return repositoryService.get('GPS_STATUS');
    },

    /**
     * @function getLocalizationMethod
     * @description Returns an alias to the workflow. This is api intended for analytics
     * @return {string} Returns an alias to workflow.
     */
    getLocalizationMethod: function() {
      var workflow =  this.getWorkflow();
      return workflow ? workflowMapper[workflow].alias : '';
    },

    /**
     * @function getLegacyLocalizationMethod
     * @description This method is relevant only until the migration is completed.
     * This method will be removed once all consumers have migrated to new localizer.
     * ** DO NOT USE THIS METHOD ***
     * @return {string} Returns localization method
     */
    __getLegacyLocalizationMethod: function() {
      return repositoryService.get('localizationMethod');
    },

    /**
     * @deprecated This method shouldn't be used. This method most likely is not necessary.
     * Will be removed in future once all client consumes this standardized localizer.
     * @function isRunningUpdatedVersion
     * @description Checks if the client is running on latest version localization_version.
     * @return {boolean} Returns true if loc_version is less than or equal to localizatization version.
     */
    __isRunningUpdatedVersion : function() {
      var currentVersion = repositoryService.get(LOCALIZATION_VERSION_KEY);
      return userService.status.isInternal() && currentVersion !== null && currentVersion
            && Number(currentVersion) >= LOCALIZATION_VERSION_VALUE;
    }
  }

  /**
   * @member UserService.operations
   * @description User Service with methods to perform write operation.
   * @type {Object}
   */
  userService.operations = {

    /**
     * @function markAsInternalUser
     * @description Marks user as internal by setting THD_INTERNAL cookie to 1
     */
    markAsInternalUser: function() {
      var workflow = userService.status.getWorkflow();
      repositoryService.put('THD_INTERNAL', 1, workflow);
    },

    /**
     * @function markAsExternalUser
     * @description Marks user as external by setting THD_INTERNAL cookie to 0
     */
    markAsExternalUser: function() {
      var workflow = userService.status.getWorkflow();
      repositoryService.put('THD_INTERNAL', 0, workflow);
    },

    /**
     * @function setLocalizationMode
     * @description Sets the localization mode as Self/Auto/Default by setting THD_FORCE_LOC to either 0,1,2
     * @param {string} workflow workflow as returned by localization-service or client workflow.
     */
    setLocalizationMode: function(workflow) {
      this.setWorkflow(workflow);
      repositoryService.put('THD_FORCE_LOC', workflowMapper[workflow].category, workflow);
    },

    /**
     * @function setWorkflow
     * @description Persists the workflow in the storage.
     * @param {string} workflow - workflow to be persisted
     */
    setWorkflow: function(workflow) {
      repositoryService.put('WORKFLOW', workflow);

      /**
       * SHOULD BE REMOVED IN FUTURE
       * Persisting WORKFLOW in local storage too.
       */
      repositoryService.storageStrategy['local'].put('WORKFLOW', workflow, 365*24*60*60*1000);
    },

    /**
     * @function setGpsStatus
     * @description Persist gps status in storage
     * @param {string} gpsStatus GPS status Eg: gps access granted, gps access denied, gps timeout
     */
    setGpsStatus: function(gpsStatus) {
      repositoryService.put('GPS_STATUS', gpsStatus);
    },

    /**
     * @function markAsInStoreUser
     * @description Marks the user as in-store user.
     * @param  {string} workflow localization workflow
     */
    markAsInStoreUser: function(workflow) {
      if(workflow === 'THD_STORE_LOCATION') {
        // In the current system, THD_INSTORE cookie is set by AutoLocalizer service in header.
        repositoryService.put('THD_INSTORE', 'TRUE');
      }
    },

    /**
     * @function updateLocalizerVersion
     * @description Updates the localization version and persists in the storage.
     * This version helps to force run localization for internal users when there are changes
     * to localizer.
     */
    updateLocalizationVersion: function() {
      repositoryService.put(LOCALIZATION_VERSION_KEY, LOCALIZATION_VERSION_VALUE);
    },

    /**
     * @function markAsCanadianUser
     * @description If the user accesses HD.com from canada marks those users as canadian users
     * by setting CA_USER cookie
     */
    markAsCanadianUser: function() {
      repositoryService.put('THD_CA_USER', 1);
      repositoryService.put('THD_AUTOLOCINTERCEPT', 1);
    }
  }

  return userService;

});

(function(root, factory) {
	if (typeof define === 'function' && define.amd) {
		define('storeService', ['repositoryService','statusService'], function(repositoryService, userService) {
			return factory(root, repositoryService, userService);
		});
	} else {
		 root.StoreService = factory(root, repositoryService, userService);
	}
})(this, function(root, repositoryService, userService) {

	/**
	 * @constant
	 * @type {String}
	 */
	var storeStorageKey = 'THD_LOCSTORE';

	/**
	 * @member
	 * @description Default store #121 details
	 * @type {object}
	 */
	var defaultStore =  {
        storeId: '121',
        name: 'Cumberland',
        address: {
          postalCode: '30339',
          county: 'Cobb',
          state: 'GA',
          country: 'US',
          city: 'Atlanta',
          street: '2450 Cumberland Pkwy'
        },
        storeHours: {
          monday: { open: '6:00', close: '21:00' },
          tuesday: { open: '6:00', close: '21:00' },
          wednesday: { open: '6:00', close: '21:00' },
          thursday: { open: '6:00', close: '21:00' },
          friday: { open: '6:00', close: '21:00' },
          saturday: { open: '6:00', close: '21:00' },
          sunday: { open: '8:00', close: '19:00' }
        }
      };

  var days = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];

	var mapStoreHoursToString = function(storeHours) {
		var storeHoursInString = days.map(function(day, index) {
			return (index + 1) + ';' + storeHours[day].open + '-' + storeHours[day].close;
		}).reduce(function(concatenatedStoreHours, storeHours) {
			return concatenatedStoreHours ? (concatenatedStoreHours + ';' + storeHours) : storeHours;
		});
		return storeHoursInString;
	};

	var mapStringToStoreHours = function(storeHoursInString) {
		var storeHours = {};
		storeHoursInString
					.split(';')
					.filter(function(value, index) {
						return index %2 !== 0;
					}).map(function(openCloseHours) {
						var hours = openCloseHours.split('-');
						return {
							'open': hours[0], 'close' : hours[1]
						}
					}).forEach(function(openCloseHours, index) {
						var day = days[index];
						storeHours[day] = openCloseHours;
					});
		return storeHours;
	};

  /**
   * @module StoreService
   * @description Provides methods to get/set/remove store details in json format.
   * @type {Object}
   */
	var storeService = {

		/**
		 * @function GetDefaultStore
		 * @description Returns the default store details #121
		 * @return {object} Returns the default store #121
		 */
		getDefaultStore: function() {
			return defaultStore;
		},

		/**
		 * @function SetDefaultStore
		 * @description Persists default store #121
		 */
		setDefaultStore: function() {
			this.setStore(defaultStore);
		},

		/**
		 * @function SetStore
		 * @description Converts the subset of store information(json) to string format and
		 * persists in storage.
		 * @param {object} store - store to be persisted.
		 * @param {string} storageStrategy Optional parameter allows consumer to specify the storage method.
		 */
		setStore: function(store) {
			var workflow = userService.status.getWorkflow();
			var fixedStoreId = store.storeId.replace(/^0/, '');

			var storeDetails = JSON.stringify({
				storeId: fixedStoreId,
				name: store.name,
				street: store.address && store.address.street,
				city: store.address && store.address.city,
				state: store.address && store.address.state,
				zipcode: store.address && store.address.postalCode
			});
			var oneYearInMilliSeconds = 365*24*60*60*1000;
			// will be stored in C4. Hence the below transormation.
			storeDetails = fixedStoreId + '+' + store.name + ' - ' + store.address.city + ', ' + store.address.state + '+',
			repositoryService.put(storeStorageKey, storeDetails, workflow);
			// Store hours and zip code added to support migration.
			// These two cookies should be removed in future.
			repositoryService.put('THD_STRFINDERZIP', store.address.postalCode);
			var storeHoursInString = mapStoreHoursToString(store.storeHours);
			repositoryService.put('THD_STORE_HOURS', storeHoursInString);
			// if store user self localizes to different store, update store_info expiration
			if(userService.status.isUserInStore()) {
				if(userService.status.isSelfLocalized()) {
						var existingStoreDetails = repositoryService.get('THD_STORE_INFO');
						repositoryService.put('THD_STORE_INFO', existingStoreDetails, workflow); // same store, update expiration
				} else if(userService.status.isAutoLocalized()) {
						repositoryService.put('THD_STORE_INFO', storeDetails, workflow);
				}
			}
		},

		/**
		 * @function GetStore
		 * @description Reads the store details from storage, Parses to JSON.
		 * @param {string} storageStrategy Optional parameter allows consumer to specify the storage method.
		 * @return {object} Returns the store
		 */
		getStore: function(workflow) {
			var workflow = userService.status.getWorkflow();
			var store = workflow && repositoryService.get(storeStorageKey, workflow);
			var zipCode = repositoryService.get('THD_STRFINDERZIP');
			var storeHours = repositoryService.get('THD_STORE_HOURS');
			storeHours = storeHours && mapStringToStoreHours(storeHours);

			if(store) {
				var storeDetails = store.split('+');

				try {
					var storeNameAndCityState = storeDetails[1];
					var dashCount = storeNameAndCityState.split('-').length - 1;

					if (dashCount === 1) {
						return {
							storeId: storeDetails[0],
							name: storeDetails[1].split('-')[0].trim(),
							city: storeDetails[1].split('-')[1].split(',')[0].trim(),
							state: storeDetails[1].split('-')[1].split(',')[1].trim(),
							zipcode: zipCode,
							storeHours: storeHours
						}
					} else {
						var lastIndexOf = storeNameAndCityState.lastIndexOf(' - ');
						var name = storeNameAndCityState.substr(0, lastIndexOf);
						var cityState = storeNameAndCityState.substr(lastIndexOf + 3); // Add 3 because of lengt of " - "

						return {
							storeId: storeDetails[0],
							name: name,
							city: cityState.split(',')[0].trim(),
							state: cityState.split(',')[1].trim(),
							zipcode: zipCode,
							storeHours: storeHours
						}
					}
				} catch (ex) {
						// *** Remove this catch block post migration ***
						// unfortunately my account persists store details in different format.
						// Ideally my account shouldn't really update store details. This shouldn't happen post migration.
						// Ex: 6553+Howard Lane+-+Austin,+TX+ (Incorrect format)
						return {
							storeId: storeDetails[0],
							name: storeDetails[1].trim(),
							city: storeDetails[3].split(',')[0].trim(),
							state: storeDetails[4],
							zipcode: zipCode,
							storeHours: storeHours
						}
				}
			}

			return store;
		},

		 /**
     * @function getUserStore
     * @description If HD is accessed from one of the store location, this method returns the store
     * from where the user has accessed HD.com
     * @return {object} Store details
     */
		getUserStore: function() {
			var store = repositoryService.get('THD_STORE_INFO');
			if(!store) {
				return undefined;
			}
			var storeDetails = store.split('+');
			return {
				storeId: storeDetails[0],
				name: storeDetails[1].split('-')[0].trim(),
				city: storeDetails[1].split('-')[1].split(',')[0].trim(),
				state: storeDetails[1].split('-')[1].split(',')[1].trim()
			}
		},

		/**
		 * @function RemoveStore
		 * @description Removes the store details from the storage.
		 * @param {string} storageStrategy Optional parameter allows consumer to specify the storage method.
		 * @return {boolean} true if store details successfully removed else false.
		 */
		removeStore: function() {
			var workflow = userService.status.getWorkflow();
			repositoryService.remove(storeStorageKey, workflow);
		}
	}

	return storeService;
});


(function(root, factory) {
  root.THD = root.THD || {};
  root.THD.Analytics = root.THD.Analytics || {};
  if (typeof define === 'function' && define.amd) {
    define('digitalData',['jquery', 'cookie-utils', 'Localizer'], function(jQuery, cookieUtils, Localizer) {
      return factory(jQuery, cookieUtils, Localizer, root);
    });
  } else {
    root.THD.Analytics.GlobalDDO = factory(root.jQuery, cookieUtils, Localizer, root);
  }
})(this, function($, cookieUtils, Localizer, root) {
  root.digitalData = root.digitalData || {};
  root.digitalData.event = root.digitalData.event || [];
  root.digitalData.legacy = root.digitalData.legacy || {};

  // helper to fetch specific named cookies
  function getCookieVal(cookieName) {
    if (!cookieName) {
      return null;
    }
    return (
      decodeURIComponent(
        root.document.cookie.replace(
          new RegExp(
            '(?:(?:^|.*;)\\s*' +
              encodeURIComponent(cookieName).replace(/[\-\.\+\*]/g, '\\$&') +
              '\\s*\\=\\s*([^;]*).*$)|^.*$'
          ),
          '$1'
        )
      ) || null
    );
  }

  /* --------------------------------------------------------------------
		Doing this temporarly so we can support all
		channels.  evenutally need to pull in common
		module to read cookie data

		cookieArgs = {
			name: "",		// string ~ cookie name ~ required
			crumb: ""		// string ~ cookie crumb ID= (e.g. C4=)
			delimiter: ""	// string (e.g. ; or space character)
		};
	---------------------------------------------------------------------- */
  function parseCookie(cookieArgs) {
    var cookieVal = getCookieVal(cookieArgs.name),
      cookieLength,
      i;

    if (!cookieVal) return null;

    if (cookieArgs.hasOwnProperty('delimiter')) {
      cookieVal = cookieVal ? cookieVal.split(cookieArgs.delimiter) : '';

      cookieLength = cookieVal.length;

      for (i = cookieLength - 1; i >= 0; i -= 1) {
        if (cookieVal[i].indexOf(cookieArgs.crumb) !== -1) {
          return cookieVal[i].split('=')[1];
        }
      }
      // if the code does not return by this point
      // the value looked for is not there and should
      // return null.
      return null;
    }

    return cookieVal;
  }

  // Should belong in cookie-utils but only THD_CUSTOMER
  // is decoded for global analytics
  function getJWTPayload(cookie) {
    if (cookie) {
      var JWT = cookie.split('.');
      return JWT.length === 3 ? JWT[1] : JWT[0];
    }

    return null;
  }

  function parseJWTCookie(cookieName) {
    var JWT = cookieUtils.readCookie(cookieName);
    var JWTPayload = getJWTPayload(JWT);

    try {
      return JSON.parse(window.atob(JWTPayload));
    } catch(err) {
      return null;
    }
  }

  /*
		Gets WCS Cookies that have dynamic names (e.g. WC_USERACTIVITY_<RANDOMNUMBER>)
		The cookieAlias would be something like: WC_USERACTIVITY_
	---------------------------------------------------------------------------*/
  function parseWCSCookie(cookieAlias) {
    var browserCookies = root.document.cookie.split('; '),
      allCookies = browserCookies.length,
      i,
      wcsCookie;

    for (i = allCookies - 1; i >= 0; i -= 1) {
      if (browserCookies[i].indexOf(cookieAlias) === 0) {
        wcsCookie = browserCookies[i].split('=')[0];
        wcsCookie = getCookieVal(wcsCookie);

        if (wcsCookie) {
          return wcsCookie.split(',')[0];
        }
      }
    }
  }

  /* Setting storage to capture persistant methods
	--------------------------------------------------------*/
  root.THD.Analytics.setStorage = function(msg) {
    try {
      root.localStorage.setItem('localizationMethod', msg);
    } catch (e) {
      return;
    }
  };

  /*
		returns text string for mobile /tablet/desktop/mobile
	---------------------------------------------------------------------------*/
  function getExperienceType() {
    var channelString = '';
    if (typeof THD_GLOBAL !== 'undefined' && THD_GLOBAL.channel === 'mobile') {
      channelString = 'mobile';
    }
    if (channelString === '') {
      channelString = /ipad/i.test(root.navigator.userAgent)
        ? 'tablet'
        : 'desktop';
    }

    return channelString;
  }

  function isUserLoggedIn() {
    if (
      cookieUtils.readCookie('THD_USER') &&
      cookieUtils.readCookie('THD_USER_SESSION')
    ) {
      return 'authenticated';
    } else if (
      cookieUtils.readCookie('THD_USER') &&
      !cookieUtils.readCookie('THD_USER_SESSION')
    ) {
      return 'persisted';
    } else {
      return 'guest';
    }
  }

  /* returns the Global Digital Data Object
	------------------------------------------------ */
  return {
    // Either expose private methods to fully test, or remove completely and not test
    __private__: {
      parseJWTCookie: parseJWTCookie,
      getJWTPayload: getJWTPayload
    },
    init: function init() {
      // Removed singleton as it was breaking single
      // page apps like checkout.
      // @TODO add back and create new method for single
      // page apps such as `.refesh`.
      var isB2BCustomer =
        cookieUtils.hasBrowserCookie('THD_CUSTOMER') &&
        Boolean(parseJWTCookie('THD_CUSTOMER'));

      if (!cookieUtils.cookieManager) {
        cookieUtils.initializeCookieManager();
      }

      var _DDO = root.digitalData,
        inStoreUser,
        storeNumber,
        userStatus,
        geoLocalized,
        geoText = '';
      window.THD.Analytics._DDO = _DDO;

      // define site globals
      _DDO.site = {
        experienceType: getExperienceType(),
        siteId: '',
        betaSite: (function() {
          var site = parseCookie({ name: 'HD_DC' });
          return site === 'origin' ? 'prod' : site === 'beta' ? 'beta' : '';
        })()
      };

      // define setStorage
      _DDO.setStorage = function(msg) {
        try {
          root.localStorage.setItem('localizationMethod', msg);
          root.digitalData.user.localization.method = msg;
        } catch (e) {
          return;
        }
      };

      // define user globals
      _DDO.user = {
        profile: {
          authenticationStatus: !isB2BCustomer ? isUserLoggedIn() : '',
          profileInfo: {
            profileID: !isB2BCustomer ? cookieUtils.getSVOCID() : ''
          }
        },
        localization: {
          storeNumber: (function(){
            var store = Localizer.getLocalizedStore();
            return store ? store.storeId : 'not localized';
          })(),

          storeState: (function(){
            var store = Localizer.getLocalizedStore();
            return store ? store.state : '';
          })(),

          gpsPermission: Localizer.status.getGpsStatus(),

          storeZip: (function(){
            var store = Localizer.getLocalizedStore();
            return store ? store.zipcode : '';
          })(),

          method: Localizer.status.getLocalizationMethod()
        }
      };

      // Capture B2B Analytics Globally
      if (isB2BCustomer) {
        var thdCustomer = parseJWTCookie('THD_CUSTOMER');
        _DDO.site.siteId = 'b2bSite';
        _DDO.site.businessType = thdCustomer.c;

        _DDO.user.b2bProfile = {
          userType: thdCustomer.r,
          userID: thdCustomer.u,
          accountID: thdCustomer.t,
          userTradeType: thdCustomer.g
        };

        _DDO.user.profile.authenticationStatus =
          thdCustomer.v &&
          new Date().getTime() - thdCustomer.v > 3600000
            ? 'persisted'
            : 'authenticated';

        _DDO.user.profile.profileInfo.profileID =
          thdCustomer.t;
      }

      // capture the legacy WCS User ID
      // var WCSID = parseWCSCookie("WC_USERACTIVITY_");
      // _DDO.legacy.profileID = WCSID ? WCSID : '';

      // localization
      inStoreUser = Localizer.status.isUserInStore();

      if (_DDO.user.profile.authenticationStatus === 'authenticated') {
        _DDO.user.localization.method = 'my account sign-in';
        root.THD.Analytics.setStorage('my account sign-in');
      }

      if (inStoreUser) {
        _DDO.user.localization.method = 'in store access';
        root.THD.Analytics.setStorage('in store access');
      }

      Localizer.on(Localizer.event.LOCALIZED, function() {
        var store = Localizer.getLocalizedStore();
        _DDO.user.localization.storeNumber = store ? store.storeId : 'not localized';
	      _DDO.user.localization.storeState = store ? store.state: '';
	      _DDO.user.localization.storeZip = store ? store.zipcode : '';
	      _DDO.user.localization.method = Localizer.status.getLocalizationMethod();
	      _DDO.user.localization.gpsPermission = Localizer.status.getGpsStatus();
      });

      // emit event notifying that our global ddo is set
      $(root.document).trigger('globalDDOready', _DDO);

      return _DDO;
    },
    get: function get() {
      return root.digitalData;
    }
  };
});

/*--------------------------------------------------------------------------------
	New, Safe Logging Code, JNH 11-28-2012
	Usage: THD.log('Message', variable);
	To turn logging on or off just set THD.isLogging
--------------------------------------------------------------------------------*/
(function closure(root, factory) {
	if(typeof define === 'function' && define.amd) {
		define('global.logging',['global.namespace'],
			function load(THD) {
				return factory(THD);
			});
	} else{
		// For non-AMD module, expose this to global (will also be useful for test cases)
		/* eslint-disable*/
		THD.log = factory(THD).log;
		/*eslint-enable*/
	}
})(this, function factory(THD) {
	THD.isLogging = false;
	THD.log = function log() {
		var logArgs = Array.prototype.slice.call(arguments); /* Fix for ION-1733 */

		// Based on code from: https://github.com/cpatik/console.log-wrapper/blob/master/consolelog.js
		// Tell IE9 to use its built-in console
		if (Function.prototype.bind && (typeof console === 'object' || typeof console === 'function') && typeof console.log === 'object') {
			if (Array.prototype.forEach) {
				['log', 'info', 'warn', 'error', 'assert', 'dir', 'clear', 'profile', 'profileEnd'].forEach(function each(method) {
					console[method] = this.call(console[method], console);
				}, Function.prototype.bind);
			}
		}

		// Modern browsers
		if (typeof console !== 'undefined' && typeof console.log === 'function') {
			return function logger() {
				if (THD.isLogging) {
					// Single argument, which is a string
					if (logArgs.length === 1 && typeof logArgs[0] === 'string') {
						console.log((logArgs).toString());
					} else {
						console.log(logArgs);
					}
				}
			};
		}

		// Check IE8 - Originally used !Function.prototype.bind && as well, but prevented logging in IE9 with 7 compat
		if (typeof console !== 'undefined' && typeof console.log === 'object') {
			return function logger() {
				if (THD.isLogging) {
					Function.prototype.call.call(console.log, console, logArgs);
				}
			};
		}
		return function() {};
	};

	return {
		log: THD.log
	};
});


/* ---------------------------------------------------------------------------------------
	THD Global localization Module
-----------------------------------------------------------------------------------------*/
// localization popup

(function closure(root, factory) {
	if(typeof define === 'function' && define.amd) {
		define('localizationPopup',[
			'jquery',
			'global.namespace',
			'global.utility',
			'digitalData',
			'cookie-utils',
			'utils.url',
			'global.logging',
			'Localizer'
		], function load($, THD, globalUtility, digitalData, cookieUtils, utilsUrl, thdLogger, Localizer) {
			return factory(root, $, THD, globalUtility, digitalData, cookieUtils, utilsUrl, thdLogger, Localizer);
		});
	} else {
		// For non-AMD module, expose this to global (will also be useful for test cases)
		/* eslint-disable*/
		root.localizationPopup = factory(root, jQuery, THD, THD.Global.Config, digitalData, cookieUtils, THD.Utils.Url, THD.log, THD.Localizer);
		/*eslint-enable*/
	}
})(this, function factory(root, $, THD, globalUtility, digitalDataWrapper, cookieUtils, utilsUrl, thdLogger, Localizer) {
	'use strict';
	// This is so that we can do unit testing in a Node environment, without a Browser.
	if(!window){
		var window = (typeof global !== 'undefined') ? global.window : (root ? root.window : null);
	}
	if(!window){
		throw new Error("Window object is required");
	}

	var loc = THD.Utility.Namespace.createNamespace('THD.Widget.LocalizationModal');

	loc.buildLocalizationContainer = function buildLocalizationContainer() {
		var locContr = ['<div id="sfModalContainer" class="">',
							'<div id="sfHeader">',
								'<h1 class="modal_title">Change Your Local Store</h1>',
							'</div>',
							'<div id="sfContents" class="modal_contents">',
								'<div id="sfYourStore" class="sfStoreLocal"></div>',
								'<div class="clear"></div>',
								'<div id="sf_search_bar">',
									'<form id="frmStoreFinder">',
										'<fieldset id="fsStoreFinder">',
											'<label class="control-label" id="lblFindStore"></label>',
											'<div id="divStoreFinderBox" class="sf-control-group">',
												'<label for="txtStoreFinder" id="lblStoreFinder" class="control-label labelRemove">Enter your ZIP Code -OR- City and State</label>',
												'<div class="sf-controls">',
													'<input type="text" maxlength="60" tabindex="18" id="txtStoreFinder" autocomplete="off">',
												'</div>',
											'</div>',
											'<div id="divStoreFinderBtn" class="sf-control-group">',
												'<div class="sf-controls">',
													'<button value="StoreFinder" class="btn btn-orange btn-icon" id="btnStoreFinder"><i class="icon-search"></i></button>',
												'</div>',
											'</div>',
										'</fieldset>',
									'</form>',
								'</div>',
								'<div id="StoreFinderResultSet">',
									'<p class="sfSugHeader"></p>',
									'<div id="sfStoreList"></div>',
								'</div>',
							'</div>',
						'</div>',
						'<div id="thdFeedBackLocOverlay"></div>',
						'<div id="sfFooter"><a id="hlViewStoreFinder" class="b">View Store Finder<i class="icon-carrot-orange"></i></a>',
						'</div>',
						'<div style="clear:both"><br/></div>'].join('\n');

		$('#localizationModalContent').html(locContr);
	};

	var formatTime = function(hours, mins, am_or_pm) {
    return hours + ":" + mins + am_or_pm;
  }
	/**
   * Convert time from 24 hours format to 12 hours format
   * @param  {String} hh_mm hours and minutes in hh:mm format
   * @return {String}       Formated string in 12Hrs format
   */
  var convertTo12HrFormat = function(hh_mm) {
    if (hh_mm) {
      var hours = Number(hh_mm.split(':')[0]);
      var mins = hh_mm.split(':')[1];
      if(hours === 12) {
      	return formatTime(12, mins, 'pm');
      }
      if (hours > 12) {
        return formatTime((hours - 12), mins, 'pm');
      } else {
        return hours === 0 ? formatTime(12, mins, 'am') : formatTime(hours, mins, 'am');
      }
    }
    return hh_mm;
  }

	var formatStoreHours = function(storeHours) {
		var days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
		return days.map(function(day) {
				var open = storeHours[day].open;
				var close = storeHours[day].close;
				if(open === '0:00' && close === '0:00') {
					return 'Closed';
				}
				return convertTo12HrFormat(open) + '-' + convertTo12HrFormat(close);
			})
			.reduce(function(accumulator, current, index) {
				if (index === 0 || accumulator[accumulator.length - 1].value !== current) {
					return accumulator.concat({
						value: current,
						first: index,
						last: index
					});
				}
				accumulator[accumulator.length - 1].last++;
				return accumulator;
			}, [])
			.map(function(result) {
				var first = days[result.first].substring(0, 3);
				var last = days[result.last].substring(0, 3);
				var dayHours = {};
				if (result.first === result.last) {
					dayHours.day = first[0].toUpperCase() + first.slice(1);
					dayHours.hours = result.value;
				} else {
					dayHours.day = first[0].toUpperCase() + first.slice(1) + '-' + last[0].toUpperCase() + last.slice(1);
					dayHours.hours = result.value;
				}
				return dayHours;
			})
			.reduce(function(accumulator, dayHour, index, dayHours) {
				accumulator += '<span><strong>' + dayHour.day + ':</strong> ' + dayHour.hours + '</span>';
				accumulator += (index < dayHours.length - 1) ? ', ' : '';
				accumulator += ((index + 1) % 2 === 0) ? '<br />' : '';
				return accumulator;
			}, '');
	}

	var storeSearchServiceProxy = (function() {
		var MAX_RESULTS = 30;
		var host = '//' + THD_GLOBAL.storeSearchServiceHostName;
		var service = '/StoreSearchServices/v2/storesearch';

		function http(queryParams) {
			var deferred = $.Deferred();
			$.ajax({
				url: host + service + '?' + queryParams,
				dataType: 'jsonp',
				success: function success(json) {
					deferred.resolve(json);
				},
				error: function error(err) {
					loc.printErrorMsgs();
					THD.log('error function error: ' + err);
					THD.log('error function searchParams: ' + searchParams);
					deferred.reject(err);
				}
			});
			return deferred.promise();
		}

		return {
			searchStoreById: function(storeId) {
				var queryParam = 'storeid=' + storeId;
				return http(queryParam);
			},

			searchStoresByCooridnates: function(latitude, longitude, radius) {
				var queryParams = 'latitude=' + latitude + '&longitude=' + longitude + '&radius=' + radius + '&pagesize=' + MAX_RESULTS;
				return http(queryParams);
			},

			searchStoreByAddress: function(address, radius) {
				var queryParams = 'address=' + address + '&radius='+ radius + '&pagesize=' + MAX_RESULTS;
				return http(queryParams);
			}
		}
	}());


	loc.getHost = function() {
		return window.location.host;
	}

	// getStores and list them to the user
	loc.getStores = function getStores(json, userInputAddress) {
		var parsedData = '';
		var cookieDomain = globalUtility.getHostNameNonSecure();
		var h = 0;
		var storeResultsh = 0;
		var userLocalStoreID = loc.getUserLocalStore();
		var buttonClass;
		var storeHoursText;
		var storeFinderURL;
		var buttonText;
		var makeMyStore = '';
		var storeHoursList;

		$.each(json.stores, function ea(i, item) {
			if((Number(item.storeId) !== Number(userLocalStoreID) && Localizer.status.isSelfLocalized()) || Localizer.status.isAutoLocalized() || Localizer.status.isDefaultLocalized()) {
				h += 1;
				storeResultsh = h;
				buttonClass = 'bttn-outline--dark bttn--inline';
				buttonText = 'Make this your store';
				storeHoursList = formatStoreHours(item.storeHours);

				if (item.address.country === 'US' && item.storeType !== 'hddc') {
					makeMyStore = '<a href="#" class="' + buttonClass + '" rel="MakeMyStore" data-storezip="' + item.address.postalCode + '" data-storeinfo="' + item.name + '+' + item.storeId + ' - ' + item.address.city + ', ' + item.address.state + '" data-storeid=' + item.storeId + '><span class="bttn__content">' + buttonText + '</span></a>';
				} else {
					makeMyStore = '';
				}
				if (item.storeType === 'hddc') {
					item.url = '/c/designcenter';
				}

				storeHoursText = '<div class="time">' + storeHoursList + '</span></div></div></div>';
				parsedData += '<div class="sfStoreRow"><i class="dwarf-sfOff">' + h + '</i><span class="sfMakeThisMyStore">' + makeMyStore + '</span><div class="vcard sfStoreDetails"><div class="org"><span class="sfStoreName"><a href="//' + cookieDomain + item.url + '">' + item.name + ' #' + item.storeId + '</a></span><span class="sfDistance"> (' + parseFloat(item.distance).toFixed(2) + ' mi)</span></div><div class="adr"><span class="street-address">' + item.address.street + '</span><span class="locality">' + item.address.city + '</span>, <span class="region">' + item.address.state + ' </span><span class="postal-code">' + item.address.postalCode + ' </span><span class="b">| <a class="sfhlViewonmap" href="//' + cookieDomain + '/StoreFinder/index.jsp?storeId=' + item.storeId + '">View On Map<i class="icon-carrot-orange"></i></a></span></div><div class="tel"><span class="type b">Phone: </span><span class="value">' + item.phone + ' </span></div>' + storeHoursText;
			}
		});

		$('#StoreFinderResultSet p')
			.text(storeResultsh + ' stores within 50 miles of ' + $.trim(userInputAddress))
			.removeClass('sfRowsHeader sfSugHeader')
			.addClass('sfRowsHeader');

		$('#sfStoreList')
			.html(parsedData)
			//.scrollTop(0);

		storeFinderURL = '//' + cookieDomain + '/StoreFinder/index.jsp?storeId=' + userInputAddress;

		$('#hlViewStoreFinder').attr('href', storeFinderURL);
	};

	function getCityState(address) {
		var cityState = [];
		if (address.city) {
			cityState.push(address.city + ', ');
		}
		if (address.county) {
			cityState.push(address.county + ', ');
		}
		if (address.state) {
			cityState.push(address.state);
		}
		return cityState.join('');
	}

	loc.getSuggestions = function getSuggestions(json) {
		var parsedData = '';
		var storeFinderURL = '';
		var cookieDomain = globalUtility.getHostNameNonSecure();
		var  dataPostalCode = '';
		var dataCityState = '';
		var dataToPass = '';
		var dataAddress;

		if (json.ambiguousAddresses[0] && json.ambiguousAddresses[0].suggestedLocations &&
			json.ambiguousAddresses[0].suggestedLocations !== 0 ) {
			var suggestedAddresses = json.ambiguousAddresses[0].suggestedLocations;
			parsedData += '<ul id="ulSug">';

			$('#StoreFinderResultSet p')
				.removeClass('sfRowsHeader sfSugHeader')
				.addClass('sfSugHeader')
				.text('Did you mean:');

			$.each(suggestedAddresses, function ea(i, item) {
				parsedData += '<li><a href="#" data-lat="' + item.point.coordinates.lat + '" data-lon="' + item.point.coordinates.lng + '" data-citystate="' + getCityState(item.address) + '"data-postalcode="' + item.address.postalCode +'">' + item.address.formattedAddress + '</a></li>';
			});
			parsedData += '</ul>';

			$('#sfStoreList').on('click', '#ulSug a', function click(e) {
				var $this = $(this);
				var dymData = $this.data();

				dataPostalCode = dymData.postalcode;
				dataCityState = dymData.citystate;

				dataAddress = (dataCityState === '' || dataCityState === null || dataCityState === undefined)
					? dataPostalCode
					: dataCityState;

				// populates text field with what the user clicked and runs the printStores function
				$('#txtStoreFinder').val(dataAddress);

				dataToPass = '' + dymData.lat + ',' + dymData.lon + '';
				var request = {
					latitude : dymData.lat,
					longitude : dymData.lon,
					radius : 50,
					maxMatches: 30
				}
				storeSearchServiceProxy
					.searchStoresByCooridnates(dymData.lat, dymData.lon, 50)
					.then(function(json) {
					 		loc.printStoreResults(json, dataToPass);
					});

				e.preventDefault();
			});
		} else {
			loc.printErrorMsgs('noStores');
		}

		$('#sfStoreList').html(parsedData);

		storeFinderURL = '//' + cookieDomain + '/StoreFinder/index.jsp';
		$('#hlViewStoreFinder').attr('href', storeFinderURL);
	};

	// getUserLocalStore get's user store if they are already localized
	loc.getUserLocalStore = function getUserLocalStore() {
        var locStoreAddress = Localizer.getLocalizedStore();
        if (locStoreAddress) {
            $('#lblStoreFinder').css('display', 'none');
        }
        return locStoreAddress && locStoreAddress.storeId;
	};

	// For Analytics information
	loc.setDataCollectors = function setDataCollectors(analyticType, userLocalStoreID) {
		var _hddata = window._hddata || {};
		var msg = 'change your local store';
		var sf = 'store finder';
		// var experienceType = cookieUtils.readCookie('THD_USERTYPE');

		_hddata.contentSubCategory = sf + '>' + msg;
		_hddata.contentCategory = sf + '>' + msg;
		_hddata.pageType = 'tool';
		_hddata.pageName = sf + '>' + msg;
		_hddata.siteSection = sf;
		_hddata.overlayType = 'local store';

		if (analyticType === 'notLocal') {
			_hddata.AJAX = 'changeStore';
		}

		if (analyticType === 'localized') {
			_hddata.localStoreNum = userLocalStoreID;
			_hddata.AJAX = 'setStore';
		}

		if (window.hddataReady) {
			window.hddataReady();
		}

		window.ishddataReady = true;
	};

	// getUserLocalStoreId get's user store if they are already localized (think about mkain' this provate)
	loc.setUserLocalStore = function setUserLocalStore(storeID) {
		storeSearchServiceProxy.searchStoreById(storeID).then(function(storeDetails) {
			loc.printUserLocalStore(storeDetails);
		});

    var localizerRequest = { storeId: storeID, localizationMethod: 'change store overlay'};
    Localizer.localize(localizerRequest).then(function() {
			var isMyCart = document.getElementById('ShopCartForm') ||
				document.getElementById('mcc_cart') || /^\/mycart/.test(window.location.pathname);

			if (window.location.pathname.substr(0, 9) === '/l/search') { // If page is storefinder, redirect
				window.location = '//' + window.location.hostname + '/l/search/' + ('' + storeID).replace(/^0/, '') + '/full/';
			} else if (isMyCart) {
				$(document).trigger({ type: 'newStoreSet' });
				$(document).trigger({ type: 'storeSetFromLocPopup', storeId: storeID });
			} else {
				window.location.reload();
			}
		});
	};

	loc.printErrorMsgs = function printErrorMsgs(msgType) {
		var noStoreMessage = '<p id="sfSubHeader">There are no stores found that meet your search criteria.</p>';
		var needMoreInfoMessage = '<p id="sfSubHeader">We\'re sorry we need more information. Please enter a ZIP Code, City AND State, street address or store number to find a store.</p>';
		var userMessage = (msgType === 'noStores')
			? noStoreMessage
			: needMoreInfoMessage;

		$('#StoreFinderResultSet p').text('Search Results: No stores found.');
		$('#sfStoreList').html(userMessage);
	};


	loc.printStoreResults = function printStoreResults(json, userInputAddress) {
		var jsonAddress = json.ambiguousAddresses;
		var jsonStores = json.stores;
		var jsonAddressLength;

		if (typeof jsonAddress !== 'undefined') {
			jsonAddressLength = jsonAddress[0].suggestedLocations.length;

			if (jsonAddressLength === 1) {
				if (typeof jsonStores === 'undefined') {
					loc.printErrorMsgs('noStores');
					return;
				}
				loc.getStores(json, userInputAddress);
				return;
			}
			if (jsonAddressLength === 0) {
				loc.printErrorMsgs();
				return;
			}
			if (jsonAddressLength > 1) {
				loc.getSuggestions(json);
				return;
			}
		}

		if (typeof jsonStores !== 'undefined') {
			loc.getStores(json, $('#txtStoreFinder').val());
			return;
		}
		loc.printErrorMsgs('noStores');
		return;
	};

	loc.printUserLocalStore = function printUserLocalStore(json) {
		var parsedData = '';
		var userStoreAddress = '';
		var cookieDomain = globalUtility.getHostNameNonSecure();
		var storeHoursList = formatStoreHours(json.stores[0].storeHours);

		parsedData = ['<i class="dwarf-sfOn"></i>',
									'<p class="sfYourstoreHeader">Your Store:</p>',
									'<div class="vcard sfStoreHeaderDetails">',
										'<div class="org">',
											'<span class="sfStoreName">',
												'<a href="//' + cookieDomain + json.stores[0].url + '">' + json.stores[0].name + ' #' + json.stores[0].storeId + '</a>',
											'</span>',
										'</div>',
										'<div class="adr">',
											'<span class="street-address">' + json.stores[0].address.street + '</span>',
											'<span class="locality">' + json.stores[0].address.city + ', </span>',
											'<span class="region">' + json.stores[0].address.state + ' </span>',
											'<span class="postal-code">' + json.stores[0].address.postalCode + ' </span>',
											'<span class="b">| <a class="sfhlViewonmap" href="//' + cookieDomain + '/StoreFinder/index.jsp?storeId=' + json.stores[0].storeId + '">View On Map<i class="icon-carrot-orange"></i></a></span>',
										'</div>',
										'<div class="tel">',
											'<span class="type b">Phone: </span><span class="value">' + json.stores[0].phone + '</span>',
										'</div>',
										'<div class="time">' + storeHoursList + '</div>',
									'</div>'].join('\n');

		userStoreAddress = json.stores[0].address.city + ', ' + json.stores[0].address.state + ' ' + json.stores[0].address.postalCode;

		$('#sfYourStore').html(parsedData);
		$('#txtStoreFinder').val(userStoreAddress);
	};

	loc.search = function search(searchText) {
		$('#myStore').find('a').eq(0).trigger('click');
		$('#txtStoreFinder').trigger('click').val(searchText);
		$('#btnStoreFinder').trigger('click');
	};

	loc.userInputGetStoreInfo =	function userInputGetStoreInfo(e, maxRadius, maxResults) {
		var thdAnalyticsEvent = {
			category: {
				primaryCategory: 'button submission'
			},
			eventInfo: {
				eventName: 'find a store'
			}
		};
		var userInputAddress = $.trim(document.getElementById('txtStoreFinder').value);
		e.preventDefault();
		$('#sfStoreList').show();
		var digitalData = digitalDataWrapper.get();
		if (typeof digitalData !== 'undefined' && digitalData.hasOwnProperty('event')) {
			digitalData.event.push(thdAnalyticsEvent);
		}
		if (userInputAddress !== '') {
			storeSearchServiceProxy
				.searchStoreByAddress(userInputAddress, maxRadius)
				.then(function(json) {
					loc.printStoreResults(json, userInputAddress);
					$(document).trigger('storeListAvailable');
					$('#sfStoreList').scrollTop(0);
				});
		} else {
			loc.printErrorMsgs();
		}
	};

	loc.startLocalizationProcess = function startLocalizationProcess() {
		var userLocalStoreID;
		var userMessage;
		var txtFieldMessage;
		var storeFinderURL;
		var userInputAddress;
		var cookieDomain = globalUtility.getHostNameNonSecure();
		var maxResults = 30;
		var maxRadius = '50';
		var currentLocationDiv = '<div id="useMyLocation" style="margin:13px; float:left"><span class="orText">or </span><a href="#" class="userLocLink"><i class="localizeIcon"></i>Use Current Location</a></div>';
		var geoCookie = cookieUtils.readCookie('THD_GEOLOCALIZED');
		var isCurrentLocation = $('#myStore').find('.useCurrentLoc').length;
		var deferred = $.Deferred();

			// this is so we can run buildLocalizationContainer which builds out the frame of the modal
			$('<div style="display:none;"><div id="localizationModalContent" style="width: 680px; padding:5px; text-align: left">'+
				'<div id ="locdcContainer" style="display:none;"></div></div>')
				.appendTo('body');

			loc.buildLocalizationContainer();

			userLocalStoreID = loc.getUserLocalStore();

        if (Localizer.status.isNotLocalized() || Localizer.status.isAutoLocalized() || Localizer.status.isDefaultLocalized()) {
				loc.setDataCollectors('noLocal', '');
				userMessage = '<p id="sfSubHeader">Enter a Zip Code, City and State or store number to find a store location.</p>';

				txtFieldMessage = 'View Stores Near The ZIP Code:';
				//$('#sfYourStore').html(userMessage);
				$('#lblFindStore').text(txtFieldMessage);

				// no results to display, hiding result section
				$('#sfStoreList').hide();
				storeFinderURL = '//' + cookieDomain + '/StoreFinder/index.jsp';
				$('#hlViewStoreFinder').attr('href', storeFinderURL);
				deferred.resolve($('#localizationModalContent'));
			} else {
				$('#sfStoreList').show();
				// maxResults = 1;
				loc.setDataCollectors('localized', userLocalStoreID);

				storeSearchServiceProxy.searchStoreById(userLocalStoreID).then(function(storeDetails){
					loc.printUserLocalStore(storeDetails);
				});

				storeSearchServiceProxy.searchStoreByAddress(userLocalStoreID, maxRadius).then(function(storeList) {
					loc.getStores(storeList, userLocalStoreID);
					deferred.resolve($('#localizationModalContent'));
				});

				txtFieldMessage = 'View Stores Near Another ZIP Code:';

				if ('geolocation' in navigator && !geoCookie && isCurrentLocation > 0) {
					$('#fsStoreFinder').append(currentLocationDiv);
					txtFieldMessage = '';
				}

				$('#lblFindStore').text(txtFieldMessage);

				storeFinderURL = '//' + cookieDomain + '/StoreFinder/index.jsp?storeId=' + userInputAddress;
				$('#hlViewStoreFinder').attr('href', storeFinderURL);
			}


			$('#frmStoreFinder')
				.on('keypress', '#txtStoreFinder', function keypress(e) {
					if (e.which === 13) {
						loc.userInputGetStoreInfo(e, maxRadius, maxResults);
					}
				})
				.on('click', '#btnStoreFinder', function click(e) {
					loc.userInputGetStoreInfo(e, maxRadius, maxResults);
				})
				.on('click', '#txtStoreFinder', function click(e) {
					e.preventDefault();
					$('#lblStoreFinder').css('display', 'none');
				});

				return deferred.promise();

	};

	loc.init = function init() {
		// @TODO remove from here, pip stuff should be in PIP
		$('#checkAvailabilityPIP').on('click', function click(e) {
			e.preventDefault();
			window.pipBopisZipCheck = true;
		});
		$(document).on('click', 'a[rel="MakeMyStore"]', function click(e) {
			var $this = $(this);
			var thdAnalyticsEvent = createAnalyticsEvent('make this my store', 'button submission')
			e.preventDefault();
			var digitalData = digitalDataWrapper.get();

			if (typeof digitalData !== 'undefined' && digitalData.hasOwnProperty('event')) {
				digitalData.event.push(thdAnalyticsEvent);
			}
			loc.setUserLocalStore($this.data('storeid'), $this.data('storeinfo'), $this.data('storezip'));
		});
	};

	/**
	 * Registers an event to a selector
	 * @param  {[type]} selector     [description]
	 * @param  {[type]} eventName    [description]
	 * @param  {[type]} eventHandler [description]
	 */
	var registerEvent = function(selector, eventName, eventHandler) {
		$(document).on(eventName, selector, eventHandler);
	}

	/**
	 * Factory function which create Analytics event object.
	 *
	 * @param  {[type]} eventName [description]
	 * @param  {[type]} category  [description]
	 * @return {[type]}           [description]
	 */
	var createAnalyticsEvent = function(eventName, category) {
	    return {
	        category: {
	            primaryCategory: category
	        },
	        eventInfo: {
	            eventName: eventName
	        }
	    };
	}

	return loc;
});
/*!
 * jQuery Migrate - v1.2.1 - 2013-05-08
 * https://github.com/jquery/jquery-migrate
 * Copyright 2005, 2013 jQuery Foundation, Inc. and other contributors; Licensed MIT
 */
(function( jQuery, window, undefined ) {
// See http://bugs.jquery.com/ticket/13335
// "use strict";


var warnedAbout = {};

// List of warnings already given; public read only
jQuery.migrateWarnings = [];

// Set to true to prevent console output; migrateWarnings still maintained
// jQuery.migrateMute = false;

// Show a message on the console so devs know we're active
if ( !jQuery.migrateMute && window.console && window.console.log ) {
	window.console.log("JQMIGRATE: Logging is active");
}

// Set to false to disable traces that appear with warnings
if ( jQuery.migrateTrace === undefined ) {
	jQuery.migrateTrace = true;
}

// Forget any warnings we've already given; public
jQuery.migrateReset = function() {
	warnedAbout = {};
	jQuery.migrateWarnings.length = 0;
};

function migrateWarn( msg) {
	var console = window.console;
	if ( !warnedAbout[ msg ] ) {
		warnedAbout[ msg ] = true;
		jQuery.migrateWarnings.push( msg );
		if ( console && console.warn && !jQuery.migrateMute ) {
			console.warn( "JQMIGRATE: " + msg );
			if ( jQuery.migrateTrace && console.trace ) {
				console.trace();
			}
		}
	}
}

function migrateWarnProp( obj, prop, value, msg ) {
	if ( Object.defineProperty ) {
		// On ES5 browsers (non-oldIE), warn if the code tries to get prop;
		// allow property to be overwritten in case some other plugin wants it
		try {
			Object.defineProperty( obj, prop, {
				configurable: true,
				enumerable: true,
				get: function() {
					migrateWarn( msg );
					return value;
				},
				set: function( newValue ) {
					migrateWarn( msg );
					value = newValue;
				}
			});
			return;
		} catch( err ) {
			// IE8 is a dope about Object.defineProperty, can't warn there
		}
	}

	// Non-ES5 (or broken) browser; just set the property
	jQuery._definePropertyBroken = true;
	obj[ prop ] = value;
}

if ( document.compatMode === "BackCompat" ) {
	// jQuery has never supported or tested Quirks Mode
	migrateWarn( "jQuery is not compatible with Quirks Mode" );
}


var attrFn = jQuery( "<input/>", { size: 1 } ).attr("size") && jQuery.attrFn,
	oldAttr = jQuery.attr,
	valueAttrGet = jQuery.attrHooks.value && jQuery.attrHooks.value.get ||
		function() { return null; },
	valueAttrSet = jQuery.attrHooks.value && jQuery.attrHooks.value.set ||
		function() { return undefined; },
	rnoType = /^(?:input|button)$/i,
	rnoAttrNodeType = /^[238]$/,
	rboolean = /^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,
	ruseDefault = /^(?:checked|selected)$/i;

// jQuery.attrFn
migrateWarnProp( jQuery, "attrFn", attrFn || {}, "jQuery.attrFn is deprecated" );

jQuery.attr = function( elem, name, value, pass ) {
	var lowerName = name.toLowerCase(),
		nType = elem && elem.nodeType;

	if ( pass ) {
		// Since pass is used internally, we only warn for new jQuery
		// versions where there isn't a pass arg in the formal params
		if ( oldAttr.length < 4 ) {
			migrateWarn("jQuery.fn.attr( props, pass ) is deprecated");
		}
		if ( elem && !rnoAttrNodeType.test( nType ) &&
			(attrFn ? name in attrFn : jQuery.isFunction(jQuery.fn[name])) ) {
			return jQuery( elem )[ name ]( value );
		}
	}

	// Warn if user tries to set `type`, since it breaks on IE 6/7/8; by checking
	// for disconnected elements we don't warn on $( "<button>", { type: "button" } ).
	if ( name === "type" && value !== undefined && rnoType.test( elem.nodeName ) && elem.parentNode ) {
		migrateWarn("Can't change the 'type' of an input or button in IE 6/7/8");
	}

	// Restore boolHook for boolean property/attribute synchronization
	if ( !jQuery.attrHooks[ lowerName ] && rboolean.test( lowerName ) ) {
		jQuery.attrHooks[ lowerName ] = {
			get: function( elem, name ) {
				// Align boolean attributes with corresponding properties
				// Fall back to attribute presence where some booleans are not supported
				var attrNode,
					property = jQuery.prop( elem, name );
				return property === true || typeof property !== "boolean" &&
					( attrNode = elem.getAttributeNode(name) ) && attrNode.nodeValue !== false ?

					name.toLowerCase() :
					undefined;
			},
			set: function( elem, value, name ) {
				var propName;
				if ( value === false ) {
					// Remove boolean attributes when set to false
					jQuery.removeAttr( elem, name );
				} else {
					// value is true since we know at this point it's type boolean and not false
					// Set boolean attributes to the same name and set the DOM property
					propName = jQuery.propFix[ name ] || name;
					if ( propName in elem ) {
						// Only set the IDL specifically if it already exists on the element
						elem[ propName ] = true;
					}

					elem.setAttribute( name, name.toLowerCase() );
				}
				return name;
			}
		};

		// Warn only for attributes that can remain distinct from their properties post-1.9
		if ( ruseDefault.test( lowerName ) ) {
			migrateWarn( "jQuery.fn.attr('" + lowerName + "') may use property instead of attribute" );
		}
	}

	return oldAttr.call( jQuery, elem, name, value );
};

// attrHooks: value
jQuery.attrHooks.value = {
	get: function( elem, name ) {
		var nodeName = ( elem.nodeName || "" ).toLowerCase();
		if ( nodeName === "button" ) {
			return valueAttrGet.apply( this, arguments );
		}
		if ( nodeName !== "input" && nodeName !== "option" ) {
			migrateWarn("jQuery.fn.attr('value') no longer gets properties");
		}
		return name in elem ?
			elem.value :
			null;
	},
	set: function( elem, value ) {
		var nodeName = ( elem.nodeName || "" ).toLowerCase();
		if ( nodeName === "button" ) {
			return valueAttrSet.apply( this, arguments );
		}
		if ( nodeName !== "input" && nodeName !== "option" ) {
			migrateWarn("jQuery.fn.attr('value', val) no longer sets properties");
		}
		// Does not return so that setAttribute is also used
		elem.value = value;
	}
};


var matched, browser,
	oldInit = jQuery.fn.init,
	oldParseJSON = jQuery.parseJSON,
	// Note: XSS check is done below after string is trimmed
	rquickExpr = /^([^<]*)(<[\w\W]+>)([^>]*)$/;

// $(html) "looks like html" rule change
jQuery.fn.init = function( selector, context, rootjQuery ) {
	var match;

	if ( selector && typeof selector === "string" && !jQuery.isPlainObject( context ) &&
			(match = rquickExpr.exec( jQuery.trim( selector ) )) && match[ 0 ] ) {
		// This is an HTML string according to the "old" rules; is it still?
		if ( selector.charAt( 0 ) !== "<" ) {
			migrateWarn("$(html) HTML strings must start with '<' character");
		}
		if ( match[ 3 ] ) {
			migrateWarn("$(html) HTML text after last tag is ignored");
		}
		// Consistently reject any HTML-like string starting with a hash (#9521)
		// Note that this may break jQuery 1.6.x code that otherwise would work.
		if ( match[ 0 ].charAt( 0 ) === "#" ) {
			migrateWarn("HTML string cannot start with a '#' character");
			jQuery.error("JQMIGRATE: Invalid selector string (XSS)");
		}
		// Now process using loose rules; let pre-1.8 play too
		if ( context && context.context ) {
			// jQuery object as context; parseHTML expects a DOM object
			context = context.context;
		}
		if ( jQuery.parseHTML ) {
			return oldInit.call( this, jQuery.parseHTML( match[ 2 ], context, true ),
					context, rootjQuery );
		}
	}
	return oldInit.apply( this, arguments );
};
jQuery.fn.init.prototype = jQuery.fn;

// Let $.parseJSON(falsy_value) return null
jQuery.parseJSON = function( json ) {
	if ( !json && json !== null ) {
		migrateWarn("jQuery.parseJSON requires a valid JSON string");
		return null;
	}
	return oldParseJSON.apply( this, arguments );
};

jQuery.uaMatch = function( ua ) {
	ua = ua.toLowerCase();

	var match = /(chrome)[ \/]([\w.]+)/.exec( ua ) ||
		/(webkit)[ \/]([\w.]+)/.exec( ua ) ||
		/(opera)(?:.*version|)[ \/]([\w.]+)/.exec( ua ) ||
		/(msie) ([\w.]+)/.exec( ua ) ||
		ua.indexOf("compatible") < 0 && /(mozilla)(?:.*? rv:([\w.]+)|)/.exec( ua ) ||
		[];

	return {
		browser: match[ 1 ] || "",
		version: match[ 2 ] || "0"
	};
};

// Don't clobber any existing jQuery.browser in case it's different
if ( !jQuery.browser ) {
	matched = jQuery.uaMatch( navigator.userAgent );
	browser = {};

	if ( matched.browser ) {
		browser[ matched.browser ] = true;
		browser.version = matched.version;
	}

	// Chrome is Webkit, but Webkit is also Safari.
	if ( browser.chrome ) {
		browser.webkit = true;
	} else if ( browser.webkit ) {
		browser.safari = true;
	}

	jQuery.browser = browser;
}

// Warn if the code tries to get jQuery.browser
migrateWarnProp( jQuery, "browser", jQuery.browser, "jQuery.browser is deprecated" );

jQuery.sub = function() {
	function jQuerySub( selector, context ) {
		return new jQuerySub.fn.init( selector, context );
	}
	jQuery.extend( true, jQuerySub, this );
	jQuerySub.superclass = this;
	jQuerySub.fn = jQuerySub.prototype = this();
	jQuerySub.fn.constructor = jQuerySub;
	jQuerySub.sub = this.sub;
	jQuerySub.fn.init = function init( selector, context ) {
		if ( context && context instanceof jQuery && !(context instanceof jQuerySub) ) {
			context = jQuerySub( context );
		}

		return jQuery.fn.init.call( this, selector, context, rootjQuerySub );
	};
	jQuerySub.fn.init.prototype = jQuerySub.fn;
	var rootjQuerySub = jQuerySub(document);
	migrateWarn( "jQuery.sub() is deprecated" );
	return jQuerySub;
};


// Ensure that $.ajax gets the new parseJSON defined in core.js
jQuery.ajaxSetup({
	converters: {
		"text json": jQuery.parseJSON
	}
});


var oldFnData = jQuery.fn.data;

jQuery.fn.data = function( name ) {
	var ret, evt,
		elem = this[0];

	// Handles 1.7 which has this behavior and 1.8 which doesn't
	if ( elem && name === "events" && arguments.length === 1 ) {
		ret = jQuery.data( elem, name );
		evt = jQuery._data( elem, name );
		if ( ( ret === undefined || ret === evt ) && evt !== undefined ) {
			migrateWarn("Use of jQuery.fn.data('events') is deprecated");
			return evt;
		}
	}
	return oldFnData.apply( this, arguments );
};


var rscriptType = /\/(java|ecma)script/i,
	oldSelf = jQuery.fn.andSelf || jQuery.fn.addBack;

jQuery.fn.andSelf = function() {
	migrateWarn("jQuery.fn.andSelf() replaced by jQuery.fn.addBack()");
	return oldSelf.apply( this, arguments );
};

// Since jQuery.clean is used internally on older versions, we only shim if it's missing
if ( !jQuery.clean ) {
	jQuery.clean = function( elems, context, fragment, scripts ) {
		// Set context per 1.8 logic
		context = context || document;
		context = !context.nodeType && context[0] || context;
		context = context.ownerDocument || context;

		migrateWarn("jQuery.clean() is deprecated");

		var i, elem, handleScript, jsTags,
			ret = [];

		jQuery.merge( ret, jQuery.buildFragment( elems, context ).childNodes );

		// Complex logic lifted directly from jQuery 1.8
		if ( fragment ) {
			// Special handling of each script element
			handleScript = function( elem ) {
				// Check if we consider it executable
				if ( !elem.type || rscriptType.test( elem.type ) ) {
					// Detach the script and store it in the scripts array (if provided) or the fragment
					// Return truthy to indicate that it has been handled
					return scripts ?
						scripts.push( elem.parentNode ? elem.parentNode.removeChild( elem ) : elem ) :
						fragment.appendChild( elem );
				}
			};

			for ( i = 0; (elem = ret[i]) != null; i++ ) {
				// Check if we're done after handling an executable script
				if ( !( jQuery.nodeName( elem, "script" ) && handleScript( elem ) ) ) {
					// Append to fragment and handle embedded scripts
					fragment.appendChild( elem );
					if ( typeof elem.getElementsByTagName !== "undefined" ) {
						// handleScript alters the DOM, so use jQuery.merge to ensure snapshot iteration
						jsTags = jQuery.grep( jQuery.merge( [], elem.getElementsByTagName("script") ), handleScript );

						// Splice the scripts into ret after their former ancestor and advance our index beyond them
						ret.splice.apply( ret, [i + 1, 0].concat( jsTags ) );
						i += jsTags.length;
					}
				}
			}
		}

		return ret;
	};
}

var eventAdd = jQuery.event.add,
	eventRemove = jQuery.event.remove,
	eventTrigger = jQuery.event.trigger,
	oldToggle = jQuery.fn.toggle,
	oldLive = jQuery.fn.live,
	oldDie = jQuery.fn.die,
	ajaxEvents = "ajaxStart|ajaxStop|ajaxSend|ajaxComplete|ajaxError|ajaxSuccess",
	rajaxEvent = new RegExp( "\\b(?:" + ajaxEvents + ")\\b" ),
	rhoverHack = /(?:^|\s)hover(\.\S+|)\b/,
	hoverHack = function( events ) {
		if ( typeof( events ) !== "string" || jQuery.event.special.hover ) {
			return events;
		}
		if ( rhoverHack.test( events ) ) {
			migrateWarn("'hover' pseudo-event is deprecated, use 'mouseenter mouseleave'");
		}
		return events && events.replace( rhoverHack, "mouseenter$1 mouseleave$1" );
	};

// Event props removed in 1.9, put them back if needed; no practical way to warn them
if ( jQuery.event.props && jQuery.event.props[ 0 ] !== "attrChange" ) {
	jQuery.event.props.unshift( "attrChange", "attrName", "relatedNode", "srcElement" );
}

// Undocumented jQuery.event.handle was "deprecated" in jQuery 1.7
if ( jQuery.event.dispatch ) {
	migrateWarnProp( jQuery.event, "handle", jQuery.event.dispatch, "jQuery.event.handle is undocumented and deprecated" );
}

// Support for 'hover' pseudo-event and ajax event warnings
jQuery.event.add = function( elem, types, handler, data, selector ){
	if ( elem !== document && rajaxEvent.test( types ) ) {
		migrateWarn( "AJAX events should be attached to document: " + types );
	}
	eventAdd.call( this, elem, hoverHack( types || "" ), handler, data, selector );
};
jQuery.event.remove = function( elem, types, handler, selector, mappedTypes ){
	eventRemove.call( this, elem, hoverHack( types ) || "", handler, selector, mappedTypes );
};

jQuery.fn.error = function() {
	var args = Array.prototype.slice.call( arguments, 0);
	migrateWarn("jQuery.fn.error() is deprecated");
	args.splice( 0, 0, "error" );
	if ( arguments.length ) {
		return this.bind.apply( this, args );
	}
	// error event should not bubble to window, although it does pre-1.7
	this.triggerHandler.apply( this, args );
	return this;
};

jQuery.fn.toggle = function( fn, fn2 ) {

	// Don't mess with animation or css toggles
	if ( !jQuery.isFunction( fn ) || !jQuery.isFunction( fn2 ) ) {
		return oldToggle.apply( this, arguments );
	}
	migrateWarn("jQuery.fn.toggle(handler, handler...) is deprecated");

	// Save reference to arguments for access in closure
	var args = arguments,
		guid = fn.guid || jQuery.guid++,
		i = 0,
		toggler = function( event ) {
			// Figure out which function to execute
			var lastToggle = ( jQuery._data( this, "lastToggle" + fn.guid ) || 0 ) % i;
			jQuery._data( this, "lastToggle" + fn.guid, lastToggle + 1 );

			// Make sure that clicks stop
			event.preventDefault();

			// and execute the function
			return args[ lastToggle ].apply( this, arguments ) || false;
		};

	// link all the functions, so any of them can unbind this click handler
	toggler.guid = guid;
	while ( i < args.length ) {
		args[ i++ ].guid = guid;
	}

	return this.click( toggler );
};

jQuery.fn.live = function( types, data, fn ) {
	migrateWarn("jQuery.fn.live() is deprecated");
	if ( oldLive ) {
		return oldLive.apply( this, arguments );
	}
	jQuery( this.context ).on( types, this.selector, data, fn );
	return this;
};

jQuery.fn.die = function( types, fn ) {
	migrateWarn("jQuery.fn.die() is deprecated");
	if ( oldDie ) {
		return oldDie.apply( this, arguments );
	}
	jQuery( this.context ).off( types, this.selector || "**", fn );
	return this;
};

// Turn global events into document-triggered events
jQuery.event.trigger = function( event, data, elem, onlyHandlers  ){
	if ( !elem && !rajaxEvent.test( event ) ) {
		migrateWarn( "Global events are undocumented and deprecated" );
	}
	return eventTrigger.call( this,  event, data, elem || document, onlyHandlers  );
};
jQuery.each( ajaxEvents.split("|"),
	function( _, name ) {
		jQuery.event.special[ name ] = {
			setup: function() {
				var elem = this;

				// The document needs no shimming; must be !== for oldIE
				if ( elem !== document ) {
					jQuery.event.add( document, name + "." + jQuery.guid, function() {
						jQuery.event.trigger( name, null, elem, true );
					});
					jQuery._data( this, name, jQuery.guid++ );
				}
				return false;
			},
			teardown: function() {
				if ( this !== document ) {
					jQuery.event.remove( document, name + "." + jQuery._data( this, name ) );
				}
				return false;
			}
		};
	}
);


})( jQuery, window );

define("jquery-migrate", ["jquery"], function(){});

(function($){var tmp,loading,overlay,wrap,outer,content,close,title,nav_left,nav_right,selectedIndex=0,selectedOpts={},selectedArray=[],currentIndex=0,currentOpts={},currentArray=[],ajaxLoader=null,imgPreloader=new Image,imgRegExp=/\.(jpg|gif|png|bmp|jpeg)(.*)?$/i,swfRegExp=/[^\.]\.(swf)\s*$/i,loadingTimer,loadingFrame=1,titleHeight=0,titleStr="",start_pos,final_pos,busy=false,fx=$.extend($("<div/>")[0],{prop:0}),isIE6=$.browser.msie&&$.browser.version<7&&!window.XMLHttpRequest,_abort=function(){loading.hide();
imgPreloader.onerror=imgPreloader.onload=null;if(ajaxLoader)ajaxLoader.abort();tmp.empty()},_error=function(){if(false===selectedOpts.onError(selectedArray,selectedIndex,selectedOpts)){loading.hide();busy=false;return}selectedOpts.titleShow=false;selectedOpts.width="auto";selectedOpts.height="auto";tmp.html('<p id="fancybox-error">The requested content cannot be loaded.<br />Please try again later.</p>');_process_inline()},_start=function(){var obj=selectedArray[selectedIndex],href,type,title,str,
emb,ret;_abort();selectedOpts=$.extend({},$.fn.fancybox.defaults,typeof $(obj).data("fancybox")=="undefined"?selectedOpts:$(obj).data("fancybox"));ret=selectedOpts.onStart(selectedArray,selectedIndex,selectedOpts);if(ret===false){busy=false;return}else if(typeof ret=="object")selectedOpts=$.extend(selectedOpts,ret);title=selectedOpts.title||(obj.nodeName?$(obj).attr("title"):obj.title)||"";if(obj.nodeName&&!selectedOpts.orig)selectedOpts.orig=$(obj).children("img:first").length?$(obj).children("img:first"):
$(obj);if(title===""&&selectedOpts.orig&&selectedOpts.titleFromAlt)title=selectedOpts.orig.attr("alt");href=selectedOpts.href||(obj.nodeName?$(obj).attr("href"):obj.href)||null;if(/^(?:javascript)/i.test(href)||href=="#")href=null;if(selectedOpts.type){type=selectedOpts.type;if(!href)href=selectedOpts.content}else if(selectedOpts.content)type="html";else if(href)if(href.match(imgRegExp))type="image";else if(href.match(swfRegExp))type="swf";else if($(obj).hasClass("iframe"))type="iframe";else if(href.indexOf("#")===
0)type="inline";else type="ajax";if(!type){_error();return}if(type=="inline"){obj=href.substr(href.indexOf("#"));type=$(obj).length>0?"inline":"ajax"}selectedOpts.type=type;selectedOpts.href=href;selectedOpts.title=title;if(selectedOpts.autoDimensions)if(selectedOpts.type=="html"||selectedOpts.type=="inline"||selectedOpts.type=="ajax"){selectedOpts.width="auto";selectedOpts.height="auto"}else selectedOpts.autoDimensions=false;if(selectedOpts.modal){selectedOpts.overlayShow=true;selectedOpts.hideOnOverlayClick=
false;selectedOpts.hideOnContentClick=false;selectedOpts.enableEscapeButton=false;selectedOpts.showCloseButton=false}selectedOpts.padding=parseInt(selectedOpts.padding,10);selectedOpts.margin=parseInt(selectedOpts.margin,10);tmp.css("padding",selectedOpts.padding+selectedOpts.margin);$(".fancybox-inline-tmp").unbind("fancybox-cancel").bind("fancybox-change",function(){$(this).replaceWith(content.children())});switch(type){case "html":tmp.html(selectedOpts.content);_process_inline();break;case "inline":if($(obj).parent().is("#fancybox-content")===
true){busy=false;return}$('<div class="fancybox-inline-tmp" />').hide().insertBefore($(obj)).bind("fancybox-cleanup",function(){$(this).replaceWith(content.children())}).bind("fancybox-cancel",function(){$(this).replaceWith(tmp.children())});$(obj).appendTo(tmp);_process_inline();break;case "image":busy=false;$.fancybox.showActivity();imgPreloader=new Image;imgPreloader.onerror=function(){_error()};imgPreloader.onload=function(){busy=true;imgPreloader.onerror=imgPreloader.onload=null;_process_image()};
imgPreloader.src=href;break;case "swf":selectedOpts.scrolling="no";str='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+selectedOpts.width+'" height="'+selectedOpts.height+'"><param name="movie" value="'+href+'"></param>';emb="";$.each(selectedOpts.swf,function(name,val){str+='<param name="'+name+'" value="'+val+'"></param>';emb+=" "+name+'="'+val+'"'});str+='<embed src="'+href+'" type="application/x-shockwave-flash" width="'+selectedOpts.width+'" height="'+selectedOpts.height+
'"'+emb+"></embed></object>";tmp.html(str);_process_inline();break;case "ajax":busy=false;$.fancybox.showActivity();selectedOpts.ajax.win=selectedOpts.ajax.success;ajaxLoader=$.ajax($.extend({},selectedOpts.ajax,{url:href,data:selectedOpts.ajax.data||{},error:function(XMLHttpRequest,textStatus,errorThrown){if(XMLHttpRequest.status>0)_error()},success:function(data,textStatus,XMLHttpRequest){var o=typeof XMLHttpRequest=="object"?XMLHttpRequest:ajaxLoader;if(o.status==200){if(typeof selectedOpts.ajax.win==
"function"){ret=selectedOpts.ajax.win(href,data,textStatus,XMLHttpRequest);if(ret===false){loading.hide();return}else if(typeof ret=="string"||typeof ret=="object")data=ret}tmp.html(data);_process_inline()}}}));break;case "iframe":_show();break}},_process_inline=function(){var w=selectedOpts.width,h=selectedOpts.height;if(w.toString().indexOf("%")>-1)w=parseInt(($(window).width()-selectedOpts.margin*2)*parseFloat(w)/100,10)+"px";else w=w=="auto"?"auto":w+"px";if(h.toString().indexOf("%")>-1)h=parseInt(($(window).height()-
selectedOpts.margin*2)*parseFloat(h)/100,10)+"px";else h=h=="auto"?"auto":h+"px";tmp.wrapInner('<div style="width:'+w+";height:"+h+";overflow: "+(selectedOpts.scrolling=="auto"?"auto":selectedOpts.scrolling=="yes"?"scroll":"hidden")+';position:relative;"></div>');selectedOpts.width=tmp.width();selectedOpts.height=tmp.height();_show()},_process_image=function(){selectedOpts.width=imgPreloader.width;selectedOpts.height=imgPreloader.height;$("<img />").attr({"id":"fancybox-img","src":imgPreloader.src,
"alt":selectedOpts.title}).appendTo(tmp);_show()},_show=function(){var pos,equal;loading.hide();if(wrap.is(":visible")&&false===currentOpts.onCleanup(currentArray,currentIndex,currentOpts)){$.event.trigger("fancybox-cancel");busy=false;return}busy=true;$(content.add(overlay)).unbind();$(window).unbind("resize.fb scroll.fb");$(document).unbind("keydown.fb");if(wrap.is(":visible")&&currentOpts.titlePosition!=="outside")wrap.css("height",wrap.height());currentArray=selectedArray;currentIndex=selectedIndex;
currentOpts=selectedOpts;if(currentOpts.overlayShow){overlay.css({"background-color":currentOpts.overlayColor,"opacity":currentOpts.overlayOpacity,"cursor":currentOpts.hideOnOverlayClick?"pointer":"auto","height":$(document).height()});if(!overlay.hasClass("show-overlay")){if(isIE6)$("select:not(#fancybox-tmp select)").filter(function(){return this.style.visibility!=="hidden"}).css({"visibility":"hidden"}).one("fancybox-cleanup",function(){this.style.visibility="inherit"});overlay.addClass("show-overlay")}}else overlay.removeClass("show-overlay").removeAttr('style');
final_pos=_get_zoom_to();_process_title();if(wrap.is(":visible")){$(close.add(nav_left).add(nav_right)).hide();pos=wrap.position(),start_pos={top:pos.top,left:pos.left,width:wrap.width(),height:wrap.height()};equal=start_pos.width==final_pos.width&&start_pos.height==final_pos.height;content.fadeTo(currentOpts.changeFade,0.3,function(){var finish_resizing=function(){content.html(tmp.contents()).fadeTo(currentOpts.changeFade,1,_finish)};$.event.trigger("fancybox-change");content.empty().removeAttr("filter").css({"border-width":currentOpts.padding,
"width":final_pos.width-currentOpts.padding*2,"height":selectedOpts.autoDimensions?"auto":final_pos.height-titleHeight-currentOpts.padding*2});if(equal)finish_resizing();else{fx.prop=0;$(fx).animate({prop:1},{duration:currentOpts.changeSpeed,easing:currentOpts.easingChange,step:_draw,complete:finish_resizing})}});return}wrap.removeAttr("style");content.css("border-width",currentOpts.padding);if(currentOpts.transitionIn=="elastic"){start_pos=_get_zoom_from();content.html(tmp.contents());wrap.show();
if(currentOpts.opacity)final_pos.opacity=0;fx.prop=0;$(fx).animate({prop:1},{duration:currentOpts.speedIn,easing:currentOpts.easingIn,step:_draw,complete:_finish});return}if(currentOpts.titlePosition=="inside"&&titleHeight>0)title.show();content.css({"width":final_pos.width-currentOpts.padding*2,"height":selectedOpts.autoDimensions?"auto":final_pos.height-titleHeight-currentOpts.padding*2}).html(tmp.contents());wrap.css(final_pos).fadeIn(currentOpts.transitionIn=="none"?0:currentOpts.speedIn,_finish)},
_format_title=function(title){if(title&&title.length){if(currentOpts.titlePosition=="float")return'<table id="fancybox-title-float-wrap" cellpadding="0" cellspacing="0"><tr><td id="fancybox-title-float-left"></td><td id="fancybox-title-float-main">'+title+'</td><td id="fancybox-title-float-right"></td></tr></table>';return'<div id="fancybox-title-'+currentOpts.titlePosition+'">'+title+"</div>"}return false},_process_title=function(){titleStr=currentOpts.title||"";titleHeight=0;title.empty().removeAttr("style").removeClass();
if(currentOpts.titleShow===false){title.hide();return}titleStr=$.isFunction(currentOpts.titleFormat)?currentOpts.titleFormat(titleStr,currentArray,currentIndex,currentOpts):_format_title(titleStr);if(!titleStr||titleStr===""){title.hide();return}title.addClass("fancybox-title-"+currentOpts.titlePosition).html(titleStr).appendTo("body").show();switch(currentOpts.titlePosition){case "inside":title.css({"width":final_pos.width-currentOpts.padding*2,"marginLeft":currentOpts.padding,"marginRight":currentOpts.padding});
titleHeight=title.outerHeight(true);title.appendTo(outer);final_pos.height+=titleHeight;break;case "over":title.css({"marginLeft":currentOpts.padding,"width":final_pos.width-currentOpts.padding*2,"bottom":currentOpts.padding}).appendTo(outer);break;case "float":title.css("left",parseInt((title.width()-final_pos.width-40)/2,10)*-1).appendTo(wrap);break;default:title.css({"width":final_pos.width-currentOpts.padding*2,"paddingLeft":currentOpts.padding,"paddingRight":currentOpts.padding}).appendTo(wrap);
break}title.hide()},_set_navigation=function(){if(currentOpts.enableEscapeButton||currentOpts.enableKeyboardNav)$(document).bind("keydown.fb",function(e){if(e.keyCode==27&&currentOpts.enableEscapeButton){e.preventDefault();$.fancybox.close()}else if((e.keyCode==37||e.keyCode==39)&&currentOpts.enableKeyboardNav&&e.target.tagName!=="INPUT"&&e.target.tagName!=="TEXTAREA"&&e.target.tagName!=="SELECT"){e.preventDefault();$.fancybox[e.keyCode==37?"prev":"next"]()}});if(!currentOpts.showNavArrows){nav_left.hide();
nav_right.hide();return}if(currentOpts.cyclic&&currentArray.length>1||currentIndex!==0)nav_left.show();if(currentOpts.cyclic&&currentArray.length>1||currentIndex!=currentArray.length-1)nav_right.show()},_finish=function(){if(!$.support.opacity){content.get(0).style.removeAttribute("filter");wrap.get(0).style.removeAttribute("filter")}if(selectedOpts.autoDimensions)content.css("height","auto");wrap.css("height","auto");if(titleStr&&titleStr.length)title.show();if(currentOpts.showCloseButton)close.show();
_set_navigation();if(currentOpts.hideOnContentClick)content.bind("click",$.fancybox.close);if(currentOpts.hideOnOverlayClick)overlay.bind("click",$.fancybox.close);$(window).bind("resize.fb",$.fancybox.resize);if(currentOpts.centerOnScroll)$(window).bind("scroll.fb",$.fancybox.center);if(currentOpts.type=="iframe")$('<iframe id="fancybox-frame" name="fancybox-frame'+(new Date).getTime()+'" frameborder="0" hspace="0" '+($.browser.msie?'allowtransparency="true""':"")+' scrolling="'+selectedOpts.scrolling+
'" src="'+currentOpts.href+'"></iframe>').appendTo(content);wrap.show();busy=false;$.fancybox.center();currentOpts.onComplete(currentArray,currentIndex,currentOpts);_preload_images()},_preload_images=function(){var href,objNext;if(currentArray.length-1>currentIndex){href=currentArray[currentIndex+1].href;if(typeof href!=="undefined"&&href.match(imgRegExp)){objNext=new Image;objNext.src=href}}if(currentIndex>0){href=currentArray[currentIndex-1].href;if(typeof href!=="undefined"&&href.match(imgRegExp)){objNext=
new Image;objNext.src=href}}},_draw=function(pos){var dim={width:parseInt(start_pos.width+(final_pos.width-start_pos.width)*pos,10),height:parseInt(start_pos.height+(final_pos.height-start_pos.height)*pos,10),top:parseInt(start_pos.top+(final_pos.top-start_pos.top)*pos,10),left:parseInt(start_pos.left+(final_pos.left-start_pos.left)*pos,10)};if(typeof final_pos.opacity!=="undefined")dim.opacity=pos<0.5?0.5:pos;wrap.css(dim);content.css({"width":dim.width-currentOpts.padding*2,"height":dim.height-
titleHeight*pos-currentOpts.padding*2})},_get_viewport=function(){return[$(window).width()-currentOpts.margin*2,$(window).height()-currentOpts.margin*2,$(document).scrollLeft()+currentOpts.margin,$(document).scrollTop()+currentOpts.margin]},_get_zoom_to=function(){var view=_get_viewport(),to={},resize=currentOpts.autoScale,double_padding=currentOpts.padding*2,ratio;if(currentOpts.width.toString().indexOf("%")>-1)to.width=parseInt(view[0]*parseFloat(currentOpts.width)/100,10);else to.width=currentOpts.width+
double_padding;if(currentOpts.height.toString().indexOf("%")>-1)to.height=parseInt(view[1]*parseFloat(currentOpts.height)/100,10);else to.height=currentOpts.height+double_padding;if(resize&&(to.width>view[0]||to.height>view[1]))if(selectedOpts.type=="image"||selectedOpts.type=="swf"){ratio=currentOpts.width/currentOpts.height;if(to.width>view[0]){to.width=view[0];to.height=parseInt((to.width-double_padding)/ratio+double_padding,10)}if(to.height>view[1]){to.height=view[1];to.width=parseInt((to.height-
double_padding)*ratio+double_padding,10)}}else{to.width=Math.min(to.width,view[0]);to.height=Math.min(to.height,view[1])}to.top=parseInt(Math.max(view[3]-20,view[3]+(view[1]-to.height-40)*0.5),10);to.left=parseInt(Math.max(view[2]-20,view[2]+(view[0]-to.width-40)*0.5),10);return to},_get_obj_pos=function(obj){var pos=obj.offset();pos.top+=parseInt(obj.css("paddingTop"),10)||0;pos.left+=parseInt(obj.css("paddingLeft"),10)||0;pos.top+=parseInt(obj.css("border-top-width"),10)||0;pos.left+=parseInt(obj.css("border-left-width"),
10)||0;pos.width=obj.width();pos.height=obj.height();return pos},_get_zoom_from=function(){var orig=selectedOpts.orig?$(selectedOpts.orig):false,from={},pos,view;if(orig&&orig.length){pos=_get_obj_pos(orig);from={width:pos.width+currentOpts.padding*2,height:pos.height+currentOpts.padding*2,top:pos.top-currentOpts.padding-20,left:pos.left-currentOpts.padding-20}}else{view=_get_viewport();from={width:currentOpts.padding*2,height:currentOpts.padding*2,top:parseInt(view[3]+view[1]*0.5,10),left:parseInt(view[2]+
view[0]*0.5,10)}}return from},_animate_loading=function(){if(!loading.is(":visible")){clearInterval(loadingTimer);return}$("div",loading).css("top",loadingFrame*-40+"px");loadingFrame=(loadingFrame+1)%12};$.fn.fancybox=function(options){if(!$(this).length)return this;$(this).data("fancybox",$.extend({},options,$.metadata?$(this).metadata():{})).unbind("click.fb").bind("click.fb",function(e){e.preventDefault();if(busy)return;busy=true;$(this).blur();selectedArray=[];selectedIndex=0;var rel=$(this).attr("rel")||
"";if(!rel||rel==""||rel==="nofollow")selectedArray.push(this);else{selectedArray=$("a[rel="+rel+"], area[rel="+rel+"]");selectedIndex=selectedArray.index(this)}_start();return});return this};$.fancybox=function(obj){var opts;if(busy)return;busy=true;opts=typeof arguments[1]!=="undefined"?arguments[1]:{};selectedArray=[];selectedIndex=parseInt(opts.index,10)||0;if($.isArray(obj)){for(var i=0,j=obj.length;i<j;i++)if(typeof obj[i]=="object")$(obj[i]).data("fancybox",$.extend({},opts,obj[i]));else obj[i]=
$({}).data("fancybox",$.extend({content:obj[i]},opts));selectedArray=jQuery.merge(selectedArray,obj)}else{if(typeof obj=="object")$(obj).data("fancybox",$.extend({},opts,obj));else obj=$({}).data("fancybox",$.extend({content:obj},opts));selectedArray.push(obj)}if(selectedIndex>selectedArray.length||selectedIndex<0)selectedIndex=0;_start()};$.fancybox.showActivity=function(){clearInterval(loadingTimer);loading.show();loadingTimer=setInterval(_animate_loading,66)};$.fancybox.hideActivity=function(){loading.hide()};
$.fancybox.next=function(){return $.fancybox.pos(currentIndex+1)};$.fancybox.prev=function(){return $.fancybox.pos(currentIndex-1)};$.fancybox.pos=function(pos){if(busy)return;pos=parseInt(pos);selectedArray=currentArray;if(pos>-1&&pos<currentArray.length){selectedIndex=pos;_start()}else if(currentOpts.cyclic&&currentArray.length>1){selectedIndex=pos>=currentArray.length?0:currentArray.length-1;_start()}return};$.fancybox.cancel=function(){if(busy)return;busy=true;$.event.trigger("fancybox-cancel");
_abort();selectedOpts.onCancel(selectedArray,selectedIndex,selectedOpts);busy=false};$.fancybox.close=function(){if(busy||wrap.is(":hidden"))return;busy=true;if(currentOpts&&false===currentOpts.onCleanup(currentArray,currentIndex,currentOpts)){busy=false;return}_abort();$(close.add(nav_left).add(nav_right)).hide();$(content.add(overlay)).unbind();$(window).unbind("resize.fb scroll.fb");$(document).unbind("keydown.fb");content.find("iframe").attr("src",isIE6&&/^https/i.test(window.location.href||"")?
"javascript:void(false)":"about:blank");if(currentOpts.titlePosition!=="inside")title.empty();wrap.stop();function _cleanup(){overlay.removeClass("show-overlay").removeAttr('style');title.empty().hide();wrap.hide();$.event.trigger("fancybox-cleanup");content.empty();currentOpts.onClosed(currentArray,currentIndex,currentOpts);currentArray=selectedOpts=[];currentIndex=selectedIndex=0;currentOpts=selectedOpts={};busy=false}if(currentOpts.transitionOut=="elastic"){start_pos=_get_zoom_from();var pos=wrap.position();final_pos={top:pos.top,
left:pos.left,width:wrap.width(),height:wrap.height()};if(currentOpts.opacity)final_pos.opacity=1;title.empty().hide();fx.prop=1;$(fx).animate({prop:0},{duration:currentOpts.speedOut,easing:currentOpts.easingOut,step:_draw,complete:_cleanup})}else wrap.fadeOut(currentOpts.transitionOut=="none"?0:currentOpts.speedOut,_cleanup)};$.fancybox.resize=function(){if(overlay.hasClass("show-overlay"))overlay.css("height",$(document).height());$.fancybox.center(true)};$.fancybox.center=function(){var view,align;if(busy)return;
align=arguments[0]===true?1:0;view=_get_viewport();if(!align&&(wrap.width()>view[0]||wrap.height()>view[1]))return;wrap.stop().animate({"top":parseInt(Math.max(view[3]-20,view[3]+(view[1]-content.height()-40)*0.5-currentOpts.padding)),"left":parseInt(Math.max(view[2]-20,view[2]+(view[0]-content.width()-40)*0.5-currentOpts.padding))},typeof arguments[0]=="number"?arguments[0]:200)};$.fancybox.init=function(){if($("#fancybox-wrap").length)return;$("body").append(tmp=$('<div id="fancybox-tmp"></div>'),
loading=$('<div id="fancybox-loading"><div></div></div>'),overlay=$('<div id="fancybox-overlay"></div>'),wrap=$('<div id="fancybox-wrap"></div>'));outer=$('<div id="fancybox-outer"></div>').append('<div class="fancybox-bg" id="fancybox-bg-n"></div><div class="fancybox-bg" id="fancybox-bg-ne"></div><div class="fancybox-bg" id="fancybox-bg-e"></div><div class="fancybox-bg" id="fancybox-bg-se"></div><div class="fancybox-bg" id="fancybox-bg-s"></div><div class="fancybox-bg" id="fancybox-bg-sw"></div><div class="fancybox-bg" id="fancybox-bg-w"></div><div class="fancybox-bg" id="fancybox-bg-nw"></div>').appendTo(wrap);
outer.append(content=$('<div id="fancybox-content"></div>'),close=$('<a id="fancybox-close"></a>'),title=$('<div id="fancybox-title"></div>'),nav_left=$('<a href="javascript:;" id="fancybox-left"><span class="fancy-ico" id="fancybox-left-ico"></span></a>'),nav_right=$('<a href="javascript:;" id="fancybox-right"><span class="fancy-ico" id="fancybox-right-ico"></span></a>'));close.click($.fancybox.close);loading.click($.fancybox.cancel);nav_left.click(function(e){e.preventDefault();$.fancybox.prev()});
nav_right.click(function(e){e.preventDefault();$.fancybox.next()});if($.fn.mousewheel)wrap.bind("mousewheel.fb",function(e,delta){if(busy)e.preventDefault();else if($(e.target).get(0).clientHeight==0||$(e.target).get(0).scrollHeight===$(e.target).get(0).clientHeight){e.preventDefault();$.fancybox[delta>0?"prev":"next"]()}});if(!$.support.opacity)wrap.addClass("fancybox-ie");if(isIE6){loading.addClass("fancybox-ie6");wrap.addClass("fancybox-ie6");$('<iframe id="fancybox-hide-sel-frame" src="'+(/^https/i.test(window.location.href||
"")?"javascript:void(false)":"about:blank")+'" scrolling="no" border="0" frameborder="0" tabindex="-1"></iframe>').prependTo(outer)}};$.fn.fancybox.defaults={padding:10,margin:40,opacity:false,modal:false,cyclic:false,scrolling:"auto",width:560,height:340,autoScale:true,autoDimensions:true,centerOnScroll:false,ajax:{},swf:{wmode:"transparent"},hideOnOverlayClick:true,hideOnContentClick:false,overlayShow:true,overlayOpacity:0.7,overlayColor:"#777",titleShow:true,titlePosition:"float",titleFormat:null,
titleFromAlt:false,transitionIn:"fade",transitionOut:"fade",speedIn:300,speedOut:300,changeSpeed:300,changeFade:"fast",easingIn:"swing",easingOut:"swing",showCloseButton:true,showNavArrows:true,enableEscapeButton:true,enableKeyboardNav:true,onStart:function(){},onCancel:function(){},onComplete:function(){},onCleanup:function(){},onClosed:function(){},onError:function(){}};$(document).ready(function(){$.fancybox.init()})})(jQuery);
define("jquery-fancybox", ["jquery","jquery-migrate"], function(){});

/* ---------------------------------------------------------------------------------------
	THD Global Modal Module
-----------------------------------------------------------------------------------------*/
// thd.applAtcOverlay
// thd.applChangeZipCode

(function closure(root, factory) {
	if(typeof define === 'function' && define.amd) {
		define('global.modal',['jquery', 'global.namespace', 'global.utility', 'digitalData', 'localizationPopup', 'cookie-utils', 'jquery-fancybox'],
			function load($, THD, globalUtility, digitalData, localizationPopup, cookieUtils) {
				return factory(root, $, THD, globalUtility, digitalData, localizationPopup, cookieUtils);
			});
	} else{
		// For non-AMD module, expose this to global (will also be useful for test cases)
		/* eslint-disable*/
		factory(root, jQuery, THD, THD.Global.Config, digitalData, localizationPopup, cookieUtils);
		/*eslint-enable*/
	}
})(this, function factory(root, $, THD, globalUtility, digitalDataWrapper, localizationPopup, cookieUtils) {
	var currentStore;
	var newStore;
	var theHref;
	var overlayConfig;
	var emailDirectionsFrame = '';
	var thdAnalyticsEvent = {};
	var privateMethods = {};
	
	
	THD.Global.overlayConfigs = {};// public use to access the configs
	overlayConfig = THD.Global.overlayConfigs;


	// Generic Modal Config.
	overlayConfig.default = {
		'autoDimensions': true,
		'autoSize': false,
		'centerOnScroll': true,
		'enableEscapeButton': true,
		'height': 'auto',
		'hideOnOverlayClick': true,
		'margin': 0,
		'modal': false,
		'overlayColor': '#666',
		'overlayOpacity': 0.7,
		'padding': 0,
		'scrolling': 'no',
		'showCloseButton': false,
		'titleShow': false,
		'showNavArrows': false,
		'transitionIn': 'none',
		'transitionOut': 'none',
		'width': 'auto'
	};

	// Directions Email Module.
	overlayConfig.modal = $.extend(true, {}, overlayConfig.default, {
		'autoDimensions': false,
		'width': 766,
		'padding': 15,
		'showCloseButton': true
	});

	// Quickview Overlay Config.
	overlayConfig.quickview = $.extend(true, {}, overlayConfig.default, {
		'width': 928,
		'height': 510,
		'modal': false,
		'centerOnScroll': false,
		'showCloseButton': true,
		'overlayOpacity': 0,
		'type': 'iframe',
		'href': theHref
	});

	// Localization popUp Overlay Config.
	overlayConfig.localizationModule = $.extend(true, {}, overlayConfig.default, {
		'width': 680,
		'height': 630,
		'type': 'inline',
		'enableEscapeButton': true,
		'centerOnScroll': true,
		'overlayColor': '#666',
		'overlayOpacity': 0.7,
		'overlayShow': true,
		'showCloseButton': true,
		'onStart': function onStart() {
			var urlHostName = window.location.hostname;
			var urlHostNameSplit = [];
			urlHostNameSplit = urlHostName.split('.');
			if ((urlHostNameSplit[0] !== 'www' && urlHostNameSplit[1] === 'homedepot')
				|| urlHostNameSplit.indexOf('dev-blinds') > -1
				|| urlHostNameSplit.indexOf('qa-blinds') > -1
				|| urlHostNameSplit.indexOf('uat-blinds') > -1
				|| urlHostNameSplit.indexOf('stage-blinds') > -1
				|| urlHostNameSplit.indexOf('blinds') > -1) {
				window.location = 'http://www.homedepot.com/StoreFinder/index.jsp';
				return false;
			}

			var	digitalData = digitalDataWrapper.get();
			
			// DDO for Success
			thdAnalyticsEvent = {
				category: {
					primaryCategory: 'overlay'
				},
				eventInfo: {
					eventName: 'change your local store'
				}
			};

			if(typeof digitalData !== 'undefined' && digitalData.hasOwnProperty('event')) {
				digitalData.event.push(thdAnalyticsEvent);
			}
			localizationPopup.startLocalizationProcess();
		}
	});

	// Canadian message popUp Overlay Config.
	overlayConfig.canadaMessageModule = $.extend(true, {}, overlayConfig.default, {
		'width': 680,
		'height': 630,
		'type': 'inline',
		'enableEscapeButton': true,
		'centerOnScroll': true,
		'overlayColor': '#666',
		'overlayOpacity': 0.7,
		'showCloseButton': true
	});

	// Directions Email Module.
	overlayConfig.directionsEmailModule = $.extend(true, {}, overlayConfig.default, {
		'width': 700,
		'height': 600,
		'type': 'inline',
		'enableEscapeButton': true,
		'centerOnScroll': true,
		'overlayColor': '#666',
		'overlayOpacity': 0.7,
		'overlayShow': true,
		'showCloseButton': true,
		'onStart': function onStart() {
			emailDirectionsFrame = $('#emailDirections').clone();
			$('#edItinerary').html($('#directionsItinerary').html());
			$('#directions-header').val($('#directionsItinerary').html());
		},
		'onClosed': function onClosed() {
			$('#emailDirectionsModal').html(emailDirectionsFrame);
		}
	});

	overlayConfig.quickOrder = $.extend(true, {}, overlayConfig.default, {
		'width': 841,
		'autoSize': false,
		'height': 685,
		'padding': 0,
		'href': theHref,
		'type': 'iframe',
		'autoScale': false
	});

	// Email SignUp
	overlayConfig.emailSignUp = $.extend(true, {}, overlayConfig.default, {
		'width': 350,
		'height': 150,
		'type': 'iframe',
		'href': theHref,
		'centerOnScroll': true,
		'overlayShow': true,
		'showCloseButton': true
	});

	// Video Overlay
	overlayConfig.videoOverlay = $.extend(true, {}, overlayConfig.default, {
		'autoDimensions': true,
		'width': 'auto',
		'height': 'auto',
		'centerOnScroll': true,
		'overlayShow': true,
		'showCloseButton': true
	});

	// Email Overlay
	overlayConfig.email = $.extend(true, {}, overlayConfig.default, {
		'width': 478,
		'height': 440,
		'cache': false,
		'enableEscapeButton': true,
		'showCloseButton': true,
		'href': theHref,
		'modal': false,
		'centerOnScroll': false,
		'overlayColor': '#666',
		'overlayOpacity': 0.7,
		'type': 'iframe'
	});

	// Gallery Overlay Config.
	overlayConfig.gallery = $.extend(true, {}, overlayConfig.default, {
		'width': 898,
		'height': 601,
		'type': 'iframe',
		'showCloseButton': true,
		'href': theHref
	});

	// Bopis 2 Overlay Config.
	overlayConfig.bopis = $.extend(true, {}, overlayConfig.default, {
		'padding': 15,
		'width': 795,
		'height': 710,
		'type': 'iframe',
		'modal': false,
		'href': theHref,
		'overlayOpacity': 0,
		'centerOnScroll': false,
		'showCloseButton': true,
		'onStart': function onStart() {
			$.fancybox.showActivity();
			$('#fancybox-wrap').addClass('invisible');
			if($('#fancybox-wrap').is(':visible')) {
				$('#fancybox-wrap').css({'visibility': 'hidden'});
			}
		},
		'onComplete': function onComplete() {
			$.fancybox.showActivity();
			currentStore = cookieUtils.getStoreNum();

			$('#fancybox-frame').load(function load() {
				$.fancybox.hideActivity();
				$('#fancybox-wrap').css({'visibility': 'visible'}).removeClass('invisible');
			});
		},
		'onClosed': function onClosed() {
			newStore = cookieUtils.getStoreNum();
			if ( newStore !== currentStore ) {
				window.location.reload();
			}
		}
	});

	// Quickview Overlay Config.
	overlayConfig.content = $.extend(true, {}, overlayConfig.default, {
		'autoDimensions': false,
		'width': 766,
		'type': 'ajax',
		'href': theHref,
		'showCloseButton': true,
		'onComplete': function onComplete() {
			$.fancybox.showActivity();
			$('#fancybox-wrap').css({'visibility': 'hidden'});

			setTimeout(function to() {
				var $fbContent = $('#fancybox-content');
				var $dctmContentOverlay = $('#dctm_content_overlay');

				$fbContent.find('.pod').css({'height': 'auto'});
				window.fixPodHeights();

				$dctmContentOverlay.parent().css({'height': 'auto'});
				$fbContent.css({'height': 'auto'});

				$.fancybox.hideActivity();
				$('#fancybox-wrap').css({'visibility': 'visible'});
			}, 1500);
		}
	});

	// Generic Overlay Trigger for most modals
	privateMethods.overlayTrigger = function overlayTrigger(e) {
		var $this = $(this);
		var theRel = $this.attr('rel').toLowerCase();
		var useConfig;
		e.preventDefault();

		switch (theRel) {
		case 'directionsemailmodule': useConfig = overlayConfig.directionsEmailModule; break;
		case 'localizationmodule': $(document).trigger('launchLocOverlay'); break;
		case 'bopis': useConfig = overlayConfig.bopis; break;
		case 'quickview': useConfig = overlayConfig.quickview; break;
		case 'gallery': useConfig = overlayConfig.gallery; break;
		case 'email': useConfig = overlayConfig.email; break;
		case 'modal': useConfig = overlayConfig.modal; break;
		case 'content': useConfig = overlayConfig.content; break;
		default : useConfig = overlayConfig.content;
		}

		// get the href for fancybox
		theHref = $this.attr('href');
		// if we get a hit, fire fancybox and pass in configs
		return (useConfig) ? $.fancybox(theHref, useConfig) : false;
	};

	privateMethods.getCurrentStore = function getCurrentStore(){
		var storeAddress = cookieUtils.readCookie('THD_LOCSTORE');
		var currentStore = storeAddress.split('+')[0] || '';
		return currentStore;
	}

	// Quick Order Module - right now called from Pro header
	privateMethods.overlayQuickOrderModule = function overlayQuickOrderModule(e) {
		e.preventDefault();

		theHref = 'https://' + globalUtility.getHostNameSecure() + '/webapp/wcs/stores/servlet/THDQuickOrderFormAjaxResponseView?langId=-1&storeId=10051&catalogId=10053';
		$.fancybox(theHref, overlayConfig.quickOrder);
	};


	privateMethods.overlayFooterEmailPopup = function overlayFooterEmailPopup(e) {
		e.preventDefault();
		// @QUESTION: What is `document.emailsub`
		theHref = 'https://' + globalUtility.getHostNameSecure() + '/webapp/wcs/stores/servlet/THDEmailSignUpAddCmd?langId=-1&storeId=10051&catalogId=10053&URL=EmailSignUpView&subscrType=' + document.emailsub.subscrType.value + '&emailInput=' + document.emailsub.emailInput.value + '&formName=emailsub';
		$.fancybox(theHref, overlayConfig.emailSignUp);
		document.emailsub.emailInput.value = 'Enter Email Address';
	};

	// Load applinaces JS to Trigger Appliances
	// privateMethods.triggerATCApplOverlay = function triggerATCApplOverlay(e) {
	// 	var $this = $(this);

	// 	e.preventDefault();

	// 	if ($this.hasClass('triggerATCAppliOverlay')) {
	// 		require(['thd.applAtcOverlay']).done(function done(applAtcOverlay) {
	// 			applAtcOverlay.initApplATCOverlay($this);
	// 		});
	// 	} else if ($this.hasClass('triggerApplChangeZipOverlay')) {
	// 		require(['thd.applChangeZipCode'], function done(applChangeZipCode) {
	// 			applChangeZipCode.initApplChangeZipCodeOverlay($this);
	// 		});
	// 	}
	// };
	// Fetch page implimentation to trigger overlays
	privateMethods.triggerOverlay = function triggerOverlay(e) {
		var type = $(this).data('overlay-type');
		theHref = $(this).attr('href');
		var content = (type === 'modal') ? $(theHref).html() : theHref; // For hidden content on a page ref by ID
		e.preventDefault();
		return (overlayConfig[type]) ? $.fancybox(content, overlayConfig[type]) : false;
	};

	// this module is a singleton that is invoked when loaded based on the `initialized` flag
	overlayConfig.init = function init() {
		if (!overlayConfig.initialized) {
			overlayConfig.initialized = true;
			$(document)
				.on('click', '.overlayTrigger', privateMethods.overlayTrigger)// The General Modal Trigger Event listner
				.on('click', '.fbClose a', function fbClose() { $.fancybox.close(); return false; })// Fancybox Close Listiner
				.on('click', '#btnEmailFooter', privateMethods.overlayFooterEmailPopup)// Footer email Listner
				.on('click', '#quickorderModule, .quickorderModule', privateMethods.overlayQuickOrderModule)// Quick Order Module Listner
				// .on('click', '.triggerATCAppliOverlay,.triggerApplChangeZipOverlay', privateMethods.triggerATCApplOverlay)// Trigger Appliances Overlay
				.on('click', '.triggerOverlay', privateMethods.triggerOverlay);// Fetch Modal Trigger Event listner
		}
	};

	/*----------------------------------------------------
	|
	| CReplicate the HD_lightbox functionality QC# 13990 & 11801
	|
	----------------------------------------------------*/
	overlayConfig.HDLightbox = function HDLightbox() {
		var galleryOutput = '<div id="gallery_wrapper" class="clearfix"><a class="close_btn" href="#">CLOSE X</a><div id="galleryPlaceHolder">{{GALERY_HERE}}</div></div>';
		var theLink = $(this).attr('href');
		var galleryOverlayConfig = {
			'onComplete': function onComplete() {
				$('.close_btn', '#fancybox-wrap').click(function click() {
					$.fancybox.close();
					return false;
				});
			},
			'padding': 0,
			'autoSize': false,
			'transitionIn': 'none',
			'transitionOut': 'none',
			'scrolling': 'no',
			'showCloseButton': false,
			'overlayOpacity': 0.70,
			'overlayColor': '#666'
		};


		$.ajax({
			url: theLink,
			success: function success(newHTML) {
				var html = newHTML.replace(/[\n\t\r]/g, '').match(/<body>(.*)<\/body>/)[1];

				galleryOutput = galleryOutput.replace('{{GALERY_HERE}}', html);
			}
		});

		$.fancybox(galleryOutput, galleryOverlayConfig);
		return false;
	};

	// Removing this as i dont know who uses it.
	// @TODO expose
	window.HD_Lightbox = function HD_Lightbox() {
		console.warn('HD_Lightbox as a global is deprecated, use global.modal.HDLightbox');
		overlayConfig.HDLightbox();
	};

	return overlayConfig;
});


(function closure(root, factory) {
	if(typeof define === 'function' && define.amd) {
		define('global.gestureHandler',['jquery', 'global.namespace'], function load($, THD) {
			return factory(root, $, THD);
		});
	} else{
		/* eslint-disable*/
		factory(root, jQuery, THD);
		/*eslint-enable*/
	}
})(this, function factory(root, $, THD) {
	var self = {};
	self.ui = {};
	self.clickbuster = {};

	THD.Utils = THD.Utils || {};
	THD.Utils.GestureHandler = THD.Utils.GestureHandler  || {};
	THD.Utils.GestureHandler.isInitialized = false;
	self.ui.FastButton = function FastButton(element, handler) {
		this.element = element;
		this.handler = handler;

		element.addEventListener('touchstart', this, false);
		element.addEventListener('click', this, false);
	};

	self.ui.FastButton.prototype.handleEvent = function handleEvent(event) {
		switch (event.type) {
		case 'touchstart':
			this.onTouchStart(event);
			break;
		case 'touchmove':
			this.onTouchMove(event);
			break;
		case 'touchend':
			this.onClick(event);
			break;
		case 'click':
			this.onClick(event);
			break;
		default :
			break;
		}
	};

	self.ui.FastButton.prototype.onTouchStart = function onTouchStart(event) {
		event.stopPropagation();

		this.element.addEventListener('touchend', this, false);
		document.body.addEventListener('touchmove', this, false);

		this.startX = event.touches[0].clientX;
		this.startY = event.touches[0].clientY;
	};

	self.ui.FastButton.prototype.onTouchMove = function onTouchMove(event) {
		if (Math.abs(event.touches[0].clientX - this.startX) > 10 ||
			Math.abs(event.touches[0].clientY - this.startY) > 10) {
			this.reset();
		}
	};

	self.ui.FastButton.prototype.onClick = function onClick(event) {
		event.stopPropagation();
		this.reset();
		this.handler(event);

		if (event.type === 'touchend') {
			self.clickbuster.preventGhostClick(this.startX, this.startY);
		}
	};

	self.ui.FastButton.prototype.reset = function reset() {
		this.element.removeEventListener('touchend', this, false);
		document.body.removeEventListener('touchmove', this, false);
	};

	self.clickbuster.preventGhostClick = function preventGhostClick(x, y) {
		self.clickbuster.coordinates.push(x, y);
		window.setTimeout(self.clickbuster.pop, 2500);
	};

	self.clickbuster.pop = function pop() {
		self.clickbuster.coordinates.splice(0, 2);
	};

	self.clickbuster.onClick = function onClick(event) {
		for (var i = 0; i < self.clickbuster.coordinates.length; i += 2) {
			var x = self.clickbuster.coordinates[i];
			var y = self.clickbuster.coordinates[i + 1];
			if (Math.abs(event.clientX - x) < 25 && Math.abs(event.clientY - y) < 25) {
				event.stopPropagation();
				event.preventDefault();
			}
		}
	};


	/**
	 * @function - Builds tap event and intercepts mouseover events for touch devices. fast click functionality taken from https://developers.google.com/mobile/articles/fast_buttons
	 */
	function initTouch() {
		var isTouch;
		if (!THD.Utils.GestureHandler.isInitialized) {
			isTouch = 'ontouchstart' in document.documentElement;
			THD.Utils.GestureHandler.touch = false;

			if (isTouch) {
				document.addEventListener('click', self.clickbuster.onClick, true);
				self.clickbuster.coordinates = [];

				THD.Utils.GestureHandler.touch = true;
			}
		} else {
			THD.Utils.GestureHandler.isInitialized = true;
		}
	}

	THD.Utils.GestureHandler.init = initTouch;

	// $(THD.Utils.GestureHandler.init);

	return {
		init: function init() {
			initTouch();
		},
		touch: 'ontouchstart' in document.documentElement
	};
});

/* --------------------------------------------------------------------------------------------------
	dynamic product ratings display primarlly for Certona
--------------------------------------------------------------------------------------------------*/

(function closure(root, factory) {
	if(typeof define === 'function' && define.amd) {
		define('global.dynamicRatings',['jquery'],
			function load($) {
				return factory(root, $);
			});
	} else {
			// For non-AMD module, expose this to global (will also be useful for test cases)
			/* eslint-disable*/
			factory(root, jQuery);
			/*eslint-enable*/
	}
})(this, function factory(root, $) {
	var dynamicRatings = function dynamicRatings() {
		var obj = $('#container').find('span.stars');
		var i;
		var avgRating;
		var RatingNumber;
		var $this;

		for (i = 0; i < $(obj).length; i += 1) {
			$this = $(obj).eq(i);
			avgRating = $this.attr('rel');
			RatingNumber = avgRating * 20;

			if (avgRating === 'noRating' || RatingNumber === '0.0') {
				$this.parent().css('background-position', '0px -62px').width('0px'); // need to make this a class
			} else {
				$this.css('width', RatingNumber + '%');
			}
		}
	};

	return {
		init: function init() {
			$(window).load(dynamicRatings);
		},
		dynamicRatings: dynamicRatings
	};
});

(function(c,n){var l="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";c.fn.imagesLoaded=function(f){function m(){var b=c(i),a=c(h);d&&(h.length?d.reject(e,b,a):d.resolve(e));c.isFunction(f)&&f.call(g,e,b,a)}function j(b,a){b.src===l||-1!==c.inArray(b,k)||(k.push(b),a?h.push(b):i.push(b),c.data(b,"imagesLoaded",{isBroken:a,src:b.src}),o&&d.notifyWith(c(b),[a,e,c(i),c(h)]),e.length===k.length&&(setTimeout(m),e.unbind(".imagesLoaded")))}var g=this,d=c.isFunction(c.Deferred)?c.Deferred():
0,o=c.isFunction(d.notify),e=g.find("img").add(g.filter("img")),k=[],i=[],h=[];c.isPlainObject(f)&&c.each(f,function(b,a){if("callback"===b)f=a;else if(d)d[b](a)});e.length?e.bind("load.imagesLoaded error.imagesLoaded",function(b){j(b.target,"error"===b.type)}).each(function(b,a){var d=a.src,e=c.data(a,"imagesLoaded");if(e&&e.src===d)j(a,e.isBroken);else if(a.complete&&a.naturalWidth!==n)j(a,0===a.naturalWidth||0===a.naturalHeight);else if(a.readyState||a.complete)a.src=l,a.src=d}):m();return d?d.promise(g):
g}})(jQuery);
define("jquery-imagesloaded", function(){});



// Depends on
// /static/scripts/jquery/jquery.imagesloaded.min.js

(function closure(root, factory) {
	if(typeof define === 'function' && define.amd) {
		define('thdSlider',['jquery', 'global.namespace', 'jquery-imagesloaded'],
			function load($, THD) {
				return factory(root, $, THD);
			});
	} else{
		// For non-AMD module, expose this to global (will also be useful for test cases)
		/* eslint-disable*/
		factory(root, jQuery, THD);
		/*eslint-enable*/
	}
})(this, function factory(root, $, THD) {
	// DXC Updates to this plugin. General Clean Up and performance tweaks
	$.fn.thdSlider = function thdSliderPlugin(_options) {
		var $this = $(this);
		var $SliderWindow = $this.find('.slider_window');
		var $Slide = $this.find('.row');
		var defaults;
		var options;
		var $Controls;
		var $NextSlideButton;
		var $PrevSlideButton;
		var $PaginationHolder;
		// var $SlideMax;
		var i;
		var $PageControl;

		$this.css('overflow', 'hidden');
		$this.height($Slide.height());

		// SLIDER OPTIONS JUST ADD CLASS TO .slider
		defaults = {
			sliderName: 'slider',
			playSlides: 0,
			SlideNum: 0,
			SlideTimer: parseInt($this.attr('rel') * 1000, 10) || 9000,
			SlideSpeed: parseInt($SliderWindow.attr('rel') * 100, 10) || 900,
			HideSliderArrows: $this.hasClass('hideArrow'),
			HideSliderDots: $this.hasClass('hideDots'),
			SliderPageText: $this.hasClass('showPageText'),
			RecentlyViewed: $this.parent().hasClass('RV_container_rr'),
			HideSliderControls: $this.hasClass('hideControls'),
			MoveControls: $this.hasClass('moveControls'),
			SliderTypeVert: $this.hasClass('vert'),
			SliderTypeFade: $this.hasClass('fade'),
			SliderStopAutoRotate: $this.hasClass('noAuto'),
			BackgoundSlider: $this.hasClass('bgSlider'),
			SliderParentWidth: $this.width(),
			SliderParentHeight: $Slide.height(),
			currentThumb: '',
			NumberOfSlides: $Slide.length,
			newSlideNum: '',
			customControls: '',
			cloneSlides: true
		};

		options = $.extend({}, defaults, _options);

		options.SliderWindowWidth = (options.SliderParentWidth * options.NumberOfSlides);
		options.SliderWindowheight = options.SliderParentHeight;

		// BUILD & ASSIGN CONTROLS FROM DOM ELEMENTS
		function buildControls() {
			var $nextButton = '<a class="next"></a>';
			var $prevButton = '<a class="prev"></a>';

			if (options.SliderPageText && options.RecentlyViewed) {
				$nextButton = '<a class="next" cm_sp="d-recently_viewed-right_arrow"></a>';
				$prevButton = '<a class="prev" cm_sp="d-recently_viewed-left_arrow"></a>';
			} else if (options.SliderPageText && !options.RecentlyViewed) {
				$nextButton = '<a class="next"></a>';
				$prevButton = '<a class="prev"></a>';
			}

			if (options.MoveControls) {
				$this.after('<div class="clear"></div><div class="slider_controls">' + $nextButton + $prevButton + '<ul class="slider_pagination"></ul></div>');
			} else {
				$this.append('<div class="clear"></div><div class="slider_controls">' + $nextButton + $prevButton + '<ul class="slider_pagination"></ul></div>');
			}
		}

		buildControls();

		if (options.MoveControls) {
			$Controls = $this.next().next('.slider_controls');
		} else {
			$Controls = $this.find('.slider_controls');
		}

		// $SlideMax = Math.round(options.SliderParentWidth / 30 - 4);
		$NextSlideButton = $Controls.find('a.next');
		$PrevSlideButton = $Controls.find('a.prev');
		$PaginationHolder = $Controls.find('.slider_pagination');

		// Hide Controls
		$Controls.hide();

		function paginationDots() {
			if (options.NumberOfSlides > options.SlideMax) {
				options.HideSliderDots = true;
			}
		}

		paginationDots();

		// DYNAMICALLY BUILD PAGINATION AND ATTACH REL FOR POSITIONING
		if (!options.HideSliderDots) {
			for (i = 1; i <= options.NumberOfSlides; i++) {
				$PaginationHolder.append('<li class="pagination_control" rel="' + i + '"></li>');
			}
			// $PaginationHolder.append('<li class="pagination_control" rel="'+i+'"></li>');
		}

		// builds the initial text for the Text pagination
		if (options.SliderPageText) {
			$PaginationHolder.html('1 of ' + options.NumberOfSlides).addClass('pagination_text b large');
		}


		// CACHE PAGEINATION BUTTONS
		$PageControl = $Controls.find('.pagination_control');

		// added an additional class to give more flexibility on the buttons controls when disabled
		function showHideArrow() {
			if (options.SlideNum === options.NumberOfSlides - 1) {
				$NextSlideButton.addClass('disable-btn');
			} else {
				$NextSlideButton.removeClass('disable-btn');
			}

			if (options.SlideNum === 0) {
				$PrevSlideButton.addClass('disable-btn');
			} else {
				$PrevSlideButton.removeClass('disable-btn');
			}
		}

		function stopRotateSlides() {
			clearInterval(options.playSlides);
		}

		function slideVert() {
			stopRotateSlides();
			options.sliderWindowPosition = (options.SliderParentHeight * options.SlideNum);

			$SliderWindow.animate({
				marginTop: -options.sliderWindowPosition
			}, {
				duration: options.SlideSpeed,
				complete: function sliderAnimateComplete() {
					/* eslint-disable*/
					// Circular dependency means there is no way to get these functions in order
					rotateSlides();
					/*eslint-enable*/
				}
			});
		}

		function slideFade() {
			stopRotateSlides();
			$Slide.css({position: 'relative'}).fadeOut(options.SlideSpeed);

			setTimeout(function slideFadeTimeout() {
				// Gets rel of next active $PageControl
				options.PageNum = parseInt(options.SlideNum, 10);
				$SliderWindow.find($Slide[options.PageNum]).css({
					position: 'relative'}
				).fadeIn(options.SlideSpeed, function slideFadeInTimeout() {
					/* eslint-disable*/
					// Circular dependency means there is no way to get these functions in order
					rotateSlides();
					/*eslint-enable*/
				});
			}, options.SlideSpeed);
		}

		function slideHoriz() {
			stopRotateSlides();
			$SliderWindow.width(options.SliderWindowWidth);
			options.sliderWindowPosition = (options.SliderParentWidth * options.SlideNum);

			$SliderWindow.animate({
				right: options.sliderWindowPosition
			}, {
				duration: options.SlideSpeed,
				complete: function slidehorizAnimateComplete() {
					/* eslint-disable*/
					// Circular dependency means there is no way to get these functions in order
					rotateSlides();
					/*eslint-enable*/
				}
			});
		}

		function jumpToLast() {
			if (options.SliderTypeVert) {
				$SliderWindow.animate({
					marginTop: - ((options.SliderParentHeight * (options.NumberOfSlides - 1)))
				}, 0);

			// horizontal slider
			} else if (!options.SliderTypeFade) {
				$SliderWindow.animate({
					right: (options.SliderWindowWidth - options.SliderParentWidth)
				}, 0);
			}
		}

		// Jump to first slide after landing on clone
		function jumpToFirst() {
			if (options.SliderTypeVert) {
				$SliderWindow.animate({
					marginTop: '0px'
				}, 0);
			// horizontal slider
			} else if (!options.SliderTypeFade) {
				$SliderWindow.animate({
					right: '0px'
				}, 0);
			}
		}

		// Slide BG Image
		function bgSlider() {
			if (options.BackgoundSlider) {
				options.BGNum = parseInt(options.SlideNum, 10);

				$('img.iefullBG').fadeOut(options.SlideSpeed);

				options.BGNum ++;

				$('img.iefullBG[rel="' + options.BGNum + '"]')
					.fadeIn(options.SlideSpeed);
			}
		}

		function slideTo() {
			$PageControl.removeClass('active');

			if (options.HideSliderArrows) {
				showHideArrow();
			}

			if (options.SliderTypeVert) {
				slideVert();
			} else if (options.SliderTypeFade) {
				slideFade();
			} else {
				slideHoriz();
			}

			if (options.SlideNum === options.NumberOfSlides) {
				jumpToFirst();
				options.SlideNum = 0;
			} else if (options.SlideNum < 0) {
				jumpToLast();
				options.SlideNum = options.NumberOfSlides - 1;
			}

			// Gets rel of next active $PageControl
			options.PageNum = parseInt(options.SlideNum, 10);
			bgSlider();
			// Indicator for pagination
			$PaginationHolder.find($PageControl[options.PageNum]).addClass('active');

			if (options.SliderPageText) {
				$PaginationHolder.html(options.PageNum + 1 + ' of ' + options.NumberOfSlides);
			}
		}

		function rotateSlides() {
			stopRotateSlides();
			if (!options.SliderStopAutoRotate) {
				options.playSlides = setInterval(function rotateSlideInterval() {
					options.SlideNum ++;
					slideTo();
				}, options.SlideTimer);
			} else {
				stopRotateSlides();
			}
		}

		function controlOptions() {
			// Hide dots
			if (options.HideSliderDots) {
				$PaginationHolder.hide();
			}

			// MAKE FIRST PAGINATION ITEM ACTIVE
			$PageControl.first().addClass('active');

			// ON PAGINATION CLICK
			$PageControl.click(function pageControlClick() {
				options.SlideNum = $(this).attr('rel') - 1;
				slideTo();
				options.SliderStopAutoRotate = true;
			});

			// Control click functions
			$NextSlideButton.click(function nextSlideClick() {
				if (!$(this).hasClass('disable-btn') ) {
					options.SlideNum++;
					slideTo();
					options.SliderStopAutoRotate = true;
				}
			});

			$PrevSlideButton.click(function prevSlideClick() {
				if (!$(this).hasClass('disable-btn') ) {
					options.SlideNum--;
					slideTo();
					options.SliderStopAutoRotate = true;
				}
			});

			// hover and hover off
			$this.hover(function sliderHoverIn() {
				stopRotateSlides();
			}, function sliderHoverOut() {
				rotateSlides();
			});
		}

		function customControls() {
			THD.thdSliderCustomControls = (THD.thdSliderCustomControls) ? THD.thdSliderCustomControls : {};
			THD.thdSliderCustomControls = {
				slideNum: options.newSlideNum,
				updateSlide: options.updateSlide,
				nextBtn: options.customControls.nextBtn,
				prevBtn: options.customControls.prevBtn
			};
			options.SlideNum = THD.thdSliderCustomControls.slideNum;
			slideTo();
			options.SliderStopAutoRotate = true;

			function updateSlide() {
				options.SlideNum = parseInt(THD.thdSliderCustomControls.slideNum, 10);
				slideTo();
				options.SliderStopAutoRotate = true;
			}

			$(options.customControls.updateSlide).click(function updateSlideClick() {
				if (parseInt(options.SlideNum, 10) !== parseInt(THD.thdSliderCustomControls.slideNum, 10)) {
					updateSlide();
				}
			});
			$(options.customControls.nextBtn).click(function nextBtnClick() {
				if (parseInt(options.SlideNum, 10) !== parseInt(THD.thdSliderCustomControls.slideNum, 10)) {
					updateSlide();
				}
			});
			$(options.customControls.prevBtn).click(function prevBtnClick() {
				if (parseInt(options.SlideNum, 10) !== parseInt(THD.thdSliderCustomControls.slideNum, 10)) {
					updateSlide();
				}
			});
		}

		// Show Slider Controls Default
		function showControls() {
			if (!options.HideSliderControls) {
				if (options.HideSliderArrows) {
					showHideArrow();
				}
				$Controls.fadeIn();
			// Show Slider conntrols on hover
			} else{
				$this.hover(function sliderHoverIn() {
					$Controls.fadeIn();
				}, function sliderHoverOut() {
					$Controls.fadeOut();
				});
			}
		}

		// Cloning first and last slides
		function cloneSlide() {
			var $FirstSlide = $Slide.first().clone();
			var $LastSlide = $Slide.last().clone();

			if (!options.SliderTypeFade && !options.HideSliderArrows) {
				if (options.SliderTypeVert) {
					$SliderWindow.prepend($LastSlide.css({
						position: 'relative',
						marginTop: - (options.SliderParentHeight)
					}));

					$SliderWindow.append($FirstSlide);
				} else {
					$SliderWindow.append($FirstSlide.css({
						position: 'absolute',
						left: options.SliderWindowWidth,
						width: '100%'
					}));

					$SliderWindow.prepend($LastSlide.css({
						position: 'absolute',
						left: - options.SliderParentWidth
					}));
				}
			}
		}

		function loadSlides() {
			// Var to Check if ajax URL is good
			var checkURL = true;

			// Loads Content
			$Slide.each(function loadSlidesEach(x) {
				var $AjaxSlide;
				x++;
				$AjaxSlide = $(this).attr('ajaxSlide');
				if (!$AjaxSlide && x === 2) {
					showControls();
					if (options.cloneSlides) {
						cloneSlide();
					}
					controlOptions();
					rotateSlides();
				} else if ($AjaxSlide && x > 1) {
					$(this).find('.pod')
						.load($AjaxSlide, function sliderLoad(response, status) {
							if (status === 'success') {
								if (x === options.NumberOfSlides && checkURL === true) {
									showControls();
									if (options.cloneSlides) {
										cloneSlide();
									}
									controlOptions();
									rotateSlides();
								}
							} else if (status === 'error') {
								checkURL = false;
							}
						});
				}
			});
		}

		// $(window).load(function(){loadSlides();});
		loadSlides();

		if (options.newSlideNum || options.customControls) {
			customControls();
		}

		// returns the jQuery object to allow for chainability.
		$this.removeClass(options.sliderName);

		return this;
	};

	function init() {
		var heroSlider;
		var counterInterval;
		var intervalId;

		// Slider adjustments for the Hero
		heroSlider = Boolean($('.homepage .grid_30.slider').find('.hero_wrapper').length);

		if (heroSlider && $('.tophat').children().hasClass('slider', 'hero_wrapper')) {
			$('.homepage .grid_30.slider:not(":first")').addClass('hero_slider');
		} else if (heroSlider) {
			$('.homepage .grid_30.slider:first').addClass('hero_slider');
		}

		$('.sliderInlinePlayer').each(function sliderInlinePlayerEach() {
			$(this).imagesLoaded(function sliderInlinePlayerImagesLoaded() {
				// Not sure where this comes from
				if (window.thd && window.thd.buildProduct && window.thd.buildProduct.inlinePlayer && window.thd.buildProduct.inlinePlayer.sliderOptions) {
					$(this).thdSlider(window.thd.buildProduct.inlinePlayer.sliderOptions);
				}
			});
		});

		function setSlider() {
			counterInterval++;
			if ($('.slider').length > 0) {
				$('.slider').each(function sliderEach() {
					$(this).imagesLoaded(function sliderEachImagesLoaded() {
						$(this).thdSlider();
					});
				});
				clearInterval(intervalId);
			} else {
				if (counterInterval > 12) {
					clearInterval(intervalId);
				}
			}
		}

		if ($('.slider').length > 0) {
			$('.slider').each(function sliderEach() {
				$(this).imagesLoaded(function sliderImagesLoaded() {
					$(this).thdSlider();
				});
			});
		} else {
			counterInterval = 0;
			intervalId = setInterval(setSlider, 250);
		}
	}

	init();

	return {
		init: init
	};
});


(function closure(root, factory) {
	if(typeof define === 'function' && define.amd) {
		define('thdTheme',['jquery', 'thdSlider'],
			function load($, thdSlider) {
				return factory(root, $, thdSlider);
			});
	} else{
		// For non-AMD module, expose this to global (will also be useful for test cases)
		/* eslint-disable*/
		factory(root, jQuery);
		/*eslint-enable*/
	}
})(this, function factory(root, $) {
	//  thdTheme - Funtion to set the page background image/s, container_30 background image and the pod background image
	var $body = $('body');
	var pageID = $('#container').attr('data-thdtheme').split('-');
	var ext = pageID.pop();
	var lastNode = pageID.pop();
	var bgStyle;
	var pageTheme;
	var pageThemeDir;
	var heroSlider;

	// SlideBackground = false; // Defined in cartridge.js
	// Checks to see if there's a container background.
	if (lastNode === 'containerBG') {
		bgStyle = pageID.pop();
	} else {
		bgStyle = lastNode;
	}

	pageTheme = pageID.join('-');
	pageThemeDir = pageTheme.replace(/-/g, '/');

	$body.addClass(pageTheme + ' ' + bgStyle);

	if (lastNode === 'containerBG') {
		$('#container').css({'background-image': 'url(http://www.homedepot.com/hdus/en_US/DTCCOM/common/Themes/' + pageThemeDir + '/containerBG.jpg', 'background-repeat': 'no-repeat'});
	}

	$('.podBG').css('background-image', 'url(http://www.homedepot.com/hdus/en_US/DTCCOM/common/Themes/' + pageThemeDir + '/podBG.' + ext + ')');

	switch (bgStyle) {
	case 'fullBGSlider':
		heroSlider = Boolean($('.homepage .grid_30.slider').find('.hero_wrapper').length);
		if (heroSlider && $('.tophat').children().hasClass('slider')) {
			$('.homepage .grid_30.slider:not("first")').addClass('bgSlider');
		} else if (heroSlider) {
			$('.homepage .grid_30.slider:first').addClass('bgSlider');
		}

		$(function fullBGSliderOnLoad() {
			var i;
			var $HeroBG;
			var $Slider = $('.slider:first .slider_window');

			// Finds the amount of slides
			var $SlideCount = $Slider.find('.row').length;

			$body.css('background', 'none');

			// Loop to append background images to be used for the background slider
			for (i = 1; i <= $SlideCount; i++) {
				$HeroBG = '<img class="iefullBG" src="http://www.homedepot.com/hdus/en_US/DTCCOM/common/Themes/' + pageThemeDir + '/bgSlide' + i + '.jpg" rel="' + i + '>';
				$body.append($HeroBG);
			}

			$('.iefullBG[rel="1"]').fadeIn(1000);
		});

		break;
	case 'fullBG':
		$(function fullBGOnLoad() {
			$body.css('background', 'none').append('<img class="iefullBG" src="http://www.homedepot.com/hdus/en_US/DTCCOM/common/Themes/' + pageThemeDir + '/bg.jpg">');
			$('.iefullBG').fadeIn(1000);
		});
		break;
	case 'tileBG':
		$(function tileBGOnLoad() {
			$body.css('background', 'url(http://www.homedepot.com/hdus/en_US/DTCCOM/common/Themes/' + pageThemeDir + '/bg.jpg) repeat fixed left top transparent');
		});
		break;
	case 'fullTC':
		$(function fullTCOnLoad() {
			$body.css('background', 'url(http://www.homedepot.com/hdus/en_US/DTCCOM/common/Themes/' + pageThemeDir + '/bg.jpg) no-repeat center top transparent');
		});
		break;
	default:
		/*eslint-disable*/
		console.log('hit default state')
		/*eslint-enable*/
		break;
	}

	if (Boolean($('.slider').length)) {
		// Get the slider and call it.
		require('thdSlider').init();
	}
});

// DXC Updates to this plugin. General Clean Up and performance tweaks
(function closure(root, factory) {
	if(typeof define === 'function' && define.amd) {
		define('thdSliderV2',['jquery', 'jquery-imagesloaded'], function load(jQuery) {
			return factory(jQuery);
		});
	} else{
		/*eslint-disable*/
		factory(jQuery);
		/*eslint-enable*/
	}
})(this, function factory($) {
	if ($.fn.thdSliderV2) {
		return $.fn.thdSliderV2;
	}

	$.fn.thdSliderV2 = function thdSliderV2(opts) {
		var $this = $(this);
		var $sliderWindow = $this.find('.slider_window');
		var $slide = $sliderWindow.children('.row');

		// SLIDER OPTIONS JUST ADD CLASS TO .slider
		var defaults = {
			sliderName: $this.attr('data-sliderName') || 'sliderV2',
			initialLoad: true,
			playSlides: 0,
			slideNum: 0,
			SlideTimer: parseInt($this.attr('rel') * 1000, 10) || 9000,
			SlideSpeed: parseInt($sliderWindow.attr('rel') * 100, 10) || 900,
			carouselOn: Boolean($this.attr('data-carousel')), // for all Boolean values only return true, false will also evaluate to true "" will evaluate to false.
			showPagination: Boolean($this.attr('data-show-pagination')),
			paginationType: $this.attr('data-pagination-type') || 'dots',
			recentlyViewed: Boolean($this.attr('data-recently-viewed')),
			showControls: Boolean($this.attr('data-show-controls')),
			controlPosition: $this.attr('data-controls-position') || 'inset',
			sliderType: $this.attr('data-slider-type') || 'horizontal', // options horizontal, vertical, fade
			autoStart: Boolean($this.attr('data-auto-start')),
			sliderParentWidth: $this.width(),
			sliderParentHeight: $slide.height(),
			numberOfSlides: $slide.length,
			templates: {
				controls: {
					next: '<a class="next"></a>',
					previous: '<a class="prev"></a>'
				}
			}
		};
		var options = $.extend({}, defaults, opts);
		var $Controls;

		// BUILD & ASSIGN CONTROLS FROM DOM ELEMENTS
		var buildControls = function buildControls() {
			var $nextButton = options.templates.controls.next;
			var $prevButton = options.templates.controls.previous;
			if (options.controlPosition === 'inset') {
				$this.append('<div class="clear"></div><div class="slider_controls">' + $nextButton + $prevButton + '<ul class="slider_pagination"></ul></div>');
			} else {
				$this.after('<div class="clear"></div><div class="slider_controls">' + $nextButton + $prevButton + '<ul class="slider_pagination"></ul></div>');
			}
		};

		var $NextSlideButton;
		var $PrevSlideButton;
		var $PaginationHolder;
		var $PageControl;

		// var $slideMax;

		var i;

		$this.css('overflow', 'hidden');
		$this.height($slide.height());


		options.sliderWindowWidth = (options.sliderParentWidth * options.numberOfSlides);
		options.sliderWindowHeight = options.sliderParentHeight;

		if (options.sliderType === 'vertical') {
			$this.addClass('vert');
		}

		buildControls();


		if (options.controlPosition === 'inset') {
			$Controls = $this.find('.slider_controls');
		} else {
			$Controls = $this.next().next('.slider_controls');
		}

		$NextSlideButton = $Controls.find('a.next');
		$PrevSlideButton = $Controls.find('a.prev');
		$PaginationHolder = $Controls.find('.slider_pagination');
		// $slideMax = Math.round(options.sliderParentWidth / 30 - 4);

		if(options.recentlyViewed) {
			$NextSlideButton.attr('cm_sp', 'd-recently_viewed-right_arrow');
			$PrevSlideButton.attr('cm_sp', 'd-recently_viewed-left_arrow');
		}
		// Hide Controls
		$Controls.hide();

		if (options.numberOfSlides > options.SlideMax) {
			options.showPagination = false;
		}

		// DYNAMICALLY BUILD PAGINATION AND ATTACH REL FOR POSITIONING
		if (options.showPagination) {
			for (i = 1; i <= options.numberOfSlides; i++) {
				$PaginationHolder.append('<li class="pagination_control" rel="' + i + '"></li>');
			}
		}
		// builds the initial text for the Text pagination
		if (options.paginationType === 'pageNumbers') {
			$PaginationHolder.html('1 of ' + options.numberOfSlides).addClass('pagination_text b large');
		}

		// CACHE PAGEINATION BUTTONS
		$PageControl = $Controls.find('.pagination_control');

		// Jump to first slide after landing on clone
		function jumpToFirst() {
			if (options.sliderType === 'vertical') {
				$sliderWindow.animate({
					marginTop: '0px'
				}, 0);
			} else if (options.sliderType === 'horizontal') {
				$sliderWindow.animate({right: '0px'}, 0);
			}
		}
		// Jump to last slide after landing on clone
		function jumpToLast() {
			if (options.sliderType === 'vertical') {
				$sliderWindow.animate({
					marginTop: - ((options.sliderParentHeight * (options.numberOfSlides - 1)))
				}, 0);
			} else if (options.sliderType === 'horizontal') {
				$sliderWindow.animate({
					right: (options.sliderWindowWidth - options.sliderParentWidth)
				}, 0);
			}
		}

		// added an additional class to give more flexibility on the buttons controls when disabled
		function showHideArrow() {
			if (options.slideNum === options.numberOfSlides - 1) {
				$NextSlideButton.addClass('disable-btn');
			} else {
				$NextSlideButton.removeClass('disable-btn');
			}

			if (options.slideNum === 0) {
				$PrevSlideButton.addClass('disable-btn');
			} else {
				$PrevSlideButton.removeClass('disable-btn');
			}
		}

		function stopRotateSlides() {
			clearInterval(options.playSlides);
		}

		// Set Auto Rotate
		function rotateSlides() {
			stopRotateSlides();
			if (options.autoStart) {
				options.playSlides = setInterval(function interval() {
					options.slideNum ++;
					slideTo();
				}, options.SlideTimer);
			} else {
				stopRotateSlides();
			}
		}

		function slideVert() {
			stopRotateSlides();
			options.sliderWindowPosition = (options.sliderParentHeight * options.slideNum);
			$sliderWindow.animate({
				marginTop: - options.sliderWindowPosition
			}, {
				duration: options.slideSpeed,
				complete: function complete() {
					rotateSlides();
				}
			});
		}

		function slideFade() {
			stopRotateSlides();
			$slide.css({position: 'relative'}).fadeOut(options.slideSpeed);
			setTimeout(function to() {
				options.PageNum = parseInt(options.slideNum, 10); // Gets rel of next active $PageControl
				$sliderWindow
					.find($slide[options.PageNum])
					.css({position: 'relative'})
					.fadeIn(options.slideSpeed, function fadeIn() {
						rotateSlides();
					});
			}, options.slideSpeed);
		}

		function slideHoriz() {
			stopRotateSlides();
			$sliderWindow.width(options.sliderWindowWidth);
			options.sliderWindowPosition = (options.sliderParentWidth * options.slideNum);
			$sliderWindow.animate({
				right: options.sliderWindowPosition
			}, {
				duration: options.slideSpeed,
				complete: function complete() {
					rotateSlides();
				}
			});
		}

		function slideTo() {
			$PageControl.removeClass('active');
			if (!options.carouselOn) {
				showHideArrow();
			}
			if (options.sliderType === 'vertical') {
				slideVert();
			} else if (options.sliderType === 'fade') {
				slideFade();
			} else {
				slideHoriz();
			}

			if (options.slideNum === options.numberOfSlides) {
				jumpToFirst();
				options.slideNum = 0;
			} else if (options.slideNum < 0) {
				jumpToLast();
				options.slideNum = options.numberOfSlides - 1;
			}
			// Gets rel of next active $PageControl
			options.PageNum = parseInt(options.slideNum, 10);
			// Indicator for pagination
			$PaginationHolder.find($PageControl[options.PageNum]).addClass('active');

			if (options.paginationType === 'pageNumbers') {
				$PaginationHolder.html(options.PageNum + 1 + ' of ' + options.numberOfSlides);
			}
		}

		function controlOptions() {
			// Hide dots
			if (!options.showPagination) {
				$PaginationHolder.hide();
			}
			// MAKE FIRST PAGINATION ITEM ACTIVE
			$PageControl.first().addClass('active');
			// ON PAGINATION CLICK
			$PageControl.click(function click() {
				options.slideNum = $(this).attr('rel') - 1;
				slideTo();
				options.autoStart = false;
			});
			// Control click functions
			$NextSlideButton.click(function click() {
				if (!$(this).hasClass('disable-btn') ) {
					options.slideNum ++;
					slideTo();
					options.autoStart = false;
				}
			});
			$PrevSlideButton.click(function click() {
				if ( !$(this).hasClass('disable-btn') ) {
					options.slideNum --;
					slideTo();
					options.autoStart = false;
				}
			});
			// hover and hover off
			$this.hover(function hover() {
				stopRotateSlides();
			}, function hoveroff() {
				rotateSlides();
			});
		}

		// Trigger the event by updating hidden input field with the page you'd like to show: $('element').find('.pageNum').val(value).trigger('change');
		function customControls() {
			if (options.initialLoad) {
				$this.append('<input class="pageNum" type="hidden" value="' + options.slideNum + '">');
			}
			$this.find('.pageNum').change(function change() {
				options.slideNum = parseInt($(this).val(), 10) - 1;
				slideTo();
				options.autoStart = false;
			});
		}
		// Show Slider Controls Default
		function showControls() {
			if (options.showControls) {
				if (!options.carouselOn) {
					showHideArrow();
				}
				$Controls.fadeIn();
			} else {
				$this.hover(function hover() {
					// Show Slider conntrols on hover
					$Controls.fadeIn();
				}, function hoverout() {
					$Controls.fadeOut();
				});
			}
		}
		// Cloning first and last slides
		function cloneSlide() {
			var $FirstSlide = $slide.first().clone();
			var $LastSlide = $slide.last().clone();
			if (options.sliderType === 'vertical') {
				$sliderWindow.prepend($LastSlide.css({
					position: 'relative',
					marginTop: - (options.sliderParentHeight)
				}));
				$sliderWindow.append($FirstSlide);
			} else if (options.sliderType === 'horizontal') {
				$sliderWindow.append($FirstSlide.css({
					position: 'absolute',
					left: options.sliderWindowWidth,
					width: '100%'
				}));
				$sliderWindow.prepend($LastSlide.css({
					position: 'absolute',
					left: - options.sliderParentWidth
				}));
			}
		}

		function loadSlides() {
			// Var to Check if ajax URL is good
			var checkURL = true;
			var n;
			var $AjaxSlide;
			// Loads Content
			if ($slide.length > 1) {
				showControls();
				customControls();
				if (options.carouselOn) {
					cloneSlide();
				}
				controlOptions();
				rotateSlides();
				for (n = 1; n < $slide.length; n++) {
					$AjaxSlide = $(this).attr('data-ajaxSlide');
					if ($AjaxSlide && i > 1){
						$(this).find('.pod').load($AjaxSlide, function(response, status, xhr){
							if (status === "success"){
									if (i === options.numberOfSlides && checkURL === true){
										showControls();
										if(options.carouselOn){
											cloneSlide();
										}
										controlOptions();
										rotateSlides();
									}
							} else if (status === 'error') {
								checkURL = false;
							}
						});
					}
				}
			}
			options.initialLoad = false;
		}


		// $(window).load(function(){loadSlides();});
		loadSlides();
		// returns the jQuery object to allow for chainability.
		$this.removeClass(options.sliderName);
		$this.addClass('sliderDone');

		return this;  
	};

	$(function docReady() {
		$('.sliderV2').each(function ea(){
			$(this).imagesLoaded(function imagesLoaded() {
				$(this).thdSliderV2();
			});
		});
	});

	return $.fn.thdSliderV2;
});

/*! Hammer.JS - v1.0.5 - 2013-04-07
 * http://eightmedia.github.com/hammer.js
 *
 * Copyright (c) 2013 Jorik Tangelder <j.tangelder@gmail.com>;
 * Licensed under the MIT license */

(function(window, undefined) {
    'use strict';

/**
 * Hammer
 * use this to create instances
 * @param   {HTMLElement}   element
 * @param   {Object}        options
 * @returns {Hammer.Instance}
 * @constructor
 */
var Hammer = function(element, options) {
    return new Hammer.Instance(element, options || {});
};

// default settings
Hammer.defaults = {
    // add styles and attributes to the element to prevent the browser from doing
    // its native behavior. this doesnt prevent the scrolling, but cancels
    // the contextmenu, tap highlighting etc
    // set to false to disable this
    stop_browser_behavior: {
		// this also triggers onselectstart=false for IE
        userSelect: 'none',
		// this makes the element blocking in IE10 >, you could experiment with the value
		// see for more options this issue; https://github.com/EightMedia/hammer.js/issues/241
        touchAction: 'none',
		touchCallout: 'none',
        contentZooming: 'none',
        userDrag: 'none',
        tapHighlightColor: 'rgba(0,0,0,0)'
    }

    // more settings are defined per gesture at gestures.js
};

// detect touchevents
Hammer.HAS_POINTEREVENTS = navigator.pointerEnabled || navigator.msPointerEnabled;
Hammer.HAS_TOUCHEVENTS = ('ontouchstart' in window);

// dont use mouseevents on mobile devices
Hammer.MOBILE_REGEX = /mobile|tablet|ip(ad|hone|od)|android/i;
Hammer.NO_MOUSEEVENTS = Hammer.HAS_TOUCHEVENTS && navigator.userAgent.match(Hammer.MOBILE_REGEX);

// eventtypes per touchevent (start, move, end)
// are filled by Hammer.event.determineEventTypes on setup
Hammer.EVENT_TYPES = {};

// direction defines
Hammer.DIRECTION_DOWN = 'down';
Hammer.DIRECTION_LEFT = 'left';
Hammer.DIRECTION_UP = 'up';
Hammer.DIRECTION_RIGHT = 'right';

// pointer type
Hammer.POINTER_MOUSE = 'mouse';
Hammer.POINTER_TOUCH = 'touch';
Hammer.POINTER_PEN = 'pen';

// touch event defines
Hammer.EVENT_START = 'start';
Hammer.EVENT_MOVE = 'move';
Hammer.EVENT_END = 'end';

// hammer document where the base events are added at
Hammer.DOCUMENT = document;

// plugins namespace
Hammer.plugins = {};

// if the window events are set...
Hammer.READY = false;

/**
 * setup events to detect gestures on the document
 */
function setup() {
    if(Hammer.READY) {
        return;
    }

    // find what eventtypes we add listeners to
    Hammer.event.determineEventTypes();

    // Register all gestures inside Hammer.gestures
    for(var name in Hammer.gestures) {
        if(Hammer.gestures.hasOwnProperty(name)) {
            Hammer.detection.register(Hammer.gestures[name]);
        }
    }

    // Add touch events on the document
    Hammer.event.onTouch(Hammer.DOCUMENT, Hammer.EVENT_MOVE, Hammer.detection.detect);
    Hammer.event.onTouch(Hammer.DOCUMENT, Hammer.EVENT_END, Hammer.detection.detect);

    // Hammer is ready...!
    Hammer.READY = true;
}

/**
 * create new hammer instance
 * all methods should return the instance itself, so it is chainable.
 * @param   {HTMLElement}       element
 * @param   {Object}            [options={}]
 * @returns {Hammer.Instance}
 * @constructor
 */
Hammer.Instance = function(element, options) {
    var self = this;

    // setup HammerJS window events and register all gestures
    // this also sets up the default options
    setup();

    this.element = element;

    // start/stop detection option
    this.enabled = true;

    // merge options
    this.options = Hammer.utils.extend(
        Hammer.utils.extend({}, Hammer.defaults),
        options || {});

    // add some css to the element to prevent the browser from doing its native behavoir
    if(this.options.stop_browser_behavior) {
        Hammer.utils.stopDefaultBrowserBehavior(this.element, this.options.stop_browser_behavior);
    }

    // start detection on touchstart
    Hammer.event.onTouch(element, Hammer.EVENT_START, function(ev) {
        if(self.enabled) {
            Hammer.detection.startDetect(self, ev);
        }
    });

    // return instance
    return this;
};


Hammer.Instance.prototype = {
    /**
     * bind events to the instance
     * @param   {String}      gesture
     * @param   {Function}    handler
     * @returns {Hammer.Instance}
     */
    on: function onEvent(gesture, handler){
        var gestures = gesture.split(' ');
        for(var t=0; t<gestures.length; t++) {
            this.element.addEventListener(gestures[t], handler, false);
        }
        return this;
    },


    /**
     * unbind events to the instance
     * @param   {String}      gesture
     * @param   {Function}    handler
     * @returns {Hammer.Instance}
     */
    off: function offEvent(gesture, handler){
        var gestures = gesture.split(' ');
        for(var t=0; t<gestures.length; t++) {
            this.element.removeEventListener(gestures[t], handler, false);
        }
        return this;
    },


    /**
     * trigger gesture event
     * @param   {String}      gesture
     * @param   {Object}      eventData
     * @returns {Hammer.Instance}
     */
    trigger: function triggerEvent(gesture, eventData){
        // create DOM event
        var event = Hammer.DOCUMENT.createEvent('Event');
		event.initEvent(gesture, true, true);
		event.gesture = eventData;

        // trigger on the target if it is in the instance element,
        // this is for event delegation tricks
        var element = this.element;
        if(Hammer.utils.hasParent(eventData.target, element)) {
            element = eventData.target;
        }

        element.dispatchEvent(event);
        return this;
    },


    /**
     * enable of disable hammer.js detection
     * @param   {Boolean}   state
     * @returns {Hammer.Instance}
     */
    enable: function enable(state) {
        this.enabled = state;
        return this;
    }
};

/**
 * this holds the last move event,
 * used to fix empty touchend issue
 * see the onTouch event for an explanation
 * @type {Object}
 */
var last_move_event = null;


/**
 * when the mouse is hold down, this is true
 * @type {Boolean}
 */
var enable_detect = false;


/**
 * when touch events have been fired, this is true
 * @type {Boolean}
 */
var touch_triggered = false;


Hammer.event = {
    /**
     * simple addEventListener
     * @param   {HTMLElement}   element
     * @param   {String}        type
     * @param   {Function}      handler
     */
    bindDom: function(element, type, handler) {
        var types = type.split(' ');
        for(var t=0; t<types.length; t++) {
            element.addEventListener(types[t], handler, false);
        }
    },


    /**
     * touch events with mouse fallback
     * @param   {HTMLElement}   element
     * @param   {String}        eventType        like Hammer.EVENT_MOVE
     * @param   {Function}      handler
     */
    onTouch: function onTouch(element, eventType, handler) {
		var self = this;

        this.bindDom(element, Hammer.EVENT_TYPES[eventType], function bindDomOnTouch(ev) {
            var sourceEventType = ev.type.toLowerCase();

            // onmouseup, but when touchend has been fired we do nothing.
            // this is for touchdevices which also fire a mouseup on touchend
            if(sourceEventType.match(/mouse/) && touch_triggered) {
                return;
            }

            // mousebutton must be down or a touch event
            else if( sourceEventType.match(/touch/) ||   // touch events are always on screen
                sourceEventType.match(/pointerdown/) || // pointerevents touch
                (sourceEventType.match(/mouse/) && ev.which === 1)   // mouse is pressed
            ){
                enable_detect = true;
            }

            // we are in a touch event, set the touch triggered bool to true,
            // this for the conflicts that may occur on ios and android
            if(sourceEventType.match(/touch|pointer/)) {
                touch_triggered = true;
            }

            // count the total touches on the screen
            var count_touches = 0;

            // when touch has been triggered in this detection session
            // and we are now handling a mouse event, we stop that to prevent conflicts
            if(enable_detect) {
                // update pointerevent
                if(Hammer.HAS_POINTEREVENTS && eventType != Hammer.EVENT_END) {
                    count_touches = Hammer.PointerEvent.updatePointer(eventType, ev);
                }
                // touch
                else if(sourceEventType.match(/touch/)) {
                    count_touches = ev.touches.length;
                }
                // mouse
                else if(!touch_triggered) {
                    count_touches = sourceEventType.match(/up/) ? 0 : 1;
                }

                // if we are in a end event, but when we remove one touch and
                // we still have enough, set eventType to move
                if(count_touches > 0 && eventType == Hammer.EVENT_END) {
                    eventType = Hammer.EVENT_MOVE;
                }
                // no touches, force the end event
                else if(!count_touches) {
                    eventType = Hammer.EVENT_END;
                }

                // because touchend has no touches, and we often want to use these in our gestures,
                // we send the last move event as our eventData in touchend
                if(!count_touches && last_move_event !== null) {
                    ev = last_move_event;
                }
                // store the last move event
                else {
                    last_move_event = ev;
                }

                // trigger the handler
                handler.call(Hammer.detection, self.collectEventData(element, eventType, ev));

                // remove pointerevent from list
                if(Hammer.HAS_POINTEREVENTS && eventType == Hammer.EVENT_END) {
                    count_touches = Hammer.PointerEvent.updatePointer(eventType, ev);
                }
            }

            //debug(sourceEventType +" "+ eventType);

            // on the end we reset everything
            if(!count_touches) {
                last_move_event = null;
                enable_detect = false;
                touch_triggered = false;
                Hammer.PointerEvent.reset();
            }
        });
    },


    /**
     * we have different events for each device/browser
     * determine what we need and set them in the Hammer.EVENT_TYPES constant
     */
    determineEventTypes: function determineEventTypes() {
        // determine the eventtype we want to set
        var types;

        // pointerEvents magic
        if(Hammer.HAS_POINTEREVENTS) {
            types = Hammer.PointerEvent.getEvents();
        }
        // on Android, iOS, blackberry, windows mobile we dont want any mouseevents
        else if(Hammer.NO_MOUSEEVENTS) {
            types = [
                'touchstart',
                'touchmove',
                'touchend touchcancel'];
        }
        // for non pointer events browsers and mixed browsers,
        // like chrome on windows8 touch laptop
        else {
            types = [
                'touchstart mousedown',
                'touchmove mousemove',
                'touchend touchcancel mouseup'];
        }

        Hammer.EVENT_TYPES[Hammer.EVENT_START]  = types[0];
        Hammer.EVENT_TYPES[Hammer.EVENT_MOVE]   = types[1];
        Hammer.EVENT_TYPES[Hammer.EVENT_END]    = types[2];
    },


    /**
     * create touchlist depending on the event
     * @param   {Object}    ev
     * @param   {String}    eventType   used by the fakemultitouch plugin
     */
    getTouchList: function getTouchList(ev/*, eventType*/) {
        // get the fake pointerEvent touchlist
        if(Hammer.HAS_POINTEREVENTS) {
            return Hammer.PointerEvent.getTouchList();
        }
        // get the touchlist
        else if(ev.touches) {
            return ev.touches;
        }
        // make fake touchlist from mouse position
        else {
            return [{
                identifier: 1,
                pageX: ev.pageX,
                pageY: ev.pageY,
                target: ev.target
            }];
        }
    },


    /**
     * collect event data for Hammer js
     * @param   {HTMLElement}   element
     * @param   {String}        eventType        like Hammer.EVENT_MOVE
     * @param   {Object}        eventData
     */
    collectEventData: function collectEventData(element, eventType, ev) {
        var touches = this.getTouchList(ev, eventType);

        // find out pointerType
        var pointerType = Hammer.POINTER_TOUCH;
        if(ev.type.match(/mouse/) || Hammer.PointerEvent.matchType(Hammer.POINTER_MOUSE, ev)) {
            pointerType = Hammer.POINTER_MOUSE;
        }

        return {
            center      : Hammer.utils.getCenter(touches),
            timeStamp   : new Date().getTime(),
            target      : ev.target,
            touches     : touches,
            eventType   : eventType,
            pointerType : pointerType,
            srcEvent    : ev,

            /**
             * prevent the browser default actions
             * mostly used to disable scrolling of the browser
             */
            preventDefault: function() {
                if(this.srcEvent.preventManipulation) {
                    this.srcEvent.preventManipulation();
                }

                if(this.srcEvent.preventDefault) {
                    this.srcEvent.preventDefault();
                }
            },

            /**
             * stop bubbling the event up to its parents
             */
            stopPropagation: function() {
                this.srcEvent.stopPropagation();
            },

            /**
             * immediately stop gesture detection
             * might be useful after a swipe was detected
             * @return {*}
             */
            stopDetect: function() {
                return Hammer.detection.stopDetect();
            }
        };
    }
};

Hammer.PointerEvent = {
    /**
     * holds all pointers
     * @type {Object}
     */
    pointers: {},

    /**
     * get a list of pointers
     * @returns {Array}     touchlist
     */
    getTouchList: function() {
        var self = this;
        var touchlist = [];

        // we can use forEach since pointerEvents only is in IE10
        Object.keys(self.pointers).sort().forEach(function(id) {
            touchlist.push(self.pointers[id]);
        });
        return touchlist;
    },

    /**
     * update the position of a pointer
     * @param   {String}   type             Hammer.EVENT_END
     * @param   {Object}   pointerEvent
     */
    updatePointer: function(type, pointerEvent) {
        if(type == Hammer.EVENT_END) {
            this.pointers = {};
        }
        else {
            pointerEvent.identifier = pointerEvent.pointerId;
            this.pointers[pointerEvent.pointerId] = pointerEvent;
        }

        return Object.keys(this.pointers).length;
    },

    /**
     * check if ev matches pointertype
     * @param   {String}        pointerType     Hammer.POINTER_MOUSE
     * @param   {PointerEvent}  ev
     */
    matchType: function(pointerType, ev) {
        if(!ev.pointerType) {
            return false;
        }

        var types = {};
        types[Hammer.POINTER_MOUSE] = (ev.pointerType == ev.MSPOINTER_TYPE_MOUSE || ev.pointerType == Hammer.POINTER_MOUSE);
        types[Hammer.POINTER_TOUCH] = (ev.pointerType == ev.MSPOINTER_TYPE_TOUCH || ev.pointerType == Hammer.POINTER_TOUCH);
        types[Hammer.POINTER_PEN] = (ev.pointerType == ev.MSPOINTER_TYPE_PEN || ev.pointerType == Hammer.POINTER_PEN);
        return types[pointerType];
    },


    /**
     * get events
     */
    getEvents: function() {
        return [
            'pointerdown MSPointerDown',
            'pointermove MSPointerMove',
            'pointerup pointercancel MSPointerUp MSPointerCancel'
        ];
    },

    /**
     * reset the list
     */
    reset: function() {
        this.pointers = {};
    }
};


Hammer.utils = {
    /**
     * extend method,
     * also used for cloning when dest is an empty object
     * @param   {Object}    dest
     * @param   {Object}    src
	 * @parm	{Boolean}	merge		do a merge
     * @returns {Object}    dest
     */
    extend: function extend(dest, src, merge) {
        for (var key in src) {
			if(dest[key] !== undefined && merge) {
				continue;
			}
            dest[key] = src[key];
        }
        return dest;
    },


    /**
     * find if a node is in the given parent
     * used for event delegation tricks
     * @param   {HTMLElement}   node
     * @param   {HTMLElement}   parent
     * @returns {boolean}       has_parent
     */
    hasParent: function(node, parent) {
        while(node){
            if(node == parent) {
                return true;
            }
            node = node.parentNode;
        }
        return false;
    },


    /**
     * get the center of all the touches
     * @param   {Array}     touches
     * @returns {Object}    center
     */
    getCenter: function getCenter(touches) {
        var valuesX = [], valuesY = [];

        for(var t= 0,len=touches.length; t<len; t++) {
            valuesX.push(touches[t].pageX);
            valuesY.push(touches[t].pageY);
        }

        return {
            pageX: ((Math.min.apply(Math, valuesX) + Math.max.apply(Math, valuesX)) / 2),
            pageY: ((Math.min.apply(Math, valuesY) + Math.max.apply(Math, valuesY)) / 2)
        };
    },


    /**
     * calculate the velocity between two points
     * @param   {Number}    delta_time
     * @param   {Number}    delta_x
     * @param   {Number}    delta_y
     * @returns {Object}    velocity
     */
    getVelocity: function getVelocity(delta_time, delta_x, delta_y) {
        return {
            x: Math.abs(delta_x / delta_time) || 0,
            y: Math.abs(delta_y / delta_time) || 0
        };
    },


    /**
     * calculate the angle between two coordinates
     * @param   {Touch}     touch1
     * @param   {Touch}     touch2
     * @returns {Number}    angle
     */
    getAngle: function getAngle(touch1, touch2) {
        var y = touch2.pageY - touch1.pageY,
            x = touch2.pageX - touch1.pageX;
        return Math.atan2(y, x) * 180 / Math.PI;
    },


    /**
     * angle to direction define
     * @param   {Touch}     touch1
     * @param   {Touch}     touch2
     * @returns {String}    direction constant, like Hammer.DIRECTION_LEFT
     */
    getDirection: function getDirection(touch1, touch2) {
        var x = Math.abs(touch1.pageX - touch2.pageX),
            y = Math.abs(touch1.pageY - touch2.pageY);

        if(x >= y) {
            return touch1.pageX - touch2.pageX > 0 ? Hammer.DIRECTION_LEFT : Hammer.DIRECTION_RIGHT;
        }
        else {
            return touch1.pageY - touch2.pageY > 0 ? Hammer.DIRECTION_UP : Hammer.DIRECTION_DOWN;
        }
    },


    /**
     * calculate the distance between two touches
     * @param   {Touch}     touch1
     * @param   {Touch}     touch2
     * @returns {Number}    distance
     */
    getDistance: function getDistance(touch1, touch2) {
        var x = touch2.pageX - touch1.pageX,
            y = touch2.pageY - touch1.pageY;
        return Math.sqrt((x*x) + (y*y));
    },


    /**
     * calculate the scale factor between two touchLists (fingers)
     * no scale is 1, and goes down to 0 when pinched together, and bigger when pinched out
     * @param   {Array}     start
     * @param   {Array}     end
     * @returns {Number}    scale
     */
    getScale: function getScale(start, end) {
        // need two fingers...
        if(start.length >= 2 && end.length >= 2) {
            return this.getDistance(end[0], end[1]) /
                this.getDistance(start[0], start[1]);
        }
        return 1;
    },


    /**
     * calculate the rotation degrees between two touchLists (fingers)
     * @param   {Array}     start
     * @param   {Array}     end
     * @returns {Number}    rotation
     */
    getRotation: function getRotation(start, end) {
        // need two fingers
        if(start.length >= 2 && end.length >= 2) {
            return this.getAngle(end[1], end[0]) -
                this.getAngle(start[1], start[0]);
        }
        return 0;
    },


    /**
     * boolean if the direction is vertical
     * @param    {String}    direction
     * @returns  {Boolean}   is_vertical
     */
    isVertical: function isVertical(direction) {
        return (direction == Hammer.DIRECTION_UP || direction == Hammer.DIRECTION_DOWN);
    },


    /**
     * stop browser default behavior with css props
     * @param   {HtmlElement}   element
     * @param   {Object}        css_props
     */
    stopDefaultBrowserBehavior: function stopDefaultBrowserBehavior(element, css_props) {
        var prop,
            vendors = ['webkit','khtml','moz','ms','o',''];

        if(!css_props || !element.style) {
            return;
        }

        // with css properties for modern browsers
        for(var i = 0; i < vendors.length; i++) {
            for(var p in css_props) {
                if(css_props.hasOwnProperty(p)) {
                    prop = p;

                    // vender prefix at the property
                    if(vendors[i]) {
                        prop = vendors[i] + prop.substring(0, 1).toUpperCase() + prop.substring(1);
                    }

                    // set the style
                    element.style[prop] = css_props[p];
                }
            }
        }

        // also the disable onselectstart
        if(css_props.userSelect == 'none') {
            element.onselectstart = function() {
                return false;
            };
        }
    }
};

Hammer.detection = {
    // contains all registred Hammer.gestures in the correct order
    gestures: [],

    // data of the current Hammer.gesture detection session
    current: null,

    // the previous Hammer.gesture session data
    // is a full clone of the previous gesture.current object
    previous: null,

    // when this becomes true, no gestures are fired
    stopped: false,


    /**
     * start Hammer.gesture detection
     * @param   {Hammer.Instance}   inst
     * @param   {Object}            eventData
     */
    startDetect: function startDetect(inst, eventData) {
        // already busy with a Hammer.gesture detection on an element
        if(this.current) {
            return;
        }

        this.stopped = false;

        this.current = {
            inst        : inst, // reference to HammerInstance we're working for
            startEvent  : Hammer.utils.extend({}, eventData), // start eventData for distances, timing etc
            lastEvent   : false, // last eventData
            name        : '' // current gesture we're in/detected, can be 'tap', 'hold' etc
        };

        this.detect(eventData);
    },


    /**
     * Hammer.gesture detection
     * @param   {Object}    eventData
     * @param   {Object}    eventData
     */
    detect: function detect(eventData) {
        if(!this.current || this.stopped) {
            return;
        }

        // extend event data with calculations about scale, distance etc
        eventData = this.extendEventData(eventData);

        // instance options
        var inst_options = this.current.inst.options;

        // call Hammer.gesture handlers
        for(var g=0,len=this.gestures.length; g<len; g++) {
            var gesture = this.gestures[g];

            // only when the instance options have enabled this gesture
            if(!this.stopped && inst_options[gesture.name] !== false) {
                // if a handler returns false, we stop with the detection
                if(gesture.handler.call(gesture, eventData, this.current.inst) === false) {
                    this.stopDetect();
                    break;
                }
            }
        }

        // store as previous event event
        if(this.current) {
            this.current.lastEvent = eventData;
        }

        // endevent, but not the last touch, so dont stop
        if(eventData.eventType == Hammer.EVENT_END && !eventData.touches.length-1) {
            this.stopDetect();
        }

        return eventData;
    },


    /**
     * clear the Hammer.gesture vars
     * this is called on endDetect, but can also be used when a final Hammer.gesture has been detected
     * to stop other Hammer.gestures from being fired
     */
    stopDetect: function stopDetect() {
        // clone current data to the store as the previous gesture
        // used for the double tap gesture, since this is an other gesture detect session
        this.previous = Hammer.utils.extend({}, this.current);

        // reset the current
        this.current = null;

        // stopped!
        this.stopped = true;
    },


    /**
     * extend eventData for Hammer.gestures
     * @param   {Object}   ev
     * @returns {Object}   ev
     */
    extendEventData: function extendEventData(ev) {
        var startEv = this.current.startEvent;

        // if the touches change, set the new touches over the startEvent touches
        // this because touchevents don't have all the touches on touchstart, or the
        // user must place his fingers at the EXACT same time on the screen, which is not realistic
        // but, sometimes it happens that both fingers are touching at the EXACT same time
        if(startEv && (ev.touches.length != startEv.touches.length || ev.touches === startEv.touches)) {
            // extend 1 level deep to get the touchlist with the touch objects
            startEv.touches = [];
            for(var i=0,len=ev.touches.length; i<len; i++) {
                startEv.touches.push(Hammer.utils.extend({}, ev.touches[i]));
            }
        }

        var delta_time = ev.timeStamp - startEv.timeStamp,
            delta_x = ev.center.pageX - startEv.center.pageX,
            delta_y = ev.center.pageY - startEv.center.pageY,
            velocity = Hammer.utils.getVelocity(delta_time, delta_x, delta_y);

        Hammer.utils.extend(ev, {
            deltaTime   : delta_time,

            deltaX      : delta_x,
            deltaY      : delta_y,

            velocityX   : velocity.x,
            velocityY   : velocity.y,

            distance    : Hammer.utils.getDistance(startEv.center, ev.center),
            angle       : Hammer.utils.getAngle(startEv.center, ev.center),
            direction   : Hammer.utils.getDirection(startEv.center, ev.center),

            scale       : Hammer.utils.getScale(startEv.touches, ev.touches),
            rotation    : Hammer.utils.getRotation(startEv.touches, ev.touches),

            startEvent  : startEv
        });

        return ev;
    },


    /**
     * register new gesture
     * @param   {Object}    gesture object, see gestures.js for documentation
     * @returns {Array}     gestures
     */
    register: function register(gesture) {
        // add an enable gesture options if there is no given
        var options = gesture.defaults || {};
        if(options[gesture.name] === undefined) {
            options[gesture.name] = true;
        }

        // extend Hammer default options with the Hammer.gesture options
        Hammer.utils.extend(Hammer.defaults, options, true);

        // set its index
        gesture.index = gesture.index || 1000;

        // add Hammer.gesture to the list
        this.gestures.push(gesture);

        // sort the list by index
        this.gestures.sort(function(a, b) {
            if (a.index < b.index) {
                return -1;
            }
            if (a.index > b.index) {
                return 1;
            }
            return 0;
        });

        return this.gestures;
    }
};


Hammer.gestures = Hammer.gestures || {};

/**
 * Custom gestures
 * ==============================
 *
 * Gesture object
 * --------------------
 * The object structure of a gesture:
 *
 * { name: 'mygesture',
 *   index: 1337,
 *   defaults: {
 *     mygesture_option: true
 *   }
 *   handler: function(type, ev, inst) {
 *     // trigger gesture event
 *     inst.trigger(this.name, ev);
 *   }
 * }

 * @param   {String}    name
 * this should be the name of the gesture, lowercase
 * it is also being used to disable/enable the gesture per instance config.
 *
 * @param   {Number}    [index=1000]
 * the index of the gesture, where it is going to be in the stack of gestures detection
 * like when you build an gesture that depends on the drag gesture, it is a good
 * idea to place it after the index of the drag gesture.
 *
 * @param   {Object}    [defaults={}]
 * the default settings of the gesture. these are added to the instance settings,
 * and can be overruled per instance. you can also add the name of the gesture,
 * but this is also added by default (and set to true).
 *
 * @param   {Function}  handler
 * this handles the gesture detection of your custom gesture and receives the
 * following arguments:
 *
 *      @param  {Object}    eventData
 *      event data containing the following properties:
 *          timeStamp   {Number}        time the event occurred
 *          target      {HTMLElement}   target element
 *          touches     {Array}         touches (fingers, pointers, mouse) on the screen
 *          pointerType {String}        kind of pointer that was used. matches Hammer.POINTER_MOUSE|TOUCH
 *          center      {Object}        center position of the touches. contains pageX and pageY
 *          deltaTime   {Number}        the total time of the touches in the screen
 *          deltaX      {Number}        the delta on x axis we haved moved
 *          deltaY      {Number}        the delta on y axis we haved moved
 *          velocityX   {Number}        the velocity on the x
 *          velocityY   {Number}        the velocity on y
 *          angle       {Number}        the angle we are moving
 *          direction   {String}        the direction we are moving. matches Hammer.DIRECTION_UP|DOWN|LEFT|RIGHT
 *          distance    {Number}        the distance we haved moved
 *          scale       {Number}        scaling of the touches, needs 2 touches
 *          rotation    {Number}        rotation of the touches, needs 2 touches *
 *          eventType   {String}        matches Hammer.EVENT_START|MOVE|END
 *          srcEvent    {Object}        the source event, like TouchStart or MouseDown *
 *          startEvent  {Object}        contains the same properties as above,
 *                                      but from the first touch. this is used to calculate
 *                                      distances, deltaTime, scaling etc
 *
 *      @param  {Hammer.Instance}    inst
 *      the instance we are doing the detection for. you can get the options from
 *      the inst.options object and trigger the gesture event by calling inst.trigger
 *
 *
 * Handle gestures
 * --------------------
 * inside the handler you can get/set Hammer.detection.current. This is the current
 * detection session. It has the following properties
 *      @param  {String}    name
 *      contains the name of the gesture we have detected. it has not a real function,
 *      only to check in other gestures if something is detected.
 *      like in the drag gesture we set it to 'drag' and in the swipe gesture we can
 *      check if the current gesture is 'drag' by accessing Hammer.detection.current.name
 *
 *      @readonly
 *      @param  {Hammer.Instance}    inst
 *      the instance we do the detection for
 *
 *      @readonly
 *      @param  {Object}    startEvent
 *      contains the properties of the first gesture detection in this session.
 *      Used for calculations about timing, distance, etc.
 *
 *      @readonly
 *      @param  {Object}    lastEvent
 *      contains all the properties of the last gesture detect in this session.
 *
 * after the gesture detection session has been completed (user has released the screen)
 * the Hammer.detection.current object is copied into Hammer.detection.previous,
 * this is usefull for gestures like doubletap, where you need to know if the
 * previous gesture was a tap
 *
 * options that have been set by the instance can be received by calling inst.options
 *
 * You can trigger a gesture event by calling inst.trigger("mygesture", event).
 * The first param is the name of your gesture, the second the event argument
 *
 *
 * Register gestures
 * --------------------
 * When an gesture is added to the Hammer.gestures object, it is auto registered
 * at the setup of the first Hammer instance. You can also call Hammer.detection.register
 * manually and pass your gesture object as a param
 *
 */

/**
 * Hold
 * Touch stays at the same place for x time
 * @events  hold
 */
Hammer.gestures.Hold = {
    name: 'hold',
    index: 10,
    defaults: {
        hold_timeout	: 500,
        hold_threshold	: 1
    },
    timer: null,
    handler: function holdGesture(ev, inst) {
        switch(ev.eventType) {
            case Hammer.EVENT_START:
                // clear any running timers
                clearTimeout(this.timer);

                // set the gesture so we can check in the timeout if it still is
                Hammer.detection.current.name = this.name;

                // set timer and if after the timeout it still is hold,
                // we trigger the hold event
                this.timer = setTimeout(function() {
                    if(Hammer.detection.current.name == 'hold') {
                        inst.trigger('hold', ev);
                    }
                }, inst.options.hold_timeout);
                break;

            // when you move or end we clear the timer
            case Hammer.EVENT_MOVE:
                if(ev.distance > inst.options.hold_threshold) {
                    clearTimeout(this.timer);
                }
                break;

            case Hammer.EVENT_END:
                clearTimeout(this.timer);
                break;
        }
    }
};


/**
 * Tap/DoubleTap
 * Quick touch at a place or double at the same place
 * @events  tap, doubletap
 */
Hammer.gestures.Tap = {
    name: 'tap',
    index: 100,
    defaults: {
        tap_max_touchtime	: 250,
        tap_max_distance	: 10,
		tap_always			: true,
        doubletap_distance	: 20,
        doubletap_interval	: 300
    },
    handler: function tapGesture(ev, inst) {
        if(ev.eventType == Hammer.EVENT_END) {
            // previous gesture, for the double tap since these are two different gesture detections
            var prev = Hammer.detection.previous,
				did_doubletap = false;

            // when the touchtime is higher then the max touch time
            // or when the moving distance is too much
            if(ev.deltaTime > inst.options.tap_max_touchtime ||
                ev.distance > inst.options.tap_max_distance) {
                return;
            }

            // check if double tap
            if(prev && prev.name == 'tap' &&
                (ev.timeStamp - prev.lastEvent.timeStamp) < inst.options.doubletap_interval &&
                ev.distance < inst.options.doubletap_distance) {
				inst.trigger('doubletap', ev);
				did_doubletap = true;
            }

			// do a single tap
			if(!did_doubletap || inst.options.tap_always) {
				Hammer.detection.current.name = 'tap';
				inst.trigger(Hammer.detection.current.name, ev);
			}
        }
    }
};


/**
 * Swipe
 * triggers swipe events when the end velocity is above the threshold
 * @events  swipe, swipeleft, swiperight, swipeup, swipedown
 */
Hammer.gestures.Swipe = {
    name: 'swipe',
    index: 40,
    defaults: {
        // set 0 for unlimited, but this can conflict with transform
        swipe_max_touches  : 1,
        swipe_velocity     : 0.7
    },
    handler: function swipeGesture(ev, inst) {
        if(ev.eventType == Hammer.EVENT_END) {
            // max touches
            if(inst.options.swipe_max_touches > 0 &&
                ev.touches.length > inst.options.swipe_max_touches) {
                return;
            }

            // when the distance we moved is too small we skip this gesture
            // or we can be already in dragging
            if(ev.velocityX > inst.options.swipe_velocity ||
                ev.velocityY > inst.options.swipe_velocity) {
                // trigger swipe events
                inst.trigger(this.name, ev);
                inst.trigger(this.name + ev.direction, ev);
            }
        }
    }
};


/**
 * Drag
 * Move with x fingers (default 1) around on the page. Blocking the scrolling when
 * moving left and right is a good practice. When all the drag events are blocking
 * you disable scrolling on that area.
 * @events  drag, drapleft, dragright, dragup, dragdown
 */
Hammer.gestures.Drag = {
    name: 'drag',
    index: 50,
    defaults: {
        drag_min_distance : 10,
        // set 0 for unlimited, but this can conflict with transform
        drag_max_touches  : 1,
        // prevent default browser behavior when dragging occurs
        // be careful with it, it makes the element a blocking element
        // when you are using the drag gesture, it is a good practice to set this true
        drag_block_horizontal   : false,
        drag_block_vertical     : false,
        // drag_lock_to_axis keeps the drag gesture on the axis that it started on,
        // It disallows vertical directions if the initial direction was horizontal, and vice versa.
        drag_lock_to_axis       : false,
        // drag lock only kicks in when distance > drag_lock_min_distance
        // This way, locking occurs only when the distance has become large enough to reliably determine the direction
        drag_lock_min_distance : 25
    },
    triggered: false,
    handler: function dragGesture(ev, inst) {
        // current gesture isnt drag, but dragged is true
        // this means an other gesture is busy. now call dragend
        if(Hammer.detection.current.name != this.name && this.triggered) {
            inst.trigger(this.name +'end', ev);
            this.triggered = false;
            return;
        }

        // max touches
        if(inst.options.drag_max_touches > 0 &&
            ev.touches.length > inst.options.drag_max_touches) {
            return;
        }

        switch(ev.eventType) {
            case Hammer.EVENT_START:
                this.triggered = false;
                break;

            case Hammer.EVENT_MOVE:
                // when the distance we moved is too small we skip this gesture
                // or we can be already in dragging
                if(ev.distance < inst.options.drag_min_distance &&
                    Hammer.detection.current.name != this.name) {
                    return;
                }

                // we are dragging!
                Hammer.detection.current.name = this.name;

                // lock drag to axis?
                if(Hammer.detection.current.lastEvent.drag_locked_to_axis || (inst.options.drag_lock_to_axis && inst.options.drag_lock_min_distance<=ev.distance)) {
                    ev.drag_locked_to_axis = true;
                }
                var last_direction = Hammer.detection.current.lastEvent.direction;
                if(ev.drag_locked_to_axis && last_direction !== ev.direction) {
                    // keep direction on the axis that the drag gesture started on
                    if(Hammer.utils.isVertical(last_direction)) {
                        ev.direction = (ev.deltaY < 0) ? Hammer.DIRECTION_UP : Hammer.DIRECTION_DOWN;
                    }
                    else {
                        ev.direction = (ev.deltaX < 0) ? Hammer.DIRECTION_LEFT : Hammer.DIRECTION_RIGHT;
                    }
                }

                // first time, trigger dragstart event
                if(!this.triggered) {
                    inst.trigger(this.name +'start', ev);
                    this.triggered = true;
                }

                // trigger normal event
                inst.trigger(this.name, ev);

                // direction event, like dragdown
                inst.trigger(this.name + ev.direction, ev);

                // block the browser events
                if( (inst.options.drag_block_vertical && Hammer.utils.isVertical(ev.direction)) ||
                    (inst.options.drag_block_horizontal && !Hammer.utils.isVertical(ev.direction))) {
                    ev.preventDefault();
                }
                break;

            case Hammer.EVENT_END:
                // trigger dragend
                if(this.triggered) {
                    inst.trigger(this.name +'end', ev);
                }

                this.triggered = false;
                break;
        }
    }
};


/**
 * Transform
 * User want to scale or rotate with 2 fingers
 * @events  transform, pinch, pinchin, pinchout, rotate
 */
Hammer.gestures.Transform = {
    name: 'transform',
    index: 45,
    defaults: {
        // factor, no scale is 1, zoomin is to 0 and zoomout until higher then 1
        transform_min_scale     : 0.01,
        // rotation in degrees
        transform_min_rotation  : 1,
        // prevent default browser behavior when two touches are on the screen
        // but it makes the element a blocking element
        // when you are using the transform gesture, it is a good practice to set this true
        transform_always_block  : false
    },
    triggered: false,
    handler: function transformGesture(ev, inst) {
        // current gesture isnt drag, but dragged is true
        // this means an other gesture is busy. now call dragend
        if(Hammer.detection.current.name != this.name && this.triggered) {
            inst.trigger(this.name +'end', ev);
            this.triggered = false;
            return;
        }

        // atleast multitouch
        if(ev.touches.length < 2) {
            return;
        }

        // prevent default when two fingers are on the screen
        if(inst.options.transform_always_block) {
            ev.preventDefault();
        }

        switch(ev.eventType) {
            case Hammer.EVENT_START:
                this.triggered = false;
                break;

            case Hammer.EVENT_MOVE:
                var scale_threshold = Math.abs(1-ev.scale);
                var rotation_threshold = Math.abs(ev.rotation);

                // when the distance we moved is too small we skip this gesture
                // or we can be already in dragging
                if(scale_threshold < inst.options.transform_min_scale &&
                    rotation_threshold < inst.options.transform_min_rotation) {
                    return;
                }

                // we are transforming!
                Hammer.detection.current.name = this.name;

                // first time, trigger dragstart event
                if(!this.triggered) {
                    inst.trigger(this.name +'start', ev);
                    this.triggered = true;
                }

                inst.trigger(this.name, ev); // basic transform event

                // trigger rotate event
                if(rotation_threshold > inst.options.transform_min_rotation) {
                    inst.trigger('rotate', ev);
                }

                // trigger pinch event
                if(scale_threshold > inst.options.transform_min_scale) {
                    inst.trigger('pinch', ev);
                    inst.trigger('pinch'+ ((ev.scale < 1) ? 'in' : 'out'), ev);
                }
                break;

            case Hammer.EVENT_END:
                // trigger dragend
                if(this.triggered) {
                    inst.trigger(this.name +'end', ev);
                }

                this.triggered = false;
                break;
        }
    }
};


/**
 * Touch
 * Called as first, tells the user has touched the screen
 * @events  touch
 */
Hammer.gestures.Touch = {
    name: 'touch',
    index: -Infinity,
    defaults: {
        // call preventDefault at touchstart, and makes the element blocking by
        // disabling the scrolling of the page, but it improves gestures like
        // transforming and dragging.
        // be careful with using this, it can be very annoying for users to be stuck
        // on the page
        prevent_default: false,

        // disable mouse events, so only touch (or pen!) input triggers events
        prevent_mouseevents: false
    },
    handler: function touchGesture(ev, inst) {
        if(inst.options.prevent_mouseevents && ev.pointerType == Hammer.POINTER_MOUSE) {
            ev.stopDetect();
            return;
        }

        if(inst.options.prevent_default) {
            ev.preventDefault();
        }

        if(ev.eventType ==  Hammer.EVENT_START) {
            inst.trigger(this.name, ev);
        }
    }
};


/**
 * Release
 * Called as last, tells the user has released the screen
 * @events  release
 */
Hammer.gestures.Release = {
    name: 'release',
    index: Infinity,
    handler: function releaseGesture(ev, inst) {
        if(ev.eventType ==  Hammer.EVENT_END) {
            inst.trigger(this.name, ev);
        }
    }
};

// node export
if(typeof module === 'object' && typeof module.exports === 'object'){
    module.exports = Hammer;
}
// just window export
else {
    window.Hammer = Hammer;

    // requireJS module definition
    if(typeof window.define === 'function' && window.define.amd) {
        window.define('hammer', [], function() {
            return Hammer;
        });
    }
}
})(this);

(function($, undefined) {
    'use strict';

    // no jQuery or Zepto!
    if($ === undefined) {
        return;
    }

    /**
     * bind dom events
     * this overwrites addEventListener
     * @param   {HTMLElement}   element
     * @param   {String}        eventTypes
     * @param   {Function}      handler
     */
    Hammer.event.bindDom = function(element, eventTypes, handler) {
        $(element).on(eventTypes, function(ev) {
            var data = ev.originalEvent || ev;

            // IE pageX fix
            if(data.pageX === undefined) {
                data.pageX = ev.pageX;
                data.pageY = ev.pageY;
            }

            // IE target fix
            if(!data.target) {
                data.target = ev.target;
            }

            // IE button fix
            if(data.which === undefined) {
                data.which = data.button;
            }

            // IE preventDefault
            if(!data.preventDefault) {
                data.preventDefault = ev.preventDefault;
            }

            // IE stopPropagation
            if(!data.stopPropagation) {
                data.stopPropagation = ev.stopPropagation;
            }

            handler.call(this, data);
        });
    };

    /**
     * the methods are called by the instance, but with the jquery plugin
     * we use the jquery event methods instead.
     * @this    {Hammer.Instance}
     * @return  {jQuery}
     */
    Hammer.Instance.prototype.on = function(types, handler) {
        return $(this.element).on(types, handler);
    };
    Hammer.Instance.prototype.off = function(types, handler) {
        return $(this.element).off(types, handler);
    };


    /**
     * trigger events
     * this is called by the gestures to trigger an event like 'tap'
     * @this    {Hammer.Instance}
     * @param   {String}    gesture
     * @param   {Object}    eventData
     * @return  {jQuery}
     */
    Hammer.Instance.prototype.trigger = function(gesture, eventData){
        var el = $(this.element);
        if(el.has(eventData.target).length) {
            el = $(eventData.target);
        }

        return el.trigger({
            type: gesture,
            gesture: eventData
        });
    };


    /**
     * jQuery plugin
     * create instance of Hammer and watch for gestures,
     * and when called again you can change the options
     * @param   {Object}    [options={}]
     * @return  {jQuery}
     */
    $.fn.hammer = function(options) {
        return this.each(function() {
            var el = $(this);
            var inst = el.data('hammer');
            // start new hammer instance
            if(!inst) {
                el.data('hammer', new Hammer(this, options || {}));
            }
            // change the options
            else if(inst && options) {
                Hammer.utils.extend(inst.options, options);
            }
        });
    };

})(window.jQuery || window.Zepto);
         var debug_el = $("#debug");
    function debug(text) {
        debug_el.text(text);
    }


    /**
     * requestAnimationFrame and cancel polyfill
     */
    (function() {
        var lastTime = 0;
        var vendors = ['ms', 'moz', 'webkit', 'o'];
        for(var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {
            window.requestAnimationFrame = window[vendors[x]+'RequestAnimationFrame'];
            window.cancelAnimationFrame =
                    window[vendors[x]+'CancelAnimationFrame'] || window[vendors[x]+'CancelRequestAnimationFrame'];
        }

        if (!window.requestAnimationFrame)
            window.requestAnimationFrame = function(callback, element) {
                var currTime = new Date().getTime();
                var timeToCall = Math.max(0, 16 - (currTime - lastTime));
                var id = window.setTimeout(function() { callback(currTime + timeToCall); },
                        timeToCall);
                lastTime = currTime + timeToCall;
                return id;
            };

        if (!window.cancelAnimationFrame)
            window.cancelAnimationFrame = function(id) {
                clearTimeout(id);
            };
    }());
define("hammer", function(){});


/*

	Slider V3 to be used ONLY with content on responsive grid

	Sample HTML with autorun and runspeed set to 5 seconds:
	<div class="sliderV3" data-autorun="true" data-runspeed="5">
		<div class="col-1-4-lg col-1-3-sm pad">...</div>
		<div class="col-1-4-lg col-1-3-sm pad">...</div>
		<div class="col-1-4-lg col-1-3-sm pad">...</div>
		<div class="col-1-4-lg col-1-3-sm pad">...</div>
	</div>
*/
(function closure(root, factory) {
	if(typeof define === 'function' && define.amd) {
		define('thd.sliderV3',['jquery', 'global.namespace', 'hammer', 'global.gestureHandler'],
			function load($, THD, hammer) {
				return factory(root, $, hammer, THD);
			});
	} else{
		// For non-AMD module, expose this to global (will also be useful for test cases)
		/* eslint-disable*/
		factory(root, jQuery, Hammer, THD);
		/*eslint-enable*/
	}
})(this, function factory(root, $, hammer, THD) {
	// private
	var sliderModule = THD.Utility.Namespace.createNamespace('THD.Widget.Slider');
	var sliderSelector = '.sliderV3';
	var columnSelector = 'div[class*="col-"]';
	var breakpoints = {
		xs: 300,
		sm: 568,
		md: 769,
		lg: 960
	};
	var sliderWindowWidth;
	var currentBreakpoint;

	/*
	 * This is called from the inside of Carousel - this is a bad dependency entanglement
	 */
	// parse through breakpoints object to get current breakpoint based on window width
	function getCurrentBreakPoint() {
		var windowWidth = $(window).width();
		var breakPoint;
		var currentBreakPoint;
		var key;

		for (key in breakpoints) {
			if (breakpoints.hasOwnProperty(key)) {
				currentBreakPoint = breakpoints[key];
				if (windowWidth > currentBreakPoint) {
					breakPoint = key;
				}
			}
		}
		return breakPoint;
	}

	/**
	 * super simple carousel
	 * animation between panes happens with css transitions
	 */
	function Carousel(element) {
		var self = this;
		var currentPane = 0;
		var $sliderFrame;
		var $navContainer;
		var paneCount;
		var $pagination = $('#paginationText');
		var slideTimer = parseInt(element.data('runspeed') * 1000, 10) || 9000;

		self.autorun = (element.data('autorun'));
		self.playSlides = 0;

		// set up rotation interval
		function setupAuto() {
			self.playSlides = setInterval(function carouselPlaySlidesInterval() {
				if (currentPane === (paneCount - 1)) {
					self.showPane(0, true);
				} else {
					self.next();
				}
			}, slideTimer);
		}

		// does what it says
		function stopRotateSlides() {
			clearInterval(self.playSlides);
		}

		// find currently applied class based on breakpoint
		function getColumnClass($column) {
			var classNames = $column.attr('class').split(' ');
			var selectedClass;
			var defaultClass;
			var classSuffix;
			var i = classNames.length;

			while (i--) {
				if (classNames[i].indexOf(currentBreakpoint) > -1) {
					// found one with current break point, time to stop
					return classNames[i];
				} else if (classNames[i].indexOf('col-') > -1) {
					// doesn't have breakpoint, look for default class
					selectedClass = classNames[i];
					classSuffix = classNames[i].slice(-2);
					if (!isNaN(parseInt(classSuffix, 10))) {
						defaultClass = selectedClass;
					}
				}
			}
			if (typeof defaultClass !== 'undefined') {
				selectedClass = defaultClass;
			}

			return selectedClass;
		}

		// takes contents and sets each column to expected column width based on fullWidth param
		// DOES NOT USE THE fulWidth any more...
		function adjustColumnWidths($contents) {
			var i = $contents.length;
			var $column;
			var adjustedColumnWidth;
			var columnPlacement;
			var numberOfColumns;
			var columnClass;
			var columnProps;
			var newColumnWidth;

			while (i--) {
				$column = $($contents[i]);
				columnClass = getColumnClass($column);
				columnProps = columnClass.split('-');

				numberOfColumns = parseFloat(columnProps[2], 10);
				columnPlacement = parseFloat(columnProps[1], 10);

				adjustedColumnWidth = sliderWindowWidth / numberOfColumns;
				newColumnWidth = adjustedColumnWidth * columnPlacement;

				$column.css({
					'width': newColumnWidth + 'px'
				});
			}

			return $contents;
		}

		function adjustSliderWidth($contents) {
			var i = $contents.length;
			var $column;
			var fullWidth = 0;

			while (i--) {
				$column = $($contents[i]);
				fullWidth += $column.outerWidth();
			}

			/* adding 5 to account for box model padding issue*/
			return fullWidth + 5;
		}

		function getPaneCount() {
			var sliderFrameWidth = $sliderFrame.width();

			/* number of frames filled with content*/
			var fullFrameCount = Math.floor(sliderFrameWidth / sliderWindowWidth);

			/* get count of frames period */
			var frameCount = (sliderFrameWidth / sliderWindowWidth);
			var frameCountRoundedUp = Math.ceil(frameCount);
			var frameCountRoundedDown = Math.floor(frameCount);
			var frameCountDiff = frameCount - frameCountRoundedDown;

			var finalFrameCount = (frameCountDiff >= 0.017) ? frameCountRoundedUp : frameCountRoundedDown;

			/* set percentage for last frame */
			self.lastFrameSize = fullFrameCount - frameCount;

			return finalFrameCount;
		}

		function buildCarousel() {
			var content;
			var $columns;
			var frameWidth;

			// always stop autorun
			stopRotateSlides();

			currentBreakpoint = getCurrentBreakPoint();
			sliderWindowWidth = element.width();

			// need to calculate container frame width and set column widths based on viewport and expected number of columns
			content = element.html();
			$columns = $(columnSelector, element);
			frameWidth = adjustSliderWidth($columns);

			$sliderFrame = $('.slider-frame', element);
			content = adjustColumnWidths($columns, frameWidth);

			$sliderFrame = ($sliderFrame.length < 1) ? $('<div class="slider-frame" />') : $sliderFrame;

			$sliderFrame.width(frameWidth);
			paneCount = getPaneCount();

			/* resized from smaller to larger, start over */
			if ((paneCount * sliderWindowWidth) > frameWidth) {
				frameWidth = adjustSliderWidth($columns);
				$sliderFrame.width(frameWidth);
				paneCount = getPaneCount();
			}

			if (element.data('loaded') !== 'true' && paneCount > 1) {
				$sliderFrame.html(content);
				$(element).addClass('done').html($sliderFrame).data('loaded', 'true').before('<nav class="slider-arrows start" id="sliderArrowNav"><a class="slide-left">left</a><a class="slide-right">right</a></nav>');

				/* populate the pagination */
				$pagination.text('1 of ' + paneCount);

				/* cache a reffrence to the nav once appneded before to be used later */
				$navContainer = $('#sliderArrowNav');

				self.showPane(0, true);
			}

			if (self.autorun) {
				setupAuto();
			}
		}

		function setContainerOffset(percent, animate) {
			var px;

			$sliderFrame.removeClass('animate');

			if (animate) { $sliderFrame.addClass('animate'); }

			px = ((sliderWindowWidth * paneCount) / 100) * percent;

			$sliderFrame.css('left', px + 'px');
		}

		// initialize carousel and set window behavior
		self.init = function carouselInit() {
			buildCarousel();
			$(window).on('resize orientationchange', function carouselOnResizeOrientationChange() {
				buildCarousel();
			});
		};

		this.next = function carouselNext() {
			return this.showPane(currentPane + 1, true);
		};
		this.prev = function carouselPrev() {
			return this.showPane(currentPane - 1, true);
		};

		/**
		 * show pane by index
		 * @param   {Number}    index
		 */
		this.showPane = function carouselShowPane(_index) {
			var offset;
			var index;

			$navContainer.removeClass('start').removeClass('end');

			// between the bounds
			index = Math.max(0, Math.min(_index, paneCount - 1));

			currentPane = index;

			/* Update Pagination */
			$pagination.text( (currentPane + 1) + ' of ' + paneCount);

			offset = -((100 / paneCount) * currentPane);

			if (index === 0) {
				$navContainer.addClass('start');
			} else if (index + 1 === paneCount) {
				$navContainer.addClass('end');
			}

			setContainerOffset(offset, true);
		};

		// hammer event handler
		function handleHammer(ev) {
			var paneOffset;
			var dragOffset;

			// disable browser scrolling
			ev.gesture.preventDefault();
			stopRotateSlides();

			switch (ev.type) {
			case 'dragright':
			case 'dragleft':
				// stick to the finger
				paneOffset = -(100 / paneCount) * currentPane;
				dragOffset = ((100 / sliderWindowWidth) * ev.gesture.deltaX) / paneCount;

				// slow down at the first and last pane
				if ((currentPane === 0 && ev.gesture.direction === hammer.DIRECTION_RIGHT) ||
					(currentPane === paneCount - 1 && ev.gesture.direction === hammer.DIRECTION_LEFT)) {
					dragOffset *= 0.4;
				}

				setContainerOffset(dragOffset + paneOffset);
				break;

			case 'swipeleft':
				self.next();
				ev.gesture.stopDetect();
				break;

			case 'swiperight':
				self.prev();
				ev.gesture.stopDetect();
				break;

			case 'release':
				// more then 50% moved, navigate
				if (Math.abs(ev.gesture.deltaX) > sliderWindowWidth / 2) {
					if (ev.gesture.direction === 'right') {
						self.prev();
					} else {
						self.next();
					}
				} else {
					self.showPane(currentPane, true);
				}
				break;

			default:
				// Error state
				break;
			}
		}

		if (THD.Utils.GestureHandler.touch) {
			element.hammer({
				drag_lock_to_axis: true
			})
			.on('release dragleft dragright swipeleft swiperight', handleHammer);
		}

		$(document).hammer().on('tap, click', '.slide-left', function carouselOnTapClickLeft() {
			stopRotateSlides();
			self.prev();
		});

		$(document).hammer().on('tap, click', '.slide-right', function carouselOnTapClickRight() {
			stopRotateSlides();
			self.next();
		});
	}

	// get list of sliders from html and build new carousel object for each
	function initSliders() {
		var $sliderList = $(sliderSelector);
		var i = $sliderList.length;
		var $slider;
		var carousel;

		while (i--) {
			$slider = $($sliderList[i]);

			if ($slider.data('loaded') !== 'true') {
				carousel = new Carousel($slider);
				carousel.init();
			}
		}
	}

	// main init
	function build() {
		initSliders();
	}

	$(window).on('load', build);

	// public
	sliderModule.init = function sliderInit() {
		build();
	};

	sliderModule.refresh = function sliderRefresh() {
		initSliders();
	};

	// Explicitly add 'Slider' to the global space
	window.Slider = sliderModule;

	return sliderModule;
});

// jquery.event.move
//
// 1.3.6
//
// Stephen Band
//
// Triggers 'movestart', 'move' and 'moveend' events after
// mousemoves following a mousedown cross a distance threshold,
// similar to the native 'dragstart', 'drag' and 'dragend' events.
// Move events are throttled to animation frames. Move event objects
// have the properties:
//
// pageX:
// pageY:   Page coordinates of pointer.
// startX:
// startY:  Page coordinates of pointer at movestart.
// distX:
// distY:  Distance the pointer has moved since movestart.
// deltaX:
// deltaY:  Distance the finger has moved since last event.
// velocityX:
// velocityY:  Average velocity over last few events.


(function (module) {
	if (typeof define === 'function' && define.amd) {
		// AMD. Register as an anonymous module.
		define('jquery.event.move',['jquery'], module);
	} else {
		// Browser globals
		module(jQuery);
	}
})(function(jQuery, undefined){

	var // Number of pixels a pressed pointer travels before movestart
	    // event is fired.
	    threshold = 6,
	
	    add = jQuery.event.add,
	
	    remove = jQuery.event.remove,

	    // Just sugar, so we can have arguments in the same order as
	    // add and remove.
	    trigger = function(node, type, data) {
	    	jQuery.event.trigger(type, data, node);
	    },

	    // Shim for requestAnimationFrame, falling back to timer. See:
	    // see http://paulirish.com/2011/requestanimationframe-for-smart-animating/
	    requestFrame = (function(){
	    	return (
	    		window.requestAnimationFrame ||
	    		window.webkitRequestAnimationFrame ||
	    		window.mozRequestAnimationFrame ||
	    		window.oRequestAnimationFrame ||
	    		window.msRequestAnimationFrame ||
	    		function(fn, element){
	    			return window.setTimeout(function(){
	    				fn();
	    			}, 25);
	    		}
	    	);
	    })(),
	    
	    ignoreTags = {
	    	textarea: true,
	    	input: true,
	    	select: true,
	    	button: true
	    },
	    
	    mouseevents = {
	    	move: 'mousemove',
	    	cancel: 'mouseup dragstart',
	    	end: 'mouseup'
	    },
	    
	    touchevents = {
	    	move: 'touchmove',
	    	cancel: 'touchend',
	    	end: 'touchend'
	    };


	// Constructors
	
	function Timer(fn){
		var callback = fn,
		    active = false,
		    running = false;
		
		function trigger(time) {
			if (active){
				callback();
				requestFrame(trigger);
				running = true;
				active = false;
			}
			else {
				running = false;
			}
		}
		
		this.kick = function(fn) {
			active = true;
			if (!running) { trigger(); }
		};
		
		this.end = function(fn) {
			var cb = callback;
			
			if (!fn) { return; }
			
			// If the timer is not running, simply call the end callback.
			if (!running) {
				fn();
			}
			// If the timer is running, and has been kicked lately, then
			// queue up the current callback and the end callback, otherwise
			// just the end callback.
			else {
				callback = active ?
					function(){ cb(); fn(); } : 
					fn ;
				
				active = true;
			}
		};
	}


	// Functions
	
	function returnTrue() {
		return true;
	}
	
	function returnFalse() {
		return false;
	}
	
	function preventDefault(e) {
		e.preventDefault();
	}
	
	function preventIgnoreTags(e) {
		// Don't prevent interaction with form elements.
		if (ignoreTags[ e.target.tagName.toLowerCase() ]) { return; }
		
		e.preventDefault();
	}

	function isLeftButton(e) {
		// Ignore mousedowns on any button other than the left (or primary)
		// mouse button, or when a modifier key is pressed.
		return (e.which === 1 && !e.ctrlKey && !e.altKey);
	}

	function identifiedTouch(touchList, id) {
		var i, l;

		if (touchList.identifiedTouch) {
			return touchList.identifiedTouch(id);
		}
		
		// touchList.identifiedTouch() does not exist in
		// webkit yet we must do the search ourselves...
		
		i = -1;
		l = touchList.length;
		
		while (++i < l) {
			if (touchList[i].identifier === id) {
				return touchList[i];
			}
		}
	}

	function changedTouch(e, event) {
		var touch = identifiedTouch(e.changedTouches, event.identifier);

		// This isn't the touch you're looking for.
		if (!touch) { return; }

		// Chrome Android (at least) includes touches that have not
		// changed in e.changedTouches. That's a bit annoying. Check
		// that this touch has changed.
		if (touch.pageX === event.pageX && touch.pageY === event.pageY) { return; }

		return touch;
	}


	// Handlers that decide when the first movestart is triggered
	
	function mousedown(e){
		var data;

		if (!isLeftButton(e)) { return; }

		data = {
			target: e.target,
			startX: e.pageX,
			startY: e.pageY,
			timeStamp: e.timeStamp
		};

		add(document, mouseevents.move, mousemove, data);
		add(document, mouseevents.cancel, mouseend, data);
	}

	function mousemove(e){
		var data = e.data;

		checkThreshold(e, data, e, removeMouse);
	}

	function mouseend(e) {
		removeMouse();
	}

	function removeMouse() {
		remove(document, mouseevents.move, mousemove);
		remove(document, mouseevents.cancel, mouseend);
	}

	function touchstart(e) {
		var touch, template;

		// Don't get in the way of interaction with form elements.
		if (ignoreTags[ e.target.tagName.toLowerCase() ]) { return; }

		touch = e.changedTouches[0];
		
		// iOS live updates the touch objects whereas Android gives us copies.
		// That means we can't trust the touchstart object to stay the same,
		// so we must copy the data. This object acts as a template for
		// movestart, move and moveend event objects.
		template = {
			target: touch.target,
			startX: touch.pageX,
			startY: touch.pageY,
			timeStamp: e.timeStamp,
			identifier: touch.identifier
		};

		// Use the touch identifier as a namespace, so that we can later
		// remove handlers pertaining only to this touch.
		add(document, touchevents.move + '.' + touch.identifier, touchmove, template);
		add(document, touchevents.cancel + '.' + touch.identifier, touchend, template);
	}

	function touchmove(e){
		var data = e.data,
		    touch = changedTouch(e, data);

		if (!touch) { return; }

		checkThreshold(e, data, touch, removeTouch);
	}

	function touchend(e) {
		var template = e.data,
		    touch = identifiedTouch(e.changedTouches, template.identifier);

		if (!touch) { return; }

		removeTouch(template.identifier);
	}

	function removeTouch(identifier) {
		remove(document, '.' + identifier, touchmove);
		remove(document, '.' + identifier, touchend);
	}


	// Logic for deciding when to trigger a movestart.

	function checkThreshold(e, template, touch, fn) {
		var distX = touch.pageX - template.startX,
		    distY = touch.pageY - template.startY;

		// Do nothing if the threshold has not been crossed.
		if ((distX * distX) + (distY * distY) < (threshold * threshold)) { return; }

		triggerStart(e, template, touch, distX, distY, fn);
	}

	function handled() {
		// this._handled should return false once, and after return true.
		this._handled = returnTrue;
		return false;
	}

	function flagAsHandled(e) {
		e._handled();
	}

	function triggerStart(e, template, touch, distX, distY, fn) {
		var node = template.target,
		    touches, time;

		touches = e.targetTouches;
		time = e.timeStamp - template.timeStamp;

		// Create a movestart object with some special properties that
		// are passed only to the movestart handlers.
		template.type = 'movestart';
		template.distX = distX;
		template.distY = distY;
		template.deltaX = distX;
		template.deltaY = distY;
		template.pageX = touch.pageX;
		template.pageY = touch.pageY;
		template.velocityX = distX / time;
		template.velocityY = distY / time;
		template.targetTouches = touches;
		template.finger = touches ?
			touches.length :
			1 ;

		// The _handled method is fired to tell the default movestart
		// handler that one of the move events is bound.
		template._handled = handled;
			
		// Pass the touchmove event so it can be prevented if or when
		// movestart is handled.
		template._preventTouchmoveDefault = function() {
			e.preventDefault();
		};

		// Trigger the movestart event.
		trigger(template.target, template);

		// Unbind handlers that tracked the touch or mouse up till now.
		fn(template.identifier);
	}


	// Handlers that control what happens following a movestart

	function activeMousemove(e) {
		var timer = e.data.timer;

		e.data.touch = e;
		e.data.timeStamp = e.timeStamp;
		timer.kick();
	}

	function activeMouseend(e) {
		var event = e.data.event,
		    timer = e.data.timer;
		
		removeActiveMouse();

		endEvent(event, timer, function() {
			// Unbind the click suppressor, waiting until after mouseup
			// has been handled.
			setTimeout(function(){
				remove(event.target, 'click', returnFalse);
			}, 0);
		});
	}

	function removeActiveMouse(event) {
		remove(document, mouseevents.move, activeMousemove);
		remove(document, mouseevents.end, activeMouseend);
	}

	function activeTouchmove(e) {
		var event = e.data.event,
		    timer = e.data.timer,
		    touch = changedTouch(e, event);

		if (!touch) { return; }

		// Stop the interface from gesturing
		e.preventDefault();

		event.targetTouches = e.targetTouches;
		e.data.touch = touch;
		e.data.timeStamp = e.timeStamp;
		timer.kick();
	}

	function activeTouchend(e) {
		var event = e.data.event,
		    timer = e.data.timer,
		    touch = identifiedTouch(e.changedTouches, event.identifier);

		// This isn't the touch you're looking for.
		if (!touch) { return; }

		removeActiveTouch(event);
		endEvent(event, timer);
	}

	function removeActiveTouch(event) {
		remove(document, '.' + event.identifier, activeTouchmove);
		remove(document, '.' + event.identifier, activeTouchend);
	}


	// Logic for triggering move and moveend events

	function updateEvent(event, touch, timeStamp, timer) {
		var time = timeStamp - event.timeStamp;

		event.type = 'move';
		event.distX =  touch.pageX - event.startX;
		event.distY =  touch.pageY - event.startY;
		event.deltaX = touch.pageX - event.pageX;
		event.deltaY = touch.pageY - event.pageY;
		
		// Average the velocity of the last few events using a decay
		// curve to even out spurious jumps in values.
		event.velocityX = 0.3 * event.velocityX + 0.7 * event.deltaX / time;
		event.velocityY = 0.3 * event.velocityY + 0.7 * event.deltaY / time;
		event.pageX =  touch.pageX;
		event.pageY =  touch.pageY;
	}

	function endEvent(event, timer, fn) {
		timer.end(function(){
			event.type = 'moveend';

			trigger(event.target, event);
			
			return fn && fn();
		});
	}


	// jQuery special event definition

	function setup(data, namespaces, eventHandle) {
		// Stop the node from being dragged
		//add(this, 'dragstart.move drag.move', preventDefault);
		
		// Prevent text selection and touch interface scrolling
		//add(this, 'mousedown.move', preventIgnoreTags);
		
		// Tell movestart default handler that we've handled this
		add(this, 'movestart.move', flagAsHandled);

		// Don't bind to the DOM. For speed.
		return true;
	}
	
	function teardown(namespaces) {
		remove(this, 'dragstart drag', preventDefault);
		remove(this, 'mousedown touchstart', preventIgnoreTags);
		remove(this, 'movestart', flagAsHandled);
		
		// Don't bind to the DOM. For speed.
		return true;
	}
	
	function addMethod(handleObj) {
		// We're not interested in preventing defaults for handlers that
		// come from internal move or moveend bindings
		if (handleObj.namespace === "move" || handleObj.namespace === "moveend") {
			return;
		}
		
		// Stop the node from being dragged
		add(this, 'dragstart.' + handleObj.guid + ' drag.' + handleObj.guid, preventDefault, undefined, handleObj.selector);
		
		// Prevent text selection and touch interface scrolling
		add(this, 'mousedown.' + handleObj.guid, preventIgnoreTags, undefined, handleObj.selector);
	}
	
	function removeMethod(handleObj) {
		if (handleObj.namespace === "move" || handleObj.namespace === "moveend") {
			return;
		}
		
		remove(this, 'dragstart.' + handleObj.guid + ' drag.' + handleObj.guid);
		remove(this, 'mousedown.' + handleObj.guid);
	}
	
	jQuery.event.special.movestart = {
		setup: setup,
		teardown: teardown,
		add: addMethod,
		remove: removeMethod,

		_default: function(e) {
			var event, data;
			
			// If no move events were bound to any ancestors of this
			// target, high tail it out of here.
			if (!e._handled()) { return; }

			function update(time) {
				updateEvent(event, data.touch, data.timeStamp);
				trigger(e.target, event);
			}

			event = {
				target: e.target,
				startX: e.startX,
				startY: e.startY,
				pageX: e.pageX,
				pageY: e.pageY,
				distX: e.distX,
				distY: e.distY,
				deltaX: e.deltaX,
				deltaY: e.deltaY,
				velocityX: e.velocityX,
				velocityY: e.velocityY,
				timeStamp: e.timeStamp,
				identifier: e.identifier,
				targetTouches: e.targetTouches,
				finger: e.finger
			};

			data = {
				event: event,
				timer: new Timer(update),
				touch: undefined,
				timeStamp: undefined
			};
			
			if (e.identifier === undefined) {
				// We're dealing with a mouse
				// Stop clicks from propagating during a move
				add(e.target, 'click', returnFalse);
				add(document, mouseevents.move, activeMousemove, data);
				add(document, mouseevents.end, activeMouseend, data);
			}
			else {
				// We're dealing with a touch. Stop touchmove doing
				// anything defaulty.
				e._preventTouchmoveDefault();
				add(document, touchevents.move + '.' + e.identifier, activeTouchmove, data);
				add(document, touchevents.end + '.' + e.identifier, activeTouchend, data);
			}
		}
	};

	jQuery.event.special.move = {
		setup: function() {
			// Bind a noop to movestart. Why? It's the movestart
			// setup that decides whether other move events are fired.
			add(this, 'movestart.move', jQuery.noop);
		},
		
		teardown: function() {
			remove(this, 'movestart.move', jQuery.noop);
		}
	};
	
	jQuery.event.special.moveend = {
		setup: function() {
			// Bind a noop to movestart. Why? It's the movestart
			// setup that decides whether other move events are fired.
			add(this, 'movestart.moveend', jQuery.noop);
		},
		
		teardown: function() {
			remove(this, 'movestart.moveend', jQuery.noop);
		}
	};

	add(document, 'mousedown.move', mousedown);
	add(document, 'touchstart.move', touchstart);

	// Make jQuery copy touch event properties over to the jQuery event
	// object, if they are not already listed. But only do the ones we
	// really need. IE7/8 do not have Array#indexOf(), but nor do they
	// have touch events, so let's assume we can ignore them.
	if (typeof Array.prototype.indexOf === 'function') {
		(function(jQuery, undefined){
			var props = ["changedTouches", "targetTouches"],
			    l = props.length;
			
			while (l--) {
				if (jQuery.event.props.indexOf(props[l]) === -1) {
					jQuery.event.props.push(props[l]);
				}
			}
		})(jQuery);
	};
});



(function closure(root, factory) {
	if(typeof define === 'function' && define.amd) {
		define('twentytwenty',['jquery'],
			function load($) {
				return factory(root, $);
			});
	} else{
		// For non-AMD module, expose this to global (will also be useful for test cases)
		/* eslint-disable*/
		factory(root, jQuery);
		/*eslint-enable*/
	}
})(this, function factory(root, $) {
	$.fn.twentytwenty = function twentyTwentyPlugin(_options) {
		var options = $.extend({
			default_offset_pct: 0.5,
			orientation: 'horizontal'
		}, _options);

		return this.each(function twentyTwentyPluginEach() {
			var sliderPct = options.default_offset_pct;
			var container = $(this);
			var sliderOrientation = options.orientation;
			var beforeDirection = (sliderOrientation === 'vertical') ? 'down' : 'left';
			var afterDirection = (sliderOrientation === 'vertical') ? 'up' : 'right';
			var beforeImg;
			var afterImg;
			var slider;
			var overlay;

			var offsetX = 0;
			var offsetY = 0;
			var imgWidth = 0;
			var imgHeight = 0;

			container.wrap('<div class="twentytwenty-wrapper twentytwenty-' + sliderOrientation + '"></div>');
			container.append('<div class="twentytwenty-overlay"></div>');
			beforeImg = container.find('img:first');
			afterImg = container.find('img:last');
			container.append('<div class="twentytwenty-handle"></div>');
			slider = container.find('.twentytwenty-handle');
			slider.append('<span class="twentytwenty-' + beforeDirection + '-arrow"></span>');
			slider.append('<span class="twentytwenty-' + afterDirection + '-arrow"></span>');
			container.addClass('twentytwenty-container');
			beforeImg.addClass('twentytwenty-before');
			afterImg.addClass('twentytwenty-after');

			overlay = container.find('.twentytwenty-overlay');
			overlay.append('<div class="twentytwenty-before-label"></div>');
			overlay.append('<div class="twentytwenty-after-label"></div>');

			function calcOffset(dimensionPct) {
				var w = beforeImg.width();
				var h = beforeImg.height();
				return {
					w: w + 'px',
					h: h + 'px',
					cw: (dimensionPct * w) + 'px',
					ch: (dimensionPct * h) + 'px'
				};
			}

			function adjustContainer(offset) {
				if (sliderOrientation === 'vertical') {
					beforeImg.css('clip', 'rect(0,' + offset.w + ',' + offset.ch + ',0)');
				} else {
					beforeImg.css('clip', 'rect(0,' + offset.cw + ',' + offset.h + ',0)');
				}

				container.css('height', offset.h);
			}

			function adjustSlider(pct) {
				var offset = calcOffset(pct);
				slider.css((sliderOrientation === 'vertical') ? 'top' : 'left', (sliderOrientation === 'vertical') ? offset.ch : offset.cw);
				adjustContainer(offset);
			}

			$(window).on('resize.twentytwenty', function twentyTwentyOnResize() {
				adjustSlider(sliderPct);
			});

			slider.on('movestart', function silderOnMoveStart(e) {
				if (((e.distX > e.distY && e.distX < -e.distY) || (e.distX < e.distY && e.distX > -e.distY)) && sliderOrientation !== 'vertical') {
					e.preventDefault();
				} else if (((e.distX < e.distY && e.distX < -e.distY) || (e.distX > e.distY && e.distX > -e.distY)) && sliderOrientation === 'vertical') {
					e.preventDefault();
				}

				container.addClass('active');

				offsetX = container.offset().left;
				offsetY = container.offset().top;

				imgWidth = beforeImg.width();
				imgHeight = beforeImg.height();
			});

			slider.on('moveend', function sliderOnMoveEnd() {
				container.removeClass('active');
			});

			slider.on('move', function sliderOnMove(e) {
				if (container.hasClass('active')) {
					sliderPct = (sliderOrientation === 'vertical') ? (e.pageY - offsetY) / imgHeight : (e.pageX - offsetX) / imgWidth;

					if (sliderPct < 0) {
						sliderPct = 0;
					}

					if (sliderPct > 1) {
						sliderPct = 1;
					}
					adjustSlider(sliderPct);
				}
			});

			container.find('img')
				.on('mousedown', function containerOnMouseDown(event) {
					event.preventDefault();
				});

			$(window).trigger('resize.twentytwenty');
		});
	};

	function init() {
		$('.twentytwenty-container[data-orientation!="vertical"]')
			.twentytwenty({default_offset_pct: 0.7});

		$('.twentytwenty-container[data-orientation="vertical"]')
			.twentytwenty({default_offset_pct: 0.3, orientation: 'vertical'});
	}

	// On Load
	$(window).load(init);

	return {
		init: init
	};
});


/* ---------------------------------------------------------------------------------------
	Called on window.load by default. Can also be called as a public function and
	adjust the heights of all the pods.

	* this will eventually be scrapped for flex-box once the new grid takes hold.
-----------------------------------------------------------------------------------------*/

(function closure(root, factory) {
	if(typeof define === 'function' && define.amd) {
		define('global.podHeights',['jquery'], function load(jQuery) {
			return factory(jQuery);
		});
	} else{
		// For non-AMD module, expose this to global (will also be useful for test cases)
		/* eslint-disable*/
		factory(jQuery);
		/*eslint-enable*/
	}
})(this, function factory($) {
	// TAKES PARENT EL & CHILD EL TO MAKE EQUAL HEIGHT COLS. USED IN FIXPODHEIGHTS
	function equalColHeights(parentElement, childElement) {
		var $thisParentsChild;
		var numOfChildern;
		var index;
		var i;
		var ThisHeight;
		var tallestChild;
		var childHeights;

		for(index = 0; index < $(parentElement).length; index += 1) {
			$thisParentsChild = $(parentElement).eq(index).children(childElement);
			numOfChildern = $thisParentsChild.length;

			if (numOfChildern > 1) {
				childHeights = [];
				for(i = 0; i < numOfChildern; i += 1) {
					ThisHeight = $thisParentsChild.eq(i).height();
					childHeights[i] = ThisHeight;
				}

				/* find tallest height out of this row's array */
				tallestChild = Math.max.apply(Math, childHeights);
				/*
					if this pod does not have "no-pod-height" setting. give all this
					row's child pods the height of tallest pod
				*/
				if (!$thisParentsChild.hasClass('no-pod-height')) {
					$thisParentsChild.css('min-height', tallestChild);
				}
			}
		}
	}
	// Soon to not be a global
	window.fixPodHeights = function fixPodHeights() {
		var $this;
		var $rail;
		var $mainC;
		var railHeight;
		var mainContentHeight;
		var i;
		var $theRows = $('#container div.row');

		for (i = 0; i < $theRows.length; i += 1) {
			$this = $theRows.eq(i);
			$rail = $this.find('div.rail');
			// first check to see if row has a rail
			if ($rail.length > 0) {
				$mainC = $this.find('div.mainContent');
				railHeight = $rail.height();
				mainContentHeight = $mainC.height();

				if ($('#mainDiv').find('div').hasClass('rail footerRail grid_6 alpha')) {
					$rail.css('min-height', mainContentHeight);
				} else {
					if (railHeight > mainContentHeight) {
						$mainC.css('min-height', railHeight);
					} else if (railHeight < mainContentHeight) {
						$rail.css('min-height', mainContentHeight);
					}
				}
			}
		}

		equalColHeights('div.row', 'div.pod');
		equalColHeights('div.pod', 'div.pod');
		// remove all inline styles of rail pods quickfix
		$('#container').find('div.rail div.pod').removeAttr('style');
	};

	return {
		init: function init() {
			var self = this;
			// For some stinkin' global variable that a certian person created...
			$(function doc() { (window.ignoreStripeTablePage) ? '' : window.ignoreStripeTablePage = {}; });
			// timeout is set after quickview overlay since this is lower on page
			$(window).load(function load() {
				setTimeout(function to() {
					self.fixPodHeights();
				}, 1600);
			});
		},
		fixPodHeights: window.fixPodHeights
	};
});


/* Related Resources Widget
	Requires: jquery.min.js, mustache.js
	Function: Handles functionality for displaying dynamic related resources content on any page. Leverages limitText and dynamicRatings methods from global.js
*/

(function closure(root, factory) {
	if(typeof define === 'function' && define.amd) {
		define('relatedResourceWidget',['jquery', 'mustache', 'global.dynamicRatings', 'global.podHeights'],
			function load($, mustache, dynamicRatings, podHeights) {
				return factory(root, $, mustache, window, dynamicRatings, podHeights);
			});
	} else{
		// For non-AMD module, expose this to global (will also be useful for test cases)
		/* eslint-disable*/
		factory(root, jQuery, Mustache, window);
		/*eslint-enable*/
	}
})(this, function factory(root, $, mustache, window, dynamicRatingsModule, podHeightsModule) {
// !function ($, Mustache) {
	// Object created to store templates
	var $mainContent = $('#container');
	var mustacheTemplates = {
		fullTemplate: '<div class="grid_12 articleSnippet"><div class="spad"><div class="content">{{#image}}<div class="content_image"><a href="{{url}}"><img src="{{image}}" alt=""></a></div>{{/image}}<a href="{{url}}" class="b large">{{title}}</a><p class="content-description">{{description}}</p>{{#rating}}<a class="reviews" href="{{{url}}}#customer_reviews"><span class="stars" rel="{{rating}}"></span></a>{{/rating}}</div></div></div>',
		linkList: '<li class="related-resource-info"><a href="{{url}}">{{title}}</a></li>',
		leadArticle: '<div class="grid_8"><div class="spad"><div class="content box-shadow"><div class="content_image">{{^hasImage}}<img src="http://www.homedepot.com/hdus/en_US/DTCCOM/common/Themes/transparentHT/wood/noImageAvail.jpg">{{/hasImage}}{{#image}}<img src={{image}}>{{/image}}<div class="article_data"><a href="{{url}}"><span class="title">{{title}}<i class="icon-carrot-orange"></i></span>{{#author}}<span class="author">{{author}}</span>{{/author}}{{#publishedOn}}<span class="published"> on {{publishedOn}}</span>{{/publishedOn}}<p class="short-description">{{description}}</p>{{#rating}}<span class="label">Ratings :</span><div class="reviews"><span class="stars" rel="{{rating}}"></span></div>{{/rating}}{{#duration}}<div class="duration">Duration :<span class="data">{{duration}}</span></div>{{/duration}}{{#difficulty}}<div class="difficulty">Difficulty :<span class="data">{{difficulty}}</span></div>{{/difficulty}}</a></div></div></div></div></div>',
		'related-resource-accordion': '{{#url}}<li><a href="{{url}}"><span class="article-title">{{title}}<i class="icon-carrot-orange"></i></span>{{#author}}<span class="author">{{author}}</span>{{/author}}{{#publishedOn}}<span class="published"> on {{publishedOn}}</span>{{/publishedOn}}{{#rating}}<span class="reviews"><span class="stars" rel="{{rating}}"></span></span>{{/rating}}</a></li>{{/url}}'
	};

	// A quick check to see if the correct SEO url is in the JSON
	function checkForCorrectURLStructure(data) {
		var urlCheck = data.url.split('/');
		return Boolean(urlCheck[1] === 'c');
	}

	// Applies the data to the template
	function buildContent(data, $this, template) {
		var newURL;
		var html;
		/* A check to see if this is a Grid SEO page */
		var seoPage = Boolean($('#skjpsp_ops').val() === '1');
		var hasCorrectURL = checkForCorrectURLStructure(data);

		// Checks to see if this is a SEO page and if the URL is correct in the JSON
		// We then push the updated SEO URL if it's a ContentView Page, if not it does nothing
		if (seoPage && !hasCorrectURL) {
			newURL = data.url.split('=');
			// self refferencing but...
			data.url = (newURL[0].split('?')[0] === 'ContentView') ? '/c/' + newURL[1] : data.url;
		}

		// Build out and append our template(s)
		html = mustache.to_html(mustacheTemplates[template], data);
		$(html).appendTo($this);
	}

	function limitStringLength(_string, length, _endCap) {
		var endCap = (_endCap || '&hellip;');
		var string = _string;

		if(string.length > length) {
			string = string.substr(0, length);
			string = string.substr(0, string.lastIndexOf(' '));
			string += endCap;
		}
		return string;
	}

	function limitText() {
		$mainContent.find('.article_data .short-description').each(function limitTextShortDescriptionEach() {
			var text = $(this).html();
			text = limitStringLength(text, 165);

			$(this).html(text);
		});

		$mainContent.find('.content-description').each(function limitTextContentDescriptionEach() {
			var text = $(this).html();
			text = limitStringLength(text, 80);

			$(this).html(text);
		});


		$mainContent.find('.related-resource-info a').each(function limitTextRelatedResourceInfoEach() {
			var text = $(this).html();
			text = limitStringLength(text, 55);

			$(this).html(text);
		});


		$mainContent.find('li.related-resource-info a').each(function limitTextListRelatedResourceInfoEach() {
			var text = $(this).html();
			text = limitStringLength(text, 50);

			$(this).html(text);
		});


		// Cut titles to 60 (~2 lines) if there is body text
		$mainContent.find('.articleSnippet .content a.large').each(function limitTextSnippetContentLargeEach() {
			var $this = $(this);
			var text;

			if($.trim($this.next().html()) !== '') {
				text = $(this).html();
				text = limitStringLength(text, 60);

				$(this).html(text);
			}
		});
	}


	// main function that iterates over each widget found
	function relatedResourcesWidget() {
		var $this = $(this);
		var resource = $this.data();
		var dataSource = resource.source;
		// URL of service
		var template = resource.template;
		// Template to use
		var $parent = $this.parent();

		// Get data
		$.ajax({
			type: 'GET',
			url: dataSource,
			cache: true,
			dataType: 'json',
			success: function relatedResourcesRequestSuccess(json) {
				var data = json.Resources;
				var dataL = data.length;
				var i;

				for(i = 0; i < dataL; i++) {
					buildContent(data[i], $this, template);
				}

				if(dataL === 0) {
					$parent.remove();
				}
			},
			complete: function relatedResourcesRequestComplete() {
				limitText();

				// Use the AMD module if available
				if (dynamicRatingsModule) {
					dynamicRatingsModule.dynamicRatings();
				} else {
					window.dynamicRatings();
				}

				// run again to fix rail height if necessary
				if (podHeightsModule) {
					podHeightsModule.fixPodHeights();
				} else {
					window.fixPodHeights();
				}
			},
			error: function relatedResourcesRequestError() {
				$parent.remove();
			}
		});
	}

	// find the widgets and run relatedResorucesWidget function
	$mainContent.find('[data-widget=related-resource-widget]')
		.each(relatedResourcesWidget);
});


/*
----------------------------------------------------
|
| Simple collapse function
| by adding attribute data-action="accordion-trigger" to an element
| if will collapse/expand the next element
| this example will expand/collapse the div content :
|   <a href="#1" class="active" data-action="accordion-trigger"><span>Project How-To</span></a>
|   <div class="content">
|       <ul>
|           <li><a href="#1">This is the new entry thats pretty long</a></li>
|           <li><a href="#2">This is the new entry</a></li>
|           <li><a href="#2">This is the new entry</a></li>
|           <li><a href="#1">This is the new entry</a></li
|           <li><a href="#2">This is the new entry</a></li>
|       </ul>
|   </div>
|
----------------------------------------------------
*/
(function closure(root, factory) {
	if(typeof define === 'function' && define.amd) {
		define('simpleAccordion',['jquery', 'global.namespace'],
			function load($, THD) {
				return factory(root, $, THD);
			});
	} else{
		// For non-AMD module, expose this to global (will also be useful for test cases)
		/* eslint-disable*/
		factory(root, jQuery, THD);
		/*eslint-enable*/
	}
})(this, function factory(root, $, THD) {
	// Get the namespace
	var widgets = THD.Utility.Namespace.createNamespace('THD.Widget');

	// main functionality
	function simpleAccordionCollapse() {
		var $accordionTrigger = $('*[data-action="accordion-trigger"]');

		// Get Default settings
		$accordionTrigger.each(function simpleAccordionCollapseTriggerEach() {
			var $this = $(this);

			if ($this.hasClass('active')) {
				$this.append('<span class="accordion-notification">\u2013</span>');
			} else {
				$this.append('<span class="accordion-notification">+</span>');
				$this.next('div').css('display', 'none');
			}
		});

		// click function
		$accordionTrigger.click(function simpleAccordionCollapseTriggerClick(e) {
			var $this = $(this);
			var $refinementGroup = $this.closest('.refinement-group');
			var $toggleElm = ( $refinementGroup.length > 0 ) ? $('.refinement-content', $refinementGroup) : $this.next();
			var $accordionNotification;

			// toggle section after trigger
			$toggleElm.slideToggle('125');

			$accordionNotification = $('.accordion-notification', this);

			if($this.hasClass('active')) {
				$this.removeClass('active');
				$accordionNotification.text('+');
			} else {
				$accordionNotification.text('\u2013');
				$this.addClass('active');
			}

			e.preventDefault();
			 // This function is only here for IE7 repaint issue
			if (navigator.appName === 'Microsoft Internet Explorer') {
				setTimeout(function simpleAccordionCollapseTriggerClickTimeout() {
					$('.related-resource-accordion .content').toggleClass('ieRepaint');
				}, 500);
			}
		});
	}

	// run collapse function
	simpleAccordionCollapse();

	// Define the widget interface
	widgets.simpleAccordian = {
		exec: simpleAccordionCollapse
	};

	// Return the module, not the namespace
	return widgets.simpleAccordian;
});

/* =============================================================
 * thd-collapse.js v1.0
 * thd collapse is a really simple accordian plugin
 *
 * Markup
 ********************************
 * Just add {data-toggle="collapse"} and a {data-target} to element to automatically assign control of a collapsible element.
 * The data-target attribute accepts a css selector to apply the collapse to.
 * Be sure to add the class {collapse} to the collapsible element.
 * If you'd like it to default open, add the additional class "in".
 * =============================================================*/


(function closure(root, factory) {
	if(typeof define === 'function' && define.amd) {
		define('thd.collapse',['jquery', 'global.namespace'],
			function load($, THD) {
				return factory(root, $, THD);
			});
	} else{
		// For non-AMD module, expose this to global (will also be useful for test cases)
		/* eslint-disable*/
		factory(root, jQuery, THD);
		/*eslint-enable*/
	}
})(this, function factory(root, $, THD) {
	THD.Widget.collapse = {};

	function Collapse(element, options) {
		this.$element = $(element);
		this.options = $.extend({}, $.fn.collapse.defaults, options);

		if (this.options.parent) {
			this.$parent = $(this.options.parent);
		}

		this.options.toggle && this.toggle();
	}

	Collapse.prototype = {
		constructor: Collapse,

		dimension: function CollapseDimension() {
			var hasWidth = this.$element.hasClass('width');
			return (hasWidth) ? 'width' : 'height';
		},

		show: function CollapseShow() {
			var dimension = this.dimension();
			var scroll = $.camelCase([ 'scroll', dimension ].join('-'));
			var actives = this.$parent && this.$parent.find('.in');
			var hasData;

			if (actives && actives.length) {
				hasData = actives.data('collapse');
				actives.collapse('hide');
				hasData || actives.data('collapse', null);
			}

			this.$element[dimension](0);
			this.transition('addClass', 'show', 'shown');
			this.$element[dimension](this.$element[0][scroll]);
		},
		hide: function CollapseHide() {
			var dimension = this.dimension();

			this.reset(this.$element[dimension]());
			this.transition('removeClass', 'hide', 'hidden');
			this.$element[dimension](0);
		},

		reset: function CollapseReset(size) {
			var dimension = this.dimension();

			this.$element.removeClass('collapse')[dimension](size || 'auto')[0].offsetWidth;
			this.$element[size ? 'addClass' : 'removeClass']('collapse');

			return this;
		},

		transition: function CollapseTransition(method, startEvent, completeEvent) {
			var that = this;

			function CollapseTransitionComplete() {
				if (startEvent === 'show') {
					that.reset();
				}
				that.$element.trigger(completeEvent);
			}

			this.$element.trigger(startEvent)[method]('in');

			return $.support.transition && this.$element.hasClass('collapse') ? this.$element.one($.support.transition.end, CollapseTransitionComplete) : CollapseTransitionComplete();
		},

		toggle: function CollapseToggle() {
			return this[this.$element.hasClass('in') ? 'hide' : 'show']();
		}
	};

	/* -------------------------------------------------
	 * COLLAPSIBLE PLUGIN DEFINITION
	--------------------------------------------------*/

	$.fn.collapse = function CollapsePlugin(option) {
		return this.each(function CollapsePluginEach() {
			var $this = $(this);
			var data = $this.data('collapse');
			var options = (typeof option === 'object' && option);

			if (!data) {
				$this.data('collapse', (data = new Collapse(this, options)));
			}

			if (typeof option === 'string') {
				data[option]();
			}
		});
	};

	$.fn.collapse.defaults = {
		toggle: true
	};

	$.fn.collapse.Constructor = Collapse;


	/* -----------------------------------------------------
	 * COLLAPSIBLE DATA-API - THD Style
	-------------------------------------------------------*/

	// Setting data-target for h4 and id for div at run time.
	THD.Widget.collapse.setId = (function collapseSetId() {
		var $this;
		var id;
		var i;
		var collapsible = $('#hfappContainer').find('.content > [data-toggle=collapse]');

		// specifically looks for DCTM placed collapse containers
		for (i = collapsible.length - 1; i >= 0; i -= 1) {
			$this =  $(collapsible).eq(i);
			id = $this.data('id');

			$this.siblings('.collapse').attr('id', id).end().data('target', '#' + id);

			// To accommodate the space between left & right panes not in the left rail
			if(!$this.parents().hasClass('rail')) {
				$this.parent('div.content').addClass('addSpace');
			}
		}
	})();


	// click event on a data-toggle=collapse taged element
	function toggleContainerData(e) {
		var $this = $(this);
		var href;
		// strip for ie7
		var target = $this.data('target') || e.preventDefault() || (href = $this.attr('href')) && href.replace(/.*(?=#[^\s]+$)/, '');
		var option = $(target).data('collapse') ? 'toggle' : $this.data();

		e.preventDefault();

		$(target).collapse(option);

		$this.toggleClass('on');
	}


	// checks for a hash value on page load to automatically open the coresponding content aera
	function checkForHash() {
		var hash = window.location.hash;
		if(Boolean(hash)) {
			$(hash).collapse('show');
			$(hash).siblings('[data-toggle=collapse]').addClass('on');
		}
	}


	$(document)
		.on('click.collapse.data-api', '[data-toggle=collapse]', toggleContainerData)
		.ready(checkForHash);

	return root.THD;
});



(function closure(root, factory) {
	if(typeof define === 'function' && define.amd) {
		define('thdSocialmedia',['jquery'],
			function load($) {
				return factory(root, $);
			});
	} else{
		// For non-AMD module, expose this to global (will also be useful for test cases)
		/* eslint-disable*/
		factory(root, jQuery);
		/*eslint-enable*/
	}
})(this, function factory(root, $) {
	/* url param should the path to be opened in th window,
	** windowName param should be string cannot contain special characters (IE doesnot accespts hyphen & spaces),
	** windowWidth param should be string, like 'width=626,height=436' */
	function openNewWindow(url, windowName, windowWidth) {
		window.open(url, windowName, windowWidth);
	}

	function pinImage(media) {
		var header;
		var pinImg;
		var src;

		if (media === 'pinterest') {
			$('#pinterest_overlay').remove();

			$('body').append('<div id="pinterest_overlay"></div>');

			header = '<div id="pinterest_header"><span class="dwarf-pinterestIcon small-icon"></span> <h3 class="pinterest_headermsg">Pin It to Pinterest</h3>' +
					'<a class="pinterest_headerclose" href="#"" title="Close"></a></div>';

			$('#pinterest_overlay').hide().append(header);
			$('#pinterest_overlay').append('<div id="pinterest_body"></div>');
			$('#pinterest_overlay').append('<div id="pinterest_footer"></div>');

			pinImg = '';

			$('img').each(function pinEachImage() {
				var imageWidth = $(this).width();
				var imageHeight = $(this).height();
				var pinterestImageSizeInfo = '<span class="pinterest_imageSize">';
				if( imageWidth >= 145 && imageHeight >= 100 ) {
					src = $(this).attr('src');
					// Check if the image source path is relative, if so form the absolute image path
					src = ( src.indexOf('.com') !== -1 ) ? src : ( document.location.host + src );

					if(imageHeight === 300) {
						pinterestImageSizeInfo = pinterestImageSizeInfo + 'Preferred Image </span>';
					}else{
						pinterestImageSizeInfo = pinterestImageSizeInfo + imageHeight + ' x ' + imageWidth + '</span>';
					}

					pinImg = pinImg + '<span class="pinthis-imageOuter_32x32">';
					pinImg = pinImg + '<span class="pinthis-imageInner_32x32">' +
									'<img alt="' + (($(this).attr('alt') !== undefined ) ? $(this).attr('alt') : '') + '" class="pinterestEqualSizeImage" src="' + src + '" height="" width=""/> </a> </span><div class="pinterest_icon dwarf-pinterest"></div> ' + pinterestImageSizeInfo + '</span>';
				}
			});
			$('#pinterest_body').append(pinImg);
		}
	}

	function getPinitOverlay( media ) {
		if(media === 'pinterest' ) {
			pinImage('pinterest');

			$.fancybox({
				'content': $('#pinterest_overlay').html(),
				'width': 640,
				'height': 510,
				'margin': 0,
				'padding': 0,
				'autoDimensions': false,
				'autoSize': false,
				'scrolling': 'no',
				'centerOnScroll': true,
				'enableEscapeButton': true,
				'modal': false,
				'overlayColor': '#666',
				'overlayOpacity': 0.7,
				'showCloseButton': true
			});
		}
	}

	function getSocialMediaWidget() {
		var socialMedia = $('.sharewidget').attr('data-socialmedia');
		var n = socialMedia.split(',');
		var i;
		var twitterLink;

		for (i = 0; i < n.length; i++) {
			if (n[i] === 'facebook') {
				$('.sharewidget').append('<span class="dwarf-facebookShareIcon"/>');

				/* Delegate event on Facebook click */
				$('body').delegate('.dwarf-facebookShareIcon', 'click', function facebookShareDelegateHandler(event) {
					event.preventDefault();
					openNewWindow('https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(location.href), 'facebook_share_dialog', 'width=626,height=436');
				});
			} else if(n[i] === 'twitter') {
				twitterLink =  '<div class="twitter">' +
						'<a href="https://twitter.com/share" class="twitter-share-button" data-dnt="true" data-count="none" data-via="text here">Tweet</a>' +
						'<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>' +
					'</div>';
				$('.sharewidget').append(twitterLink);
			}else if(n[i] === 'pinterest') {
				$('.sharewidget').append('<span class="pinit dwarf-pinterestShareIcon"/>');

				/* Delegate event on Pinterest click */
				$('body').delegate('.dwarf-pinterestShareIcon', 'click', function pinterestShareDelegateHandler(event) {
					event.preventDefault();
					getPinitOverlay('pinterest');
				});

				/* Delegate event on Image click from Pinterest overlay */
				$('body').delegate('.pinthis-imageOuter_32x32', 'click', function pinThisShareDelegateHandler() {
					var pinterestUrl = 'http://pinterest.com/pin/create/button/?url=' + encodeURIComponent(document.location.href) +
						'&amp;media=' + $(this).find('img').attr('src') + '&amp;description=' + encodeURIComponent(document.title);

					openNewWindow(pinterestUrl, 'pinterest_share_dialog', 'width=626,height=436');
				});

				/* Delegate event on Image hover from Pinterest overlay */
				$('body').delegate('.pinthis-imageOuter_32x32', 'mouseenter', function pinterestOuterMouseoverDelegateHandler() {
					$(this).find('.pinterest_icon').show();
					$(this).find('.pinterestEqualSizeImage').addClass('pinterestEqualSizeImageHover');
				}).delegate('.pinthis-imageOuter_32x32', 'mouseleave', function pinterestOuterMouseleaveDelegateHandler() {
					$(this).find('.pinterest_icon').hide();
					$(this).find('.pinterestEqualSizeImage').removeClass('pinterestEqualSizeImageHover');
				});
			} else if(n[i] === 'google+') {
				$('.sharewidget').append('<div class="gplus">' + '<a href="#" class="thdGooglePlusIcon">' + '<img src="https://www.gstatic.com/images/icons/gplus-64.png" alt="Share on Google+" style="height:16px;margin-top:1px;"/>' + '</a>');

				/* Delegate event on GooglePlus click */
				$('body').delegate('.thdGooglePlusIcon', 'click', function googlePlusDelegateHandler(event) {
					event.preventDefault();
					openNewWindow('https://plus.google.com/share?url={URL}', 'gplus_share_dialog', 'width=626,height=436');
				});
			}
		}
	}

	function init() {
		// exr4660 121313
		$(document).ready(function onReady() {
			var $sharewidget = $('.sharewidget');

			if ( $sharewidget.length !== 0) {
				// alert($sharewidget.length);
				getSocialMediaWidget();
			}
		});
	}

	init();

	return {
		init: init
	};
});

/* ===============================================================================================================
* THD SBOTD Widget Creation
* =================================================================================================================*/


(function closure(root, factory) {
	if(typeof define === 'function' && define.amd) {
		define('thd.sbotd',['jquery', 'mustache', 'global.namespace'],
			function load($, Mustache, THD) {
				return factory(root, $, Mustache, THD);
			});
	} else{
		// For non-AMD module, expose this to global (will also be useful for test cases)
		/* eslint-disable*/
		factory(root, jQuery, Mustache, THD);
		/*eslint-enable*/
	}
})(this, function factory(root, $, Mustache, THD) {
	// Sets up the namespace
	THD.Utility.Namespace.createNamespace('THD.Widget.sbotdWidget');

	/* SBOTD Templates
	-------------------------------------------------*/
	THD.Widget.sbotdWidget.templates = {
		'hero_tpl': '<div class="grid col-1-1 transparentBorder">' +
			'<div class="col-1-1-xs  col-1-3-sm  col-1-3-md  col-1-3-lg  col-1-3-xl">' +
			'<div class="content">' +
			'</div>' +
			'</div>' +
			'<div class="col-1-1-xs  col-1-3-sm  col-1-3-md  col-1-3-lg  col-1-3-xl">' +
			'<div class="content hero-price">' +
			'<p class="title large thdBlack">{{productName}}</p>' +
			'<ul class="linkList horizontal l priceDescription">' +
			'<li class="price wasPrice">${{wasPrice}}</li>' +
			'<li class="price-label">Was</li>' +
			'<li class="price">-${{priceDiff}}</li>' +
			'<li class="price-label">SPECIAL BUY SAVINGS</li>' +
			'<li class="price price-border">${{isPrice}}</li>' +
			'<li class="price-label">YOUR NEW PRICE</li>' +
			'</ul>' +
			'<a href="{{PIP}}" class="btn btn btn-orange shopNow" data-overlay-type="">Shop Now</a>' +
			'<a href="http://www.homedepot.com/SpecialBuy/SpecialBuyOfTheDay" class="shop-special carrot b">Shop All Specials</a>' +
			'</div>' +
			'</div>' +
			'<div class="col-1-1-xs  col-1-3-sm  col-1-3-md  col-1-3-lg  col-1-3-xl">' +
			'<div class="content">' +
			'<div class="content_image"><img src="{{heroImg}}" width="300px" height="300px" alt="" class="align-center"></div>' +
			'<i class="sp-buy" ></i>' +
			'</div>' +
			'</div>' +
			'</div>',
		'largePOD_tpl': '<div class="content_image largePOD"><img src="{{heroImg}}" width="145px" height="145px" alt="" class="align-center"></div>' +
			'<i class="sp-buy" ></i>' +
			'<p class="title">{{productName}}</p>' +
			'<p class="l">Was&nbsp;<span class="item_stike_price">${{wasPrice}}</span></p>' +
			'<p class="l pricingReg">${{isPrice}}<span class="large">/each</span></p>' +
			'<p class="l savingText">Save ${{priceDiff}}&nbsp;({{discount}}%)</p>' +
			'<a href="{{PIP}}" class="btn btn btn-orange shopNow" data-overlay-type="">Shop Now</a>' +
			'<a href="http://www.homedepot.com/SpecialBuy/SpecialBuyOfTheDay" class="shop-special carrot b">Shop All Specials</a>' +
			'</div>' +
			'</div>' +
			'</div>',
		'smallPOD_tpl': '<div class="content_image" style="width: 100%;"><img src="{{heroImg}}" width="145px" height="145px" alt="" class="align-center"></div>' +
			'<i class="sp-buy" ></i>' +
			'<p class="l">Was&nbsp;<span class="item_stike_price">${{wasPrice}}</span></p>' +
			'<p class="l pricingReg">${{isPrice}}<span class="large">/each</span></p>' +
			'<p class="l savingText">Save ${{priceDiff}}&nbsp;({{discount}}%)</p>' +
			'<p class="title">{{productName}}</p>' +
			'<a href="{{PIP}}" class="btn btn btn-orange shopNow" data-overlay-type="">Shop Now</a>' +
			'<a href="http://www.homedepot.com/SpecialBuy/SpecialBuyOfTheDay" class="shop-special carrot b">Shop All Specials</a>' +
			'</div>' +
			'</div>' +
			'</div>',
	};

	THD.Widget.sbotdWidget.displayDeal = function sbotdDisplayDeal(jsonresp) {
		var sbotdElement = $('#sbotd');
		var isType = sbotdElement.data('view');
		var available = [];
		var soldout = [];
		var indexID;
		var productId;
		var outputTemplate;
		var discountPercent;

		// arrange only available Items.
		for (indexID in jsonresp) {
			if (jsonresp.hasOwnProperty(indexID)) {
				for (productId in jsonresp[indexID]) {
					if (jsonresp[indexID][productId].invAvl === 'true') {
						discountPercent = parseInt((jsonresp[indexID][productId].priceDiff / jsonresp[indexID][productId].wasPrice) * 100, 10);
						available.push(jsonresp[indexID][productId]);
						available[(available.length) - 1].discount = discountPercent;
					} else {
						soldout.push(jsonresp[indexID]);
					}
				}
			}
		}

		if (isType === 'hero') {
			outputTemplate = Mustache.render(THD.Widget.sbotdWidget.templates.hero_tpl, available[0]);
			sbotdElement.html(outputTemplate);
		} else if (isType === 'large') {
			outputTemplate = Mustache.render(THD.Widget.sbotdWidget.templates.largePOD_tpl, available[0]);
			sbotdElement.html(outputTemplate);
		} else if (isType === 'small') {
			outputTemplate = Mustache.render(THD.Widget.sbotdWidget.templates.smallPOD_tpl, available[0]);
			sbotdElement.html(outputTemplate);
		}
	};

	THD.Widget.sbotdWidget.callSBOTDService = function sbotdCallSbotdService() {
		// var URL = path + '/SpecialBuy/SpecialBuyOfTheDay?deals=true';
		var URL = '/SpecialBuy/SpecialBuyOfTheDay?deals=true';

		$.ajax({
			type: 'GET',
			url: URL,
			dataType: 'JSON',
			success: function sbotdCallSbotdServiceSuccess(data) {
				THD.Widget.sbotdWidget.displayDeal(data);
			},
			error: function sbotdCallSbotdServiceError(e) {
				/*eslint-disable*/
				console.log(e);
				/*eslint-enable*/
			}
		});
	};

	THD.Widget.sbotdWidget.callSBOTDService();

	return THD.Widget.sbotdWidget;
});



(function closure(root, factory) {
	if(typeof define === 'function' && define.amd) {
		define('muteYTVideo',['jquery'],
			function load($) {
				return factory(root, $);
			});
	} else{
		// For non-AMD module, expose this to global (will also be useful for test cases)
		/* eslint-disable*/
		factory(root, jQuery);
		/*eslint-enable*/
	}
})(this, function factory(root, $) {
	var module = {};

	module.YTdeferred;

	module.mute = function muteYTVideoMute(id) {
		$.when(module.playerLoad())
			.done(function muteYTVideoMuteDone(YT) {
				// disabling because I don't know what affect New has
				/*eslint-disable*/
				new YT.Player(id, {
					events: {
						'onReady': module.onPlayerReady
					}
				});
				/*eslint-enable*/
			});
	};

	module.onPlayerReady = function muteYTVideoOnPlayerReady(event) {
		event.target.mute();
	};

	module.playerLoad = function muteYTVideoPlayerLoad() {
		var tag;
		var firstScriptTag;

		if (typeof window.onYouTubeIframeAPIReady === 'undefined') {
			tag = document.createElement('script');
			tag.src = 'https://www.youtube.com/iframe_api';

			firstScriptTag = document.getElementsByTagName('script')[0];
			firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

			module.YTdeferred = $.Deferred();

			window.onYouTubeIframeAPIReady = function muteYTVideoOnYouTubeIframeAPIReady() {
				module.YTdeferred.resolve(window.YT);
			};
		}
		return module.YTdeferred.promise();
	};

	module.playerLoad();

	module.init = function muteYTVideoInit() {
		var muteVideoList = $('.muteYTVideo');

		$.each(muteVideoList, function muteYTVideoInitEach() {
			var currentVideoID = $(this).attr('id');
			module.mute(currentVideoID);
		});
	};

	$(document).ready(module.init);

	return module;
});


if(brightcove==undefined){var brightcove={};brightcove.getExperience=function(){alert("Please import APIModules_all.js in order to use the API.");};}
if(brightcove.experiences==undefined){brightcove.servicesURL='http://c.brightcove.com/services';brightcove.cdnURL='http://admin.brightcove.com';brightcove.secureCDNURL='https://sadmin.brightcove.com';brightcove.secureServicesURL='https://secure.brightcove.com/services';brightcove.USservicesURL='http://c.brightcove.com/services';brightcove.UScdnURL='http://admin.brightcove.com';brightcove.USsecureCDNURL='https://sadmin.brightcove.com';brightcove.USsecureServicesURL='https://secure.brightcove.com/services';brightcove.pubHost='c.$pubcode$.$zoneprefix$$zone$';brightcove.pubSecureHost='secure.$pubcode$.$zoneprefix$$zone$';brightcove.pubSubdomain='ariessaucetown.local';brightcove.experiences={};brightcove.experienceObjects={};brightcove.renderExperienceInProcess=false;brightcove.createExperiencesQueue=[];brightcove.renderExperienceQueue=[];brightcove.timeouts={};brightcove.flashTimeoutInterval=10000;brightcove.htmlTimeoutInterval=10000;brightcove.experienceNum=0;brightcove.majorVersion=9;brightcove.majorRevision=0;brightcove.minorRevision=28;brightcove.performCdnUrl={'development':'//players.brightcove.net/','qa':'//players.qa.brightcove.net/','staging':'//players.staging.brightcove.net/','production':'//players.brightcove.net/'};brightcove.servlet={AS3:"federated_f9",HTML:"htmlFederated"};brightcove.mappingFileData={};brightcove.publisherMappingBlacklist=['11111','1625296048001','1625296047001','2632443457001','3165349001','30427124001','2155857773001','2067658940001','1786718357','963482469001','22710213001','3620503976001'];brightcove.playerType={FLASH:"flash",HTML:"html",FLASH_IFRAME:"flashIFrame",INSTALLER:"installer",NO_SUPPORT:"nosupport"};brightcove.errorCodes={UNKNOWN:0,DOMAIN_RESTRICTED:1,GEO_RESTRICTED:2,INVALID_ID:3,NO_CONTENT:4,UNAVAILABLE_CONTENT:5,UPGRADE_REQUIRED_FOR_VIDEO:6,UPGRADE_REQUIRED_FOR_PLAYER:7,SERVICE_UNAVAILABLE:8};brightcove.defaultParam={};brightcove.defaultParam.width='100%';brightcove.defaultParam.height='100%';brightcove.defaultFlashParam={};brightcove.defaultFlashParam.allowScriptAccess='always';brightcove.defaultFlashParam.allowFullScreen='true';brightcove.defaultFlashParam.seamlessTabbing=false;brightcove.defaultFlashParam.swliveconnect=true;brightcove.defaultFlashParam.wmode='window';brightcove.defaultFlashParam.quality='high';brightcove.defaultFlashParam.bgcolor='#999999';brightcove.hasActiveX=brightcove.isIE=(window.ActiveXObject!=undefined);brightcove.userAgent=navigator.userAgent;brightcove._queuedAPICalls=[];var brightcoveJS=brightcove;brightcove.createExperiences=function(pEvent,pElementID){var experiences=[];var params;var experience;var flashSupport=brightcove.checkFlashSupport();var htmlSupport=brightcove.checkHtmlSupport();if(brightcove.renderExperienceInProcess){function createExperiencesWrapper(pEvent,pElementID){return function(){brightcove.createExperiences(pEvent,pElementID);}}
brightcove.createExperiencesQueue.push(createExperiencesWrapper(pEvent,pElementID));return;}
if(pElementID!=null){experiences.push(document.getElementById(pElementID));}else{experiences=brightcove.collectExperiences();}
if(brightcove.hasActiveX){params=document.getElementsByTagName('param');}
var urlParams=brightcove.cacheUrlParams();var numExperiences=experiences.length;for(var i=0;i<numExperiences;i++){experience=experiences[i];experience=brightcove.copyDefaultParams(experience);experience=brightcove.copySnippetParams(experience,params);experience=brightcove.copyUrlParams(experience,urlParams,numExperiences);var playerType=brightcove.determinePlayerType(experience,flashSupport,htmlSupport);var secureConnections=false;if(playerType==brightcove.playerType.HTML){secureConnections=experience.params.secureHTMLConnections=="true";}else{secureConnections=experience.params.secureConnections=="true";}
if(playerType==brightcove.playerType.HTML){delete experience.params.linkBaseURL;}else{if(experience.params.includeAPI&&experience.params.templateReadyHandler!=null){experience.params.originalTemplateReadyHandler=experience.params.templateReadyHandler;var handlerName="templateReadyHandler"+experience.id;brightcove[handlerName]=(function(id){return function(event){if(brightcove.internal!=null&&brightcove.internal._instances[id]!=null){brightcove._addModuleToEvent(id,event);}
var player=brightcove.experienceObjects[id];brightcove.callHandlerForPlayer(player,"originalTemplateReadyHandler",event);};})(experience.id);experience.params.templateReadyHandler='brightcove["'+handlerName+'"]';}}
var file=brightcove.generateRequestUrl(experience,playerType,secureConnections);if(document.location.protocol=="http:"){var event='http://goku.brightcove.com/1pix.gif?';var gokuParams=["dcsuri=/viewer/player_load_req","playerType="+playerType,"playerURL="+encodeURIComponent(document.location||"")];var image=brightcove.createElement('image');for(var j in experience.params){gokuParams.push([encodeURIComponent(j)+"="+encodeURIComponent(experience.params[j])]);}
event+=gokuParams.join('&');image.src=event;}
brightcove.renderExperience(experience,file,playerType,secureConnections);}};brightcove.collectExperiences=function(){var experiences=[];var allObjects=document.getElementsByTagName('object');var numObjects=allObjects.length;for(var i=0;i<numObjects;i++){if(/\bBrightcoveExperience\b/.test(allObjects[i].className)){if(allObjects[i].type!='application/x-shockwave-flash'){experiences.push(allObjects[i]);}}}
return experiences;};brightcove.cacheUrlParams=function(){var urlParams={};urlParams.playerKey=decodeURIComponent(brightcove.getParameter("bckey"));urlParams.playerID=brightcove.getParameter("bcpid");urlParams.titleID=brightcove.getParameter("bctid");urlParams.lineupID=brightcove.getParameter("bclid");urlParams.autoStart=brightcove.getParameter("autoStart");urlParams.debuggerID=brightcove.getParameter("debuggerID");urlParams.forceHTML=brightcove.getParameter("forceHTML");urlParams.forceFlashIFrame=brightcove.getParameter("forceFlashIFrame");urlParams.debug=brightcove.getParameter("debug");urlParams.showNoContentMessage=brightcove.getParameter("showNoContentMessage");urlParams.htmlDefaultBitrate=brightcove.getParameter("htmlDefaultBitrate");urlParams.linkSrc=brightcove.getParameter("linkSrc");urlParams.enableMapping=brightcove.getParameter("enableMapping");return urlParams;};brightcove.copyDefaultParams=function(experience){if(!experience.params)experience.params={};if(!experience.flashParams)experience.flashParams={};for(var i in brightcove.defaultParam){experience.params[i]=brightcove.defaultParam[i];}
for(var j in brightcove.defaultFlashParam){experience.flashParams[j]=brightcove.defaultFlashParam[j];}
if(experience.id.length>0){experience.params.flashID=experience.id;}else{experience.id=experience.params.flashID='bcExperienceObj'+(brightcove.experienceNum++);}
experience.params.identifierClassName='BrightcoveExperienceID_'+Math.floor(Math.random()*10000);return experience;};brightcove.copySnippetParams=function(experience,params){if(!brightcove.hasActiveX){params=experience.getElementsByTagName('param');}
var numParams=params.length;var param;for(var j=0;j<numParams;j++){param=params[j];if(brightcove.hasActiveX&&param.parentNode.id!=experience.id){continue;}
experience.params[param.name]=param.value;}
if(experience.params.bgcolor!=undefined)experience.flashParams.bgcolor=experience.params.bgcolor;if(experience.params.wmode!=undefined)experience.flashParams.wmode=experience.params.wmode;if(experience.params.seamlessTabbing!=undefined)experience.flashParams.seamlessTabbing=experience.params.seamlessTabbing;return experience;};brightcove.copyUrlParams=function(experience,urlParams){if(experience.params.autoStart==undefined&&urlParams.autoStart!=undefined){experience.params.autoStart=urlParams.autoStart;}
if(urlParams.debuggerID!=undefined){experience.params.debuggerID=urlParams.debuggerID;}
if(urlParams.forceHTML!=undefined&&urlParams.forceHTML!==''){experience.params.forceHTML=urlParams.forceHTML;}
if(urlParams.forceFlashIFrame!=undefined&&urlParams.forceFlashIFrame!==''){experience.params.forceFlashIFrame=urlParams.forceFlashIFrame;}
if(urlParams.enableMapping!=undefined&&urlParams.enableMapping!==''){experience.params.enableMapping=urlParams.enableMapping.toLowerCase()==='true';}
if(urlParams.debug!=undefined&&urlParams.debug!==''){experience.params.debug=urlParams.debug;}
if(urlParams.showNoContentMessage!=undefined&&urlParams.showNoContentMessage!=''){experience.params.showNoContentMessage=urlParams.showNoContentMessage;}
if(urlParams.htmlDefaultBitrate!=undefined&&urlParams.htmlDefaultBitrate!==''){experience.params.htmlDefaultBitrate=urlParams.htmlDefaultBitrate;}
if(urlParams.linkSrc!=undefined&&urlParams.linkSrc!=''){experience.params.linkSrc=urlParams.linkSrc;}
var overrideContent=(urlParams.playerID.length<1&&urlParams.playerKey.length<1)||(urlParams.playerID==experience.params.playerID)||(urlParams.playerKey==experience.params.playerKey);if(overrideContent){if(urlParams.titleID.length>0){experience.params.videoID=urlParams.titleID;experience.params["@videoPlayer"]=urlParams.titleID;experience.params.autoStart=(experience.params.autoStart!="false"&&urlParams.autoStart!="false");}
if(urlParams.lineupID.length>0){experience.params.lineupID=urlParams.lineupID;}}
return experience;};brightcove.determinePlayerType=function(experience,flashSupport,htmlSupport){if(flashSupport==null&&htmlSupport==false){return brightcove.playerType.NO_SUPPORT;}
if(experience.params.forceHTML){if(window.console){var message="The forceHTML parameter was used for the Brightcove player. This value should ONLY be used for";message+=" development and testing purposes and is not supported in production environments.";console.log(message);}
return brightcove.playerType.HTML;}
if(experience.params.forceFlashIFrame||(brightcove.isMetroIE()&&flashSupport==null)){return brightcove.playerType.FLASH_IFRAME;}
if(flashSupport!=null){if(brightcove.isFlashVersionSufficient(experience,flashSupport)){return brightcove.playerType.FLASH;}else{return brightcove.playerType.INSTALLER;}}
if(htmlSupport){if(brightcove.isSupportedHTMLDevice()||experience.params.htmlFallback){return brightcove.playerType.HTML;}}
return brightcove.playerType.NO_SUPPORT;};brightcove.isFlashVersionSufficient=function(experience,flashSupport){if(flashSupport==null)return false;var setMajorVersion=false;var requestedMajorVersion;var requestedMajorRevision;var requestedMinorRevision;if(experience.params.majorVersion!=undefined){requestedMajorVersion=parseInt(experience.params.majorVersion,10);setMajorVersion=true;}else{requestedMajorVersion=brightcove.majorVersion;}
if(experience.params.majorRevision!=undefined){requestedMajorRevision=parseInt(experience.params.majorRevision,10);}else{if(setMajorVersion){requestedMajorRevision=0;}else{requestedMajorRevision=brightcove.majorRevision;}}
if(experience.params.minorRevision!=undefined){requestedMinorRevision=parseInt(experience.params.minorRevision,10);}else{if(setMajorVersion){requestedMinorRevision=0;}else{requestedMinorRevision=brightcove.minorRevision;}}
return(flashSupport.majorVersion>requestedMajorVersion||(flashSupport.majorVersion==requestedMajorVersion&&flashSupport.majorRevision>requestedMajorRevision)||(flashSupport.majorVersion==requestedMajorVersion&&flashSupport.majorRevision==requestedMajorRevision&&flashSupport.minorRevision>=requestedMinorRevision));};brightcove.generateRequestUrl=function(experience,playerType,secureConnections){var file;if(playerType==brightcove.playerType.INSTALLER){file=brightcove.cdnURL+"/viewer/playerProductInstall.swf";var MMPlayerType=brightcove.hasActiveX?"ActiveX":"PlugIn";document.title=document.title.slice(0,47)+" - Flash Player Installation";var MMdoctitle=document.title;file+="?&MMredirectURL="+window.location+'&MMplayerType='+MMPlayerType+'&MMdoctitle='+MMdoctitle;brightcove.reportUpgradeRequired(experience);}else{if(secureConnections){file=brightcove.getPubURL(brightcove.secureServicesURL,brightcove.pubSecureHost,experience.params.pubCode);}else{file=brightcove.getPubURL(brightcove.servicesURL,brightcove.pubHost,experience.params.pubCode);}
var servlet=(playerType==brightcove.playerType.HTML)?brightcove.servlet.HTML:brightcove.servlet.AS3;file+='/viewer/'+servlet+'?'+brightcove.getOverrides();for(var config in experience.params){file+='&'+encodeURIComponent(config)+'='+encodeURIComponent(experience.params[config]);}}
return file;};brightcove.renderInstallGif=function(experience,secureConnections){var cdnURL=secureConnections?brightcove.secureCDNURL:brightcove.cdnURL;var upgradeFlashImage=cdnURL.indexOf('.co.jp')>0?"upgrade_flash_player_kk.gif":"upgrade_flash_player2.gif";var linkHTML="<a href='http://www.adobe.com/go/getflash/' target='_blank'><img src='"+cdnURL+"/viewer/"+upgradeFlashImage+"' alt='Get Flash Player' width='314' height='200' border='0'></a>";return linkHTML;};brightcove.renderExperience=function(experience,file,playerType,secureConnections){var experienceElement;var experienceID=experience.id;var isPubIdInBlacklist;var publisherID;var dummyElement;if(brightcove.renderExperienceInProcess){function wrapRenderExperience(experience,file,playerType,secureConnections){return function(){brightcove.renderExperience(experience,file,playerType,secureConnections);}}
brightcove.renderExperienceQueue.push(wrapRenderExperience(experience,file,playerType,secureConnections));return;}
brightcove.renderExperienceInProcess=true;if(!(experience.params.playerKey||experience.params.playerID||experience.params.playerId||experience.params.playerid)){if(window.console){console.log("No playerID or playerKey was found for the Brightcove player, so it can not be rendered.");}
return;}
brightcove.experienceObjects[experienceID]=experience;var unminified=(brightcove.getParameter("unminified")=="true")||(experience.params.unminified==="true");if(experience.params.includeAPI==="true"&&!(brightcove._apiRequested||brightcove.api)){var source="/js/api/";if(unminified){source+="unminified/";}
source+="SmartPlayerAPI.js";var apiInclude=brightcove.createElement('script');apiInclude.type="text/javascript";var cdnURL=secureConnections?brightcove.secureCDNURL:brightcove.cdnURL;apiInclude.src=cdnURL+source;experience.parentNode.appendChild(apiInclude);brightcove._apiRequested=true;}
file+="&startTime="+new Date().getTime();if(experience.params.playerKey){publisherID=brightcove.decodePublisherID(experience.params.playerKey);}else{publisherID=experience.params.publisherID;}
dummyElement=brightcove.createDummyElement(playerType,experience,secureConnections);if(Array.prototype.indexOf){isPubIdInBlacklist=brightcove.publisherMappingBlacklist.indexOf(String(publisherID))!==-1;}else{isPubIdInBlacklist=false;for(var i=0;i<brightcove.publisherMappingBlacklist.length;i++){if(brightcove.publisherMappingBlacklist[i]===String(publisherID)){isPubIdInBlacklist=true;}}}
if(experience.params.enableMapping===true||(experience.params.enableMapping!==false&&!isPubIdInBlacklist)){brightcove.makeMappingFileRequest(publisherID,function(err,data){if(err){if(window.console){console.log(err);}}
brightcove.generateExperienceElement(experience,publisherID,dummyElement,unminified,file,playerType,experienceID,secureConnections,data);});}else{brightcove.generateExperienceElement(experience,publisherID,dummyElement,unminified,file,playerType,experienceID,secureConnections,null);}};brightcove.generateExperienceElement=function(experience,publisherID,dummyElement,unminified,file,playerType,experienceID,secureConnections,data){var playerID;var bcPublisherID;var bcPlayerID;var bcEmbedID;var bcNewSmartPlayerID;var bcForceRefID;var parsedDataObject={};var bcIframe;var replaceElement;var container;var timeout=brightcove.flashTimeoutInterval;if(experience.params.enableMapping!==false&&data&&data.statusCode===200&&data.response&&data.response!==""){try{if(experience.params.playerKey){if(window.JSON){parsedDataObject=JSON.parse(data.response)[experience.params.playerKey];}else{parsedDataObject=brightcove.json_parse(data.response)[experience.params.playerKey];}}else{playerID=experience.params.playerId||experience.params.playerID||experience.params.playerid;if(window.JSON){parsedDataObject=JSON.parse(data.response);}else{parsedDataObject=brightcove.json_parse(data.response);}}}catch(ex){if(window.console){console.log('Error: Unable to parse mapping file: '+ex.message);}}
if(!experience.params.playerKey){for(var mappedPlayerKey in parsedDataObject){var playerMapItem;if(parsedDataObject.hasOwnProperty(mappedPlayerKey)){playerMapItem=parsedDataObject[mappedPlayerKey];if(playerMapItem.smart_player_id&&playerMapItem.smart_player_id===playerID){parsedDataObject=playerMapItem;break;}}}}
if(parsedDataObject&&(((!parsedDataObject.hasOwnProperty('enable_mapping')||parsedDataObject.enable_mapping)&&experience.params.enableMapping!==false)||((parsedDataObject.hasOwnProperty('enable_mapping')&&parsedDataObject.enable_mapping===false)&&experience.params.enableMapping===true))){bcPublisherID=parsedDataObject.account_id?parsedDataObject.account_id:publisherID;bcPlayerID=parsedDataObject.player_id;bcEmbedID=parsedDataObject.embed_id||'default';bcNewSmartPlayerID=parsedDataObject.new_smart_player_id;bcForceRefID=parsedDataObject.force_ref_id||false;}}
if(bcForceRefID){if(experience.params.videoID&&experience.params.videoID.indexOf('ref:')<0){experience.params.videoID='ref:'+experience.params.videoID;file=brightcove.generateRequestUrl(experience,playerType,secureConnections);}else if(experience.params['@videoPlayer']&&experience.params['@videoPlayer'].indexOf('ref:')<0){experience.params['@videoPlayer']='ref:'+experience.params['@videoPlayer'];file=brightcove.generateRequestUrl(experience,playerType,secureConnections);}}
if(bcNewSmartPlayerID){delete experience.params.playerKey;delete experience.params.playerId;delete experience.params.playerid;experience.params.playerID=bcNewSmartPlayerID;brightcove.servicesURL=brightcove.USservicesURL;brightcove.cdnURL=brightcove.UScdnURL;brightcove.secureCDNURL=brightcove.USsecureCDNURL;brightcove.secureServicesURL=brightcove.USsecureServicesURL;file=brightcove.generateRequestUrl(experience,playerType,secureConnections);}else if(bcPlayerID&&!bcPublisherID){bcPublisherID=publisherID;}
if(bcPublisherID&&bcPlayerID){bcIframe=brightcove.getBCPlayerIframe(experience,bcPublisherID,bcPlayerID,bcEmbedID);experienceElement=brightcove.createIFrame(experience);brightcove.copyNodeProperties(dummyElement,experienceElement);replaceElement=brightcove.getElementByClassNameCrossBrowser(experience.params.identifierClassName);if(replaceElement&&replaceElement.parentNode){replaceElement.parentNode.replaceChild(experienceElement,replaceElement);}
brightcove.experiences[experienceID]=experienceElement;experienceElement.src=bcIframe;}else if(playerType===brightcove.playerType.NO_SUPPORT){replaceElement=brightcove.getElementByClassNameCrossBrowser(experience.params.identifierClassName);if(replaceElement&&replaceElement.parentNode){replaceElement.parentNode.innerHTML=brightcove.renderInstallGif(experience,secureConnections);}
brightcove.reportUpgradeRequired(experience);}else if(playerType===brightcove.playerType.HTML){timeout=brightcove.htmlTimeoutInterval;file+="&refURL="+(window.document.referrer?window.document.referrer:'not available');if(unminified){file+="&unminified=true";}
experienceElement=brightcove.copyNode(dummyElement);replaceElement=brightcove.getElementByClassNameCrossBrowser(experience.params.identifierClassName);if(replaceElement&&replaceElement.parentNode){replaceElement.parentNode.replaceChild(experienceElement,replaceElement);}
brightcove.experiences[experienceID]=experienceElement;experience.element=experienceElement;if(experience.params.videoID||experience.params.videoId){file+="&"+encodeURIComponent("@videoPlayer")+"="+encodeURIComponent(experience.params.videoID||experience.params.videoId);}
experienceElement.src=file;}else if(playerType===brightcove.playerType.FLASH_IFRAME){var currentCDN=secureConnections?brightcove.secureCDNURL:brightcove.cdnURL;var iframeURL=currentCDN+"/js/flash_iframe.html?parentPage="+window.location.toString().split("?")[0];iframeURL+='&currentCDN='+currentCDN;if(unminified){iframeURL+='&unminified='+unminified;}
experienceElement=brightcove.copyNode(dummyElement);replaceElement=brightcove.getElementByClassNameCrossBrowser(experience.params.identifierClassName);if(replaceElement&&replaceElement.parentNode){replaceElement.parentNode.replaceChild(experienceElement,replaceElement);}
brightcove.experiences[experienceID]=experienceElement;experience.element=experienceElement;experienceElement.src=iframeURL;window.addEventListener('message',function(event){if(event.origin.split("/")[2]!==currentCDN.split("/")[2])return;var data=JSON.parse(event.data);if(data!="bcIframeInitialized"){return;}
var playerConfig;if(brightcove.hasActiveX){experience.flashParams.movie=file;var flashEmbedStr=brightcove.getFlashEmbedString(experience,secureConnections);playerConfig={activeX:flashEmbedStr,height:experience.params.height,id:'_container'+experience.id,file:file};}else{playerConfig=brightcove.getFlashObjectParams(experience,file);}
var playerConfigStr=JSON.stringify(playerConfig);experienceElement.contentWindow.postMessage(playerConfigStr,currentCDN);},false);window.addEventListener('message',function(event){if(event.origin.split("/")[2]!==currentCDN.split("/")[2])return;var data=JSON.parse(event.data);if(data.api&&brightcove.internal&&brightcove.internal._setAPICallback){if(data.api=="apiCallback"){brightcove.internal._setAPICallback(data.pid,data.callback,iframeURL);}else if(data.api=="loadEvent"){window[data.callback](data.event);}else if(data.api=="onTemplateReadyEvent"){brightcove[data.callback](data.event);}}},false);}else{if(brightcove.hasActiveX){experience.flashParams.movie=file;var flashEmbedStr=brightcove.getFlashEmbedString(experience,secureConnections);var containerID='_container'+experience.id;container=document.getElementById(containerID);replaceElement=brightcove.getElementByClassNameCrossBrowser(experience.params.identifierClassName);if(replaceElement&&replaceElement.parentNode){replaceElement.parentNode.innerHTML=flashEmbedStr;}
brightcove.experiences[experienceID]=container;}else{experienceElement=brightcove.copyNode(dummyElement);experienceElement.data=file;replaceElement=brightcove.getElementByClassNameCrossBrowser(experience.params.identifierClassName);if(replaceElement&&replaceElement.parentNode){replaceElement.parentNode.replaceChild(experienceElement,replaceElement);}
brightcove.experiences[experienceID]=experienceElement;}}
brightcove.renderExperienceInProcess=false;if(brightcove.renderExperienceQueue.length>0){brightcove.renderExperienceQueue.shift()();}else if(brightcove.createExperiencesQueue.length>0){brightcove.createExperiencesQueue.shift()();}
brightcove.timeouts[experience.id]=setTimeout(function(){brightcove.handleExperienceTimeout(experienceID);},timeout);};brightcove.copyNode=function(elementFrom){var experienceElement=elementFrom.cloneNode(true);brightcove.copyNodeProperties(elementFrom,experienceElement);return experienceElement;};brightcove.copyNodeProperties=function(elementFrom,elementTo){var propertyItem;var propertyList=['name','title','height','width','border','onclick','ondblclick','ondrag','ondragend','ondragenter','ondragleave','ondragover','ondragstart','ondrop','onmousedown','onmousemove','onmouseout','onmouseover','onmouseup','onmousewheel','onscroll','onwheel'];for(propertyItem in propertyList){if(elementFrom[propertyList[propertyItem]]){elementTo[propertyList[propertyItem]]=elementFrom[propertyList[propertyItem]];}}
if(elementTo.className!==elementFrom.className){elementTo.className+=' '+elementFrom.className;}};brightcove.getElementsByClassName=function(selector){var retnode=[];var elem=document.getElementsByTagName('*');for(var i=0;i<elem.length;i++){if((' '+elem[i].className+' ').indexOf(' '+selector+' ')>-1)retnode.push(elem[i]);}
return retnode;};brightcove.getElementByClassNameCrossBrowser=function(selector){var searchElement;if(document.querySelectorAll){searchElement=document.querySelectorAll('.'+selector)[0];}else{searchElement=brightcove.getElementsByClassName(selector)[0];}
return searchElement;};brightcove.createDummyElement=function(playerType,experience,secureConnections){var dummyElement;var containerID;var flashObjectParams;var flashEmbedStr;experience.className+=' '+experience.params.identifierClassName;if(playerType===brightcove.playerType.NO_SUPPORT){containerID='_container'+experience.id;dummyElement=brightcove.createElement('span');if(experience.params.height.charAt(experience.params.height.length-1)=="%"){dummyElement.style.display='block';}else{dummyElement.style.display='inline-block';}
dummyElement.className=experience.className;dummyElement.id=containerID;}else if(playerType===brightcove.playerType.HTML||playerType===brightcove.playerType.FLASH_IFRAME){dummyElement=brightcove.createIFrame(experience);if(experience&&experience.parentNode){experience.parentNode.replaceChild(dummyElement,experience);}}else{if(brightcove.hasActiveX){flashEmbedStr=brightcove.getDummyFlashEmbedString(experience);containerID='_container'+experience.id;dummyElement=brightcove.createFlashEmbed(containerID,experience.params.height);if(experience&&experience.parentNode){experience.parentNode.replaceChild(dummyElement,experience);dummyElement.innerHTML=flashEmbedStr;}}else{flashObjectParams=brightcove.getFlashObjectParams(experience);dummyElement=brightcove.createFlashObject(flashObjectParams);if(experience&&experience.parentNode){experience.parentNode.replaceChild(dummyElement,experience);}}}
return dummyElement;};brightcove.getDummyFlashEmbedString=function(experience){return'<object'
+' id="'+experience.id+'"'
+' width="'+experience.params.width+'"'
+' height="'+experience.params.height+'"'
+' class="BrightcoveExperience '+experience.params.identifierClassName+'" >'
+'</object>';};brightcove.createIFrame=function(experience){var iframeElement=brightcove.createElement('iframe');iframeElement.id=experience.id;iframeElement.width=experience.params.width;iframeElement.height=experience.params.height;iframeElement.className=experience.className;iframeElement.frameborder=0;iframeElement.scrolling="no";iframeElement.style.borderStyle="none";return iframeElement;};brightcove.getFlashEmbedString=function(experience,secureConnections){var options='';var flashParams=experience.flashParams;for(var pOption in flashParams){options+='<param name="'+pOption+'" value="'+experience.flashParams[pOption]+'" />';}
var protocol=secureConnections?"https":"http";return'<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'
+' codebase="'+protocol+'://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version='+brightcove.majorVersion+','+brightcove.majorRevision+','+brightcove.minorRevision+',0"'
+' id="'+experience.id+'"'
+' width="'+experience.params.width+'"'
+' height="'+experience.params.height+'"'
+' type="application/x-shockwave-flash"'
+' class="BrightcoveExperience '+experience.params.identifierClassName+'">'
+options
+'</object>';};brightcove.getFlashObjectParams=function(experience,file){var experienceObject={};experienceObject.type='application/x-shockwave-flash';experienceObject.data=file;experienceObject.id=experience.params.flashID;experienceObject.width=experience.params.width;experienceObject.height=experience.params.height;experienceObject.className=experience.className;experienceObject.seamlesstabbing=experience.flashParams.seamlessTabbing;for(var config in experience.flashParams){experienceObject["flashParam_"+config]=experience.flashParams[config];}
return experienceObject;};brightcove.createFlashEmbed=function(experienceId,height){var container=brightcove.createElement('span');if(height.charAt(height.length-1)=="%"){container.style.display='block';}else{container.style.display='inline-block';}
container.id=experienceId;return container;};brightcove.createFlashObject=function(playerConfig){var experienceElement=brightcove.createElement('object');experienceElement.type=playerConfig.type;if(playerConfig.data){experienceElement.data=playerConfig.data;}
experienceElement.id=playerConfig.id;experienceElement.width=playerConfig.width;experienceElement.height=playerConfig.height;experienceElement.className=playerConfig.className;experienceElement.setAttribute("seamlesstabbing",playerConfig.seamlessTabbing);var tempParam;var flashParamPrefix="flashParam_";for(var config in playerConfig){var flashParamInd=config.indexOf(flashParamPrefix);if(flashParamInd==0){tempParam=brightcove.createElement('param');tempParam.name=config.substring(flashParamPrefix.length);tempParam.value=playerConfig[config];experienceElement.appendChild(tempParam);}}
return experienceElement;};brightcove.handleExperienceTimeout=function(pID){brightcove.executeErrorHandlerForExperience(brightcove.experienceObjects[pID],{type:"templateError",errorType:"serviceUnavailable",code:brightcove.errorCodes.SERVICE_UNAVAILABLE,info:pID});};brightcove.reportPlayerLoad=function(pID){var timeout=brightcove.timeouts[pID];if(timeout){clearTimeout(timeout);}};brightcove.reportUpgradeRequired=function(pExperience){brightcove.executeErrorHandlerForExperience(pExperience,{type:"templateError",errorType:"upgradeRequiredForPlayer",code:brightcove.errorCodes.UPGRADE_REQUIRED_FOR_PLAYER,info:pExperience.id});};brightcove.checkFlashSupport=function(){var hasActiveX=(window.ActiveXObject!=undefined);return(hasActiveX)?brightcove.checkFlashSupportIE():brightcove.checkFlashSupportStandard();};brightcove.checkFlashSupportIE=function(){var versions;try{var flash=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");var version=flash.GetVariable('$version');versions=/ ([0-9]+),([0-9]+),([0-9]+),/.exec(version);}catch(exception){return null;}
return{majorVersion:versions[1],majorRevision:versions[2],minorRevision:versions[3]};};brightcove.isMetroIE=function(){var version=0;if(navigator.appVersion.indexOf("MSIE")!=-1){var appSplit=navigator.appVersion.split("MSIE");if(appSplit.length>1){version=parseFloat(appSplit[1]);}}
if(version<10||isNaN(version)){return false;}
var activeXSupport=false;try{activeXSupport=!!new ActiveXObject("htmlfile");}catch(e){activeXSupport=false;}
return!activeXSupport;};brightcove.checkFlashSupportStandard=function(){var versions;var majorVersion;var majorRevision;var minorRevision;try{if(typeof navigator.plugins!='undefined'&&navigator.plugins.length>0){if(navigator.plugins["Shockwave Flash 2.0"]||navigator.plugins["Shockwave Flash"]){var swfVersion=navigator.plugins["Shockwave Flash 2.0"]?" 2.0":"";var description=navigator.plugins["Shockwave Flash"+swfVersion].description;var filename=navigator.plugins["Shockwave Flash"+swfVersion].filename;if(filename.match){if(filename.toLowerCase().match(/lite/)){throw new Error();}}
versions=description.split(" ");majorVersion=versions[2].split(".")[0];majorRevision=versions[2].split(".")[1];minorRevision=versions[3];if(minorRevision==""){minorRevision=versions[4];}
if(minorRevision[0]=="d"){minorRevision=minorRevision.substring(1);}else if(minorRevision[0]=="r"){minorRevision=minorRevision.substring(1);if(minorRevision.indexOf("d")>0){minorRevision=minorRevision.substring(0,minorRevision.indexOf("d"));}}}else{throw new Error();}}else{return null;}}catch(exception){return null;}
return{majorVersion:majorVersion,majorRevision:majorRevision,minorRevision:minorRevision};};brightcove.checkHtmlSupport=function(){var v=brightcove.createElement('video');var videoSupport=true;if(!brightcove.userAgent.match(new RegExp("android","i"))){videoSupport=!!(v.canPlayType&&v.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"').replace(/no/,''));}
if(brightcove.userAgent.match(/BlackBerry.*Version\/6\.0/)){return false;}
var canvasSupport=!!brightcove.createElement('canvas').getContext;return videoSupport&&canvasSupport;};brightcove.isSupportedHTMLDevice=function(pUAString){var types=["iPad","iPhone","iPod","android","Silk","IEMobile"];var numTypes=types.length;var uaString=pUAString||brightcove.userAgent;for(var i=0;i<numTypes;i++){if(uaString.match(new RegExp(types[i],"i"))){return true;}}
return false;};brightcove.getTechnology=function(pExperienceId){for(var id in brightcove.experiences){if(pExperienceId==id){return(brightcove.experiences[id].tagName=="object")?brightcove.playerType.FLASH:brightcove.playerType.HTML;}}
return brightcove.playerType.NO_SUPPORT;};brightcove.respondToMessages=function(pMessage){if(brightcove.verifyMessage(pMessage)){var messageData=pMessage.data;if(messageData.charAt(0)=="\""){if(window.JSON){messageData=window.JSON.parse(messageData);}else{messageData=brightcove.json_parse(messageData);}}
var messageParts=messageData.split("::");var type=messageParts[1];var messageInfo="";for(var index=2;index<messageParts.length;index++){messageInfo+=messageParts[index];}
var messageJson=messageInfo.split("\n").join(" ");var messageDataObject;if(window.JSON){messageDataObject=window.JSON.parse(messageJson);}else{messageDataObject=brightcove.json_parse(messageJson);}
switch(type){case"error":brightcove.executeMessageCallback(messageDataObject,brightcove.executeErrorHandlerForExperience);break;case"api":brightcove.handleAPICallForHTML(messageDataObject);break;case"handler":var event=brightcove.internal._convertDates(messageDataObject.event);try{brightcove.internal._handlers[messageDataObject.handler](event);}catch(e){}
break;case"asyncGetter":var data=brightcove.internal._convertDates(messageDataObject.data);brightcove.internal._handlers[messageDataObject.handler](data);break;}}};brightcove.verifyMessage=function(pMessage){return(/^brightcove\.player/).test(pMessage.data);};brightcove.handleAPICallForHTML=function(pMessageObject){var experience=brightcove.experienceObjects[pMessageObject.id];if(experience==null){return;}
var id=experience.id;var method=pMessageObject.method;switch(method){case"initializeBridge":brightcove.reportPlayerLoad(id);if(pMessageObject.arguments[0]){if(brightcove.internal!=null){brightcove.internal._setAPICallback(id,null,pMessageObject.arguments[1]);brightcove.callHandlerForPlayer(experience,"templateLoadHandler",id);}else if(brightcove._apiRequested){brightcove._queuedAPICalls.push(pMessageObject);}}
break;case"callTemplateReady":if(brightcove._apiRequested&&!brightcove.internal){brightcove._queuedAPICalls.push(pMessageObject);}else{var event=pMessageObject.arguments;brightcove._addModuleToEvent(id,event);brightcove.callHandlerForPlayer(experience,"templateReadyHandler",event);}
break;}};brightcove._addModuleToEvent=function(pID,pEvent){if(pEvent.type!=null&&brightcove.api){var experience=brightcove.api.getExperience(pID);if(experience){pEvent.target=experience.getModule("experience");}}};brightcove.callHandlerForPlayer=function(pExperience,pHandler,pArgument){if(pExperience&&pExperience.params&&pExperience.params[pHandler]){var namespaceArray=pExperience.params[pHandler].split(".");var namespaces;if((namespaces=namespaceArray.length)>1){var trace=window;for(var i=0;i<namespaces;i++){trace=trace[namespaceArray[i]];}
if(typeof trace==="function"){trace(pArgument);}}else{window[pExperience.params[pHandler]](pArgument);}}};brightcove.executeErrorHandlerForExperience=function(pExperience,pErrorObject){brightcove.callHandlerForPlayer(pExperience,"templateErrorHandler",pErrorObject);};brightcove.executeMessageCallback=function(pMessageDataObject,pCallback){var experience;for(var experienceKey in brightcove.experienceObjects){experience=brightcove.experienceObjects[experienceKey];if(experience.element.src===pMessageDataObject.__srcUrl){delete pMessageDataObject.__srcUrl;pCallback(experience,pMessageDataObject);break;}}};brightcove.createExperience=function(pElement,pParentOrSibling,pAppend){if(!pElement.id||pElement.id.length<1){pElement.id='bcExperienceObj'+(brightcove.experienceNum++);}
if(pAppend){pParentOrSibling.appendChild(pElement);}else{pParentOrSibling.parentNode.insertBefore(pElement,pParentOrSibling);}
brightcove.createExperiences(null,pElement.id);};brightcove.removeExperience=function(pID){if(brightcove.experiences[pID]!=null){brightcove.experiences[pID].parentNode.removeChild(brightcove.experiences[pID]);}};brightcove.getURL=function(){var url;if(typeof window.location.search!='undefined'){url=window.location.search;}else{url=/(\?.*)$/.exec(document.location.href);}
return url;};brightcove.getOverrides=function(){var url=brightcove.getURL();var query=new RegExp('@[\\w\\.]+=[^&]+','g');var value=query.exec(url);var overrides="";while(value!=null){overrides+="&"+value;value=query.exec(url);}
return overrides;};brightcove.getParameter=function(pName,pDefaultValue){if(pDefaultValue==null)pDefaultValue="";var url=brightcove.getURL();var query=new RegExp(pName+'=([^&]*)');var value=query.exec(url);if(value!=null){return value[1];}else{return pDefaultValue;}};brightcove.createElement=function(el){if(document.createElementNS){return document.createElementNS('http://www.w3.org/1999/xhtml',el);}else{return document.createElement(el);}};brightcove.i18n={'BROWSER_TOO_OLD':'The browser you are using is too old. Please upgrade to the latest version of your browser.'};brightcove.removeListeners=function(){if(/KHTML/i.test(navigator.userAgent)){clearInterval(checkLoad);document.removeEventListener('load',brightcove.createExperiences,false);}
if(typeof document.addEventListener!='undefined'){document.removeEventListener('DOMContentLoaded',brightcove.createExperiences,false);document.removeEventListener('load',brightcove.createExperiences,false);}else if(typeof window.attachEvent!='undefined'){window.detachEvent('onload',brightcove.createExperiences);}};brightcove.getPubURL=function(source,host,pubCode){if(!pubCode||pubCode=="")return source;var re=/^([htps]{4,5}\:\/\/)([^\/\:]+)/i;host=host.replace("$pubcode$",pubCode).replace("$zoneprefix$$zone$",brightcove.pubSubdomain);return source.replace(re,"$1"+host);};brightcove.createExperiencesPostLoad=function(){brightcove.removeListeners();brightcove.createExperiences();};brightcove.encode=function(string){string=escape(string);string=string.replace(/\+/g,"%2B");string=string.replace(/\-/g,"%2D");string=string.replace(/\*/g,"%2A");string=string.replace(/\//g,"%2F");string=string.replace(/\./g,"%2E");string=string.replace(/_/g,"%5F");string=string.replace(/@/g,"%40");return string;};brightcove.decodePublisherID=function(playerKey){var b64;var bytes=[];var keys=[];var byteArrayToLong=function(byteArray,length){var value=0;for(var i=0;i<length;i++){value=(value*256)+byteArray[i];}
return value;};if(!playerKey||playerKey.indexOf(',')<0){if(window.console){console.log('The player key is in an unexpected format.Unable to extract publisher ID for potential use with player migration.');}
return;}
playerKey=playerKey.replace(/\./g,"~");keys=playerKey.split(',');try{b64=brightcove.base64().toByteArray(keys[1]);}catch(ex){if(window.console){console.log('The player key is in an unexpected format.Unable to extract publisher ID for potential use with player migration: '+ex.message);}
return;}
return byteArrayToLong(b64,8);};brightcove.makeMappingFileRequest=function(publisherID,callback){if(!publisherID){return callback();}else if(brightcove.mappingFileData.hasOwnProperty(publisherID)){return callback(null,brightcove.mappingFileData[publisherID]);}else{return brightcove.makeAjaxRequest('GET',brightcove.performCdnUrl['production']+publisherID+'/migration/mappings.json',function(err,data){if(window.console&&data&&data.statusCode===404){console.log('It is safe to ignore 404 messages for mappings.json file requests.');}
brightcove.mappingFileData[publisherID]=data;return callback(err,data);});}}
brightcove.makeAjaxRequest=function(action,url,callback){function createXmlHTTPObject(){var XMLHttpFactories=[function(){return new XDomainRequest()},function(){return new XMLHttpRequest()},function(){return new ActiveXObject('Msxml2.XMLHTTP')},function(){return new ActiveXObject('Msxml3.XMLHTTP')},function(){return new ActiveXObject('Microsoft.XMLHTTP')}];var xmlhttp=false;for(var i=0;i<XMLHttpFactories.length;i++){try{xmlhttp=XMLHttpFactories[i]();}
catch(e){continue;}
break;}
return xmlhttp;}
var xhttp=createXmlHTTPObject();if(!xhttp){return callback();}
try{xhttp.open(action,url,true);if(!window.XDomainRequest){xhttp.onreadystatechange=function(){if(xhttp.readyState==4){return callback(null,{statusCode:xhttp.status,response:xhttp.responseText});}};}else{xhttp.onload=function(){return callback(null,{statusCode:200,response:xhttp.responseText});};xhttp.ontimeout=function(){return callback(null,null);}
xhttp.onprogress=function(){};xhttp.onerror=function(){return callback(null,null);};}
xhttp.send();}catch(e){callback(null,null);}};brightcove.base64=function(){var lookup='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'
var Arr=(typeof Uint8Array!=='undefined')?Uint8Array:Array
var PLUS='+'.charCodeAt(0)
var SLASH='/'.charCodeAt(0)
var NUMBER='0'.charCodeAt(0)
var LOWER='a'.charCodeAt(0)
var UPPER='A'.charCodeAt(0)
var PLUS_URL_SAFE='-'.charCodeAt(0)
var SLASH_URL_SAFE='_'.charCodeAt(0)
function decode(elt){var code=elt.charCodeAt(0)
if(code===PLUS||code===PLUS_URL_SAFE)return 62
if(code===SLASH||code===SLASH_URL_SAFE)return 63
if(code<NUMBER)return-1
if(code<NUMBER+10)return code-NUMBER+26+26
if(code<UPPER+26)return code-UPPER
if(code<LOWER+26)return code-LOWER+26}
function b64ToByteArray(b64){var i,j,l,tmp,placeHolders,arr
if(b64.length%4>0){throw new Error('Invalid string. Length must be a multiple of 4')}
var len=b64.length
placeHolders=b64.charAt(len-2)==='='?2:b64.charAt(len-1)==='='?1:0
arr=new Arr(b64.length*3/4-placeHolders)
l=placeHolders>0?b64.length-4:b64.length
var L=0
function push(v){arr[L++]=v}
for(i=0,j=0;i<l;i+=4,j+=3){tmp=(decode(b64.charAt(i))<<18)|(decode(b64.charAt(i+1))<<12)|(decode(b64.charAt(i+2))<<6)|decode(b64.charAt(i+3))
push((tmp&0xFF0000)>>16)
push((tmp&0xFF00)>>8)
push(tmp&0xFF)}
if(placeHolders===2){tmp=(decode(b64.charAt(i))<<2)|(decode(b64.charAt(i+1))>>4)
push(tmp&0xFF)}else if(placeHolders===1){tmp=(decode(b64.charAt(i))<<10)|(decode(b64.charAt(i+1))<<4)|(decode(b64.charAt(i+2))>>2)
push((tmp>>8)&0xFF)
push(tmp&0xFF)}
return arr}
return{toByteArray:b64ToByteArray}};brightcove.getBCPlayerIframe=function(experience,accountID,playerID,embedID){var iframeSource=brightcove.performCdnUrl['production']+accountID+'/'+playerID+'_'+embedID+'/index.html?';var videoID=experience.params['@videoPlayer']||experience.params.videoID;if(videoID&&(!isNaN(videoID)||videoID.indexOf('ref:')>=0)){iframeSource+='videoId='+videoID+'&';}else if(videoID){iframeSource+='videoId=ref:'+videoID+'&';}
if(experience.params.language&&experience.params.language==='jp'){iframeSource+='language=ja&';}else if(experience.params.language){iframeSource+='language='+experience.params.language+'&';}
if(experience.params.autoStart&&experience.params.autoStart!='false'){iframeSource+='autoplay='+experience.params.autoStart+'&';}
return iframeSource;};if(/KHTML/i.test(navigator.userAgent)){var checkLoad=setInterval(function(){if(/loaded|complete/.test(document.readyState)){clearInterval(checkLoad);brightcove.createExperiencesPostLoad();}},70);document.addEventListener('load',brightcove.createExperiencesPostLoad,false);}
if(typeof document.addEventListener!='undefined'){document.addEventListener('DOMContentLoaded',brightcove.createExperiencesPostLoad,false);document.addEventListener('load',brightcove.createExperiencesPostLoad,false);window.addEventListener("message",brightcove.respondToMessages,false);}else if(typeof window.attachEvent!='undefined'){window.attachEvent('onload',brightcove.createExperiencesPostLoad);}else{alert(brightcove.i18n.BROWSER_TOO_OLD);}}
brightcove.json_parse=(function(){"use strict";var state,stack,container,key,value,escapes={'\\':'\\','"':'"','/':'/','t':'\t','n':'\n','r':'\r','f':'\f','b':'\b'},string={go:function(){state='ok';},firstokey:function(){key=value;state='colon';},okey:function(){key=value;state='colon';},ovalue:function(){state='ocomma';},firstavalue:function(){state='acomma';},avalue:function(){state='acomma';}},number={go:function(){state='ok';},ovalue:function(){state='ocomma';},firstavalue:function(){state='acomma';},avalue:function(){state='acomma';}},action={'{':{go:function(){stack.push({state:'ok'});container={};state='firstokey';},ovalue:function(){stack.push({container:container,state:'ocomma',key:key});container={};state='firstokey';},firstavalue:function(){stack.push({container:container,state:'acomma'});container={};state='firstokey';},avalue:function(){stack.push({container:container,state:'acomma'});container={};state='firstokey';}},'}':{firstokey:function(){var pop=stack.pop();value=container;container=pop.container;key=pop.key;state=pop.state;},ocomma:function(){var pop=stack.pop();container[key]=value;value=container;container=pop.container;key=pop.key;state=pop.state;}},'[':{go:function(){stack.push({state:'ok'});container=[];state='firstavalue';},ovalue:function(){stack.push({container:container,state:'ocomma',key:key});container=[];state='firstavalue';},firstavalue:function(){stack.push({container:container,state:'acomma'});container=[];state='firstavalue';},avalue:function(){stack.push({container:container,state:'acomma'});container=[];state='firstavalue';}},']':{firstavalue:function(){var pop=stack.pop();value=container;container=pop.container;key=pop.key;state=pop.state;},acomma:function(){var pop=stack.pop();container.push(value);value=container;container=pop.container;key=pop.key;state=pop.state;}},':':{colon:function(){if(Object.hasOwnProperty.call(container,key)){throw new SyntaxError('Duplicate key "'+key+'"');}
state='ovalue';}},',':{ocomma:function(){container[key]=value;state='okey';},acomma:function(){container.push(value);state='avalue';}},'true':{go:function(){value=true;state='ok';},ovalue:function(){value=true;state='ocomma';},firstavalue:function(){value=true;state='acomma';},avalue:function(){value=true;state='acomma';}},'false':{go:function(){value=false;state='ok';},ovalue:function(){value=false;state='ocomma';},firstavalue:function(){value=false;state='acomma';},avalue:function(){value=false;state='acomma';}},'null':{go:function(){value=null;state='ok';},ovalue:function(){value=null;state='ocomma';},firstavalue:function(){value=null;state='acomma';},avalue:function(){value=null;state='acomma';}}};function debackslashify(text){return text.replace(/\\(?:u(.{4})|([^u]))/g,function(a,b,c){return b?String.fromCharCode(parseInt(b,16)):escapes[c];});}
return function(source,reviver){var r,tx=/^[\x20\t\n\r]*(?:([,:\[\]{}]|true|false|null)|(-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)|"((?:[^\r\n\t\\\"]|\\(?:["\\\/trnfb]|u[0-9a-fA-F]{4}))*)")/;state='go';stack=[];try{for(;;){r=tx.exec(source);if(!r){break;}
if(r[1]){action[r[1]][state]();}else if(r[2]){value=+r[2];number[state]();}else{value=debackslashify(r[3]);string[state]();}
source=source.slice(r[0].length);}}catch(e){state=e;}
if(state!=='ok'||(/[^\x20\t\n\r]/).test(source)){throw state instanceof SyntaxError?state:new SyntaxError('JSON');}
return typeof reviver==='function'?(function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==='object'){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v;}else{delete value[k];}}}}
return reviver.call(holder,key,value);}({'':value},'')):value;};}());var APIModules={};APIModules.EXPERIENCE="experience";APIModules.CONTENT="content";APIModules.VIDEO_PLAYER="videoPlayer";APIModules.SOCIAL="social";APIModules.SEARCH="search";APIModules.CUE_POINTS="cuePoints";APIModules.ADVERTISING="advertising";APIModules.MENU="menu";APIModules.EFFECTS="effects";APIModules.CONVIVA="conviva";APIModules.CAPTIONS="captions";APIModules.AUTH="auth";APIModules.HTML5="_html5";if(brightcove==undefined){var brightcove={playerType:{FLASH:"flash",HTML:"html",INSTALLER:"installer",NO_SUPPORT:"nosupport"}};}
brightcove.instances={};brightcove.modules={};brightcove.ID_DELIM="|||";var bcPlayer=brightcove;brightcove.getExperience=function(pExperience){if(this.instances[pExperience]==null){if(window.console){console.log("Experience '"+pExperience+"' not found. Please ensure the name is correct and the API for the player is enabled.");}}
return this.instances[pExperience];};brightcove.getPlayer=brightcove.getExperience;brightcove.stringify=function(pObject){var type=typeof pObject;if(type=="function"||pObject==undefined){return"\"\"";}else if(type=="string"){return"\""+pObject.replace(/"/g,"\\\"")+"\"";}else if(pObject instanceof Array){var json="[";for(var i in pObject){if(typeof pObject[i]=="function"){json+=("\"\",");}else{json+=(this.stringify(pObject[i])+",");}}
if(json.substr(-1)==","){json=json.substr(0,json.length-1);}
return json+"]";}else if(type=="object"){var json="{";var i;var props=pObject.enumerableProperties;if(props){for(i in props){json+=("\""+props[i]+"\":"+this.stringify(pObject[props[i]])+",");}}else{for(i in pObject){if(typeof pObject[i]!="function"&&i!="__proto__"){json+=("\""+i+"\":"+this.stringify(pObject[i])+",");}}}
if(json.substr(-1)==","){json=json.substr(0,json.length-1);}
return json+"}";}else{return pObject;}}
function setAPICallback(pID,pCallback,pURL){brightcove.instances[pID]=new BrightcoveExperience(pCallback,pID,pURL);}
function BrightcoveExperience(pCallback,pID,pURL){if(pCallback==null){this.type=brightcove.playerType.HTML;this.playerURL=pURL;this.callback=brightcove.experiences[pID].contentWindow;}else{this.type=brightcove.playerType.FLASH;this.callback=pCallback;}
this.modules={};}
BrightcoveExperience.prototype.getModule=function(pModule){if(this.type==brightcove.playerType.HTML){pModule+=APIModules.HTML5;}
if(this.modules[pModule]==null&&brightcove.modules[pModule]){var module=new brightcove.modules[pModule](this);module.playerURL=this.playerURL;if(module.isPlayerDefined!=null){if(!module.isPlayerDefined()){return null;}}
this.modules[pModule]=module;}
return this.modules[pModule];};function APIModule(){this.handlers=[];}
APIModule.handlerCount=0;APIModule.getHandler=function(){return"bc_handler"+(APIModule.handlerCount++);};APIModule.callFlash=function(pCallback,pParams){var pCallbackArray=pCallback.split(brightcove.ID_DELIM);if(pCallbackArray.length<2)return;if(pCallbackArray[0].length<1)return;var pFlashId=pCallbackArray[0];var pCallback=pCallbackArray[1];var pExperience=document.getElementById(pFlashId);if(pExperience[pCallback]!=null){return pExperience[pCallback](BCXML.convertToXML(pParams,"js2flash"));}};APIModule.prototype.name="APIModule";APIModule.prototype.addEventListener=function(pEvent,pHandler,pPriority){var pNewHandler=APIModule.getHandler();this.handlers.push({handler:pHandler,bcHandler:pNewHandler,event:pEvent});window[pNewHandler]=pHandler;return this.callMethod("addEventListener",[pEvent,pNewHandler,pPriority]);};APIModule.prototype.removeEventListener=function(pEvent,pHandler){var pNum=this.handlers.length;for(var i=0;i<pNum;i++){if(this.handlers[i].event==pEvent&&this.handlers[i].handler==pHandler){var pBCHandler=this.handlers[i].bcHandler;this.handlers.splice(i,1);break;}}
if(pBCHandler==undefined)return;return this.callMethod("removeEventListener",[pEvent,pBCHandler]);};APIModule.prototype.callPlayer=function(pCallback,pParams){if(this.playerURL!=undefined){return this.callHTML5(pParams);}else{return APIModule.callFlash(pCallback,pParams);}};APIModule.prototype.callMethod=function(pMethod,pArguments){var pArgs=[];for(var i=0;i<pArguments.length;i++)pArgs.push(pArguments[i]);return this.callPlayer(this.callback,{module:this.name,method:pMethod,params:pArgs});};APIModule.prototype.callHTML5=function(pParams){if(!this.callback.postMessage){return null;}
var json;if(window.JSON){json=window.JSON.stringify(pParams);}else{json=brightcove.stringify(pParams);}
if(json){this.callback.postMessage(json,this.playerURL);}
return null;};var BCXML={};BCXML.convertToXML=function(pObj,pNodeName){if(pObj instanceof Function)return"";var pType=BCXML.getType(pObj);var pXML="<"+pType.name+pNodeName+">";if(pType.name=="obj"){for(var i in pObj){pXML+=BCXML.convertToXML(pObj[i],i);}}else if(pType.name=="arr"){for(var j=0;j<pObj.length;j++){pXML+=BCXML.convertToXML(pObj[j],j);}}else if(pType.name=="str"){pObj=BCXML.replaceEntities(pObj);pXML+=pObj;}else{pXML+=pObj;}
pXML+="</"+pType.name+pNodeName+">";return pXML;};BCXML.replaceEntities=function(pObj){pObj=pObj.replace(new RegExp("&","g"),"&amp;");pObj=pObj.replace(new RegExp("<","g"),"&lt;");pObj=pObj.replace(new RegExp(">","g"),"&gt;");return pObj;};BCXML.getType=function(pObj){switch(typeof(pObj)){case"boolean":return{name:"boo",type:Boolean};case"string":return{name:"str",type:String};case"number":return{name:"num",type:Number};default:if(pObj instanceof Array){return{name:"arr",type:Array};}else{return{name:"obj",type:Object};}}};BCAdvertisingEvent={}
BCAdvertisingEvent.AD_COMPLETE="adComplete";BCAdvertisingEvent.AD_POSTROLLS_COMPLETE="adPostRollsComplete";BCAdvertisingEvent.AD_PAUSE="adPause";BCAdvertisingEvent.AD_PROGRESS="adProgress";BCAdvertisingEvent.AD_RESUME="adResume";BCAdvertisingEvent.AD_RECEIVED="adReceived";BCAdvertisingEvent.AD_START="adStart";BCAdvertisingEvent.AD_CLICK="adClick";BCAdvertisingEvent.EXTERNAL_AD="externalAd";BCAdvertisingEvent.AD_RULES_READY="adRulesReady";brightcove.modules[APIModules.ADVERTISING]=AdvertisingAPI;function AdvertisingAPI(pExperience){this.experience=pExperience;this.callback=pExperience.callback;this.name=APIModules.ADVERTISING;}
var pttp=AdvertisingAPI.prototype=new APIModule();pttp.showAd=function(){return this.callMethod("showAd",arguments);};pttp.resumeAfterExternalAd=function(){return this.callMethod("resumeAfterExternalAd",arguments);};pttp.getEnabledAdFormats=function(){return this.callMethod("getEnabledAdFormats",arguments);};pttp.enableAdFormats=function(){return this.callMethod("enableAdFormats",arguments);};pttp.enableExternalAds=function(){return this.callMethod("enableExternalAds",arguments);};pttp.enableOverrideAds=function(){return this.callMethod("enableOverrideAds",arguments);};pttp.getExternalAdsEnabled=function(){return this.callMethod("getExternalAdsEnabled",arguments);};pttp.getOverrideAdsEnabled=function(){return this.callMethod("getOverrideAdsEnabled",arguments);};pttp.disableForExternalAd=function(){return this.callMethod("disableForExternalAd",arguments);};pttp.getCurrentAdProperties=function(){return this.callMethod("getCurrentAdProperties",arguments);};pttp.showSponsorMessage=function(){return this.callMethod("showSponsorMessage",arguments);};pttp.getShowSponsorMessage=function(){return this.callMethod("getShowSponsorMessage",arguments);};pttp.allowThirdPartyControl=function(){return this.callMethod("allowThirdPartyControl",arguments);};pttp.setThirdPartyTime=function(){return this.callMethod("setThirdPartyTime",arguments);};pttp.getThirdPartyTime=function(){return this.callMethod("getThirdPartyTime",arguments);};pttp.getAdPolicy=function(){return this.callMethod("getAdPolicy",arguments);};pttp.setAdPolicy=function(){return this.callMethod("setAdPolicy",arguments);};pttp.setAdRules=function(){return this.callMethod("setAdRules",arguments);};pttp.getCurrentAdRules=function(){return this.callMethod("getCurrentAdRules",arguments);};pttp.setAdTranslator=function(){return this.callMethod("setAdTranslator",arguments);};pttp.getCurrentAdTranslator=function(){return this.callMethod("getCurrentAdTranslator",arguments);};pttp.requestAd=function(){return this.callMethod("requestAd",arguments);};pttp.getStayInFullScreen=function(){return this.callMethod("getStayInFullScreen",arguments);};pttp.setStayInFullScreen=function(){return this.callMethod("setStayInFullScreen",arguments);};pttp.stopAd=function(){return this.callMethod("stopAd",arguments);};pttp.DEFAULT_AD_TRANSLATOR="defaultAdTranslator";BCAuthEvent={}
BCAuthEvent.AUTH_NEEDED="authNeeded";brightcove.modules[APIModules.AUTH]=AuthAPI;BCAuthService={}
BCAuthService.ADOBE_PASS="adobepass";BCAuthService.AIS="ais";function AuthAPI(pExperience){this.experience=pExperience;this.callback=pExperience.callback;this.name=APIModules.AUTH;}
var pttp=AuthAPI.prototype=new APIModule();pttp.checkStatus=function(){return this.callMethod("checkStatus",arguments);};pttp.showMessage=function(){return this.callMethod("showMessage",arguments);};pttp.removeMessage=function(){return this.callMethod("removeMessage",arguments);};pttp.playWithToken=function(){return this.callMethod("playWithToken",arguments);};BCCaptionsEvent={}
BCCaptionsEvent.DFXP_LOAD_SUCCESS="dfxpLoadSuccess";BCCaptionsEvent.DFXP_LOAD_ERROR="dfxpLoadError";brightcove.modules[APIModules.CAPTIONS]=CaptionsAPI;function CaptionsAPI(pExperience){this.experience=pExperience;this.callback=pExperience.callback;this.name=APIModules.CAPTIONS;}
var pttp=CaptionsAPI.prototype=new APIModule();pttp.loadDFXP=function(){return this.callMethod("loadDFXP",arguments);};pttp.setLanguage=function(){return this.callMethod("setLanguage",arguments);};pttp.getLanguages=function(){return this.callMethod("getLanguages",arguments);};pttp.getStyleOptions=function(){return this.callMethod("getStyleOptions",arguments);};pttp.setStyleOptions=function(){return this.callMethod("setStyleOptions",arguments);};pttp.getCaptionsEnabled=function(){return this.callMethod("getCaptionsEnabled",arguments);};pttp.setCaptionsEnabled=function(){return this.callMethod("setCaptionsEnabled",arguments);};pttp.showOptions=function(){return this.callMethod("showOptions",arguments);};BCContentEvent={}
BCContentEvent.VIDEO_LOAD="videoLoad";BCContentEvent.PLAYLIST_LOAD="playlistLoad";BCContentEvent.MEDIA_LOAD="mediaLoad";BCContentEvent.MEDIA_COLLECTION_LOAD="mediaCollectionLoad";brightcove.modules[APIModules.CONTENT]=ContentAPI;function ContentAPI(pExperience){this.experience=pExperience;if(pExperience){this.callback=pExperience.callback;}
this.name=APIModules.CONTENT;}
var pttp=ContentAPI.prototype=new APIModule();pttp.getAllMediaCollections=function(){return this.callMethod("getAllMediaCollections",arguments);};pttp.getAllMediaCollectionIDs=function(){return this.callMethod("getAllMediaCollectionIDs",arguments);};pttp.getAllPlaylists=function(){return this.callMethod("getAllPlaylists",arguments);};pttp.getAllPlaylistIDs=function(){return this.callMethod("getAllPlaylistIDs",arguments);};pttp.getMediaCollection=function(){return this.callMethod("getMediaCollection",arguments);};pttp.getMediaCollectionAsynch=function(){return this.callMethod("getMediaCollectionAsynch",arguments);};pttp.getPlaylist=function(){return this.callMethod("getPlaylist",arguments);};pttp.getPlaylistAsynch=function(){return this.callMethod("getPlaylistAsynch",arguments);};pttp.getMedia=function(){return this.callMethod("getMedia",arguments);};pttp.getMediaAsynch=function(){return this.callMethod("getMediaAsynch",arguments);};pttp.getVideo=function(){return this.callMethod("getVideo",arguments);};pttp.getVideoAsynch=function(){return this.callMethod("getVideoAsynch",arguments);};pttp.purgeAllContent=function(){return this.callMethod("purgeAllContent",arguments);};pttp.purgeMediaCollections=function(){return this.callMethod("purgeMediaCollections",arguments);};pttp.purgeMedia=function(){return this.callMethod("purgeMedia",arguments);};pttp.purgePlaylist=function(){return this.callMethod("purgePlaylist",arguments);};pttp.purgePlaylists=function(){return this.callMethod("purgePlaylists",arguments);};pttp.purgeVideo=function(){return this.callMethod("purgeVideo",arguments);};pttp.purgeVideos=function(){return this.callMethod("purgeVideos",arguments);};pttp.getMediaInGroupAsynch=function(){return this.callMethod("getMediaInGroupAsynch",arguments);};pttp.createRuntimeMediaCollection=function(){return this.callMethod("createRuntimeMediaCollection",arguments);};pttp.updateMedia=function(){return this.callMethod("updateMedia",arguments);};pttp.appendArgsToMediaRequest=function(){return this.callMethod("appendArgsToMediaRequest",arguments);};brightcove.modules[APIModules.CONVIVA]=ConvivaAPI;function ConvivaAPI(pExperience){this.experience=pExperience;this.callback=pExperience.callback;this.name=APIModules.CONVIVA;}
var pttp=ConvivaAPI.prototype=new APIModule();pttp.sendEvent=function(){return this.callMethod("sendEvent",arguments);};BCCuePointEvent={}
BCCuePointEvent.CUE="cuePoint";brightcove.modules[APIModules.CUE_POINTS]=CuePointsAPI;function CuePointsAPI(pExperience){this.experience=pExperience;this.callback=pExperience.callback;this.name=APIModules.CUE_POINTS;}
var pttp=CuePointsAPI.prototype=new APIModule();pttp.addCuePoints=function(){return this.callMethod("addCuePoints",arguments);};pttp.clearCodeCuePoints=function(){return this.callMethod("clearCodeCuePoints",arguments);};pttp.removeCodeCuePointsAtTime=function(){return this.callMethod("removeCodeCuePointsAtTime",arguments);};pttp.getCuePoints=function(){return this.callMethod("getCuePoints",arguments);};pttp.clearAdCuePoints=function(){return this.callMethod("clearAdCuePoints",arguments);};pttp.removeAdCuePointsAtTime=function(){return this.callMethod("removeAdCuePointsAtTime",arguments);};BCEffectsEvent={};BCEffectsEvent.BEGIN="animationBegin";BCEffectsEvent.COMPLETE="animationComplete";BCEffectsEvent.CHANGE="animationChange";brightcove.modules[APIModules.EFFECTS]=EffectsAPI;function EffectsAPI(pExperience){this.experience=pExperience;this.callback=pExperience.callback;this.name=APIModules.EFFECTS;}
EffectsAPI.animations={};var pttp=EffectsAPI.prototype=new APIModule();pttp.createAnimation=function(){var pID=this.callMethod("createAnimationJS",arguments);return this.getAnimation(pID);};pttp.getAnimation=function(){var pID=this.callMethod("getAnimationJS",arguments);if(pID){return this.getAnimationWrapper(pID);}
return null;};pttp.getAnimationWrapper=function(pID){var pAnimation=EffectsAPI.animations[pID];if(pAnimation==undefined){pAnimation=new EffectsAPIAnimation(pID,this.callback);EffectsAPI.animations[pID]=pAnimation;}
return pAnimation;};function EffectsAPIAnimation(pID,pCallback){this.id=pID;this.name=APIModules.EFFECTS;this.callback=pCallback;}
pttp=EffectsAPIAnimation.prototype=new APIModule();pttp.id=-1;pttp.callMethod=function(pMethod,pArguments){if(pArguments==undefined)pArguments=[];var pArgs=[this.id];for(var i=0;i<pArguments.length;i++)pArgs.push(pArguments[i]);return APIModule.callFlash(this.callback,{module:this.name,method:pMethod,params:pArgs});};pttp.start=function(){return this.callMethod("startJS",arguments);};pttp.stop=function(){return this.callMethod("stopJS",arguments);};pttp.apply=function(target){var targetID=target.getID();if(targetID){return this.callMethod("applyJS",[targetID]);}};pttp.addEventListener=function(pEvent,pHandler){var pNewHandler=APIModule.getHandler();this.handlers.push({handler:pHandler,bcHandler:pNewHandler,event:pEvent});window[pNewHandler]=pHandler;return this.callMethod("addEventListenerJS",[pEvent,pNewHandler]);};pttp.removeEventListener=function(pEvent,pHandler){var pNum=this.handlers.length;for(var i=0;i<pNum;i++){if(this.handlers[i].event==pEvent&&this.handlers[i].handler==pHandler){var pBCHandler=this.handlers[i].bcHandler;this.handlers.splice(i,1);break;}}
if(pBCHandler==undefined)return;return this.callMethod("removeEventListenerJS",[pEvent,pBCHandler]);};BCExperienceEvent={}
BCExperienceEvent.CONTENT_LOAD="contentLoad";BCExperienceEvent.USER_MESSAGE="userMessage";BCExperienceEvent.TEMPLATE_READY="templateReady";BCExperienceEvent.ENTER_FULLSCREEN="enterFullScreen";BCExperienceEvent.EXIT_FULLSCREEN="exitFullScreen";brightcove.modules[APIModules.EXPERIENCE]=ExperienceAPI;BCComponentModules={};function ExperienceAPI(pExperience){this.experience=pExperience;if(pExperience){this.callback=pExperience.callback;}
this.name=APIModules.EXPERIENCE;}
var pttp=ExperienceAPI.prototype=new APIModule();pttp.setSize=function(){return this.callMethod("setSize",arguments);};pttp.getPlayerName=function(){return this.callMethod("getPlayerName",arguments);};pttp.getReady=function(){return this.callMethod("getReady",arguments);};pttp.getWidth=function(){return this.callMethod("getWidth",arguments);};pttp.getHeight=function(){return this.callMethod("getHeight",arguments);};pttp.getAdEnabled=function(){return this.callMethod("getAdEnabled",arguments);};pttp.getEnabled=function(){return this.callMethod("getEnabled",arguments);};pttp.setEnabled=function(){return this.callMethod("setEnabled",arguments);};pttp.loadExperience=function(){return this.callMethod("loadExperience",arguments);};pttp.getLayout=function(){return this.callMethod("getLayout",arguments);};pttp.getAffiliateID=function(){return this.callMethod("getAffiliateID",arguments);};pttp.getExperienceID=function(){return this.callMethod("getExperienceID",arguments);};pttp.getPublisherID=function(){return this.callMethod("getPublisherID",arguments);};pttp.getExperienceURL=function(){return this.callMethod("getExperienceURL",arguments);};pttp.getReferrerURL=function(){return this.callMethod("getReferrerURL",arguments);};pttp.getConfiguredPropertiesForID=function(){return this.callMethod("getConfiguredPropertiesForID",arguments);};pttp.getPlayerParameter=function(){return this.callMethod("getPlayerParameter",arguments);};pttp.getLayoutRoot=function(){var pObj=this.callMethod("getLayoutRootJS",arguments);if(pObj!=null){if(BCComponentModules[pObj.elementName]!=null){return new BCComponentModules[pObj.elementName](this.experience,this.callback,pObj.elementID);}}
return null;};pttp.getElementByID=function(){var pNodeName=this.callMethod("getJSElementByID",arguments);if(pNodeName!=null){if(pNodeName=="VideoPlayer"||pNodeName=="VideoDisplay"){var pPlayerAPI=this.experience.getModule(APIModules.VIDEO_PLAYER);if(pPlayerAPI){pPlayerAPI.initializeComponentAPI();return pPlayerAPI;}}else if(BCComponentModules[pNodeName]!=null){return new BCComponentModules[pNodeName](this.experience,this.callback,arguments[0]);}}
return null;};pttp.getElementsByType=function(){var pIDs=this.callMethod("getJSElementsByType",arguments);var pElements=[];var pElement;for(var i in pIDs){if(typeof(pIDs[i])!="function"){pElement=this.getElementByID(pIDs[i]);if(pElement)pElements.push(pElement);}}
return pElements;};pttp.getModules=function(){return this.callMethod("getModules",arguments);};pttp.unload=function(){return this.callMethod("unload",arguments);};pttp.debug=function(){return this.callMethod("debug",arguments);};pttp.getUserCountry=function(){return this.callMethod("getUserCountry",arguments);};pttp.getTranslation=function(){return this.callMethod("getTranslation",arguments);};BCMenuEvent={}
BCMenuPage={}
BCMenuAdditionalMedia={}
BCMenuEvent.MENU_PAGE_OPEN="menuPageOpen";BCMenuEvent.MENU_PAGE_CLOSE="menuPageClose";BCMenuEvent.OVERLAY_MENU_OPEN="overlayMenuOpen";BCMenuEvent.OVERLAY_MENU_CLOSE="overlayMenuClose";BCMenuEvent.OVERLAY_MENU_PLAY_CLICK="overlayMenuPlayClick";BCMenuEvent.ICON_MENU_OPEN="iconMenuOpen";BCMenuEvent.ICON_MENU_CLOSE="iconMenuClose";BCMenuEvent.SEND_EMAIL_CLICK="sendEmailClick";BCMenuEvent.BLOG_POST_CLICK="blogPostClick";BCMenuEvent.COPY_LINK="copyLink";BCMenuEvent.COPY_CODE="copyCode";BCMenuEvent.VIDEO_REQUEST="videoRequest";BCMenuPage.EMAIL="Email";BCMenuPage.SHARE="Share";BCMenuPage.LINK="Link";BCMenuPage.CODE="Embed";BCMenuPage.INFO="Info";BCMenuAdditionalMedia.RELATED_VIDEOS="related videos";BCMenuAdditionalMedia.NEWEST_VIDEOS="newest videos";BCMenuAdditionalMedia.MOST_VIEWED_VIDEOS="most viewed videos";brightcove.modules[APIModules.MENU]=MenuAPI;function MenuAPI(pExperience){this.experience=pExperience;this.callback=pExperience.callback;this.name=APIModules.MENU;}
var pttp=MenuAPI.prototype=new APIModule();pttp.showIconMenu=function(){return this.callMethod("showIconMenu",arguments);};pttp.isIconMenuShowing=function(){return this.callMethod("isIconMenuShowing",arguments);};pttp.showMenuPage=function(){return this.callMethod("showMenuPage",arguments);};pttp.closeMenuPage=function(){return this.callMethod("closeMenuPage",arguments);};pttp.isMenuPageShowing=function(){return this.callMethod("isMenuPageShowing",arguments);};pttp.isOverlayMenuShowing=function(){return this.callMethod("isOverlayMenuShowing",arguments);};pttp.removeOverlayMenu=function(){return this.callMethod("removeOverlayMenu",arguments);};pttp.getCurrentMenuPage=function(){return this.callMethod("getCurrentMenuPage",arguments);};pttp.setOverlayMenuVisible=function(){return this.callMethod("setOverlayMenuVisible",arguments);};pttp.getOverlayMenuVisible=function(){return this.callMethod("getOverlayMenuVisible",arguments);};pttp.setAdditionalMediaForType=function(){return this.callMethod("setAdditionalMediaForType",arguments);};pttp.getAdditionalMediaForType=function(){return this.callMethod("getAdditionalMediaForType",arguments);};var bcAdditionalMediaCallback;pttp.setAdditionalMediaCallback=function(pCallback,pTypes){bcAdditionalMediaCallback=pCallback;return this.callMethod("setAdditionalMediaCallbackJS",["bcCallAdditionalMediaCallback",pTypes]);};function bcCallAdditionalMediaCallback(pType,pMedia){return bcAdditionalMediaCallback(pType,pMedia);};BCSearchEvent={};BCSearchEvent.RESULT="searchResult";BCSearchEvent.ERROR="searchError";brightcove.modules[APIModules.SEARCH]=SearchAPI;SortOrderType={ASC:"ASC",DESC:"DESC"};SortByType={PUBLISH_DATE:"PUBLISH_DATE",CREATION_DATE:"CREATION_DATE",MODIFIED_DATE:"MODIFIED_DATE",PLAYS_TOTAL:"PLAYS_TOTAL",PLAYS_TRAILING_WEEK:"PLAYS_TRAILING_WEEK"};function SearchAPI(pExperience){this.experience=pExperience;this.callback=pExperience.callback;this.name=APIModules.SEARCH;}
SearchAPI.searches={};var pttp=SearchAPI.prototype=new APIModule();pttp.findRelatedVideos=function(){var pID=this.callMethod("findRelatedVideosJS",arguments);return this.getVideoSearch(pID);};pttp.findVideosByText=function(){var pID=this.callMethod("findVideosByTextJS",arguments);return this.getVideoSearch(pID);};pttp.findVideosByTags=function(){var pID=this.callMethod("findVideosByTagsJS",arguments);return this.getVideoSearch(pID);};pttp.findAllVideos=function(){var pID=this.callMethod("findAllVideosJS",arguments);return this.getVideoSearch(pID);};pttp.getVideoSearch=function(pID){var pSearch=SearchAPI.searches[pID];if(pSearch==undefined){pSearch=new VideoSearch(pID,this.callback);SearchAPI.searches[pID]=pSearch;}
return pSearch;};pttp.getMaxItemsInMemory=function(){return this.callMethod("getMaxItemsInMemory",arguments);};pttp.setMaxItemsInMemory=function(){return this.callMethod("setMaxItemsInMemory",arguments);};function VideoSearch(pID,pCallback){this.id=pID;this.name=APIModules.SEARCH;this.callback=pCallback;}
pttp=VideoSearch.prototype=new APIModule();pttp.id=-1;pttp.callMethod=function(pMethod,pArguments){if(pArguments==undefined)pArguments=[];var pArgs=[this.id];for(var i=0;i<pArguments.length;i++)pArgs.push(pArguments[i]);return APIModule.callFlash(this.callback,{module:this.name,method:pMethod,params:pArgs});};pttp.getItems=function(){return this.callMethod("getItems",arguments);};pttp.getPage=function(){return this.callMethod("getPage",arguments);};pttp.getPageAsynch=function(){this.pageNumber=this.callMethod("getPageNumber");return this.callMethod("getPageAsynch",arguments);};pttp.getNextPage=function(){return this.callMethod("getNextPage",arguments);};pttp.getNextPageAsynch=function(){return this.callMethod("getNextPageAsynch",arguments);};pttp.getPreviousPage=function(){return this.callMethod("getPreviousPage",arguments);};pttp.getPreviousPageAsynch=function(){return this.callMethod("getPreviousPageAsynch",arguments);};pttp.getRow=function(){return this.callMethod("getRow",arguments);};pttp.getRowOnPage=function(){return this.callMethod("getRowOnPage",arguments);};pttp.purgeAll=function(){return this.callMethod("purgeAll",arguments);};pttp.purgePage=function(){return this.callMethod("purgePage",arguments);};pttp.getTotalRows=function(){return this.callMethod("getTotalRows",arguments);};pttp.getTotalPages=function(){return this.callMethod("getTotalPages",arguments);};pttp.getPageNumber=function(){return this.callMethod("getPageNumber",arguments);};pttp.getPageSize=function(){return this.callMethod("getPageSize",arguments);};pttp.getMaxPagesInMemory=function(){return this.callMethod("getMaxPagesInMemory",arguments);};pttp.setMaxPagesInMemory=function(){return this.callMethod("setMaxPagesInMemory",arguments);};BCSocialEvent={}
BCSocialEvent.EMBED_CODE_RETRIEVED="embedCodeRetrieved";BCSocialEvent.LINK_GENERATED="linkGenerated";brightcove.modules[APIModules.SOCIAL]=SocialAPI;function SocialAPI(pExperience){this.experience=pExperience;this.callback=pExperience.callback;this.name=APIModules.SOCIAL;}
var pttp=SocialAPI.prototype=new APIModule();pttp.shareVideoViaEmail=function(){return this.callMethod("shareVideoViaEmail",arguments);};pttp.getEmbedCode=function(){return this.callMethod("getEmbedCode",arguments);};pttp.setEmbedCode=function(){return this.callMethod("setEmbedCode",arguments);};pttp.setLink=function(){return this.callMethod("setLink",arguments);};pttp.getLink=function(){return this.callMethod("getLink",arguments);};pttp.isURLShortenedForMedia=function(){return this.callMethod("isURLShortenedForMedia",arguments);};pttp.getRSS=function(){return this.callMethod("getRSS",arguments);};pttp.enableBlogging=function(){return this.callMethod("enableBlogging",arguments);};if(BCMediaEvent==undefined){var BCMediaEvent={}
BCMediaEvent.BEGIN="mediaBegin";BCMediaEvent.BUFFER_BEGIN="mediaBufferBegin";BCMediaEvent.BUFFER_COMPLETE="mediaBufferComplete";BCMediaEvent.CHANGE="mediaChange";BCMediaEvent.COMPLETE="mediaComplete";BCMediaEvent.ERROR="mediaError";BCMediaEvent.MUTE_CHANGE="mediaMuteChange";BCMediaEvent.PLAY="mediaPlay";BCMediaEvent.PROGRESS="mediaProgress";BCMediaEvent.SEEK="mediaSeek";BCMediaEvent.SEEK_NOTIFY="mediaSeekNotify";BCMediaEvent.STOP="mediaStop";BCMediaEvent.VOLUME_CHANGE="mediaVolumeChange";}
var BCVideoEvent={}
BCVideoEvent.END_BUFFER="endBuffering";BCVideoEvent.RENDITION_CHANGE="renditionChange";BCVideoEvent.VIDEO_CHANGE="videoChange";BCVideoEvent.VIDEO_COMPLETE="videoComplete";BCVideoEvent.VIDEO_CONNECT="videoConnect";BCVideoEvent.VIDEO_LOAD="videoLoad";BCVideoEvent.VIDEO_PROGRESS="videoProgress";BCVideoEvent.VIDEO_START="videoStart";BCVideoEvent.VIDEO_STOP="videoStop";BCVideoEvent.VIDEO_MUTE="ui_mute";BCVideoEvent.VIDEO_SEEK="seek";BCVideoEvent.START_BUFFER="startBuffering";BCVideoEvent.STREAM_START="streamStart";BCVideoEvent.VOLUME_CHANGE="volumeChange";brightcove.modules[APIModules.VIDEO_PLAYER]=VideoPlayerAPI;function VideoPlayerAPI(pExperience){this.experience=pExperience;if(pExperience){this.callback=pExperience.callback;}
this.name=APIModules.VIDEO_PLAYER;}
var pttp=VideoPlayerAPI.prototype=new APIModule();pttp.initializeComponentAPI=function(){return this.callMethod("initializeComponentAPI",arguments);};pttp.getComponentAPI=function(pElementName,pElementID){if(pElementName!=null){if(pElementName=="VideoPlayer"||pElementName=="VideoDisplay"){var pPlayerAPI=this.experience.getModule(APIModules.VIDEO_PLAYER);pPlayerAPI.initializeComponentAPI();return pPlayerAPI;}else if(BCComponentModules[pElementName]!=null){return new BCComponentModules[pElementName](this.experience,this.callback,pElementID);}}
return null;};pttp.isPlayerDefined=function(){return this.callMethod("isPlayerDefined",arguments);};pttp.setVideoFilter=function(){return this.callMethod("setVideoFilter",arguments);};pttp.getCurrentVideo=function(){return this.callMethod("getCurrentVideo",arguments);};pttp.getCurrentRendition=function(){return this.callMethod("getCurrentRendition",arguments);};pttp.loadVideo=function(){return this.callMethod("loadVideo",arguments);};pttp.cueVideo=function(){return this.callMethod("cueVideo",arguments);};pttp.play=function(){return this.callMethod("play",arguments);};pttp.stop=function(){return this.callMethod("stop",arguments);};pttp.pause=function(){return this.callMethod("pause",arguments);};pttp.seek=function(){return this.callMethod("seek",arguments);};pttp.mute=function(){return this.callMethod("mute",arguments);};pttp.setVolume=function(){return this.callMethod("setVolume",arguments);};pttp.getVolume=function(){return this.callMethod("getVolume",arguments);};pttp.showVolumeControls=function(){return this.callMethod("showVolumeControls",arguments);};pttp.getVideoPosition=function(){return this.callMethod("getVideoPosition",arguments);};pttp.getVideoDuration=function(){return this.callMethod("getVideoDuration",arguments);};pttp.getVideoBytesLoaded=function(){return this.callMethod("getVideoBytesLoaded",arguments);};pttp.getVideoBytesTotal=function(){return this.callMethod("getVideoBytesTotal",arguments);};pttp.isPlaying=function(){return this.callMethod("isPlaying",arguments);};pttp.isMuted=function(){return this.callMethod("isMuted",arguments);};pttp.getContentTypeDisplayed=function(){return this.callMethod("getContentTypeDisplayed",arguments);};pttp.setSize=function(){return this.callMethod("setSize",arguments);};pttp.move=function(){return this.callMethod("move",arguments);};pttp.getX=function(){return this.callMethod("getX",arguments);};pttp.getY=function(){return this.callMethod("getY",arguments);};pttp.getDefinition=function(){return this.callMethod("getDefinition",arguments);};pttp.getID=function(){return this.callMethod("getID",arguments);};pttp.getWidth=function(){return this.callMethod("getWidth",arguments);};pttp.getHeight=function(){return this.callMethod("getHeight",arguments);};pttp.getDisplayWidth=function(){return this.callMethod("getDisplayWidth",arguments);};pttp.getDisplayHeight=function(){return this.callMethod("getDisplayHeight",arguments);};pttp.getCurrentVideoWidth=function(){return this.callMethod('getCurrentVideoWidth',arguments);};pttp.getCurrentVideoHeight=function(){return this.callMethod('getCurrentVideoHeight',arguments);};pttp.getCurrentDisplayX=function(){return this.callMethod('getCurrentDisplayX',arguments);}
pttp.getCurrentDisplayY=function(){return this.callMethod('getCurrentDisplayY',arguments);}
pttp.getCurrentDisplayWidth=function(){return this.callMethod('getCurrentDisplayWidth',arguments);};pttp.getCurrentDisplayHeight=function(){return this.callMethod('getCurrentDisplayHeight',arguments);};pttp.getEnabled=function(){return this.callMethod("getEnabled",arguments);};pttp.setStyles=function(){return this.callMethod("setStyles",arguments);};pttp.setEnabled=function(){return this.callMethod("setEnabled",arguments);};pttp.getVisible=function(){return this.callMethod("getVisible",arguments);};pttp.setVisible=function(){return this.callMethod("setVisible",arguments);};pttp.getAlpha=function(){return this.callMethod("getAlpha",arguments);};pttp.setAlpha=function(){return this.callMethod("setAlpha",arguments);};pttp.getBlendMode=function(){return this.callMethod("getBlendMode",arguments);};pttp.setBlendMode=function(){return this.callMethod("setBlendMode",arguments);};pttp.getRotation=function(){return this.callMethod("getRotation",arguments);};pttp.setRotation=function(){return this.callMethod("setRotation",arguments);};pttp.getIndex=function(){return this.callMethod("getIndex",arguments);};pttp.toggleVolumeControls=function(){return this.callMethod("toggleVolumeControls",arguments);};pttp.toggleMenuPage=function(){return this.callMethod("toggleMenuPage",arguments);};pttp.getContainer=function(){var pObj=this.callMethod("getContainerJS",arguments);if(pObj){return this.getComponentAPI(pObj.elementName,pObj.elementID);}
return null;};pttp.getNextSibling=function(){var pObj=this.callMethod("getNextSiblingJS",arguments);if(pObj){return this.getComponentAPI(pObj.elementName,pObj.elementID);}
return null;};pttp.getPreviousSibling=function(){var pObj=this.callMethod("getPreviousSiblingJS",arguments);if(pObj){return this.getComponentAPI(pObj.elementName,pObj.elementID);}
return null;};pttp.getCSS=function(){return this.callMethod("getCSS",arguments);};pttp.mediaIsLive=function(){return this.callMethod("mediaIsLive",arguments);};pttp.setDynamicDeliveryParameters=function(){return this.callMethod("setDynamicDeliveryParameters",arguments);};pttp.removeUserMessage=function(){return this.callMethod("removeUserMessage",arguments);};pttp.enableInitialBandwidthDetection=function(){return this.callMethod("enableInitialBandwidthDetection",arguments);};pttp.getInitialBandwidthDetectionEnabled=function(){return this.callMethod("getInitialBandwidthDetectionEnabled",arguments);};pttp.setBufferCapacity=function(){return this.callMethod("setBufferCapacity",arguments);};pttp.getBufferCapacity=function(){return this.callMethod("getBufferCapacity",arguments);};pttp.setDefaultBufferTime=function(){return this.callMethod("setDefaultBufferTime",arguments);};pttp.getDefaultBufferTime=function(){return this.callMethod("getDefaultBufferTime",arguments);};pttp.getBufferLength=function(){return this.callMethod("getBufferLength",arguments);};pttp.getBackBufferLength=function(){return this.callMethod("getBackBufferLength",arguments);};pttp.getBackBufferCapacity=function(){return this.callMethod("getBackBufferCapacity",arguments);};pttp.setBackBufferCapacity=function(){return this.callMethod("setBackBufferCapacity",arguments);};pttp.setConnectOnLoad=function(){return this.callMethod("setConnectOnLoad",arguments);};pttp.setBitRateRange=function(){return this.callMethod("setBitRateRange",arguments);};pttp.requestRenditionChange=function(){return this.callMethod("requestRenditionChange",arguments);};pttp.getCurrentBandwidth=function(){return this.callMethod("getCurrentBandwidth",arguments);};pttp.getCurrentFrameRate=function(){return this.callMethod("getCurrentFrameRate",arguments);};pttp.setPrivacyMode=function(){return this.callMethod("setPrivacyMode",arguments);};pttp.getPrivacyMode=function(){return this.callMethod("getPrivacyMode",arguments);};pttp.getMediaControllerProperty=function(){return this.callMethod("getMediaControllerProperty",arguments);};var bcRenditionSelectionCallback;pttp.setRenditionSelectionCallback=function(pSelector){bcRenditionSelectionCallback=pSelector;if(bcRenditionSelectionCallback!=null){return this.callMethod("setRenditionSelectionCallbackJS",["bcCallRenditionSelectionCallback"]);}else{return this.callMethod("setRenditionSelectionCallbackJS",[]);}};function bcCallRenditionSelectionCallback(pContext){return bcRenditionSelectionCallback(pContext);};function ComponentAPI(){this.name=APIModules.EXPERIENCE;}
var pttp=ComponentAPI.prototype=new APIModule();pttp.callMethod=function(pMethod,pArguments){var pArgs=[];for(var i=0;i<pArguments.length;i++)pArgs.push(pArguments[i]);return APIModule.callFlash(this.callback,{module:this.name,element:this.elementID,method:"getComponentAPI",componentMethod:pMethod,params:pArgs});};pttp.getComponentAPI=function(pElementName,pElementID){if(pElementName!=null){if(pElementName=="VideoPlayer"||pElementName=="VideoDisplay"){var pPlayerAPI=this.experience.getModule(APIModules.VIDEO_PLAYER);pPlayerAPI.initializeComponentAPI();return pPlayerAPI;}else if(BCComponentModules[pElementName]!=null){return new BCComponentModules[pElementName](this.experience,this.callback,pElementID);}}
return null;};pttp.setSize=function(){return this.callMethod("setSize",arguments);};pttp.move=function(){return this.callMethod("move",arguments);};pttp.getX=function(){return this.callMethod("getX",arguments);};pttp.getY=function(){return this.callMethod("getY",arguments);};pttp.getVisible=function(){return this.callMethod("getVisible",arguments);};pttp.setVisible=function(){return this.callMethod("setVisible",arguments);};pttp.getIncludeInLayout=function(){return this.callMethod("getIncludeInLayout",arguments);};pttp.setIncludeInLayout=function(){return this.callMethod("setIncludeInLayout",arguments);};pttp.getAlpha=function(){return this.callMethod("getAlpha",arguments);};pttp.setAlpha=function(){return this.callMethod("setAlpha",arguments);};pttp.getDefinition=function(){return this.callMethod("getDefinition",arguments);};pttp.getID=function(){return this.callMethod("getID",arguments);};pttp.getWidth=function(){return this.callMethod("getWidth",arguments);};pttp.getHeight=function(){return this.callMethod("getHeight",arguments);};pttp.getIndex=function(){return this.callMethod("getIndex",arguments);};pttp.getContainer=function(){var pObj=this.callMethod("getContainerJS",arguments);if(pObj){return this.getComponentAPI(pObj.elementName,pObj.elementID);}
return null;};pttp.getNextSibling=function(){var pObj=this.callMethod("getNextSiblingJS",arguments);if(pObj){return this.getComponentAPI(pObj.elementName,pObj.elementID);}
return null;};pttp.getPreviousSibling=function(){var pObj=this.callMethod("getPreviousSiblingJS",arguments);if(pObj){return this.getComponentAPI(pObj.elementName,pObj.elementID);}
return null;};function UIObjectAPI(pCallback,pElementID){this.callback=pCallback;this.elementID=pElementID;}
var pttp=UIObjectAPI.prototype=new ComponentAPI();pttp.getEnabled=function(){return this.callMethod("getEnabled",arguments);};pttp.setEnabled=function(){return this.callMethod("setEnabled",arguments);};pttp.getBlendMode=function(){return this.callMethod("getBlendMode",arguments);};pttp.setBlendMode=function(){return this.callMethod("setBlendMode",arguments);};pttp.getRotation=function(){return this.callMethod("getRotation",arguments);};pttp.setRotation=function(){return this.callMethod("setRotation",arguments);};pttp.setStyles=function(){return this.callMethod("setStyles",arguments);};pttp.getCSS=function(){return this.callMethod("getCSS",arguments);};if(BCMediaEvent==undefined){var BCMediaEvent={}
BCMediaEvent.BEGIN="mediaBegin";BCMediaEvent.BUFFER_BEGIN="mediaBufferBegin";BCMediaEvent.BUFFER_COMPLETE="mediaBufferComplete";BCMediaEvent.CHANGE="mediaChange";BCMediaEvent.COMPLETE="mediaComplete";BCMediaEvent.ERROR="mediaError";BCMediaEvent.MUTE_CHANGE="mediaMuteChange";BCMediaEvent.PLAY="mediaPlay";BCMediaEvent.PROGRESS="mediaProgress";BCMediaEvent.SEEK="mediaSeek";BCMediaEvent.STOP="mediaStop";BCMediaEvent.VOLUME_CHANGE="mediaVolumeChange";}
BCComponentModules["AudioPlayer"]=AudioPlayerAPI;function AudioPlayerAPI(pExperience,pCallback,pElementID){this.experience=pExperience;this.callback=pCallback;this.elementID=pElementID;}
var pttp=AudioPlayerAPI.prototype=new ComponentAPI();pttp.play=function(){return this.callMethod("play",arguments);};pttp.pause=function(){return this.callMethod("pause",arguments);};pttp.stop=function(){return this.callMethod("stop",arguments);};pttp.seek=function(){return this.callMethod("seek",arguments);};pttp.mute=function(){return this.callMethod("mute",arguments);};pttp.setVolume=function(){return this.callMethod("setVolume",arguments);};pttp.getVolume=function(){return this.callMethod("getVolume",arguments);};pttp.isPlaying=function(){return this.callMethod("isPlaying",arguments);};pttp.isMuted=function(){return this.callMethod("isMuted",arguments);};pttp.getMediaBytesLoaded=function(){return this.callMethod("getMediaBytesLoaded",arguments);};pttp.getMediaBytesTotal=function(){return this.callMethod("getMediaBytesTotal",arguments);};pttp.getMediaDuration=function(){return this.callMethod("getMediaDuration",arguments);};pttp.getMediaPosition=function(){return this.callMethod("getMediaPosition",arguments);};pttp.getCurrentMedia=function(){return this.callMethod("getCurrentMedia",arguments);};pttp.cueMedia=function(){return this.callMethod("cueMedia",arguments);};pttp.loadMedia=function(){return this.callMethod("loadMedia",arguments);};BCComponentModules["Banner"]=BannerAPI;function BannerAPI(pExperience,pCallback,pElementID){this.experience=pExperience;this.callback=pCallback;this.elementID=pElementID;}
var pttp=BannerAPI.prototype=new UIObjectAPI();BCComponentModules["Button"]=ButtonAPI;function ButtonAPI(pExperience,pCallback,pElementID){this.experience=pExperience;this.callback=pCallback;this.elementID=pElementID;}
var pttp=ButtonAPI.prototype=new UIObjectAPI();pttp.getLabel=function(){return this.callMethod("getLabel",arguments);};pttp.setLabel=function(){return this.callMethod("setLabel",arguments);};pttp.setFont=function(){return this.callMethod("setFont",arguments);};pttp.getFont=function(){return this.callMethod("getFont",arguments);};pttp.setLabelSize=function(){return this.callMethod("setLabelSize",arguments);};pttp.getLabelSize=function(){return this.callMethod("getLabelSize",arguments);};pttp.getAutoSize=function(){return this.callMethod("getAutoSize",arguments);};pttp.setAutoSize=function(){return this.callMethod("setAutoSize",arguments);};pttp.getTruncateLabel=function(){return this.callMethod("getTruncateLabel",arguments);};pttp.setTruncateLabel=function(){return this.callMethod("setTruncateLabel",arguments);};pttp.getMultiline=function(){return this.callMethod("getMultiline",arguments);};pttp.setMultiline=function(){return this.callMethod("setMultiline",arguments);};pttp.getIsTruncated=function(){return this.callMethod("getIsTruncated",arguments);};pttp.getLabelWidth=function(){return this.callMethod("getLabelWidth",arguments);};pttp.getShowBack=function(){return this.callMethod("getShowBack",arguments);};pttp.setShowBack=function(){return this.callMethod("setShowBack",arguments);};pttp.getTooltip=function(){return this.callMethod("getTooltip",arguments);};pttp.setTooltip=function(){return this.callMethod("setTooltip",arguments);};pttp.getIconScale=function(){return this.callMethod("getIconScale",arguments);};pttp.setIconScale=function(){return this.callMethod("setIconScale",arguments);};pttp.getIconOffsetX=function(){return this.callMethod("getIconOffsetX",arguments);};pttp.setIconOffsetX=function(){return this.callMethod("setIconOffsetX",arguments);};pttp.getIconOffsetY=function(){return this.callMethod("getIconOffsetY",arguments);};pttp.setIconOffsetY=function(){return this.callMethod("setIconOffsetY",arguments);};pttp.getLabelOffsetX=function(){return this.callMethod("getLabelOffsetX",arguments);};pttp.setLabelOffsetX=function(){return this.callMethod("setLabelOffsetX",arguments);};pttp.getLabelOffsetY=function(){return this.callMethod("getLabelOffsetY",arguments);};pttp.setLabelOffsetY=function(){return this.callMethod("setLabelOffsetY",arguments);};pttp.getLabelBuffer=function(){return this.callMethod("getLabelBuffer",arguments);};pttp.setLabelBuffer=function(){return this.callMethod("setLabelBuffer",arguments);};pttp.getIconAlignmentH=function(){return this.callMethod("getIconAlignmentH",arguments);};pttp.setIconAlignmentH=function(){return this.callMethod("setIconAlignmentH",arguments);};pttp.getIconAlignmentV=function(){return this.callMethod("getIconAlignmentV",arguments);};pttp.setIconAlignmentV=function(){return this.callMethod("setIconAlignmentV",arguments);};pttp.getLabelAlignmentH=function(){return this.callMethod("getLabelAlignmentH",arguments);};pttp.setLabelAlignmentH=function(){return this.callMethod("setLabelAlignmentH",arguments);};pttp.getLabelAlignmentV=function(){return this.callMethod("getLabelAlignmentV",arguments);};pttp.setLabelAlignmentV=function(){return this.callMethod("setLabelAlignmentV",arguments);};pttp.getIconName=function(){return this.callMethod("getIconName",arguments);};pttp.setIconName=function(){return this.callMethod("setIconName",arguments);};BCComponentModules["ChromelessVideoPlayer"]=ChromelessVideoPlayerAPI;function ChromelessVideoPlayerAPI(pExperience,pCallback,pElementID){this.experience=pExperience;this.callback=pCallback;this.elementID=pElementID;this.initializeComponentAPI();}
var pttp=ChromelessVideoPlayerAPI.prototype=new VideoPlayerAPI();pttp.callChromelessComponentMethod=function(pMethod,pArguments){var args=[];for(var i=0;i<pArguments.length;i++)args.push(pArguments[i]);return APIModule.callFlash(this.callback,{module:APIModules.EXPERIENCE,element:this.elementID,method:"getComponentAPI",componentMethod:pMethod,params:args});};pttp.getControls=function(){var controls=this.callChromelessComponentMethod("getControlsJS",arguments);if(controls){return this.getComponentAPI(controls.elementName,controls.elementID);}
return null;};pttp.showControls=function(){return this.callChromelessComponentMethod("showControls",arguments);};pttp.getControlsVisible=function(){return this.callChromelessComponentMethod("getControlsVisible",arguments);};pttp.getIncludeInLayout=function(){return this.callChromelessComponentMethod("getIncludeInLayout",arguments);};pttp.setIncludeInLayout=function(){return this.callChromelessComponentMethod("setIncludeInLayout",arguments);};BCComponentModules["ComboBox"]=ComboBoxAPI;function ComboBoxAPI(pExperience,pCallback,pElementID){this.experience=pExperience;this.callback=pCallback;this.elementID=pElementID;}
var pttp=ComboBoxAPI.prototype=new UIObjectAPI();pttp.setSelectedIndex=function(){return this.callMethod("setSelectedIndex",arguments);};pttp.getSelectedIndex=function(){return this.callMethod("getSelectedIndex",arguments);};pttp.getSelectedData=function(){return this.callMethod("getSelectedData",arguments);};pttp.getDataAtIndex=function(){return this.callMethod("getDataAtIndex",arguments);};pttp.getData=function(){return this.callMethod("getData",arguments);};pttp.setData=function(){return this.callMethod("setData",arguments);};pttp.getNumItems=function(){return this.callMethod("getNumItems",arguments);};pttp.getScrollerWidth=function(){return this.callMethod("getScrollerWidth",arguments);};pttp.setScrollerWidth=function(){return this.callMethod("setScrollerWidth",arguments);};pttp.getScrollerInset=function(){return this.callMethod("getScrollerInset",arguments);};pttp.setScrollerInset=function(){return this.callMethod("setScrollerInset",arguments);};pttp.getItemLeading=function(){return this.callMethod("getItemLeading",arguments);};pttp.setItemLeading=function(){return this.callMethod("setItemLeading",arguments);};pttp.getItemInsetH=function(){return this.callMethod("getItemInsetH",arguments);};pttp.setItemInsetH=function(){return this.callMethod("setItemInsetH",arguments);};pttp.getItemInsetV=function(){return this.callMethod("getItemInsetV",arguments);};pttp.setItemInsetV=function(){return this.callMethod("setItemInsetV",arguments);};pttp.getRowHeight=function(){return this.callMethod("getRowHeight",arguments);};pttp.setRowHeight=function(){return this.callMethod("setRowHeight",arguments);};pttp.getLabelBufferLeft=function(){return this.callMethod("getLabelBufferLeft",arguments);};pttp.setLabelBufferLeft=function(){return this.callMethod("setLabelBufferLeft",arguments);};pttp.getLabelBufferRight=function(){return this.callMethod("getLabelBufferRight",arguments);};pttp.setLabelBufferRight=function(){return this.callMethod("setLabelBufferRight",arguments);};pttp.getLabelBufferTop=function(){return this.callMethod("getLabelBufferTop",arguments);};pttp.setLabelBufferTop=function(){return this.callMethod("setLabelBufferTop",arguments);};pttp.getAnimated=function(){return this.callMethod("getAnimated",arguments);};pttp.setAnimated=function(){return this.callMethod("setAnimated",arguments);};pttp.getLabelField=function(){return this.callMethod("getLabelField",arguments);};pttp.setLabelField=function(){return this.callMethod("setLabelField",arguments);};pttp.getLabel=function(){return this.callMethod("getLabel",arguments);};pttp.setLabel=function(){return this.callMethod("setLabel",arguments);};function ContainerAPI(pExperience,pCallback,pElementID){this.experience=pExperience;this.callback=pCallback;this.elementID=pElementID;}
var pttp=ContainerAPI.prototype=new UIObjectAPI();pttp.getHAlign=function(){return this.callMethod("getHAlign",arguments);};pttp.setHAlign=function(){return this.callMethod("setHAlign",arguments);};pttp.getVAlign=function(){return this.callMethod("getVAlign",arguments);};pttp.setVAlign=function(){return this.callMethod("setVAlign",arguments);};pttp.getBackgroundColor=function(){return this.callMethod("getBackgroundColor",arguments);};pttp.setBackgroundColor=function(){return this.callMethod("setBackgroundColor",arguments);};pttp.getBackgroundImage=function(){return this.callMethod("getBackgroundImage",arguments);};pttp.setBackgroundImage=function(){return this.callMethod("setBackgroundImage",arguments);};pttp.getGutter=function(){return this.callMethod("getGutter",arguments);};pttp.setGutter=function(){return this.callMethod("setGutter",arguments);};pttp.getPadding=function(){return this.callMethod("getPadding",arguments);};pttp.setPadding=function(){return this.callMethod("setPadding",arguments);};pttp.appendChild=function(){return this.callMethod("appendChild",arguments);};pttp.insertChildAt=function(){return this.callMethod("insertChildAt",arguments);};pttp.removeChildByID=function(){return this.callMethod("removeChildByID",arguments);};pttp.getNumChildren=function(){return this.callMethod("getNumChildren",arguments);};pttp.removeChildAt=function(){return this.callMethod("removeChildAt",arguments);};pttp.getChildAt=function(){var pObj=this.callMethod("getChildAtJS",arguments);if(pObj){return this.getComponentAPI(pObj.elementName,pObj.elementID);}
return null;};BCComponentModules["ExpandingBanner"]=ExpandingBannerAPI;function ExpandingBannerAPI(pExperience,pCallback,pElementID){this.experience=pExperience;this.callback=pCallback;this.elementID=pElementID;}
var pttp=ExpandingBannerAPI.prototype=new UIObjectAPI();pttp.expand=function(){return this.callMethod("expand",arguments);};pttp.contract=function(){return this.callMethod("contract",arguments);};pttp.getExpanded=function(){return this.callMethod("getExpanded",arguments);};pttp.synchBannerWithExternal=function(){return this.callMethod("synchBannerWithExternal",arguments);};BCComponentModules["GraphicBlock"]=GraphicBlockAPI;function GraphicBlockAPI(pExperience,pCallback,pElementID){this.experience=pExperience;this.callback=pCallback;this.elementID=pElementID;}
var pttp=GraphicBlockAPI.prototype=new UIObjectAPI();BCComponentModules["Image"]=ImageAPI;function ImageAPI(pExperience,pCallback,pElementID){this.experience=pExperience;this.callback=pCallback;this.elementID=pElementID;}
var pttp=ImageAPI.prototype=new UIObjectAPI();pttp.setSource=function(){return this.callMethod("setSource",arguments);};pttp.getSource=function(){return this.callMethod("getSource",arguments);};pttp.getScaleMode=function(){return this.callMethod("getScaleMode",arguments);};pttp.setScaleMode=function(){return this.callMethod("setScaleMode",arguments);};pttp.getHAlign=function(){return this.callMethod("getHAlign",arguments);};pttp.setHAlign=function(){return this.callMethod("setHAlign",arguments);};pttp.getVAlign=function(){return this.callMethod("getVAlign",arguments);};pttp.setVAlign=function(){return this.callMethod("setVAlign",arguments);};pttp.getURL=function(){return this.callMethod("getURL",arguments);};pttp.setURL=function(){return this.callMethod("setURL",arguments);};pttp.getTooltip=function(){return this.callMethod("getTooltip",arguments);};pttp.setTooltip=function(){return this.callMethod("setTooltip",arguments);};pttp.getInset=function(){return this.callMethod("getInset",arguments);};pttp.setInset=function(){return this.callMethod("setInset",arguments);};pttp.getContentWidth=function(){return this.callMethod("getContentWidth",arguments);};pttp.getContentHeight=function(){return this.callMethod("getContentHeight",arguments);};BCComponentModules["Label"]=LabelAPI;function LabelAPI(pExperience,pCallback,pElementID){this.experience=pExperience;this.callback=pCallback;this.elementID=pElementID;}
var pttp=LabelAPI.prototype=new UIObjectAPI();pttp.setText=function(){return this.callMethod("setText",arguments);};pttp.getText=function(){return this.callMethod("getText",arguments);};pttp.setType=function(){return this.callMethod("setType",arguments);};pttp.getType=function(){return this.callMethod("getType",arguments);};pttp.setFont=function(){return this.callMethod("setFont",arguments);};pttp.getFont=function(){return this.callMethod("getFont",arguments);};pttp.setColor=function(){return this.callMethod("setColor",arguments);};pttp.getColor=function(){return this.callMethod("getColor",arguments);};pttp.setTextSize=function(){return this.callMethod("setTextSize",arguments);};pttp.getTextSize=function(){return this.callMethod("getTextSize",arguments);};pttp.getHAlign=function(){return this.callMethod("getHAlign",arguments);};pttp.setHAlign=function(){return this.callMethod("setHAlign",arguments);};pttp.getVAlign=function(){return this.callMethod("getVAlign",arguments);};pttp.setVAlign=function(){return this.callMethod("setVAlign",arguments);};pttp.setUnderline=function(){return this.callMethod("setUnderline",arguments);};pttp.getUnderline=function(){return this.callMethod("getUnderline",arguments);};pttp.setHTMLEnabled=function(){return this.callMethod("setHTMLEnabled",arguments);};pttp.getHTMLEnabled=function(){return this.callMethod("getHTMLEnabled",arguments);};pttp.setAutoSize=function(){return this.callMethod("setAutoSize",arguments);};pttp.getAutoSize=function(){return this.callMethod("getAutoSize",arguments);};pttp.setTruncate=function(){return this.callMethod("setTruncate",arguments);};pttp.getTruncate=function(){return this.callMethod("getTruncate",arguments);};pttp.setMultiline=function(){return this.callMethod("setMultiline",arguments);};pttp.getMultiline=function(){return this.callMethod("getMultiline",arguments);};pttp.getIsTruncated=function(){return this.callMethod("getIsTruncated",arguments);};pttp.getTextWidth=function(){return this.callMethod("getTextWidth",arguments);};pttp.getTextHeight=function(){return this.callMethod("getTextHeight",arguments);};BCComponentModules["LayoutBox"]=LayoutBoxAPI;function LayoutBoxAPI(pExperience,pCallback,pElementID){this.experience=pExperience;this.callback=pCallback;this.elementID=pElementID;}
var pttp=LayoutBoxAPI.prototype=new ComponentAPI();pttp.getHAlign=function(){return this.callMethod("getHAlign",arguments);};pttp.setHAlign=function(){return this.callMethod("setHAlign",arguments);};pttp.getVAlign=function(){return this.callMethod("getVAlign",arguments);};pttp.setVAlign=function(){return this.callMethod("setVAlign",arguments);};pttp.getBackgroundColor=function(){return this.callMethod("getBackgroundColor",arguments);};pttp.setBackgroundColor=function(){return this.callMethod("setBackgroundColor",arguments);};pttp.getBackgroundImage=function(){return this.callMethod("getBackgroundImage",arguments);};pttp.setBackgroundImage=function(){return this.callMethod("setBackgroundImage",arguments);};pttp.getGutter=function(){return this.callMethod("getGutter",arguments);};pttp.setGutter=function(){return this.callMethod("setGutter",arguments);};pttp.getPadding=function(){return this.callMethod("getPadding",arguments);};pttp.setPadding=function(){return this.callMethod("setPadding",arguments);};pttp.appendChild=function(){return this.callMethod("appendChild",arguments);};pttp.insertChildAt=function(){return this.callMethod("insertChildAt",arguments);};pttp.removeChildByID=function(){return this.callMethod("removeChildByID",arguments);};pttp.getNumChildren=function(){return this.callMethod("getNumChildren",arguments);};pttp.removeChildAt=function(){return this.callMethod("removeChildAt",arguments);};pttp.getChildAt=function(){var pObj=this.callMethod("getChildAtJS",arguments);if(pObj){return this.getComponentAPI(pObj.elementName,pObj.elementID);}
return null;};BCComponentModules["Link"]=LinkAPI;function LinkAPI(pExperience,pCallback,pElementID){this.experience=pExperience;this.callback=pCallback;this.elementID=pElementID;}
var pttp=LinkAPI.prototype=new UIObjectAPI();pttp.setText=function(){return this.callMethod("setText",arguments);};pttp.getText=function(){return this.callMethod("getText",arguments);};pttp.setAutoSize=function(){return this.callMethod("setAutoSize",arguments);};pttp.getAutoSize=function(){return this.callMethod("getAutoSize",arguments);};pttp.setFont=function(){return this.callMethod("setFont",arguments);};pttp.getFont=function(){return this.callMethod("getFont",arguments);};pttp.setTextSize=function(){return this.callMethod("setTextSize",arguments);};pttp.getTextSize=function(){return this.callMethod("getTextSize",arguments);};pttp.getHAlign=function(){return this.callMethod("getHAlign",arguments);};pttp.setHAlign=function(){return this.callMethod("setHAlign",arguments);};pttp.getVAlign=function(){return this.callMethod("getVAlign",arguments);};pttp.setVAlign=function(){return this.callMethod("setVAlign",arguments);};pttp.setMultiline=function(){return this.callMethod("setMultiline",arguments);};pttp.getMultiline=function(){return this.callMethod("getMultiline",arguments);};pttp.getURL=function(){return this.callMethod("getURL",arguments);};pttp.setURL=function(){return this.callMethod("setURL",arguments);};pttp.getTooltip=function(){return this.callMethod("getTooltip",arguments);};pttp.setTooltip=function(){return this.callMethod("setTooltip",arguments);};BCComponentModules["List"]=ListAPI;function ListAPI(pExperience,pCallback,pElementID){this.experience=pExperience;this.callback=pCallback;this.elementID=pElementID;}
var pttp=ListAPI.prototype=new UIObjectAPI();pttp.setSelectedIndex=function(){return this.callMethod("setSelectedIndex",arguments);};pttp.getSelectedIndex=function(){return this.callMethod("getSelectedIndex",arguments);};pttp.previous=function(){return this.callMethod("previous",arguments);};pttp.next=function(){return this.callMethod("next",arguments);};pttp.scrollTo=function(){return this.callMethod("scrollTo",arguments);};pttp.getSelectedData=function(){return this.callMethod("getSelectedData",arguments);};pttp.getDataAtIndex=function(){return this.callMethod("getDataAtIndex",arguments);};pttp.getData=function(){return this.callMethod("getData",arguments);};pttp.setData=function(){return this.callMethod("setData",arguments);};pttp.showPlaylist=function(){return this.callMethod("showPlaylist",arguments);};pttp.getNumItems=function(){return this.callMethod("getNumItems",arguments);};pttp.getAutomaticAdvance=function(){return this.callMethod("getAutomaticAdvance",arguments);};pttp.setAutomaticAdvance=function(){return this.callMethod("setAutomaticAdvance",arguments);};pttp.getScrollerWidth=function(){return this.callMethod("getScrollerWidth",arguments);};pttp.setScrollerWidth=function(){return this.callMethod("setScrollerWidth",arguments);};pttp.getScrollerInset=function(){return this.callMethod("getScrollerInset",arguments);};pttp.setScrollerInset=function(){return this.callMethod("setScrollerInset",arguments);};pttp.getItemLeading=function(){return this.callMethod("getItemLeading",arguments);};pttp.setItemLeading=function(){return this.callMethod("setItemLeading",arguments);};pttp.getItemInsetH=function(){return this.callMethod("getItemInsetH",arguments);};pttp.setItemInsetH=function(){return this.callMethod("setItemInsetH",arguments);};pttp.getItemInsetV=function(){return this.callMethod("getItemInsetV",arguments);};pttp.setItemInsetV=function(){return this.callMethod("setItemInsetV",arguments);};pttp.getRowHeight=function(){return this.callMethod("getRowHeight",arguments);};pttp.setRowHeight=function(){return this.callMethod("setRowHeight",arguments);};BCComponentModules["LiveButton"]=ButtonAPI;BCComponentModules["Mask"]=MaskAPI;function MaskAPI(pExperience,pCallback,pElementID){this.experience=pExperience;this.callback=pCallback;this.elementID=pElementID;}
var pttp=MaskAPI.prototype=new UIObjectAPI();BCComponentModules["MediaControls"]=MediaControlsAPI;function MediaControlsAPI(pExperience,pCallback,pElementID){this.experience=pExperience;this.callback=pCallback;this.elementID=pElementID;}
var pttp=MediaControlsAPI.prototype=new ContainerAPI();BCComponentModules["Module"]=ModuleAPI;function ModuleAPI(pExperience,pCallback,pElementID){this.name=APIModules.EXPERIENCE;this.experience=pExperience;this.callback=pCallback;this.elementID=pElementID;var methods=this.experience.getModule("experience").callMethod("getCustomModuleMethods",[pElementID]);var method;for(var i=0;i<methods.length;i++){method=methods[i];this[method]=(function(methodName){return function(){return this.callMethod(methodName,arguments);}})(method);}}
var pttp=ModuleAPI.prototype=new APIModule();pttp.callMethod=function(pMethod,pArguments){var args=[];for(var i=0;i<pArguments.length;i++){args.push(pArguments[i]);}
return APIModule.callFlash(this.callback,{module:this.name,element:this.elementID,method:"getComponentAPI",componentMethod:pMethod,params:args});};BCComponentModules["Playhead"]=PlayheadAPI;function PlayheadAPI(pExperience,pCallback,pElementID){this.experience=pExperience;this.callback=pCallback;this.elementID=pElementID;}
var pttp=PlayheadAPI.prototype=new UIObjectAPI();pttp.getSliderWidth=function(){return this.callMethod("getSliderWidth",arguments);};pttp.setSliderWidth=function(){return this.callMethod("setSliderWidth",arguments);};pttp.getAutohideSlider=function(){return this.callMethod("getAutohideSlider",arguments);};pttp.setAutohideSlider=function(){return this.callMethod("setAutohideSlider",arguments);};if(BCLoaderEvent==undefined){var BCLoaderEvent={};BCLoaderEvent.PROGRESS="loaderProgress";BCLoaderEvent.INIT="loaderInit";BCLoaderEvent.COMPLETE="loaderComplete";BCLoaderEvent.ERROR="loaderError";}
if(BCLoaderState==undefined){var BCLoaderState={};BCLoaderState.DEFAULT="default";BCLoaderState.LOADING="loading";BCLoaderState.LOADED="loaded";BCLoaderState.ERROR="error";}
BCComponentModules["SWFLoader"]=SWFLoaderAPI;function SWFLoaderAPI(pExperience,pCallback,pElementID){this.experience=pExperience;this.callback=pCallback;this.elementID=pElementID;}
var pttp=SWFLoaderAPI.prototype=new UIObjectAPI();pttp.getState=function(){return this.callMethod("getState",arguments);}
pttp.setSource=function(){return this.callMethod("setSource",arguments);};pttp.getSource=function(){return this.callMethod("getSource",arguments);};pttp.callSWFMethod=function(){return this.callMethod("callSWFMethod",arguments);};BCComponentModules["TabBar"]=TabBarAPI;function TabBarAPI(pExperience,pCallback,pElementID){this.experience=pExperience;this.callback=pCallback;this.elementID=pElementID;}
var pttp=TabBarAPI.prototype=new UIObjectAPI();pttp.setSelectedIndex=function(){return this.callMethod("setSelectedIndex",arguments);};pttp.getSelectedIndex=function(){return this.callMethod("getSelectedIndex",arguments);};pttp.getSelectedData=function(){return this.callMethod("getSelectedData",arguments);};pttp.getDataAtIndex=function(){return this.callMethod("getDataAtIndex",arguments);};pttp.getData=function(){return this.callMethod("getData",arguments);};pttp.setData=function(){return this.callMethod("setData",arguments);};pttp.getNumItems=function(){return this.callMethod("getNumItems",arguments);};pttp.getAutoSizeTabs=function(){return this.callMethod("getAutoSizeTabs",arguments);};pttp.setAutoSizeTabs=function(){return this.callMethod("setAutoSizeTabs",arguments);};pttp.getTabWidth=function(){return this.callMethod("getTabWidth",arguments);};pttp.setTabWidth=function(){return this.callMethod("setTabWidth",arguments);};pttp.getLabelBuffer=function(){return this.callMethod("getLabelBuffer",arguments);};pttp.setLabelBuffer=function(){return this.callMethod("setLabelBuffer",arguments);};pttp.getLabelField=function(){return this.callMethod("getLabelField",arguments);};pttp.setLabelField=function(){return this.callMethod("setLabelField",arguments);};pttp.getTabPadding=function(){return this.callMethod("getTabPadding",arguments);};pttp.setTabPadding=function(){return this.callMethod("setTabPadding",arguments);};pttp.getTabAlign=function(){return this.callMethod("getTabAlign",arguments);};pttp.setTabAlign=function(){return this.callMethod("setTabAlign",arguments);};pttp.getIncludeMenu=function(){return this.callMethod("getIncludeMenu",arguments);};pttp.setIncludeMenu=function(){return this.callMethod("setIncludeMenu",arguments);};pttp.getMenuWidth=function(){return this.callMethod("getMenuWidth",arguments);};pttp.setMenuWidth=function(){return this.callMethod("setMenuWidth",arguments);};pttp.getMenuRowHeight=function(){return this.callMethod("getMenuRowHeight",arguments);};pttp.setMenuRowHeight=function(){return this.callMethod("setMenuRowHeight",arguments);};pttp.getMenuItemInset=function(){return this.callMethod("getMenuItemInset",arguments);};pttp.setMenuItemInset=function(){return this.callMethod("setMenuItemInset",arguments);};pttp.getMaxMenuRows=function(){return this.callMethod("getMaxMenuRows",arguments);};pttp.setMaxMenuRows=function(){return this.callMethod("setMaxMenuRows",arguments);};pttp.getHideSingleTab=function(){return this.callMethod("getHideSingleTab",arguments);};pttp.setHideSingleTab=function(){return this.callMethod("setHideSingleTab",arguments);};pttp.appendTab=function(){return this.callMethod("appendTab",arguments);};pttp.insertTabAt=function(){return this.callMethod("insertTabAt",arguments);};pttp.replaceTabAt=function(){return this.callMethod("replaceTabAt",arguments);};pttp.removeTabAt=function(){return this.callMethod("removeTabAt",arguments);};BCComponentModules["TextRegion"]=TextRegionAPI;function TextRegionAPI(pExperience,pCallback,pElementID){this.experience=pExperience;this.callback=pCallback;this.elementID=pElementID;}
var pttp=TextRegionAPI.prototype=new ContainerAPI();BCComponentModules["TileList"]=TileListAPI;function TileListAPI(pExperience,pCallback,pElementID){this.experience=pExperience;this.callback=pCallback;this.elementID=pElementID;}
var pttp=TileListAPI.prototype=new UIObjectAPI();pttp.setSelectedIndex=function(){return this.callMethod("setSelectedIndex",arguments);};pttp.getSelectedIndex=function(){return this.callMethod("getSelectedIndex",arguments);};pttp.getSelectedData=function(){return this.callMethod("getSelectedData",arguments);};pttp.getDataAtIndex=function(){return this.callMethod("getDataAtIndex",arguments);};pttp.getData=function(){return this.callMethod("getData",arguments);};pttp.setData=function(){return this.callMethod("setData",arguments);};pttp.showPlaylist=function(){return this.callMethod("showPlaylist",arguments);};pttp.previous=function(){return this.callMethod("previous",arguments);};pttp.next=function(){return this.callMethod("next",arguments);};pttp.getNumItems=function(){return this.callMethod("getNumItems",arguments);};pttp.getAutomaticAdvance=function(){return this.callMethod("getAutomaticAdvance",arguments);};pttp.setAutomaticAdvance=function(){return this.callMethod("setAutomaticAdvance",arguments);};pttp.getButtonOffsetX=function(){return this.callMethod("getButtonOffsetX",arguments);};pttp.setButtonOffsetX=function(){return this.callMethod("setButtonOffsetX",arguments);};pttp.getButtonOffsetY=function(){return this.callMethod("getButtonOffsetY",arguments);};pttp.setButtonOffsetY=function(){return this.callMethod("setButtonOffsetY",arguments);};pttp.getButtonSize=function(){return this.callMethod("getButtonSize",arguments);};pttp.setButtonSize=function(){return this.callMethod("setButtonSize",arguments);};pttp.getNumRows=function(){return this.callMethod("getNumRows",arguments);};pttp.setNumRows=function(){return this.callMethod("setNumRows",arguments);};pttp.getNumColumns=function(){return this.callMethod("getNumColumns",arguments);};pttp.setNumColumns=function(){return this.callMethod("setNumColumns",arguments);};pttp.getRowHeight=function(){return this.callMethod("getRowHeight",arguments);};pttp.setRowHeight=function(){return this.callMethod("setRowHeight",arguments);};pttp.getColumnWidth=function(){return this.callMethod("getColumnWidth",arguments);};pttp.setColumnWidth=function(){return this.callMethod("setColumnWidth",arguments);};pttp.getColumnGutter=function(){return this.callMethod("getColumnGutter",arguments);};pttp.setColumnGutter=function(){return this.callMethod("setColumnGutter",arguments);};pttp.getRowGutter=function(){return this.callMethod("getRowGutter",arguments);};pttp.setRowGutter=function(){return this.callMethod("setRowGutter",arguments);};pttp.getContentInsetV=function(){return this.callMethod("getContentInsetV",arguments);};pttp.setContentInsetV=function(){return this.callMethod("setContentInsetV",arguments);};pttp.getContentInsetH=function(){return this.callMethod("getContentInsetH",arguments);};pttp.setContentInsetH=function(){return this.callMethod("setContentInsetH",arguments);};pttp.setScrollDirection=function(){return this.callMethod("setScrollDirection",arguments);};pttp.getScrollDirection=function(){return this.callMethod("getScrollDirection",arguments);};pttp.getAnimationType=function(){return this.callMethod("getAnimationType",arguments);};pttp.setAnimationType=function(){return this.callMethod("setAnimationType",arguments);};pttp.getUseBlur=function(){return this.callMethod("getUseBlur",arguments);};pttp.setUseBlur=function(){return this.callMethod("setUseBlur",arguments);};pttp.showPage=function(){return this.callMethod("showPage",arguments);};pttp.showNextPage=function(){return this.callMethod("showNextPage",arguments);};pttp.showPreviousPage=function(){return this.callMethod("showPreviousPage",arguments);};pttp.getPageIndex=function(){return this.callMethod("getPageIndex",arguments);};pttp.getNumPages=function(){return this.callMethod("getNumPages",arguments);};pttp.getCenterContent=function(){return this.callMethod("getCenterContent",arguments);};pttp.setCenterContent=function(){return this.callMethod("setCenterContent",arguments);};pttp.getColumnCount=function(){return this.callMethod("getColumnCount",arguments);};pttp.getRowCount=function(){return this.callMethod("getRowCount",arguments);};BCComponentModules["TitleLabel"]=TitleLabelAPI;function TitleLabelAPI(pExperience,pCallback,pElementID){this.experience=pExperience;this.callback=pCallback;this.elementID=pElementID;}
var pttp=TitleLabelAPI.prototype=new UIObjectAPI();pttp.setText=function(){return this.callMethod("setText",arguments);};pttp.getText=function(){return this.callMethod("getText",arguments);};pttp.setFont=function(){return this.callMethod("setFont",arguments);};pttp.getFont=function(){return this.callMethod("getFont",arguments);};pttp.setTextSize=function(){return this.callMethod("setTextSize",arguments);};pttp.getTextSize=function(){return this.callMethod("getTextSize",arguments);};pttp.getHAlign=function(){return this.callMethod("getHAlign",arguments);};pttp.setHAlign=function(){return this.callMethod("setHAlign",arguments);};pttp.getVAlign=function(){return this.callMethod("getVAlign",arguments);};pttp.setVAlign=function(){return this.callMethod("setVAlign",arguments);};pttp.setAutoSize=function(){return this.callMethod("setAutoSize",arguments);};pttp.getAutoSize=function(){return this.callMethod("getAutoSize",arguments);};pttp.setTruncate=function(){return this.callMethod("setTruncate",arguments);};pttp.getTruncate=function(){return this.callMethod("getTruncate",arguments);};pttp.setMultiline=function(){return this.callMethod("setMultiline",arguments);};pttp.getMultiline=function(){return this.callMethod("getMultiline",arguments);};pttp.getIsTruncated=function(){return this.callMethod("getIsTruncated",arguments);};pttp.getTextWidth=function(){return this.callMethod("getTextWidth",arguments);};pttp.getSelected=function(){return this.callMethod("getSelected",arguments);};pttp.setSelected=function(){return this.callMethod("setSelected",arguments);};BCComponentModules["ToggleButton"]=ToggleButtonAPI;function ToggleButtonAPI(pExperience,pCallback,pElementID){this.experience=pExperience;this.callback=pCallback;this.elementID=pElementID;}
var pttp=ToggleButtonAPI.prototype=new ButtonAPI();pttp.getToggledLabel=function(){return this.callMethod("getToggledLabel",arguments);};pttp.setToggledLabel=function(){return this.callMethod("setToggledLabel",arguments);};pttp.getToggledTooltip=function(){return this.callMethod("getToggledTooltip",arguments);};pttp.setToggledTooltip=function(){return this.callMethod("setToggledTooltip",arguments);};pttp.getToggledIconName=function(){return this.callMethod("getToggledIconName",arguments);};pttp.setToggledIconName=function(){return this.callMethod("setToggledIconName",arguments);};pttp.getIsToggled=function(){return this.callMethod("getIsToggled",arguments);};pttp.setIsToggled=function(){return this.callMethod("setIsToggled",arguments);};BCComponentModules["ViewStack"]=ViewStackAPI;function ViewStackAPI(pExperience,pCallback,pElementID){this.experience=pExperience;this.callback=pCallback;this.elementID=pElementID;}
var pttp=ViewStackAPI.prototype=new LayoutBoxAPI();pttp.getSelectedIndex=function(){return this.callMethod("getSelectedIndex",arguments);};pttp.setSelectedIndex=function(){return this.callMethod("setSelectedIndex",arguments);};pttp.getSelectedItemID=function(){return this.callMethod("getSelectedItemID",arguments);};pttp.setSelectedItemID=function(){return this.callMethod("setSelectedItemID",arguments);};BCComponentModules["VolumeControl"]=VolumeControlAPI;function VolumeControlAPI(pExperience,pCallback,pElementID){this.experience=pExperience;this.callback=pCallback;this.elementID=pElementID;}
var pttp=VolumeControlAPI.prototype=new UIObjectAPI();pttp.getShowBack=function(){return this.callMethod("getShowBack",arguments);};pttp.setShowBack=function(){return this.callMethod("setShowBack",arguments);};pttp.getTooltip=function(){return this.callMethod("getTooltip",arguments);};pttp.setTooltip=function(){return this.callMethod("setTooltip",arguments);};pttp.getIconScale=function(){return this.callMethod("getIconScale",arguments);};pttp.setIconScale=function(){return this.callMethod("setIconScale",arguments);};pttp.getIconOffsetX=function(){return this.callMethod("getIconOffsetX",arguments);};pttp.setIconOffsetX=function(){return this.callMethod("setIconOffsetX",arguments);};pttp.getIconOffsetY=function(){return this.callMethod("getIconOffsetY",arguments);};pttp.setIconOffsetY=function(){return this.callMethod("setIconOffsetY",arguments);};pttp.getIconAlignmentH=function(){return this.callMethod("getIconAlignmentH",arguments);};pttp.setIconAlignmentH=function(){return this.callMethod("setIconAlignmentH",arguments);};pttp.getIconAlignmentV=function(){return this.callMethod("getIconAlignmentV",arguments);};pttp.setIconAlignmentV=function(){return this.callMethod("setIconAlignmentV",arguments);};pttp.getIconName=function(){return this.callMethod("getIconName",arguments);};pttp.setIconName=function(){return this.callMethod("setIconName",arguments);};pttp.getMutedTooltip=function(){return this.callMethod("getMutedTooltip",arguments);};pttp.setMutedTooltip=function(){return this.callMethod("setMutedTooltip",arguments);};pttp.getMutedIconName=function(){return this.callMethod("getMutedIconName",arguments);};pttp.setMutedIconName=function(){return this.callMethod("setMutedIconName",arguments);};pttp.getIsToggled=function(){return this.callMethod("getIsToggled",arguments);};pttp.setIsToggled=function(){return this.callMethod("setIsToggled",arguments);};pttp.getSliderHeight=function(){return this.callMethod("getSliderHeight",arguments);};pttp.setSliderHeight=function(){return this.callMethod("setSliderHeight",arguments);};pttp.getPopupHeight=function(){return this.callMethod("getPopupHeight",arguments);};pttp.setPopupHeight=function(){return this.callMethod("setPopupHeight",arguments);};pttp.getHorizontalPadding=function(){return this.callMethod("getHorizontalPadding",arguments);};pttp.setHorizontalPadding=function(){return this.callMethod("setHorizontalPadding",arguments);};pttp.getVerticalPadding=function(){return this.callMethod("getVerticalPadding",arguments);};pttp.setVerticalPadding=function(){return this.callMethod("setVerticalPadding",arguments);};pttp.getDirection=function(){return this.callMethod("getDirection",arguments);};pttp.setDirection=function(){return this.callMethod("setDirection",arguments);};pttp.getAnimated=function(){return this.callMethod("getAnimated",arguments);};pttp.setAnimated=function(){return this.callMethod("setAnimated",arguments);};
define("brightcove", function(){});

/* global brightcove */
/*
 Project/Purpose:
 WCS 7 Video Player

 Description:
 wcs7 playVideo() replacement.

 Notes:
 * To switch between the new WCS7 layout and the old WCS5.6 layout,
 change "$.fancybox( wcs56VPHtml" to "$.fancybox( wcs7VPHtml" in the
 playVideo() function.
 * These functions are in global scope to continue to be backwards
 compatible.

 Last Updated for Release:
 WCS 7

 $Last Updated: 20-May-2011 12:39:45PM $

 */


(function closure(root, factory) {
	if(typeof define === 'function' && define.amd) {
		define('videoPlayer',['jquery', 'global.modal', 'brightcove'],
			function load($, overlayConfigs) {
				return factory(root, $, overlayConfigs);
			});
	} else {
		// For non-AMD module, expose this to global (will also be useful for test cases)
		/* eslint-disable*/
		factory(root, jQuery, THD.Global.overlayConfigs);
		/*eslint-enable*/
	}
})(this, function factory(root, $, overlayConfigs) {
	var isPlayerAdded = false;
	var playerName = '';

	function removePlayer() {
		if(isPlayerAdded === true) {
			isPlayerAdded = false;
			brightcove.removeExperience(playerName);
		}
	}

	function addPlayer(vidID) {
		var params;
		var player;
		var parameter;
		var i;
		var playerContainer;

		if(isPlayerAdded === false) {
			isPlayerAdded = true;

			playerName = 'myExperience' + vidID;
			params = {};
			params.playerID = '671100694001';
			params.playerKey = 'AQ%2E%2E,AAAAD2AZimE%2E,cuHgoGQ9jPmKtd0i5FDrRRXaQ1PXD6vT';
			params.autoStart = 'true';
			params.bgcolor = '#00000';
			params.width = '640';
			params.height = '360';
			params.isVid = 'true';
			params.isUI = 'true';
			params.dynamicStreaming = 'true';
			params.wmode = 'transparent';

			params['@videoPlayer'] = vidID;

			player = brightcove.createElement('object');
			player.id = playerName;
			parameter;
			for (i in params) {
				if (params.hasOwnProperty(i)) {
					parameter = brightcove.createElement('param');
					parameter.name = i;
					parameter.value = params[i];
					player.appendChild(parameter);
				}
			}

			playerContainer = document.getElementById('videoPlaceHolder');
			brightcove.createExperience(player, playerContainer, true);
		}
	}

	function addPlayerPIP(vidID) {
		var params;
		var player;
		var parameter;
		var i;
		var playerContainer;

		if(isPlayerAdded === false) {
			isPlayerAdded = true;

			playerName = 'myExperience' + vidID;
			params = {};
			params.playerID = '2536261721001';
			params.playerKey = 'AQ~~,AAAAD2AZimE~,cuHgoGQ9jPlv7sA7AQvn0id0vLzXqaNR';
			params.autoStart = 'true';
			params.bgcolor = '#ffffff';
			params.width = '300';
			params.height = '166';
			params.isVid = 'true';
			params.isUI = 'true';
			params.dynamicStreaming = 'true';
			params.wmode = 'transparent';
			params.includeAPI = 'true';
			params.templateLoadHandler = 'myTemplateLoaded';

			params['@videoPlayer'] = vidID;

			player = brightcove.createElement('object');
			player.id = playerName;
			parameter;
			for (i in params) {
				if (params.hasOwnProperty(i)) {
					parameter = brightcove.createElement('param');
					parameter.name = i;
					parameter.value = params[i];
					player.appendChild(parameter);
				}
			}

			playerContainer = document.getElementById('videoPlaceHolder');
			brightcove.createExperience(player, playerContainer, true);
		}
	}

	function playVideo(vidID) {
		// var closeBtnHtml = '<span class="fbVideoClose"><a href="#">CLOSE <span class="thdOrange">X</span></a></span>';

		// wcs56VPHtml = '<div id="videoPlaceHolder">'+closeBtnHtml+'<!-- The video gets placed here automagically --></div>',
		var wcs56VPHtml = '<div id="videoPlaceHolder"><!-- The video gets placed here automagically --></div>';
		// var wcs7VPHtml = '<div id="videoContainer" class="clearfix">' +
		// 		'<div class="videoTop">' +
		// 			closeBtnHtml +
		// 			'<h1>{videoTitle}</h1>'  +
		// 			'<div id="videoPlaceHolder"><!-- The video gets placed here automagically --></div>' +
		// 			'<p>{sample text} <a href="#" class="carrot">Learn More</a></p>' +
		// 		'</div>' +
		// 		'<div class="videoBottom">' +
		// 			'<div class="videoRotatorContainer clearfix">' +
		// 				'<h3 class="large b">Related To This Video</h3>' +
		// 				'<ul id="videoRelatedThumbs">' +
		// 					'<li><img src="http://dummyimage.com/85x50/99ccff" /></li>' +
		// 				'</ul>' +
		// 			'</div>' +
		// 			'<div class="videoSocialBox">&nbsp;' +
		// 			'</div>' +
		// 			'<div id="videoRotatorInfo">' +
		// 			'</div>' +
		// 		'</div>' +
		// 	'</div>';

		// vpOverlayConfig = $.extend(true, {}, overlayConfigs.modal,{
		// vpOverlayConfig = $.extend(true, {}, THD.Global.overlayConfigs.modal,{
		var vpOverlayConfig = $.extend(true, {}, overlayConfigs.videoOverlay, {
			onComplete: function videoPlayerOverlayOnComplete() {
				$('.fbVideoClose', '#fancybox-wrap').click(function closeButtonEach() {
					$.fancybox.close();
					return false;
				});
				addPlayer.call(window, vidID);
				$.fancybox.resize();
			},
			onCleanup: function videoPlayerOverlayOnCleanup() {
				removePlayer();
			}
		});

		$.fancybox(wcs56VPHtml, vpOverlayConfig);
	}

	function BrightcoveVideoPlayer(videoID, params) {
		var _params = {
			'playerID': 2536261721001,
			'playerKey': 'AQ~~,AAAAD2AZimE~,cuHgoGQ9jPlv7sA7AQvn0id0vLzXqaNR',
			'autoStart': true,
			'bgcolor': '#ffffff',
			'width': 300,
			'height': 166,
			'isVid': true,
			'isUI': true,
			'dynamicStreaming': true,
			'wmode': 'transparent',
			'includeAPI': 'true',
			'templateLoadHandler': 'myTemplateLoaded',
			'templateReadyHandler': 'onTemplateReady',
			'@videoPlayer': videoID
		};

		this.experienceName =  'myExperience' + videoID;
		this.params = $.extend(_params, params);
	}

	BrightcoveVideoPlayer.prototype.render = function render(selector) {
		var params;
		var player;

		if (!window.brightcove) {
			/*eslint-disable*/
			console.warn('BrightcoveExperiences_all.js is not present. Include this file prior to instantiating a new video player.');
			/*eslint-enable*/
			return;
		}

		params = this.params;
		player = $('<object/>').attr('id', this.experienceName);

		$.each(params, function playerEach(key) {
			var _param = $('<param/>').attr({
				name: key,
				value: params[key]
			});
			player.append(_param);
		});

		brightcove.createExperience(player.get(0), $(selector).get(0), true);

		/*eslint-disable*/
		return this;
		/*eslint-enable*/
	};

	function BrightcoveVideoPlayerHTML5(videoID, settings) {
		var _params = {
			videoID: videoID,
			account: '66036796001',
			player: '4JE-ofbdg',
			autoplay: true
		};

		this.params = $.extend(_params, settings);
		this.markup = '<video id="bcvideo_' + this.params.videoID + '" data-embed="default" class="video-js" controls></video>';
		this.scriptSrc = 'http://players.brightcove.net/' + this.params.account  + '/' + this.params.player + '_default/index.min.js';
	}


	BrightcoveVideoPlayerHTML5.prototype.render = function render(div) {
		var self = this;

		$(div).html(this.markup);

		require([self.scriptSrc], function requireCallback() {
			// require(['bc'], function requireCallbackBC(bc) {
			// 	var player = $('#bcvideo_' + self.params.videoID);
			// 	player.attr('data-account', self.params.account);
			// 	player.attr('data-player', self.params.player);
			// 	player.attr('data-video-id', self.params.videoID);
			// 	bc(player.get(0));
			//
			// 	bcPlayer = videojs('bcvideo_' + self.params.videoID);
			//
			// 	bcPlayer.on('loadedmetadata', function loadedmetadataCallback() {
			// 		if(self.params.autoplay) {
			// 			bcPlayer.play();
			// 		} else {
			// 			bcPlayer.pause();
			// 		}
			// 		$(document).trigger('BRIGHTCOVE_VIDEO_LOADED', { videoID: self.params.videoID, videoName: bcPlayer.mediainfo.name });
			// 	});
			// });
		});
	};


	BrightcoveVideoPlayerHTML5.prototype.destroy = function destroy() {
		if(!bcPlayer) return;

		bcPlayer.pause();
		bcPlayer.dispose();
	};

	/* Rendering BC video inline with Image */
	function renderVideo(videoID, id, vidwidth) {
		$('#' + id).find('a').addClass('hide');

		new BrightcoveVideoPlayer(videoID, {
			autoStart: true,
			width: vidwidth
		}).render('#' + id);
	}

	// Map these back to window
	window.playVideo = playVideo;
	window.renderVideo = renderVideo;
	window.addPlayerPIP = addPlayerPIP;

	return {
		playVideo: playVideo,
		renderVideo: renderVideo,
		addPlayerPIP: addPlayerPIP,
		renderLegacyPlayer: function renderLegacyPlayer(videoID, settings) {
			return new BrightcoveVideoPlayer(videoID, settings);
		},
		renderHTML5player: function renderHTML5player(videoID, settings) {
			return new BrightcoveVideoPlayerHTML5(videoID, settings);
		}

	};
});

/*
------------------------------------------------------------------------------
| Modulular function to call in necessary files on demand.
|
|
| THDModuleLoader.$inludeModule(ThisIsModulesName, dependency1, dependency2, dependency3,.....)
|	$ModuleName = Boolean($(".moduleTest").length);
|		if($ModuleName) {
|		$includeModule("testname", "cart", "certona");
|	}
|
|	$ModuleName2 = Boolean($(".moduleTest2").length);
|		if($ModuleName2) {
|		$includeModule("testname2", "cart", "gridx");
|	}
|
|	The Above would return
|
|	<script type="text/javascript" src="/library/scripts/cart.js"></script>
|	<script type="text/javascript" src="/library/scripts/certona.js"></script>
|	<link rel="stylesheet" href="/modules/styles/testname.css">
|	<script type="text/javascript" src="modules/scripts/testname.js"></script>
|	<script type="text/javascript" src="/library/scripts/gridx.js"></script>
|	<link rel="stylesheet" href="/modules/styles/testname2.css">
|	<script type="text/javascript" src="modules/scripts/testname2.js"></script>
|
------------------------------------------------------------------------------

# THDModuleLoader is deprecated. You should be using requirejs.

	The below scripts are dependencies of THDModule loader and need to be defined
	in your requirejs config with the below alias and correct paths

	'heroSlideShow': '../../node_modules/olt-global-scripts/desktop/widgets/heroSlideShow',
	'thdTheme': '../../node_modules/olt-global-scripts/desktop/widgets/thdTheme',
	'thdSlider': '../../node_modules/olt-global-scripts/desktop/widgets/thdSlider',
	'thdSliderV2': '../../node_modules/olt-global-scripts/desktop/widgets/thdSliderV2',
	'thd.sliderV3': '../../node_modules/olt-global-scripts/desktop/widgets/thd.sliderV3',
	'twentytwenty': '../../node_modules/olt-global-scripts/desktop/widgets/twentytwenty',
	'jquery.event.move': '../../node_modules/olt-global-scripts/desktop/lib/plugins/jquery.event.move',
	'thdSilo': '../../node_modules/olt-global-scripts/desktop/widgets/thdSilo',
	'relatedResourceWidget': '../../node_modules/olt-global-scripts/desktop/widgets/relatedResourceWidget',
	'simpleAccordion': '../../node_modules/olt-global-scripts/desktop/widgets/simpleAccordion',
	'thd.collapse': '../../node_modules/olt-global-scripts/desktop/widgets/thd.collapse',
	'thdSocialmedia': '../../node_modules/olt-global-scripts/desktop/widgets/thdSocialmedia',
	'thd.sbotd': '../../node_modules/olt-global-scripts/desktop/widgets/thd.sbotd',
	'muteYTVideo': '../../node_modules/olt-global-scripts/desktop/widgets/muteYTVideo',
*/

(function closure(root, factory) {
	if(typeof define === 'function' && define.amd) {
		define('thd.moduleLoader', [
			'jquery',
			'global.namespace',
			'global.logging',
			'global.utility'
		], function load($, THD, thdLogger, globalUtility) {
			return factory($, THD, thdLogger, globalUtility);
		});
	} else{
		/* eslint-disable*/
		root.THDModuleLoader = factory(jQuery, THD, THD, globalUtility);
		/*eslint-enable*/
	}
})(this, function factory($, THD, thdLogger, globalUtility) {
	var THDModuleLoader;
	var THDModuleDependencies = [];
	var loadBV;
	// var secureLLC;


	// check for URL type 'origin'
	function isURLTypeOrigin(urlSuffix) {
		return urlSuffix === 'origin';
	}

	// formats passed in urls
	function urlFormatter(urlParam, pathParam) {
		var path = (pathParam) ? pathParam : '';
		var url = (urlParam.indexOf('http://') === 0 || urlParam.indexOf('https://') === 0)
			? urlParam
			: path + urlParam;
		return url;
	}

	// Private: breaks down the host so we can apply logic based on LLC vs. Producion environment.
	function determineHost() {
		var sub = window.location.host;
		var secureDomain = (sub.indexOf('dev.') > -1)
			? 'secure.'
			: 'secure2.';
		var domains = {};
		var httpProtocol = window.location.protocol;
		/* sub = "t.hd-st71.homedepotdev.com";
		sub = "www.homedepot.com";
		sub = "hd-st71.homedepot.com";
		sub = "t.homedepot.com";
		sub = "secure2.homedepot.com";
		sub = "secure2.hd-st71.homedepotdev.com";
		sub = "t.secure2.homedepot.com";
		sub = "origin.hd-st71.homedepotdev.com";
		sub = "secure2.origin.hd-st71.homedepotdev.com";
		httProtocol = "https:";*/

		sub = sub.split('.');
		// checking to see if we are in and LLC
		try {
			domains.secure = (httpProtocol === 'https:') ? secureDomain : '';
			if(sub[0].length === 1) {
			/* tablet */
				domains.channel = sub[0] + '.';
				if (sub[2].indexOf('dev') > -1 || sub[1].indexOf('dev') > -1) {
					if (httpProtocol === 'https:') {
						domains.environment = '';
						domains.topLevel = sub[2] + '.com';
					} else {
						domains.environment = sub[1] + '.';
						domains.topLevel = sub[2] + '.com';
					}
				}else{
					if(httpProtocol === 'https:') {
						domains.environment = '';
						domains.topLevel = sub[2] + '.com';
					}else{
						domains.environment = '';
						domains.topLevel = sub[1] + '.com';
					}
				}
			} else {
				/* desktop*/
				domains.channel = '';

				if(sub[1].indexOf('dev') > -1 || sub[2].indexOf('dev') > -1 || (sub[3] && sub[3].indexOf('dev') > -1)) {
					if(httpProtocol === 'https:') {
						domains.environment = sub[1] + '.';
						domains.topLevel = isURLTypeOrigin(sub[1])
							? (sub[2] + '.' + sub[3] + '.com')
							: sub[2] + '.com';
					}else{
						domains.environment = sub[0] + '.';
						domains.topLevel = isURLTypeOrigin(sub[0])
							? (sub[1] + '.' + sub[2] + '.com')
							: (sub[1] + '.com');
					}
				} else {
					if (httpProtocol === 'https:') {
						domains.environment = '';
						domains.topLevel = sub[1] + '.com';
					}else{
						domains.environment = sub[0] + '.';
						domains.topLevel = sub[1] + '.com';
					}
				}
			}
		} catch (e) {
			THD.isLogging = true;
			thdLogger.log('Error: ' + e + ' - D\'OH! You\'re getting this error becasue you are running on localhost:XXXX. The workaround is for you to update your hosts file localhost domain (127.0.0.1 localhost) to a genric domain like, local.homedepot.com!  Don\'t know how to change your hosts file you say? Check out this article: http://bit.ly/1fueDGB.');
		}
		return domains;
	}

	// Private: sets the full path of the resource based on environment
	function getPath() {
		var basePath = '';
		var httpProto = window.location.protocol;
		var domains = determineHost();
		basePath = httpProto + '//' + domains.secure + domains.environment + domains.topLevel;
		return basePath;
	}

	/* private callback method used to envoke a given callback function
	--------------------------------------------------------------------
		args = {
			script: //the script object,
			callback: //callback method name
		}
	------------------------------------------------------------------*/
	function callThis(args) {
		if (typeof args.callBack === 'function') {
			args.script.onload = args.callBack.call(this);

			args.script.onreadystatechange = function readystatechange() {
				if(this.readyState === 'complete' || this.readyState === 'loaded') {
					args.script.call(this);
				}
			};
		}
	}

	THDModuleLoader = {
		$includeModule: function includeModule(moduleName) {
			var jsDependencyPath;
			var cssModulePath;
			var jsModulePath;
			var i;
			var _head = parent.document.getElementsByTagName('head')[0];
			var _body = parent.document.getElementsByTagName('body')[0];
			var newScript = parent.document.createElement('script');
			var newCSS = parent.document.createElement('link');
			var newDependency;
			var path = getPath();

			// paths to correct folders
			jsDependencyPath = path + '/HFApp/static/global/scripts/desktop/lib/';
			cssModulePath = path + '/HFApp/static/global/styles/desktop/widget/';
			jsModulePath = path + '/HFApp/static/global/scripts/desktop/widgets/';

			// set the source for each variable
			newScript.type = 'text/javascript';
			newScript.src = jsModulePath + moduleName + '.js';

			// set type for each new element
			newCSS.rel = 'stylesheet';
			newCSS.href = cssModulePath + moduleName + '.css';

			// check for dependencies and append accordingly
			for(i = 1; i < arguments.length; i += 1) {
				// check if dependency exist in the global array THDModuleDependencies
				// If it doesn not exist then add it to the page and update the array
				if($.inArray(arguments[i], THDModuleDependencies) === -1) {
					// console.log(arguments[i] + '.js has been added to the page');

					newDependency = document.createElement('script');
					newDependency.src = jsDependencyPath + arguments[i] + '.js';

					THDModuleDependencies.push(arguments[i]);

					_body.appendChild(newDependency);
				}
			}

			// append script and css for module
			_head.appendChild(newCSS);
			_body.appendChild(newScript);
		},

		$includeJS: function includeJS(urlParam, myCallBack) {
			var _body = parent.document.getElementsByTagName('body')[0];
			var newScript = parent.document.createElement('script');
			var url = urlFormatter(urlParam);

			newScript.type = 'text/javascript';
			newScript.src = url;
			_body.appendChild(newScript);

			// this envokes the callback passed in
			if(typeof myCallBack !== 'undefined') {
				callThis({
					callback: myCallBack,
					script: newScript
				});
			}
		},

		$includeCSS: function includeCSS(urlParam) {
			var _head = parent.document.getElementsByTagName('head')[0];
			var newCSS = parent.document.createElement('link');
			var url = urlFormatter(urlParam);
			newCSS.rel = 'stylesheet';
			newCSS.href = url;
			_head.appendChild(newCSS);
		},

		// if you want to use a $.defered method as a callback.  Note this wont work cross domain!!!
		$includeJSAjax: function includeJSAjax(urlParam) {
			var url = urlFormatter(urlParam);
			return $.getScript(url);
		}
	};

	function runBV(bvID) {
		window.$BV.ui('rr', 'show_reviews', {
			productId: bvID,
			onEvent: function onEvent(json) {
				if(json.eventSource === 'Display') {
					// @QUESTION where is this defined?
					showRatingsDisplayed(json.attributes.numReviews);
				}
			}
		});
	}

	function waitForBV(bvID) {
		if(typeof window.$BV !== 'undefined') {
			clearInterval(loadBV);
			runBV(bvID);
		}
	}

	function handleShowMoreButton(e) {
		var $this = $(e.target);
		var moreText = 'More';
		var lessText = 'Less';
		var lessClass = 'showLess';
		// To disable parent click handlers
		e.preventDefault();
		e.stopPropagation();

		if($this.hasClass(lessClass)) {
			$this.removeClass(lessClass);
			$this.html(moreText);
		} else {
			$this.addClass(lessClass);
			$this.html(lessText);
		}
		$this.prevAll().eq(1).toggle();
		$this.prev().toggle();
	}

	THDModuleLoader.init = function init() {
		if (THD.THDModuleLoader) {
			return this;
		}

		THD.THDModuleLoader = THDModuleLoader;
		$(function docReady() {
			var themeID;
			var $hasSlider;
			var $hasSliderV2;
			var $hasSliderV3;
			var $hasSplitImageContainer;
			// var $hasNegMargin;
			var $hasRelatedResourcesWidget;
			var $hasTHDSimpleAccordion;
			var $isGen1ContactUs;
			var $isFAQPageVisible;
			var $hasSocialResourcesWidget;
			var $hasSBOTDResourcesWidget;
			var $hasmuteVideo;
			var bcAPI;
			var $hasServiceRatingsReviews;
			var hostName;
			var isDevEnvironment;
			var bvID;
			var $hasMoreLink;

			// thdTheme
			themeID = $('#container').attr('data-thdtheme');
			if (themeID) {
				require(['thdTheme']);
			} else {
				// thdSlider
				$hasSlider = Boolean($('.slider').length);
				if ($hasSlider) {
					require(['thdSlider']);
				}
			}

			$hasSliderV2 = Boolean($('.sliderV2').length);
			if ($hasSliderV2) {
				require(['thdSliderV2']);
				// THDModuleLoader.$includeCSS('/HFApp/static/global/styles/desktop/widget/thdSliderV2.css');
			}

			$hasSliderV3 = Boolean($('.sliderV3').length);
			if ($hasSliderV3) {
				require(['thd.sliderV3']);
				// THDModuleLoader.$includeCSS('/HFApp/static/global/styles/desktop/widget/thd.sliderV3.css');
			}

			$hasSplitImageContainer = Boolean($('.twentytwenty-container').length);
			if ($hasSplitImageContainer) {
				// Include jquery move event https://github.com/stephband/jquery.event.move
				require(['jquery.event.move', 'twentytwenty']);
				// THDModuleLoader.$includeCSS('/HFApp/static/global/styles/desktop/widget/twentytwenty.css');
			}

			// Related Resources
			$hasRelatedResourcesWidget = Boolean($('[data-widget=related-resource-widget]').length);
			if($hasRelatedResourcesWidget) {
				require(['relatedResourceWidget']);
			}

			// Simple Accordion
			$hasTHDSimpleAccordion = Boolean($('[data-action=accordion-trigger]').length);
			if($hasTHDSimpleAccordion) {
				require(['simpleAccordion']);
			}

			// Contact Us Page Hack
			$isGen1ContactUs = Boolean($('#contactFormWrapper').length);
			if($isGen1ContactUs) {
				// THDModuleLoader.$includeCSS('/HFApp/static/global/styles/desktop/source/ContactUsPageGen1.css');
			}

			// FAQs page
			$isFAQPageVisible = Boolean($(".content > h4[data-toggle='collapse']").length);
			if($isFAQPageVisible) {
				require(['thd.collapse']);
				// THDModuleLoader.$includeCSS('/HFApp/static/global/styles/desktop/widget/thd.collapse.css');
			}

			// THD Social Media Related Resources
			$hasSocialResourcesWidget = Boolean($('#socialWidgetTable').length);
			if($hasSocialResourcesWidget) {
				require(['thdSocialmedia']);
				// THDModuleLoader.$includeCSS('/HFApp/static/global/styles/desktop/widget/thdSocialmedia.css');
			}

			// THD SBOTD Widget Related Resources
			$hasSBOTDResourcesWidget = Boolean($('#sbotd').length);
			if($hasSBOTDResourcesWidget) {
				require(['thd.sbotd']);
				// THDModuleLoader.$includeCSS('/HFApp/static/global/styles/desktop/widget/thd.sbotd.css');
			}

			// Mute the Youtube Video Resources
			$hasmuteVideo = Boolean($('.muteYTVideo').length);
			if($hasmuteVideo) {
				require(['muteYTVideo']);
			}

			// Pull in the brightcove player, but only if it was not already called in.
			if(window.brightcove === undefined) {
				// Determine, if we need secure or not.
				bcAPI = (window.location.protocol === 'http:')
					? true
					: false;

				if (bcAPI) {
					require(['brightcove', 'videoPlayer']);
				}
			}


			// try{
			// 	// Determine if MCC throttle is on.
			// 	var MCC_OVERRIDE = readCookie("MCC_THROTTLE");
			// 	var devOverride = ((window.location.search.indexOf("mcc=true")>-1) ||
			// 							(window.location.search.indexOf("MCC=true")>-1));

			// 	if(MCC_OVERRIDE || devOverride) {
			// 		THDModuleLoader.$includeJS('/MCCCheckout/static/MCC/dist/mccFullsiteCore.js');
			// 		// Include CSS overrides for MCC
			// 		THDModuleLoader.$includeCSS('/MCCCheckout/static/MCC/dist/thd.mcc.atc.overlay.v1.css');
			// 	}
			// }catch(e){
			// 	console.log("Error loading MCC resources");
			// }


			// Pull in the BV RR, but only if it was not already called in.
			$hasServiceRatingsReviews = (Boolean($('#BVRRContainer').length) && (!Boolean($('#productinfo_ctn').length)));
			if(window.$BV === undefined && $hasServiceRatingsReviews) {
				hostName = globalUtility.getHostNameNonSecure();
				isDevEnvironment = (hostName.indexOf('homedepotdev') > -1 || hostName.indexOf('localhost') > -1);
				bvID = $('#BVRRContainer').attr('data-bv-id');

				// console.log(isDevEnvironment);

				// @TODO need to test this
				if (window.location.protocol === 'https:') {
					(!isDevEnvironment)
						? require(['https://homedepot.ugc.bazaarvoice.com/static/1999profiles/bvapi.js'])
						: require(['https://homedepot.ugc.bazaarvoice.com/bvstaging/static/1999profiles/bvapi.js']);
				} else {
					(!isDevEnvironment)
						? require(['http://homedepot.ugc.bazaarvoice.com/static/1999aa/bvapi.js'])
						: require(['http://homedepot.ugc.bazaarvoice.com/bvstaging/static/1999services/bvapi.js']);
				}


				loadBV = setInterval(function bv() {
					waitForBV(bvID);
				}, 1000);
			}

			// Handling More/Less Links on Text Widgets
			$hasMoreLink = Boolean($('.moreLink').length);
			// @QUESTIOM why is this here?
			if($hasMoreLink) {
				// Method to handle More Button click
				$('.moreLink').click(handleShowMoreButton);
			}
		});
		return this;
	};
	window.THDModuleLoader =  THDModuleLoader;

	THDModuleLoader.init();
	return THDModuleLoader;
});

(function webpackUniversalModuleDefinition(root, factory) {
	if(typeof exports === 'object' && typeof module === 'object')
		module.exports = factory(require("cookie-utils"));
	else if(typeof define === 'function' && define.amd)
		define('thd-cart-throttle',["cookie-utils"], factory);
	else {
		var a = typeof exports === 'object' ? factory(require("cookie-utils")) : factory(root["cookie-utils"]);
		for(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];
	}
})(this, function(__WEBPACK_EXTERNAL_MODULE_1__) {
return /******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId])
/******/ 			return installedModules[moduleId].exports;
/******/
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			exports: {},
/******/ 			id: moduleId,
/******/ 			loaded: false
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.loaded = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(0);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ function(module, exports, __webpack_require__) {

	var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;'use strict';
	
	/* globals define */
	(function closure(root, factory) {
	  if (true) {
	    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(1)], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory), __WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ? (__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));
	  } else {
	    root.cookieUtils = factory(cookieUtils); // eslint-disable-line
	  }
	})(undefined, function factory(cookieUtils) {
	
	  function _getThrottleFromCookie(_ref) {
	    var key = _ref.key;
	
	    var throttle = cookieUtils.readCookie('FEATURE_THROTTLE');
	    if (!throttle) return null;
	    var index = throttle.split('-').indexOf(key + '.0');
	    index = index === -1 ? throttle.split('-').indexOf(key + '.1') : index;
	    if (index === -1) return null;
	    var throttleValue = throttle.split('-')[index];
	    return parseInt(throttleValue.split('.')[1], 10);
	  }
	
	  function _setThrottleForCookie(_ref2) {
	    var key = _ref2.key,
	        throttleValue = _ref2.throttleValue;
	
	    var throttle = cookieUtils.readCookie('FEATURE_THROTTLE');
	    if (!throttle) return;
	    if (throttle.split('-').indexOf(key + '.0') !== -1 || throttle.split('-').indexOf(key + '.1') !== -1) return;
	    throttle += '-' + key + '.' + throttleValue;
	    cookieUtils.createCookie('FEATURE_THROTTLE', throttle, 1);
	  }
	
	  function getThrottleForChannel() {
	    var _ref3 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
	        _ref3$channel = _ref3.channel,
	        channel = _ref3$channel === undefined ? 'mobile' : _ref3$channel;
	
	    var MOBILE_THROTTLE_KEY = '29';
	    var DESKTOP_THROTTLE_KEY = '30';
	    var key = channel === 'desktop' ? DESKTOP_THROTTLE_KEY : MOBILE_THROTTLE_KEY;
	
	    var override = /cartThrottle=(0|1)/.exec(window.location.search);
	    if (override && override[1]) {
	      return parseInt(override[1], 10);
	    }
	
	    if (!cookieUtils.cookieManager) {
	      cookieUtils.initializeCookieManager();
	    }
	
	    var throttleValueFromCookie = _getThrottleFromCookie({ key: key });
	
	    if (typeof throttleValueFromCookie === 'number') {
	      return throttleValueFromCookie;
	    }
	
	    // if no throttle cookie
	    var throttlePercent = void 0;
	    var throttleValue = 0;
	    try {
	      if (channel === 'mobile' && window.THD_TOUCH_GLOBALS) {
	        throttlePercent = window.THD_TOUCH_GLOBALS.mobileCartThrottle;
	      } else {
	        throttlePercent = window.THD_GLOBAL.desktopCartThrottle;
	      }
	    } catch (e) {
	      throttlePercent = 0;
	    }
	    var randomNumber = Math.floor(Math.random() * 100);
	    if (throttlePercent > randomNumber) {
	      throttleValue = 1;
	    }
	    _setThrottleForCookie({ key: key, throttleValue: throttleValue });
	    return throttleValue;
	  }
	
	  return {
	    getThrottleForChannel: getThrottleForChannel
	  };
	});

/***/ },
/* 1 */
/***/ function(module, exports) {

	module.exports = __WEBPACK_EXTERNAL_MODULE_1__;

/***/ }
/******/ ])
});
;
//# sourceMappingURL=thd-cart-throttle.amd.js.map;
/**
 * Owl carousel
 * @version 2.0.0
 * @author Bartosz Wojciechowski
 * @license The MIT License (MIT)
 * @todo Lazy Load Icon
 * @todo prevent animationend bubling
 * @todo itemsScaleUp
 * @todo Test Zepto
 * @todo stagePadding calculate wrong active classes
 */
;(function($, window, document, undefined) {

	var drag, state, e;

	/**
	 * Template for status information about drag and touch events.
	 * @private
	 */
	drag = {
		start: 0,
		startX: 0,
		startY: 0,
		current: 0,
		currentX: 0,
		currentY: 0,
		offsetX: 0,
		offsetY: 0,
		distance: null,
		startTime: 0,
		endTime: 0,
		updatedX: 0,
		targetEl: null
	};

	/**
	 * Template for some status informations.
	 * @private
	 */
	state = {
		isTouch: false,
		isScrolling: false,
		isSwiping: false,
		direction: false,
		inMotion: false
	};

	/**
	 * Event functions references.
	 * @private
	 */
	e = {
		_onDragStart: null,
		_onDragMove: null,
		_onDragEnd: null,
		_transitionEnd: null,
		_resizer: null,
		_responsiveCall: null,
		_goToLoop: null,
		_checkVisibile: null
	};

	/**
	 * Creates a carousel.
	 * @class The Owl Carousel.
	 * @public
	 * @param {HTMLElement|jQuery} element - The element to create the carousel for.
	 * @param {Object} [options] - The options
	 */
	function Owl(element, options) {

		/**
		 * Current settings for the carousel.
		 * @public
		 */
		this.settings = null;

		/**
		 * Current options set by the caller including defaults.
		 * @public
		 */
		this.options = $.extend({}, Owl.Defaults, options);

		/**
		 * Plugin element.
		 * @public
		 */
		this.$element = $(element);

		/**
		 * Caches informations about drag and touch events.
		 */
		this.drag = $.extend({}, drag);

		/**
		 * Caches some status informations.
		 * @protected
		 */
		this.state = $.extend({}, state);

		/**
		 * @protected
		 * @todo Must be documented
		 */
		this.e = $.extend({}, e);

		/**
		 * References to the running plugins of this carousel.
		 * @protected
		 */
		this._plugins = {};

		/**
		 * Currently suppressed events to prevent them from beeing retriggered.
		 * @protected
		 */
		this._supress = {};

		/**
		 * Absolute current position.
		 * @protected
		 */
		this._current = null;

		/**
		 * Animation speed in milliseconds.
		 * @protected
		 */
		this._speed = null;

		/**
		 * Coordinates of all items in pixel.
		 * @todo The name of this member is missleading.
		 * @protected
		 */
		this._coordinates = [];

		/**
		 * Current breakpoint.
		 * @todo Real media queries would be nice.
		 * @protected
		 */
		this._breakpoint = null;

		/**
		 * Current width of the plugin element.
		 */
		this._width = null;

		/**
		 * All real items.
		 * @protected
		 */
		this._items = [];

		/**
		 * All cloned items.
		 * @protected
		 */
		this._clones = [];

		/**
		 * Merge values of all items.
		 * @todo Maybe this could be part of a plugin.
		 * @protected
		 */
		this._mergers = [];

		/**
		 * Invalidated parts within the update process.
		 * @protected
		 */
		this._invalidated = {};

		/**
		 * Ordered list of workers for the update process.
		 * @protected
		 */
		this._pipe = [];

		$.each(Owl.Plugins, $.proxy(function(key, plugin) {
			this._plugins[key[0].toLowerCase() + key.slice(1)]
				= new plugin(this);
		}, this));

		$.each(Owl.Pipe, $.proxy(function(priority, worker) {
			this._pipe.push({
				'filter': worker.filter,
				'run': $.proxy(worker.run, this)
			});
		}, this));

		this.setup();
		this.initialize();
	}

	/**
	 * Default options for the carousel.
	 * @public
	 */
	Owl.Defaults = {
		items: 3,
		loop: false,
		center: false,

		mouseDrag: true,
		touchDrag: true,
		pullDrag: true,
		freeDrag: false,

		margin: 0,
		stagePadding: 0,

		merge: false,
		mergeFit: true,
		autoWidth: false,

		startPosition: 0,
		rtl: false,

		smartSpeed: 250,
		fluidSpeed: false,
		dragEndSpeed: false,

		responsive: {},
		responsiveRefreshRate: 200,
		responsiveBaseElement: window,
		responsiveClass: false,

		fallbackEasing: 'swing',

		info: false,

		nestedItemSelector: false,
		itemElement: 'div',
		stageElement: 'div',

		// Classes and Names
		themeClass: 'carousel__theme',
		baseClass: 'carousel__wrapper',
		itemClass: 'carousel__item',
		centerClass: 'center',
		activeClass: 'active'
	};

	/**
	 * Enumeration for width.
	 * @public
	 * @readonly
	 * @enum {String}
	 */
	Owl.Width = {
		Default: 'default',
		Inner: 'inner',
		Outer: 'outer'
	};

	/**
	 * Contains all registered plugins.
	 * @public
	 */
	Owl.Plugins = {};

	/**
	 * Update pipe.
	 */
	Owl.Pipe = [ {
		filter: [ 'width', 'items', 'settings' ],
		run: function(cache) {
			cache.current = this._items && this._items[this.relative(this._current)];
		}
	}, {
		filter: [ 'items', 'settings' ],
		run: function() {
			var cached = this._clones,
				clones = this.$stage.children('.cloned');

			if (clones.length !== cached.length || (!this.settings.loop && cached.length > 0)) {
				this.$stage.children('.cloned').remove();
				this._clones = [];
			}
		}
	}, {
		filter: [ 'items', 'settings' ],
		run: function() {
			var i, n,
				clones = this._clones,
				items = this._items,
				delta = this.settings.loop ? clones.length - Math.max(this.settings.items * 2, 4) : 0;

			for (i = 0, n = Math.abs(delta / 2); i < n; i++) {
				if (delta > 0) {
					this.$stage.children().eq(items.length + clones.length - 1).remove();
					clones.pop();
					this.$stage.children().eq(0).remove();
					clones.pop();
				} else {
					clones.push(clones.length / 2);
					this.$stage.append(items[clones[clones.length - 1]].clone().addClass('cloned'));
					clones.push(items.length - 1 - (clones.length - 1) / 2);
					this.$stage.prepend(items[clones[clones.length - 1]].clone().addClass('cloned'));
				}
			}
		}
	}, {
		filter: [ 'width', 'items', 'settings' ],
		run: function() {
			var rtl = (this.settings.rtl ? 1 : -1),
				width = (this.width() / this.settings.items).toFixed(3),
				coordinate = 0, merge, i, n;

			this._coordinates = [];
			for (i = 0, n = this._clones.length + this._items.length; i < n; i++) {
				merge = this._mergers[this.relative(i)];
				merge = (this.settings.mergeFit && Math.min(merge, this.settings.items)) || merge;
				coordinate += (this.settings.autoWidth ? this._items[this.relative(i)].width() + this.settings.margin : width * merge) * rtl;

				this._coordinates.push(coordinate);
			}
		}
	}, {
		filter: [ 'width', 'items', 'settings' ],
		run: function() {
			var i, n, width = (this.width() / this.settings.items).toFixed(3), css = {
				'width': Math.abs(this._coordinates[this._coordinates.length - 1]) + this.settings.stagePadding * 2,
				'padding-left': this.settings.stagePadding || '',
				'padding-right': this.settings.stagePadding || ''
			};

			this.$stage.css(css);
			//editting for autoWidth to work properly....
			css = { 'width': this.settings.autoWidth ? 'auto' : width - this.settings.margin };
			css[this.settings.rtl ? 'margin-left' : 'margin-right'] = this.settings.margin;

			if (!this.settings.autoWidth && $.grep(this._mergers, function(v) { return v > 1 }).length > 0) {
				for (i = 0, n = this._coordinates.length; i < n; i++) {
					css.width = Math.abs(this._coordinates[i]) - Math.abs(this._coordinates[i - 1] || 0) - this.settings.margin;
					this.$stage.children().eq(i).css(css);
				}
			} else {
				this.$stage.children().css(css);
			}
		}
	}, {
		filter: [ 'width', 'items', 'settings' ],
		run: function(cache) {
			cache.current && this.reset(this.$stage.children().index(cache.current));
		}
	}, {
		filter: [ 'position' ],
		run: function() {
			this.animate(this.coordinates(this._current));
		}
	}, {
		filter: [ 'width', 'position', 'items', 'settings' ],
		run: function() {
			var rtl = this.settings.rtl ? 1 : -1,
				padding = this.settings.stagePadding * 2,
				begin = this.coordinates(this.current()) + padding,
				end = begin + this.width() * rtl,
				inner, outer, matches = [], i, n;

			for (i = 0, n = this._coordinates.length; i < n; i++) {
				inner = this._coordinates[i - 1] || 0;
				outer = Math.abs(this._coordinates[i]) + padding * rtl;

				if ((this.op(inner, '<=', begin) && (this.op(inner, '>', end)))
					|| (this.op(outer, '<', begin) && this.op(outer, '>', end))) {
					matches.push(i);
				}
			}

			this.$stage.children('.' + this.settings.activeClass).removeClass(this.settings.activeClass);
			this.$stage.children(':eq(' + matches.join('), :eq(') + ')').addClass(this.settings.activeClass);

			if (this.settings.center) {
				this.$stage.children('.' + this.settings.centerClass).removeClass(this.settings.centerClass);
				this.$stage.children().eq(this.current()).addClass(this.settings.centerClass);
			}
		}
	} ];

	/**
	 * Initializes the carousel.
	 * @protected
	 */
	Owl.prototype.initialize = function() {
		this.trigger('initialize');

		this.$element
			.addClass(this.settings.baseClass)
			.addClass(this.settings.themeClass)
			.toggleClass('carousel__rtl', this.settings.rtl);

		// check support
		this.browserSupport();

		if (this.settings.autoWidth && this.state.imagesLoaded !== true) {
			var imgs, nestedSelector, width;
			imgs = this.$element.find('img');
			nestedSelector = this.settings.nestedItemSelector ? '.' + this.settings.nestedItemSelector : undefined;
			width = this.$element.children(nestedSelector).width();

			if (imgs.length && width <= 0) {
				this.preloadAutoWidthImages(imgs);
				return false;
			}
		}

		this.$element.addClass('carousel__loading');

		// create stage
		this.$stage = $('<' + this.settings.stageElement + ' class="carousel__stage"/>')
			.wrap('<div class="carousel__stage__outer">');

		// append stage
		this.$element.append(this.$stage.parent());

		// append content
		this.replace(this.$element.children().not(this.$stage.parent()));

		// set view width
		this._width = this.$element.width();

		// update view
		this.refresh();

		this.$element.removeClass('carousel__loading').addClass('carousel__loaded');

		// attach generic events
		this.eventsCall();

		// attach generic events
		this.internalEvents();

		// attach custom control events
		this.addTriggerableEvents();

		this.trigger('initialized');
	};

	/**
	 * Setups the current settings.
	 * @todo Remove responsive classes. Why should adaptive designs be brought into IE8?
	 * @todo Support for media queries by using `matchMedia` would be nice.
	 * @public
	 */
	Owl.prototype.setup = function() {
		var viewport = this.viewport(),
			overwrites = this.options.responsive,
			match = -1,
			settings = null;

		if (!overwrites) {
			settings = $.extend({}, this.options);
		} else {
			$.each(overwrites, function(breakpoint) {
				if (breakpoint <= viewport && breakpoint > match) {
					match = Number(breakpoint);
				}
			});

			settings = $.extend({}, this.options, overwrites[match]);
			delete settings.responsive;

			// responsive class
			if (settings.responsiveClass) {
				this.$element.attr('class', function(i, c) {
					return c.replace(/\b owl-responsive-\S+/g, '');
				}).addClass('owl-responsive-' + match);
			}
		}

		if (this.settings === null || this._breakpoint !== match) {
			this.trigger('change', { property: { name: 'settings', value: settings } });
			this._breakpoint = match;
			this.settings = settings;
			this.invalidate('settings');
			this.trigger('changed', { property: { name: 'settings', value: this.settings } });
		}
	};

	/**
	 * Updates option logic if necessery.
	 * @protected
	 */
	Owl.prototype.optionsLogic = function() {
		// Toggle Center class
		this.$element.toggleClass('carousel__center', this.settings.center);

		// if items number is less than in body
		if (this.settings.loop && this._items.length < this.settings.items) {
			this.settings.loop = false;
		}

		if (this.settings.autoWidth) {
			this.settings.stagePadding = false;
			this.settings.merge = false;
		}
	};

	/**
	 * Prepares an item before add.
	 * @todo Rename event parameter `content` to `item`.
	 * @protected
	 * @returns {jQuery|HTMLElement} - The item container.
	 */
	Owl.prototype.prepare = function(item) {
		var event = this.trigger('prepare', { content: item });

		if (!event.data) {
			event.data = $('<' + this.settings.itemElement + '/>')
				.addClass(this.settings.itemClass).append(item)
		}

		this.trigger('prepared', { content: event.data });

		return event.data;
	};

	/**
	 * Updates the view.
	 * @public
	 */
	Owl.prototype.update = function() {
		var i = 0,
			n = this._pipe.length,
			filter = $.proxy(function(p) { return this[p] }, this._invalidated),
			cache = {};

		while (i < n) {
			if (this._invalidated.all || $.grep(this._pipe[i].filter, filter).length > 0) {
				this._pipe[i].run(cache);
			}
			i++;
		}

		this._invalidated = {};
	};

	/**
	 * Gets the width of the view.
	 * @public
	 * @param {Owl.Width} [dimension=Owl.Width.Default] - The dimension to return.
	 * @returns {Number} - The width of the view in pixel.
	 */
	Owl.prototype.width = function(dimension) {
		dimension = dimension || Owl.Width.Default;
		switch (dimension) {
			case Owl.Width.Inner:
			case Owl.Width.Outer:
				return this._width;
			default:
				return this._width - this.settings.stagePadding * 2 + this.settings.margin;
		}
	};

	/**
	 * Refreshes the carousel primarily for adaptive purposes.
	 * @public
	 */
	Owl.prototype.refresh = function() {
		if (this._items.length === 0) {
			return false;
		}

		var start = new Date().getTime();

		this.trigger('refresh');

		this.setup();

		this.optionsLogic();

		// hide and show methods helps here to set a proper widths,
		// this prevents scrollbar to be calculated in stage width
		this.$stage.addClass('carousel__refresh');

		this.update();

		this.$stage.removeClass('carousel__refresh');

		this.state.orientation = window.orientation;

		this.watchVisibility();

		this.trigger('refreshed');
	};

	/**
	 * Save internal event references and add event based functions.
	 * @protected
	 */
	Owl.prototype.eventsCall = function() {
		// Save events references
		this.e._onDragStart = $.proxy(function(e) {
			this.onDragStart(e);
		}, this);
		this.e._onDragMove = $.proxy(function(e) {
			this.onDragMove(e);
		}, this);
		this.e._onDragEnd = $.proxy(function(e) {
			this.onDragEnd(e);
		}, this);
		this.e._onResize = $.proxy(function(e) {
			this.onResize(e);
		}, this);
		this.e._transitionEnd = $.proxy(function(e) {
			this.transitionEnd(e);
		}, this);
		this.e._preventClick = $.proxy(function(e) {
			this.preventClick(e);
		}, this);
	};

	/**
	 * Checks window `resize` event.
	 * @protected
	 */
	Owl.prototype.onThrottledResize = function() {
		window.clearTimeout(this.resizeTimer);
		this.resizeTimer = window.setTimeout(this.e._onResize, this.settings.responsiveRefreshRate);
	};

	/**
	 * Checks window `resize` event.
	 * @protected
	 */
	Owl.prototype.onResize = function() {
		if (!this._items.length) {
			return false;
		}

		if (this._width === this.$element.width()) {
			return false;
		}

		if (this.trigger('resize').isDefaultPrevented()) {
			return false;
		}

		this._width = this.$element.width();

		this.invalidate('width');

		this.refresh();

		this.trigger('resized');
	};

	/**
	 * Checks for touch/mouse drag event type and add run event handlers.
	 * @protected
	 */
	Owl.prototype.eventsRouter = function(event) {
		var type = event.type;

		if (type === "mousedown" || type === "touchstart") {
			this.onDragStart(event);
		} else if (type === "mousemove" || type === "touchmove") {
			this.onDragMove(event);
		} else if (type === "mouseup" || type === "touchend") {
			this.onDragEnd(event);
		} else if (type === "touchcancel") {
			this.onDragEnd(event);
		}
	};

	/**
	 * Checks for touch/mouse drag options and add necessery event handlers.
	 * @protected
	 */
	Owl.prototype.internalEvents = function() {
		var isTouch = isTouchSupport(),
			isTouchIE = isTouchSupportIE();

		if (this.settings.mouseDrag){
			this.$stage.on('mousedown', $.proxy(function(event) { this.eventsRouter(event) }, this));
			this.$stage.on('dragstart', function() { return false });
			this.$stage.get(0).onselectstart = function() { return false };
		} else {
			this.$element.addClass('carousel__text__select__on');
		}

		if (this.settings.touchDrag && !isTouchIE){
			this.$stage.on('touchstart touchcancel', $.proxy(function(event) { this.eventsRouter(event) }, this));
		}

		// catch transitionEnd event
		if (this.transitionEndVendor) {
			this.on(this.$stage.get(0), this.transitionEndVendor, this.e._transitionEnd, false);
		}

		// responsive
		if (this.settings.responsive !== false) {
			this.on(window, 'resize', $.proxy(this.onThrottledResize, this));
		}
	};

	/**
	 * Handles touchstart/mousedown event.
	 * @protected
	 * @param {Event} event - The event arguments.
	 */
	Owl.prototype.onDragStart = function(event) {
		var ev, isTouchEvent, pageX, pageY, animatedPos;

		ev = event.originalEvent || event || window.event;

		// prevent right click
		if (ev.which === 3 || this.state.isTouch) {
			return false;
		}

		if (ev.type === 'mousedown') {
			this.$stage.addClass('carousel__grab');
		}

		this.trigger('drag');
		this.drag.startTime = new Date().getTime();
		this.speed(0);
		this.state.isTouch = true;
		this.state.isScrolling = false;
		this.state.isSwiping = false;
		this.drag.distance = 0;

		pageX = getTouches(ev).x;
		pageY = getTouches(ev).y;

		// get stage position left
		this.drag.offsetX = this.$stage.position().left;
		this.drag.offsetY = this.$stage.position().top;

		if (this.settings.rtl) {
			this.drag.offsetX = this.$stage.position().left + this.$stage.width() - this.width()
				+ this.settings.margin;
		}

		// catch position // ie to fix
		if (this.state.inMotion && this.support3d) {
			animatedPos = this.getTransformProperty();
			this.drag.offsetX = animatedPos;
			this.animate(animatedPos);
			this.state.inMotion = true;
		} else if (this.state.inMotion && !this.support3d) {
			this.state.inMotion = false;
			return false;
		}

		this.drag.startX = pageX - this.drag.offsetX;
		this.drag.startY = pageY - this.drag.offsetY;

		this.drag.start = pageX - this.drag.startX;
		this.drag.targetEl = ev.target || ev.srcElement;
		this.drag.updatedX = this.drag.start;

		// to do/check
		// prevent links and images dragging;
		if (this.drag.targetEl.tagName === "IMG" || this.drag.targetEl.tagName === "A") {
			this.drag.targetEl.draggable = false;
		}

		$(document).on('mousemove.owl.dragEvents mouseup.owl.dragEvents touchmove.owl.dragEvents touchend.owl.dragEvents', $.proxy(function(event) {this.eventsRouter(event)},this));
	};

	/**
	 * Handles the touchmove/mousemove events.
	 * @todo Simplify
	 * @protected
	 * @param {Event} event - The event arguments.
	 */
	Owl.prototype.onDragMove = function(event) {
		var ev, isTouchEvent, pageX, pageY, minValue, maxValue, pull;

		if (!this.state.isTouch) {
			return;
		}

		if (this.state.isScrolling) {
			return;
		}

		ev = event.originalEvent || event || window.event;

		pageX = getTouches(ev).x;
		pageY = getTouches(ev).y;

		// Drag Direction
		this.drag.currentX = pageX - this.drag.startX;
		this.drag.currentY = pageY - this.drag.startY;
		this.drag.distance = this.drag.currentX - this.drag.offsetX;

		// Check move direction
		if (this.drag.distance < 0) {
			this.state.direction = this.settings.rtl ? 'right' : 'left';
		} else if (this.drag.distance > 0) {
			this.state.direction = this.settings.rtl ? 'left' : 'right';
		}
		// Loop
		if (this.settings.loop) {
			if (this.op(this.drag.currentX, '>', this.coordinates(this.minimum())) && this.state.direction === 'right') {
				this.drag.currentX -= (this.settings.center && this.coordinates(0)) - this.coordinates(this._items.length);
			} else if (this.op(this.drag.currentX, '<', this.coordinates(this.maximum())) && this.state.direction === 'left') {
				this.drag.currentX += (this.settings.center && this.coordinates(0)) - this.coordinates(this._items.length);
			}
		} else {
			// pull
			minValue = this.settings.rtl ? this.coordinates(this.maximum()) : this.coordinates(this.minimum());
			maxValue = this.settings.rtl ? this.coordinates(this.minimum()) : this.coordinates(this.maximum());
			pull = this.settings.pullDrag ? this.drag.distance / 5 : 0;
			this.drag.currentX = Math.max(Math.min(this.drag.currentX, minValue + pull), maxValue + pull);
		}

		// Lock browser if swiping horizontal

		if ((this.drag.distance > 8 || this.drag.distance < -8)) {
			if (ev.preventDefault !== undefined) {
				ev.preventDefault();
			} else {
				ev.returnValue = false;
			}
			this.state.isSwiping = true;
		}

		this.drag.updatedX = this.drag.currentX;

		// Lock Owl if scrolling
		if ((this.drag.currentY > 16 || this.drag.currentY < -16) && this.state.isSwiping === false) {
			this.state.isScrolling = true;
			this.drag.updatedX = this.drag.start;
		}

		this.animate(this.drag.updatedX);
	};

	/**
	 * Handles the touchend/mouseup events.
	 * @protected
	 */
	Owl.prototype.onDragEnd = function(event) {
		var compareTimes, distanceAbs, closest;

		if (!this.state.isTouch) {
			return;
		}

		if (event.type === 'mouseup') {
			this.$stage.removeClass('carousel__grab');
		}

		this.trigger('dragged');

		// prevent links and images dragging;
		this.drag.targetEl.removeAttribute("draggable");

		// remove drag event listeners

		this.state.isTouch = false;
		this.state.isScrolling = false;
		this.state.isSwiping = false;

		// to check
		if (this.drag.distance === 0 && this.state.inMotion !== true) {
			this.state.inMotion = false;
			return false;
		}

		// prevent clicks while scrolling

		this.drag.endTime = new Date().getTime();
		compareTimes = this.drag.endTime - this.drag.startTime;
		distanceAbs = Math.abs(this.drag.distance);

		// to test
		if (distanceAbs > 3 || compareTimes > 300) {
			this.removeClick(this.drag.targetEl);
		}

		closest = this.closest(this.drag.updatedX);

		this.speed(this.settings.dragEndSpeed || this.settings.smartSpeed);
		this.current(closest);
		this.invalidate('position');
		this.update();

		// if pullDrag is off then fire transitionEnd event manually when stick
		// to border
		if (!this.settings.pullDrag && this.drag.updatedX === this.coordinates(closest)) {
			this.transitionEnd();
		}

		this.drag.distance = 0;

		$(document).off('.owl.dragEvents');
	};

	/**
	 * Attaches `preventClick` to disable link while swipping.
	 * @protected
	 * @param {HTMLElement} [target] - The target of the `click` event.
	 */
	Owl.prototype.removeClick = function(target) {
		this.drag.targetEl = target;
		$(target).on('click.preventClick', this.e._preventClick);
		// to make sure click is removed:
		window.setTimeout(function() {
			$(target).off('click.preventClick');
		}, 300);
	};

	/**
	 * Suppresses click event.
	 * @protected
	 * @param {Event} ev - The event arguments.
	 */
	Owl.prototype.preventClick = function(ev) {
		if (ev.preventDefault) {
			ev.preventDefault();
		} else {
			ev.returnValue = false;
		}
		if (ev.stopPropagation) {
			ev.stopPropagation();
		}
		$(ev.target).off('click.preventClick');
	};

	/**
	 * Catches stage position while animate (only CSS3).
	 * @protected
	 * @returns
	 */
	Owl.prototype.getTransformProperty = function() {
		var transform, matrix3d;

		transform = window.getComputedStyle(this.$stage.get(0), null).getPropertyValue(this.vendorName + 'transform');
		// var transform = this.$stage.css(this.vendorName + 'transform')
		transform = transform.replace(/matrix(3d)?\(|\)/g, '').split(',');
		matrix3d = transform.length === 16;

		return matrix3d !== true ? transform[4] : transform[12];
	};

	/**
	 * Gets absolute position of the closest item for a coordinate.
	 * @todo Setting `freeDrag` makes `closest` not reusable. See #165.
	 * @protected
	 * @param {Number} coordinate - The coordinate in pixel.
	 * @return {Number} - The absolute position of the closest item.
	 */
	Owl.prototype.closest = function(coordinate) {
		var position = -1, pull = 30, width = this.width(), coordinates = this.coordinates();

		if (!this.settings.freeDrag) {
			// check closest item
			$.each(coordinates, $.proxy(function(index, value) {
				if (coordinate > value - pull && coordinate < value + pull) {
					position = index;
				} else if (this.op(coordinate, '<', value)
					&& this.op(coordinate, '>', coordinates[index + 1] || value - width)) {
					position = this.state.direction === 'left' ? index + 1 : index;
				}
				return position === -1;
			}, this));
		}

		if (!this.settings.loop) {
			// non loop boundries
			if (this.op(coordinate, '>', coordinates[this.minimum()])) {
				position = coordinate = this.minimum();
			} else if (this.op(coordinate, '<', coordinates[this.maximum()])) {
				position = coordinate = this.maximum();
			}
		}

		return position;
	};

	/**
	 * Animates the stage.
	 * @public
	 * @param {Number} coordinate - The coordinate in pixels.
	 */
	Owl.prototype.animate = function(coordinate) {
		this.trigger('translate');
		this.state.inMotion = this.speed() > 0;

		if (this.support3d) {
			this.$stage.css({
				transform: 'translate3d(' + coordinate + 'px' + ',0px, 0px)',
				transition: (this.speed() / 1000) + 's'
			});
		} else if (this.state.isTouch) {
			this.$stage.css({
				left: coordinate + 'px'
			});
		} else {
			this.$stage.animate({
				left: coordinate
			}, this.speed() / 1000, this.settings.fallbackEasing, $.proxy(function() {
				if (this.state.inMotion) {
					this.transitionEnd();
				}
			}, this));
		}
	};

	/**
	 * Sets the absolute position of the current item.
	 * @public
	 * @param {Number} [position] - The new absolute position or nothing to leave it unchanged.
	 * @returns {Number} - The absolute position of the current item.
	 */
	Owl.prototype.current = function(position) {
		if (position === undefined) {
			return this._current;
		}

		if (this._items.length === 0) {
			return undefined;
		}

		position = this.normalize(position);

		if (this._current !== position) {
			var event = this.trigger('change', { property: { name: 'position', value: position } });

			if (event.data !== undefined) {
				position = this.normalize(event.data);
			}

			this._current = position;

			this.invalidate('position');

			this.trigger('changed', { property: { name: 'position', value: this._current } });
		}

		return this._current;
	};

	/**
	 * Invalidates the given part of the update routine.
	 * @param {String} part - The part to invalidate.
	 */
	Owl.prototype.invalidate = function(part) {
		this._invalidated[part] = true;
	}

	/**
	 * Resets the absolute position of the current item.
	 * @public
	 * @param {Number} position - The absolute position of the new item.
	 */
	Owl.prototype.reset = function(position) {
		position = this.normalize(position);

		if (position === undefined) {
			return;
		}

		this._speed = 0;
		this._current = position;

		this.suppress([ 'translate', 'translated' ]);

		this.animate(this.coordinates(position));

		this.release([ 'translate', 'translated' ]);
	};

	/**
	 * Normalizes an absolute or a relative position for an item.
	 * @public
	 * @param {Number} position - The absolute or relative position to normalize.
	 * @param {Boolean} [relative=false] - Whether the given position is relative or not.
	 * @returns {Number} - The normalized position.
	 */
	Owl.prototype.normalize = function(position, relative) {
		var n = (relative ? this._items.length : this._items.length + this._clones.length);

		if (!$.isNumeric(position) || n < 1) {
			return undefined;
		}

		if (this._clones.length) {
			position = ((position % n) + n) % n;
		} else {
			position = Math.max(this.minimum(relative), Math.min(this.maximum(relative), position));
		}

		return position;
	};

	/**
	 * Converts an absolute position for an item into a relative position.
	 * @public
	 * @param {Number} position - The absolute position to convert.
	 * @returns {Number} - The converted position.
	 */
	Owl.prototype.relative = function(position) {
		position = this.normalize(position);
		position = position - this._clones.length / 2;
		return this.normalize(position, true);
	};

	/**
	 * Gets the maximum position for an item.
	 * @public
	 * @param {Boolean} [relative=false] - Whether to return an absolute position or a relative position.
	 * @returns {Number}
	 */
	Owl.prototype.maximum = function(relative) {
		var maximum, width, i = 0, coordinate,
			settings = this.settings;

		if (relative) {
			return this._items.length - 1;
		}

		if (!settings.loop && settings.center) {
			maximum = this._items.length - 1;
		} else if (!settings.loop && !settings.center) {
			maximum = this._items.length - settings.items;
		} else if (settings.loop || settings.center) {
			maximum = this._items.length + settings.items;
		} else if (settings.autoWidth || settings.merge) {
			revert = settings.rtl ? 1 : -1;
			width = this.$stage.width() - this.$element.width();
			while (coordinate = this.coordinates(i)) {
				if (coordinate * revert >= width) {
					break;
				}
				maximum = ++i;
			}
		} else {
			throw 'Can not detect maximum absolute position.'
		}

		return maximum;
	};

	/**
	 * Gets the minimum position for an item.
	 * @public
	 * @param {Boolean} [relative=false] - Whether to return an absolute position or a relative position.
	 * @returns {Number}
	 */
	Owl.prototype.minimum = function(relative) {
		if (relative) {
			return 0;
		}

		return this._clones.length / 2;
	};

	/**
	 * Gets an item at the specified relative position.
	 * @public
	 * @param {Number} [position] - The relative position of the item.
	 * @return {jQuery|Array.<jQuery>} - The item at the given position or all items if no position was given.
	 */
	Owl.prototype.items = function(position) {
		if (position === undefined) {
			return this._items.slice();
		}

		position = this.normalize(position, true);
		return this._items[position];
	};

	/**
	 * Gets an item at the specified relative position.
	 * @public
	 * @param {Number} [position] - The relative position of the item.
	 * @return {jQuery|Array.<jQuery>} - The item at the given position or all items if no position was given.
	 */
	Owl.prototype.mergers = function(position) {
		if (position === undefined) {
			return this._mergers.slice();
		}

		position = this.normalize(position, true);
		return this._mergers[position];
	};

	/**
	 * Gets the absolute positions of clones for an item.
	 * @public
	 * @param {Number} [position] - The relative position of the item.
	 * @returns {Array.<Number>} - The absolute positions of clones for the item or all if no position was given.
	 */
	Owl.prototype.clones = function(position) {
		var odd = this._clones.length / 2,
			even = odd + this._items.length,
			map = function(index) { return index % 2 === 0 ? even + index / 2 : odd - (index + 1) / 2 };

		if (position === undefined) {
			return $.map(this._clones, function(v, i) { return map(i) });
		}

		return $.map(this._clones, function(v, i) { return v === position ? map(i) : null });
	};

	/**
	 * Sets the current animation speed.
	 * @public
	 * @param {Number} [speed] - The animation speed in milliseconds or nothing to leave it unchanged.
	 * @returns {Number} - The current animation speed in milliseconds.
	 */
	Owl.prototype.speed = function(speed) {
		if (speed !== undefined) {
			this._speed = speed;
		}

		return this._speed;
	};

	/**
	 * Gets the coordinate of an item.
	 * @todo The name of this method is missleanding.
	 * @public
	 * @param {Number} position - The absolute position of the item within `minimum()` and `maximum()`.
	 * @returns {Number|Array.<Number>} - The coordinate of the item in pixel or all coordinates.
	 */
	Owl.prototype.coordinates = function(position) {
		var coordinate = null;

		if (position === undefined) {
			return $.map(this._coordinates, $.proxy(function(coordinate, index) {
				return this.coordinates(index);
			}, this));
		}

		if (this.settings.center) {
			coordinate = this._coordinates[position];
			coordinate += (this.width() - coordinate + (this._coordinates[position - 1] || 0)) / 2 * (this.settings.rtl ? -1 : 1);
		} else {
			coordinate = this._coordinates[position - 1] || 0;
		}

		return coordinate;
	};

	/**
	 * Calculates the speed for a translation.
	 * @protected
	 * @param {Number} from - The absolute position of the start item.
	 * @param {Number} to - The absolute position of the target item.
	 * @param {Number} [factor=undefined] - The time factor in milliseconds.
	 * @returns {Number} - The time in milliseconds for the translation.
	 */
	Owl.prototype.duration = function(from, to, factor) {
		return Math.min(Math.max(Math.abs(to - from), 1), 6) * Math.abs((factor || this.settings.smartSpeed));
	};

	/**
	 * Slides to the specified item.
	 * @public
	 * @param {Number} position - The position of the item.
	 * @param {Number} [speed] - The time in milliseconds for the transition.
	 */
	Owl.prototype.to = function(position, speed) {
		if (this.settings.loop) {
			var distance = position - this.relative(this.current()),
				revert = this.current(),
				before = this.current(),
				after = this.current() + distance,
				direction = before - after < 0 ? true : false,
				items = this._clones.length + this._items.length;

			if (after < this.settings.items && direction === false) {
				revert = before + this._items.length;
				this.reset(revert);
			} else if (after >= items - this.settings.items && direction === true) {
				revert = before - this._items.length;
				this.reset(revert);
			}
			window.clearTimeout(this.e._goToLoop);
			this.e._goToLoop = window.setTimeout($.proxy(function() {
				this.speed(this.duration(this.current(), revert + distance, speed));
				this.current(revert + distance);
				this.update();
			}, this), 30);
		} else {
			this.speed(this.duration(this.current(), position, speed));
			this.current(position);
			this.update();
		}
	};

	/**
	 * Slides to the next item.
	 * @public
	 * @param {Number} [speed] - The time in milliseconds for the transition.
	 */
	Owl.prototype.next = function(speed) {
		speed = speed || false;
		this.to(this.relative(this.current()) + 1, speed);
	};

	/**
	 * Slides to the previous item.
	 * @public
	 * @param {Number} [speed] - The time in milliseconds for the transition.
	 */
	Owl.prototype.prev = function(speed) {
		speed = speed || false;
		this.to(this.relative(this.current()) - 1, speed);
	};

	/**
	 * Handles the end of an animation.
	 * @protected
	 * @param {Event} event - The event arguments.
	 */
	Owl.prototype.transitionEnd = function(event) {

		// if css2 animation then event object is undefined
		if (event !== undefined) {
			event.stopPropagation();

			// Catch only carousel__stage transitionEnd event
			if ((event.target || event.srcElement || event.originalTarget) !== this.$stage.get(0)) {
				return false;
			}
		}

		this.state.inMotion = false;
		this.trigger('translated');
	};

	/**
	 * Gets viewport width.
	 * @protected
	 * @return {Number} - The width in pixel.
	 */
	Owl.prototype.viewport = function() {
		var width;
		if (this.options.responsiveBaseElement !== window) {
			width = $(this.options.responsiveBaseElement).width();
		} else if (window.innerWidth) {
			width = window.innerWidth;
		} else if (document.documentElement && document.documentElement.clientWidth) {
			width = document.documentElement.clientWidth;
		} else {
			throw 'Can not detect viewport width.';
		}
		return width;
	};

	/**
	 * Replaces the current content.
	 * @public
	 * @param {HTMLElement|jQuery|String} content - The new content.
	 */
	Owl.prototype.replace = function(content) {
		this.$stage.empty();
		this._items = [];

		if (content) {
			content = (content instanceof jQuery) ? content : $(content);
		}

		if (this.settings.nestedItemSelector) {
			content = content.find('.' + this.settings.nestedItemSelector);
		}

		content.filter(function() {
			return this.nodeType === 1;
		}).each($.proxy(function(index, item) {
			item = this.prepare(item);
			this.$stage.append(item);
			this._items.push(item);
			this._mergers.push(item.find('[data-merge]').andSelf('[data-merge]').attr('data-merge') * 1 || 1);
		}, this));

		this.reset($.isNumeric(this.settings.startPosition) ? this.settings.startPosition : 0);

		this.invalidate('items');
	};

	/**
	 * Adds an item.
	 * @todo Use `item` instead of `content` for the event arguments.
	 * @public
	 * @param {HTMLElement|jQuery|String} content - The item content to add.
	 * @param {Number} [position] - The relative position at which to insert the item otherwise the item will be added to the end.
	 */
	Owl.prototype.add = function(content, position) {
		position = position === undefined ? this._items.length : this.normalize(position, true);

		this.trigger('add', { content: content, position: position });

		if (this._items.length === 0 || position === this._items.length) {
			this.$stage.append(content);
			this._items.push(content);
			this._mergers.push(content.find('[data-merge]').andSelf('[data-merge]').attr('data-merge') * 1 || 1);
		} else {
			this._items[position].before(content);
			this._items.splice(position, 0, content);
			this._mergers.splice(position, 0, content.find('[data-merge]').andSelf('[data-merge]').attr('data-merge') * 1 || 1);
		}

		this.invalidate('items');

		this.trigger('added', { content: content, position: position });
	};

	/**
	 * Removes an item by its position.
	 * @todo Use `item` instead of `content` for the event arguments.
	 * @public
	 * @param {Number} position - The relative position of the item to remove.
	 */
	Owl.prototype.remove = function(position) {
		position = this.normalize(position, true);

		if (position === undefined) {
			return;
		}

		this.trigger('remove', { content: this._items[position], position: position });

		this._items[position].remove();
		this._items.splice(position, 1);
		this._mergers.splice(position, 1);

		this.invalidate('items');

		this.trigger('removed', { content: null, position: position });
	};

	/**
	 * Adds triggerable events.
	 * @protected
	 */
	Owl.prototype.addTriggerableEvents = function() {
		var handler = $.proxy(function(callback, event) {
			return $.proxy(function(e) {
				if (e.relatedTarget !== this) {
					this.suppress([ event ]);
					callback.apply(this, [].slice.call(arguments, 1));
					this.release([ event ]);
				}
			}, this);
		}, this);

		$.each({
			'next': this.next,
			'prev': this.prev,
			'to': this.to,
			'destroy': this.destroy,
			'refresh': this.refresh,
			'replace': this.replace,
			'add': this.add,
			'remove': this.remove
		}, $.proxy(function(event, callback) {
			this.$element.on(event + '.owl.carousel', handler(callback, event + '.owl.carousel'));
		}, this));

	};

	/**
	 * Watches the visibility of the carousel element.
	 * @protected
	 */
	Owl.prototype.watchVisibility = function() {

		// test on zepto
		if (!isElVisible(this.$element.get(0))) {
			this.$element.addClass('carousel__hidden');
			window.clearInterval(this.e._checkVisibile);
			this.e._checkVisibile = window.setInterval($.proxy(checkVisible, this), 500);
		}

		function isElVisible(el) {
			return el.offsetWidth > 0 && el.offsetHeight > 0;
		}

		function checkVisible() {
			if (isElVisible(this.$element.get(0))) {
				this.$element.removeClass('carousel__hidden');
				this.refresh();
				window.clearInterval(this.e._checkVisibile);
			}
		}
	};

	/**
	 * Preloads images with auto width.
	 * @protected
	 * @todo Still to test
	 */
	Owl.prototype.preloadAutoWidthImages = function(imgs) {
		var loaded, that, $el, img;

		loaded = 0;
		that = this;
		imgs.each(function(i, el) {
			$el = $(el);
			img = new Image();

			img.onload = function() {
				loaded++;
				$el.attr('src', img.src);
				$el.css('opacity', 1);
				if (loaded >= imgs.length) {
					that.state.imagesLoaded = true;
					that.initialize();
				}
			};

			img.src = $el.attr('src') || $el.attr('data-src') || $el.attr('data-src-retina');
		});
	};

	/**
	 * Destroys the carousel.
	 * @public
	 */
	Owl.prototype.destroy = function() {

		if (this.$element.hasClass(this.settings.themeClass)) {
			this.$element.removeClass(this.settings.themeClass);
		}

		if (this.settings.responsive !== false) {
			$(window).off('resize.owl.carousel');
		}

		if (this.transitionEndVendor) {
			this.off(this.$stage.get(0), this.transitionEndVendor, this.e._transitionEnd);
		}

		for ( var i in this._plugins) {
			this._plugins[i].destroy();
		}

		if (this.settings.mouseDrag || this.settings.touchDrag) {
			this.$stage.off('mousedown touchstart touchcancel');
			$(document).off('.owl.dragEvents');
			this.$stage.get(0).onselectstart = function() {};
			this.$stage.off('dragstart', function() { return false });
		}

		// remove event handlers in the ".owl.carousel" namespace
		this.$element.off('.owl');

		this.$stage.children('.cloned').remove();
		this.e = null;
		this.$element.removeData('owlCarousel');

		this.$stage.children().contents().unwrap();
		this.$stage.children().unwrap();
		this.$stage.unwrap();
	};

	/**
	 * Operators to calculate right-to-left and left-to-right.
	 * @protected
	 * @param {Number} [a] - The left side operand.
	 * @param {String} [o] - The operator.
	 * @param {Number} [b] - The right side operand.
	 */
	Owl.prototype.op = function(a, o, b) {
		var rtl = this.settings.rtl;
		switch (o) {
			case '<':
				return rtl ? a > b : a < b;
			case '>':
				return rtl ? a < b : a > b;
			case '>=':
				return rtl ? a <= b : a >= b;
			case '<=':
				return rtl ? a >= b : a <= b;
			default:
				break;
		}
	};

	/**
	 * Attaches to an internal event.
	 * @protected
	 * @param {HTMLElement} element - The event source.
	 * @param {String} event - The event name.
	 * @param {Function} listener - The event handler to attach.
	 * @param {Boolean} capture - Wether the event should be handled at the capturing phase or not.
	 */
	Owl.prototype.on = function(element, event, listener, capture) {
		if (element.addEventListener) {
			element.addEventListener(event, listener, capture);
		} else if (element.attachEvent) {
			element.attachEvent('on' + event, listener);
		}
	};

	/**
	 * Detaches from an internal event.
	 * @protected
	 * @param {HTMLElement} element - The event source.
	 * @param {String} event - The event name.
	 * @param {Function} listener - The attached event handler to detach.
	 * @param {Boolean} capture - Wether the attached event handler was registered as a capturing listener or not.
	 */
	Owl.prototype.off = function(element, event, listener, capture) {
		if (element.removeEventListener) {
			element.removeEventListener(event, listener, capture);
		} else if (element.detachEvent) {
			element.detachEvent('on' + event, listener);
		}
	};

	/**
	 * Triggers an public event.
	 * @protected
	 * @param {String} name - The event name.
	 * @param {*} [data=null] - The event data.
	 * @param {String} [namespace=.owl.carousel] - The event namespace.
	 * @returns {Event} - The event arguments.
	 */
	Owl.prototype.trigger = function(name, data, namespace) {
		var status = {
			item: { count: this._items.length, index: this.current() }
		}, handler = $.camelCase(
			$.grep([ 'on', name, namespace ], function(v) { return v })
				.join('-').toLowerCase()
		), event = $.Event(
			[ name, 'owl', namespace || 'carousel' ].join('.').toLowerCase(),
			$.extend({ relatedTarget: this }, status, data)
		);

		if (!this._supress[name]) {
			$.each(this._plugins, function(name, plugin) {
				if (plugin.onTrigger) {
					plugin.onTrigger(event);
				}
			});

			this.$element.trigger(event);

			if (this.settings && typeof this.settings[handler] === 'function') {
				this.settings[handler].apply(this, event);
			}
		}

		return event;
	};

	/**
	 * Suppresses events.
	 * @protected
	 * @param {Array.<String>} events - The events to suppress.
	 */
	Owl.prototype.suppress = function(events) {
		$.each(events, $.proxy(function(index, event) {
			this._supress[event] = true;
		}, this));
	}

	/**
	 * Releases suppressed events.
	 * @protected
	 * @param {Array.<String>} events - The events to release.
	 */
	Owl.prototype.release = function(events) {
		$.each(events, $.proxy(function(index, event) {
			delete this._supress[event];
		}, this));
	}

	/**
	 * Checks the availability of some browser features.
	 * @protected
	 */
	Owl.prototype.browserSupport = function() {
		this.support3d = isPerspective();

		if (this.support3d) {
			this.transformVendor = isTransform();

			// take transitionend event name by detecting transition
			var endVendors = [ 'transitionend', 'webkitTransitionEnd', 'transitionend', 'oTransitionEnd' ];
			this.transitionEndVendor = endVendors[isTransition()];

			// take vendor name from transform name
			this.vendorName = this.transformVendor.replace(/Transform/i, '');
			this.vendorName = this.vendorName !== '' ? '-' + this.vendorName.toLowerCase() + '-' : '';
		}

		this.state.orientation = window.orientation;
	};

	/**
	 * Get touch/drag coordinats.
	 * @private
	 * @param {event} - mousedown/touchstart event
	 * @returns {object} - Contains X and Y of current mouse/touch position
	 */

	function getTouches(event) {
		if (event.touches !== undefined) {
			return {
				x: event.touches[0].pageX,
				y: event.touches[0].pageY
			};
		}

		if (event.touches === undefined) {
			if (event.pageX !== undefined) {
				return {
					x: event.pageX,
					y: event.pageY
				};
			}

		if (event.pageX === undefined) {
			return {
					x: event.clientX,
					y: event.clientY
				};
			}
		}
	}

	/**
	 * Checks for CSS support.
	 * @private
	 * @param {Array} array - The CSS properties to check for.
	 * @returns {Array} - Contains the supported CSS property name and its index or `false`.
	 */
	function isStyleSupported(array) {
		var p, s, fake = document.createElement('div'), list = array;
		for (p in list) {
			s = list[p];
			if (typeof fake.style[s] !== 'undefined') {
				fake = null;
				return [ s, p ];
			}
		}
		return [ false ];
	}

	/**
	 * Checks for CSS transition support.
	 * @private
	 * @todo Realy bad design
	 * @returns {Number}
	 */
	function isTransition() {
		return isStyleSupported([ 'transition', 'WebkitTransition', 'MozTransition', 'OTransition' ])[1];
	}

	/**
	 * Checks for CSS transform support.
	 * @private
	 * @returns {String} The supported property name or false.
	 */
	function isTransform() {
		return isStyleSupported([ 'transform', 'WebkitTransform', 'MozTransform', 'OTransform', 'msTransform' ])[0];
	}

	/**
	 * Checks for CSS perspective support.
	 * @private
	 * @returns {String} The supported property name or false.
	 */
	function isPerspective() {
		return isStyleSupported([ 'perspective', 'webkitPerspective', 'MozPerspective', 'OPerspective', 'MsPerspective' ])[0];
	}

	/**
	 * Checks wether touch is supported or not.
	 * @private
	 * @returns {Boolean}
	 */
	function isTouchSupport() {
		return 'ontouchstart' in window || !!(navigator.msMaxTouchPoints);
	}

	/**
	 * Checks wether touch is supported or not for IE.
	 * @private
	 * @returns {Boolean}
	 */
	function isTouchSupportIE() {
		return window.navigator.msPointerEnabled;
	}

	/**
	 * The jQuery Plugin for the Owl Carousel
	 * @public
	 */
	$.fn.owlCarousel = function(options) {
		return this.each(function() {
			if (!$(this).data('owlCarousel')) {
				$(this).data('owlCarousel', new Owl(this, options));
			}
		});
	};

	/**
	 * The constructor for the jQuery Plugin
	 * @public
	 */
	$.fn.owlCarousel.Constructor = Owl;

})(window.Zepto || window.jQuery, window, document);

/**
 * Lazy Plugin
 * @version 2.0.0
 * @author Bartosz Wojciechowski
 * @license The MIT License (MIT)
 */
;(function($, window, document, undefined) {

	/**
	 * Creates the lazy plugin.
	 * @class The Lazy Plugin
	 * @param {Owl} carousel - The Owl Carousel
	 */
	var Lazy = function(carousel) {

		/**
		 * Reference to the core.
		 * @protected
		 * @type {Owl}
		 */
		this._core = carousel;

		/**
		 * Already loaded items.
		 * @protected
		 * @type {Array.<jQuery>}
		 */
		this._loaded = [];

		/**
		 * Event handlers.
		 * @protected
		 * @type {Object}
		 */
		this._handlers = {
			'initialized.owl.carousel change.owl.carousel': $.proxy(function(e) {
				if (!e.namespace) {
					return;
				}

				if (!this._core.settings || !this._core.settings.lazyLoad) {
					return;
				}

				if ((e.property && e.property.name == 'position') || e.type == 'initialized') {
					var settings = this._core.settings,
						n = (settings.center && Math.ceil(settings.items / 2) || settings.items),
						i = ((settings.center && n * -1) || 0),
						position = ((e.property && e.property.value) || this._core.current()) + i,
						clones = this._core.clones().length,
						load = $.proxy(function(i, v) { this.load(v) }, this);

					while (i++ < n) {
						this.load(clones / 2 + this._core.relative(position));
						clones && $.each(this._core.clones(this._core.relative(position++)), load);
					}
				}
			}, this)
		};

		// set the default options
		this._core.options = $.extend({}, Lazy.Defaults, this._core.options);

		// register event handler
		this._core.$element.on(this._handlers);
	}

	/**
	 * Default options.
	 * @public
	 */
	Lazy.Defaults = {
		lazyLoad: false
	}

	/**
	 * Loads all resources of an item at the specified position.
	 * @param {Number} position - The absolute position of the item.
	 * @protected
	 */
	Lazy.prototype.load = function(position) {
		var $item = this._core.$stage.children().eq(position),
			$elements = $item && $item.find('.owl-lazy');

		if (!$elements || $.inArray($item.get(0), this._loaded) > -1) {
			return;
		}

		$elements.each($.proxy(function(index, element) {
			var $element = $(element), image,
				url = (window.devicePixelRatio > 1 && $element.attr('data-src-retina')) || $element.attr('data-src');

			this._core.trigger('load', { element: $element, url: url }, 'lazy');

			if ($element.is('img')) {
				$element.one('load.owl.lazy', $.proxy(function() {
					$element.css('opacity', 1);
					this._core.trigger('loaded', { element: $element, url: url }, 'lazy');
				}, this)).attr('src', url);
			} else {
				image = new Image();
				image.onload = $.proxy(function() {
					$element.css({
						'background-image': 'url(' + url + ')',
						'opacity': '1'
					});
					this._core.trigger('loaded', { element: $element, url: url }, 'lazy');
				}, this);
				image.src = url;
			}
		}, this));

		this._loaded.push($item.get(0));
	}

	/**
	 * Destroys the plugin.
	 * @public
	 */
	Lazy.prototype.destroy = function() {
		var handler, property;

		for (handler in this.handlers) {
			this._core.$element.off(handler, this.handlers[handler]);
		}
		for (property in Object.getOwnPropertyNames(this)) {
			typeof this[property] != 'function' && (this[property] = null);
		}
	}

	$.fn.owlCarousel.Constructor.Plugins.Lazy = Lazy;

})(window.Zepto || window.jQuery, window, document);

/**
 * AutoHeight Plugin
 * @version 2.0.0
 * @author Bartosz Wojciechowski
 * @license The MIT License (MIT)
 */
;(function($, window, document, undefined) {

	/**
	 * Creates the auto height plugin.
	 * @class The Auto Height Plugin
	 * @param {Owl} carousel - The Owl Carousel
	 */
	var AutoHeight = function(carousel) {
		/**
		 * Reference to the core.
		 * @protected
		 * @type {Owl}
		 */
		this._core = carousel;

		/**
		 * All event handlers.
		 * @protected
		 * @type {Object}
		 */
		this._handlers = {
			'initialized.owl.carousel': $.proxy(function() {
				if (this._core.settings.autoHeight) {
					this.update();
				}
			}, this),
			'changed.owl.carousel': $.proxy(function(e) {
				if (this._core.settings.autoHeight && e.property.name == 'position'){
					this.update();
				}
			}, this),
			'loaded.owl.lazy': $.proxy(function(e) {
				if (this._core.settings.autoHeight && e.element.closest('.' + this._core.settings.itemClass)
					=== this._core.$stage.children().eq(this._core.current())) {
					this.update();
				}
			}, this)
		};

		// set default options
		this._core.options = $.extend({}, AutoHeight.Defaults, this._core.options);

		// register event handlers
		this._core.$element.on(this._handlers);
	};

	/**
	 * Default options.
	 * @public
	 */
	AutoHeight.Defaults = {
		autoHeight: false,
		autoHeightClass: 'owl-height'
	};

	/**
	 * Updates the view.
	 */
	AutoHeight.prototype.update = function() {
		this._core.$stage.parent()
			.height(this._core.$stage.children().eq(this._core.current()).height())
			.addClass(this._core.settings.autoHeightClass);
	};

	AutoHeight.prototype.destroy = function() {
		var handler, property;

		for (handler in this._handlers) {
			this._core.$element.off(handler, this._handlers[handler]);
		}
		for (property in Object.getOwnPropertyNames(this)) {
			typeof this[property] != 'function' && (this[property] = null);
		}
	};

	$.fn.owlCarousel.Constructor.Plugins.AutoHeight = AutoHeight;

})(window.Zepto || window.jQuery, window, document);

/**
 * Video Plugin
 * @version 2.0.0
 * @author Bartosz Wojciechowski
 * @license The MIT License (MIT)
 */
;(function($, window, document, undefined) {

	/**
	 * Creates the video plugin.
	 * @class The Video Plugin
	 * @param {Owl} carousel - The Owl Carousel
	 */
	var Video = function(carousel) {
		/**
		 * Reference to the core.
		 * @protected
		 * @type {Owl}
		 */
		this._core = carousel;

		/**
		 * Cache all video URLs.
		 * @protected
		 * @type {Object}
		 */
		this._videos = {};

		/**
		 * Current playing item.
		 * @protected
		 * @type {jQuery}
		 */
		this._playing = null;

		/**
		 * Whether this is in fullscreen or not.
		 * @protected
		 * @type {Boolean}
		 */
		this._fullscreen = false;

		/**
		 * All event handlers.
		 * @protected
		 * @type {Object}
		 */
		this._handlers = {
			'resize.owl.carousel': $.proxy(function(e) {
				if (this._core.settings.video && !this.isInFullScreen()) {
					e.preventDefault();
				}
			}, this),
			'refresh.owl.carousel changed.owl.carousel': $.proxy(function(e) {
				if (this._playing) {
					this.stop();
				}
			}, this),
			'prepared.owl.carousel': $.proxy(function(e) {
				var $element = $(e.content).find('.owl-video');
				if ($element.length) {
					$element.css('display', 'none');
					this.fetch($element, $(e.content));
				}
			}, this)
		};

		// set default options
		this._core.options = $.extend({}, Video.Defaults, this._core.options);

		// register event handlers
		this._core.$element.on(this._handlers);

		this._core.$element.on('click.owl.video', '.owl-video-play-icon', $.proxy(function(e) {
			this.play(e);
		}, this));
	};

	/**
	 * Default options.
	 * @public
	 */
	Video.Defaults = {
		video: false,
		videoHeight: false,
		videoWidth: false
	};

	/**
	 * Gets the video ID and the type (YouTube/Vimeo only).
	 * @protected
	 * @param {jQuery} target - The target containing the video data.
	 * @param {jQuery} item - The item containing the video.
	 */
	Video.prototype.fetch = function(target, item) {

		var type = target.attr('data-vimeo-id') ? 'vimeo' : 'youtube',
			id = target.attr('data-vimeo-id') || target.attr('data-youtube-id'),
			width = target.attr('data-width') || this._core.settings.videoWidth,
			height = target.attr('data-height') || this._core.settings.videoHeight,
			url = target.attr('href');

		if (url) {
			id = url.match(/(http:|https:|)\/\/(player.|www.)?(vimeo\.com|youtu(be\.com|\.be|be\.googleapis\.com))\/(video\/|embed\/|watch\?v=|v\/)?([A-Za-z0-9._%-]*)(\&\S+)?/);

			if (id[3].indexOf('youtu') > -1) {
				type = 'youtube';
			} else if (id[3].indexOf('vimeo') > -1) {
				type = 'vimeo';
			} else {
				throw new Error('Video URL not supported.');
			}
			id = id[6];
		} else {
			throw new Error('Missing video URL.');
		}

		this._videos[url] = {
			type: type,
			id: id,
			width: width,
			height: height
		};

		item.attr('data-video', url);

		this.thumbnail(target, this._videos[url]);
	};

	/**
	 * Creates video thumbnail.
	 * @protected
	 * @param {jQuery} target - The target containing the video data.
	 * @param {Object} info - The video info object.
	 * @see `fetch`
	 */
	Video.prototype.thumbnail = function(target, video) {

		var tnLink,
			icon,
			path,
			dimensions = video.width && video.height ? 'style="width:' + video.width + 'px;height:' + video.height + 'px;"' : '',
			customTn = target.find('img'),
			srcType = 'src',
			lazyClass = '',
			settings = this._core.settings,
			create = function(path) {
				icon = '<div class="owl-video-play-icon"></div>';

				if (settings.lazyLoad) {
					tnLink = '<div class="owl-video-tn ' + lazyClass + '" ' + srcType + '="' + path + '"></div>';
				} else {
					tnLink = '<div class="owl-video-tn" style="opacity:1;background-image:url(' + path + ')"></div>';
				}
				target.after(tnLink);
				target.after(icon);
			};

		// wrap video content into owl-video-wrapper div
		target.wrap('<div class="owl-video-wrapper"' + dimensions + '></div>');

		if (this._core.settings.lazyLoad) {
			srcType = 'data-src';
			lazyClass = 'owl-lazy';
		}

		// custom thumbnail
		if (customTn.length) {
			create(customTn.attr(srcType));
			customTn.remove();
			return false;
		}

		if (video.type === 'youtube') {
			path = "http://img.youtube.com/vi/" + video.id + "/hqdefault.jpg";
			create(path);
		} else if (video.type === 'vimeo') {
			$.ajax({
				type: 'GET',
				url: 'http://vimeo.com/api/v2/video/' + video.id + '.json',
				jsonp: 'callback',
				dataType: 'jsonp',
				success: function(data) {
					path = data[0].thumbnail_large;
					create(path);
				}
			});
		}
	};

	/**
	 * Stops the current video.
	 * @public
	 */
	Video.prototype.stop = function() {
		this._core.trigger('stop', null, 'video');
		this._playing.find('.owl-video-frame').remove();
		this._playing.removeClass('owl-video-playing');
		this._playing = null;
	};

	/**
	 * Starts the current video.
	 * @public
	 * @param {Event} ev - The event arguments.
	 */
	Video.prototype.play = function(ev) {
		this._core.trigger('play', null, 'video');

		if (this._playing) {
			this.stop();
		}

		var target = $(ev.target || ev.srcElement),
			item = target.closest('.' + this._core.settings.itemClass),
			video = this._videos[item.attr('data-video')],
			width = video.width || '100%',
			height = video.height || this._core.$stage.height(),
			html, wrap;

		if (video.type === 'youtube') {
			html = '<iframe width="' + width + '" height="' + height + '" src="http://www.youtube.com/embed/'
				+ video.id + '?autoplay=1&v=' + video.id + '" frameborder="0" allowfullscreen></iframe>';
		} else if (video.type === 'vimeo') {
			html = '<iframe src="http://player.vimeo.com/video/' + video.id + '?autoplay=1" width="' + width
				+ '" height="' + height
				+ '" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>';
		}

		item.addClass('owl-video-playing');
		this._playing = item;

		wrap = $('<div style="height:' + height + 'px; width:' + width + 'px" class="owl-video-frame">'
			+ html + '</div>');
		target.after(wrap);
	};

	/**
	 * Checks whether an video is currently in full screen mode or not.
	 * @todo Bad style because looks like a readonly method but changes members.
	 * @protected
	 * @returns {Boolean}
	 */
	Video.prototype.isInFullScreen = function() {

		// if Vimeo Fullscreen mode
		var element = document.fullscreenElement || document.mozFullScreenElement
			|| document.webkitFullscreenElement;

		if (element && $(element).parent().hasClass('owl-video-frame')) {
			this._core.speed(0);
			this._fullscreen = true;
		}

		if (element && this._fullscreen && this._playing) {
			return false;
		}

		// comming back from fullscreen
		if (this._fullscreen) {
			this._fullscreen = false;
			return false;
		}

		// check full screen mode and window orientation
		if (this._playing) {
			if (this._core.state.orientation !== window.orientation) {
				this._core.state.orientation = window.orientation;
				return false;
			}
		}

		return true;
	};

	/**
	 * Destroys the plugin.
	 */
	Video.prototype.destroy = function() {
		var handler, property;

		this._core.$element.off('click.owl.video');

		for (handler in this._handlers) {
			this._core.$element.off(handler, this._handlers[handler]);
		}
		for (property in Object.getOwnPropertyNames(this)) {
			typeof this[property] != 'function' && (this[property] = null);
		}
	};

	$.fn.owlCarousel.Constructor.Plugins.Video = Video;

})(window.Zepto || window.jQuery, window, document);

/**
 * Animate Plugin
 * @version 2.0.0
 * @author Bartosz Wojciechowski
 * @license The MIT License (MIT)
 */
;(function($, window, document, undefined) {

	/**
	 * Creates the animate plugin.
	 * @class The Navigation Plugin
	 * @param {Owl} scope - The Owl Carousel
	 */
	var Animate = function(scope) {
		this.core = scope;
		this.core.options = $.extend({}, Animate.Defaults, this.core.options);
		this.swapping = true;
		this.previous = undefined;
		this.next = undefined;

		this.handlers = {
			'change.owl.carousel': $.proxy(function(e) {
				if (e.property.name == 'position') {
					this.previous = this.core.current();
					this.next = e.property.value;
				}
			}, this),
			'drag.owl.carousel dragged.owl.carousel translated.owl.carousel': $.proxy(function(e) {
				this.swapping = e.type == 'translated';
			}, this),
			'translate.owl.carousel': $.proxy(function(e) {
				if (this.swapping && (this.core.options.animateOut || this.core.options.animateIn)) {
					this.swap();
				}
			}, this)
		};

		this.core.$element.on(this.handlers);
	};

	/**
	 * Default options.
	 * @public
	 */
	Animate.Defaults = {
		animateOut: false,
		animateIn: false
	};

	/**
	 * Toggles the animation classes whenever an translations starts.
	 * @protected
	 * @returns {Boolean|undefined}
	 */
	Animate.prototype.swap = function() {

		if (this.core.settings.items !== 1 || !this.core.support3d) {
			return;
		}

		this.core.speed(0);

		var left,
			clear = $.proxy(this.clear, this),
			previous = this.core.$stage.children().eq(this.previous),
			next = this.core.$stage.children().eq(this.next),
			incoming = this.core.settings.animateIn,
			outgoing = this.core.settings.animateOut;

		if (this.core.current() === this.previous) {
			return;
		}

		if (outgoing) {
			left = this.core.coordinates(this.previous) - this.core.coordinates(this.next);
			previous.css( { 'left': left + 'px' } )
				.addClass('animated owl-animated-out')
				.addClass(outgoing)
				.one('webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend', clear);
		}

		if (incoming) {
			next.addClass('animated owl-animated-in')
				.addClass(incoming)
				.one('webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend', clear);
		}
	};

	Animate.prototype.clear = function(e) {
		$(e.target).css( { 'left': '' } )
			.removeClass('animated owl-animated-out owl-animated-in')
			.removeClass(this.core.settings.animateIn)
			.removeClass(this.core.settings.animateOut);
		this.core.transitionEnd();
	}

	/**
	 * Destroys the plugin.
	 * @public
	 */
	Animate.prototype.destroy = function() {
		var handler, property;

		for (handler in this.handlers) {
			this.core.$element.off(handler, this.handlers[handler]);
		}
		for (property in Object.getOwnPropertyNames(this)) {
			typeof this[property] != 'function' && (this[property] = null);
		}
	};

	$.fn.owlCarousel.Constructor.Plugins.Animate = Animate;

})(window.Zepto || window.jQuery, window, document);

/**
 * Autoplay Plugin
 * @version 2.0.0
 * @author Bartosz Wojciechowski
 * @license The MIT License (MIT)
 */
;(function($, window, document, undefined) {

	/**
	 * Creates the autoplay plugin.
	 * @class The Autoplay Plugin
	 * @param {Owl} scope - The Owl Carousel
	 */
	var Autoplay = function(scope) {
		this.core = scope;
		this.core.options = $.extend({}, Autoplay.Defaults, this.core.options);

		this.handlers = {
			'translated.owl.carousel refreshed.owl.carousel': $.proxy(function() {
				this.autoplay();
			}, this),
			'play.owl.autoplay': $.proxy(function(e, t, s) {
				this.play(t, s);
			}, this),
			'stop.owl.autoplay': $.proxy(function() {
				this.stop();
			}, this),
			'mouseover.owl.autoplay': $.proxy(function() {
				if (this.core.settings.autoplayHoverPause) {
					this.pause();
				}
			}, this),
			'mouseleave.owl.autoplay': $.proxy(function() {
				if (this.core.settings.autoplayHoverPause) {
					this.autoplay();
				}
			}, this)
		};

		this.core.$element.on(this.handlers);
	};

	/**
	 * Default options.
	 * @public
	 */
	Autoplay.Defaults = {
		autoplay: false,
		autoplayTimeout: 5000,
		autoplayHoverPause: false,
		autoplaySpeed: false
	};

	/**
	 * @protected
	 * @todo Must be documented.
	 */
	Autoplay.prototype.autoplay = function() {
		if (this.core.settings.autoplay && !this.core.state.videoPlay) {
			window.clearInterval(this.interval);

			this.interval = window.setInterval($.proxy(function() {
				this.play();
			}, this), this.core.settings.autoplayTimeout);
		} else {
			window.clearInterval(this.interval);
		}
	};

	/**
	 * Starts the autoplay.
	 * @public
	 * @param {Number} [timeout] - ...
	 * @param {Number} [speed] - ...
	 * @returns {Boolean|undefined} - ...
	 * @todo Must be documented.
	 */
	Autoplay.prototype.play = function(timeout, speed) {
		// if tab is inactive - doesnt work in <IE10
		if (document.hidden === true) {
			return;
		}

		if (this.core.state.isTouch || this.core.state.isScrolling
			|| this.core.state.isSwiping || this.core.state.inMotion) {
			return;
		}

		if (this.core.settings.autoplay === false) {
			window.clearInterval(this.interval);
			return;
		}

		this.core.next(this.core.settings.autoplaySpeed);
	};

	/**
	 * Stops the autoplay.
	 * @public
	 */
	Autoplay.prototype.stop = function() {
		window.clearInterval(this.interval);
	};

	/**
	 * Pauses the autoplay.
	 * @public
	 */
	Autoplay.prototype.pause = function() {
		window.clearInterval(this.interval);
	};

	/**
	 * Destroys the plugin.
	 */
	Autoplay.prototype.destroy = function() {
		var handler, property;

		window.clearInterval(this.interval);

		for (handler in this.handlers) {
			this.core.$element.off(handler, this.handlers[handler]);
		}
		for (property in Object.getOwnPropertyNames(this)) {
			typeof this[property] != 'function' && (this[property] = null);
		}
	};

	$.fn.owlCarousel.Constructor.Plugins.autoplay = Autoplay;

})(window.Zepto || window.jQuery, window, document);

/**
 * Navigation Plugin
 * @version 2.0.0
 * @author Artus Kolanowski
 * @license The MIT License (MIT)
 */
;(function($, window, document, undefined) {
	'use strict';

	/**
	 * Creates the navigation plugin.
	 * @class The Navigation Plugin
	 * @param {Owl} carousel - The Owl Carousel.
	 */
	var Navigation = function(carousel) {
		/**
		 * Reference to the core.
		 * @protected
		 * @type {Owl}
		 */
		this._core = carousel;

		/**
		 * Indicates whether the plugin is initialized or not.
		 * @protected
		 * @type {Boolean}
		 */
		this._initialized = false;

		/**
		 * The current paging indexes.
		 * @protected
		 * @type {Array}
		 */
		this._pages = [];

		/**
		 * All DOM elements of the user interface.
		 * @protected
		 * @type {Object}
		 */
		this._controls = {};

		/**
		 * Markup for an indicator.
		 * @protected
		 * @type {Array.<String>}
		 */
		this._templates = [];

		/**
		 * The carousel element.
		 * @type {jQuery}
		 */
		this.$element = this._core.$element;

		/**
		 * Overridden methods of the carousel.
		 * @protected
		 * @type {Object}
		 */
		this._overrides = {
			next: this._core.next,
			prev: this._core.prev,
			to: this._core.to
		};

		/**
		 * All event handlers.
		 * @protected
		 * @type {Object}
		 */
		this._handlers = {
			'prepared.owl.carousel': $.proxy(function(e) {
				if (this._core.settings.dotsData) {
					this._templates.push($(e.content).find('[data-dot]').andSelf('[data-dot]').attr('data-dot'));
				}
			}, this),
			'add.owl.carousel': $.proxy(function(e) {
				if (this._core.settings.dotsData) {
					this._templates.splice(e.position, 0, $(e.content).find('[data-dot]').andSelf('[data-dot]').attr('data-dot'));
				}
			}, this),
			'remove.owl.carousel prepared.owl.carousel': $.proxy(function(e) {
				if (this._core.settings.dotsData) {
					this._templates.splice(e.position, 1);
				}
			}, this),
			'change.owl.carousel': $.proxy(function(e) {
				if (e.property.name == 'position') {
					if (!this._core.state.revert && !this._core.settings.loop && this._core.settings.navRewind) {
						var current = this._core.current(),
							maximum = this._core.maximum(),
							minimum = this._core.minimum();
						e.data = e.property.value > maximum
							? current >= maximum ? minimum : maximum
							: e.property.value < minimum ? maximum : e.property.value;
					}
				}
			}, this),
			'changed.owl.carousel': $.proxy(function(e) {
				if (e.property.name == 'position') {
					this.draw();
				}
			}, this),
			'refreshed.owl.carousel': $.proxy(function() {
				if (!this._initialized) {
					this.initialize();
					this._initialized = true;
				}
				this._core.trigger('refresh', null, 'navigation');
				this.update();
				this.draw();
				this._core.trigger('refreshed', null, 'navigation');
			}, this)
		};

		// set default options
		this._core.options = $.extend({}, Navigation.Defaults, this._core.options);

		// register event handlers
		this.$element.on(this._handlers);
	}

	/**
	 * Default options.
	 * @public
	 * @todo Rename `slideBy` to `navBy`
	 */
	Navigation.Defaults = {
		nav: false,
		navRewind: true,
		navText: [ 'prev', 'next' ],
		navSpeed: false,
		navElement: 'div',
		navContainer: false,
		navContainerClass: 'carousel__nav',
		navClass: [ 'carousel__prev', 'carousel__next' ],
		slideBy: 1,
		dotClass: 'carousel__dot',
		dotsClass: 'carousel__dots',
		dots: true,
		dotsEach: false,
		dotData: false,
		dotsSpeed: false,
		dotsContainer: false,
		controlsClass: 'carousel__controls'
	}

	/**
	 * Initializes the layout of the plugin and extends the carousel.
	 * @protected
	 */
	Navigation.prototype.initialize = function() {
		var $container, override,
			options = this._core.settings;

		// create the indicator template
		if (!options.dotsData) {
			this._templates = [ $('<div>')
				.addClass(options.dotClass)
				.append($('<span>'))
				.prop('outerHTML') ];
		}

		// create controls container if needed
		if (!options.navContainer || !options.dotsContainer) {
			this._controls.$container = $('<div>')
				.addClass(options.controlsClass)
				.appendTo(this.$element);
		}

		// create DOM structure for absolute navigation
		this._controls.$indicators = options.dotsContainer ? $(options.dotsContainer)
			: $('<div>').hide().addClass(options.dotsClass).appendTo(this._controls.$container);

		this._controls.$indicators.on('click', 'div', $.proxy(function(e) {
			var index = $(e.target).parent().is(this._controls.$indicators)
				? $(e.target).index() : $(e.target).parent().index();

			e.preventDefault();

			this.to(index, options.dotsSpeed);
		}, this));

		// create DOM structure for relative navigation
		$container = options.navContainer ? $(options.navContainer)
			: $('<div>').addClass(options.navContainerClass).prependTo(this._controls.$container);

		this._controls.$next = $('<' + options.navElement + '>');
		this._controls.$previous = this._controls.$next.clone();

		this._controls.$previous
			.addClass(options.navClass[0])
			.html(options.navText[0])
			.hide()
			.prependTo($container)
			.on('click', $.proxy(function(e) {
				this.prev(options.navSpeed);
			}, this));
		this._controls.$next
			.addClass(options.navClass[1])
			.html(options.navText[1])
			.hide()
			.appendTo($container)
			.on('click', $.proxy(function(e) {
				this.next(options.navSpeed);
			}, this));

		// override public methods of the carousel
		for (override in this._overrides) {
			this._core[override] = $.proxy(this[override], this);
		}
	}

	/**
	 * Destroys the plugin.
	 * @protected
	 */
	Navigation.prototype.destroy = function() {
		var handler, control, property, override;

		for (handler in this._handlers) {
			this.$element.off(handler, this._handlers[handler]);
		}
		for (control in this._controls) {
			this._controls[control].remove();
		}
		for (override in this.overides) {
			this._core[override] = this._overrides[override];
		}
		for (property in Object.getOwnPropertyNames(this)) {
			typeof this[property] != 'function' && (this[property] = null);
		}
	}

	/**
	 * Updates the internal state.
	 * @protected
	 */
	Navigation.prototype.update = function() {
		var i, j, k,
			options = this._core.settings,
			lower = this._core.clones().length / 2,
			upper = lower + this._core.items().length,
			size = options.center || options.autoWidth || options.dotData
				? 1 : options.dotsEach || options.items;

		if (options.slideBy !== 'page') {
			options.slideBy = Math.min(options.slideBy, options.items);
		}

		if (options.dots || options.slideBy == 'page') {
			this._pages = [];

			for (i = lower, j = 0, k = 0; i < upper; i++) {
				if (j >= size || j === 0) {
					this._pages.push({
						start: i - lower,
						end: i - lower + size - 1
					});
					j = 0, ++k;
				}
				j += this._core.mergers(this._core.relative(i));
			}
		}
	}

	/**
	 * Draws the user interface.
	 * @todo The option `dotData` wont work.
	 * @protected
	 */
	Navigation.prototype.draw = function() {
		var difference, i, html = '',
			options = this._core.settings,
			$items = this._core.$stage.children(),
			index = this._core.relative(this._core.current());

		if (options.nav && !options.loop && !options.navRewind) {
			this._controls.$previous.toggleClass('disabled', index <= 0);
			this._controls.$next.toggleClass('disabled', index >= this._core.maximum());
		}

		this._controls.$previous.toggle(options.nav);
		this._controls.$next.toggle(options.nav);

		if (options.dots) {
			difference = this._pages.length - this._controls.$indicators.children().length;

			if (options.dotData && difference !== 0) {
				for (i = 0; i < this._controls.$indicators.children().length; i++) {
					html += this._templates[this._core.relative(i)];
				}
				this._controls.$indicators.html(html);
			} else if (difference > 0) {
				html = new Array(difference + 1).join(this._templates[0]);
				this._controls.$indicators.append(html);
			} else if (difference < 0) {
				this._controls.$indicators.children().slice(difference).remove();
			}

			this._controls.$indicators.find('.active').removeClass('active');
			this._controls.$indicators.children().eq($.inArray(this.current(), this._pages)).addClass('active');
		}

		this._controls.$indicators.toggle(options.dots);
	}

	/**
	 * Extends event data.
	 * @protected
	 * @param {Event} event - The event object which gets thrown.
	 */
	Navigation.prototype.onTrigger = function(event) {
		var settings = this._core.settings;

		event.page = {
			index: $.inArray(this.current(), this._pages),
			count: this._pages.length,
			size: settings && (settings.center || settings.autoWidth || settings.dotData
				? 1 : settings.dotsEach || settings.items)
		};
	}

	/**
	 * Gets the current page position of the carousel.
	 * @protected
	 * @returns {Number}
	 */
	Navigation.prototype.current = function() {
		var index = this._core.relative(this._core.current());
		return $.grep(this._pages, function(o) {
			return o.start <= index && o.end >= index;
		}).pop();
	}

	/**
	 * Gets the current succesor/predecessor position.
	 * @protected
	 * @returns {Number}
	 */
	Navigation.prototype.getPosition = function(successor) {
		var position, length,
			options = this._core.settings;

		if (options.slideBy == 'page') {
			position = $.inArray(this.current(), this._pages);
			length = this._pages.length;
			successor ? ++position : --position;
			position = this._pages[((position % length) + length) % length].start;
		} else {
			position = this._core.relative(this._core.current());
			length = this._core.items().length;
			successor ? position += options.slideBy : position -= options.slideBy;
		}
		return position;
	}

	/**
	 * Slides to the next item or page.
	 * @public
	 * @param {Number} [speed=false] - The time in milliseconds for the transition.
	 */
	Navigation.prototype.next = function(speed) {
		$.proxy(this._overrides.to, this._core)(this.getPosition(true), speed);
	}

	/**
	 * Slides to the previous item or page.
	 * @public
	 * @param {Number} [speed=false] - The time in milliseconds for the transition.
	 */
	Navigation.prototype.prev = function(speed) {
		$.proxy(this._overrides.to, this._core)(this.getPosition(false), speed);
	}

	/**
	 * Slides to the specified item or page.
	 * @public
	 * @param {Number} position - The position of the item or page.
	 * @param {Number} [speed] - The time in milliseconds for the transition.
	 * @param {Boolean} [standard=false] - Whether to use the standard behaviour or not.
	 */
	Navigation.prototype.to = function(position, speed, standard) {
		var length;

		if (!standard) {
			length = this._pages.length;
			$.proxy(this._overrides.to, this._core)(this._pages[((position % length) + length) % length].start, speed);
		} else {
			$.proxy(this._overrides.to, this._core)(position, speed);
		}
	}

	$.fn.owlCarousel.Constructor.Plugins.Navigation = Navigation;

})(window.Zepto || window.jQuery, window, document);

/**
 * Hash Plugin
 * @version 2.0.0
 * @author Artus Kolanowski
 * @license The MIT License (MIT)
 */
;(function($, window, document, undefined) {
	'use strict';

	/**
	 * Creates the hash plugin.
	 * @class The Hash Plugin
	 * @param {Owl} carousel - The Owl Carousel
	 */
	var Hash = function(carousel) {
		/**
		 * Reference to the core.
		 * @protected
		 * @type {Owl}
		 */
		this._core = carousel;

		/**
		 * Hash table for the hashes.
		 * @protected
		 * @type {Object}
		 */
		this._hashes = {};

		/**
		 * The carousel element.
		 * @type {jQuery}
		 */
		this.$element = this._core.$element;

		/**
		 * All event handlers.
		 * @protected
		 * @type {Object}
		 */
		this._handlers = {
			'initialized.owl.carousel': $.proxy(function() {
				if (this._core.settings.startPosition == 'URLHash') {
					$(window).trigger('hashchange.owl.navigation');
				}
			}, this),
			'prepared.owl.carousel': $.proxy(function(e) {
				var hash = $(e.content).find('[data-hash]').andSelf('[data-hash]').attr('data-hash');
				this._hashes[hash] = e.content;
			}, this)
		};

		// set default options
		this._core.options = $.extend({}, Hash.Defaults, this._core.options);

		// register the event handlers
		this.$element.on(this._handlers);

		// register event listener for hash navigation
		$(window).on('hashchange.owl.navigation', $.proxy(function() {
			var hash = window.location.hash.substring(1),
				items = this._core.$stage.children(),
				position = this._hashes[hash] && items.index(this._hashes[hash]) || 0;

			if (!hash) {
				return false;
			}

			this._core.to(position, false, true);
		}, this));
	}

	/**
	 * Default options.
	 * @public
	 */
	Hash.Defaults = {
		URLhashListener: false
	}

	/**
	 * Destroys the plugin.
	 * @public
	 */
	Hash.prototype.destroy = function() {
		var handler, property;

		$(window).off('hashchange.owl.navigation');

		for (handler in this._handlers) {
			this._core.$element.off(handler, this._handlers[handler]);
		}
		for (property in Object.getOwnPropertyNames(this)) {
			typeof this[property] != 'function' && (this[property] = null);
		}
	}

	$.fn.owlCarousel.Constructor.Plugins.Hash = Hash;

})(window.Zepto || window.jQuery, window, document);

define("owlCarousel", function(){});

(function closure(root, factory) {
    if (typeof define === 'function' && define.amd) {
      define('thd-carousel', [
            'jquery',
            'global.namespace',
            'global.utility',
            'owlCarousel'
        ], function load($, THD, globalUtility) {
            return factory($, THD, globalUtility);
        });
    } else {
        factory($, THD, THD.Utility.Config);
    }
})(this, function factory($, THD, globalUtility) {
    'use strict';

    var privateMethods = {};
    var privateData = {};
    var thdCarousel = THD.Utility.Namespace.createNamespace('THD.Thirdparty.thdCarousel');
    // To find out the direction the carousel
    // is moved w.r.t user action.
    privateData.dragDirection;
    // To identify number of times we want to
    // transform right when the carousel is
    // pushed to extreme left by the user.
    privateData.autoTransformCount = 0;

    /**
    * Private Methods 
    */
    privateMethods.isMobile = function _isMobile () {
        var channel = (window.THD_TOUCH_GLOBALS && (window.THD_TOUCH_GLOBALS.channel || 'mobile')) 
        || (globalUtility.getGlobalData() && (globalUtility.getGlobalData().channel || 'web'));

        return channel.trim().toLowerCase() === 'mobile';
    };

    privateMethods.getTranslatedValue = function _getTranslatedValue ($element) {
        var transform = $element.css("-webkit-transform") ||
            $element.css("-moz-transform")    ||
            $element.css("-ms-transform")     ||
            $element.css("-o-transform")      ||
            $element.css("transform");
        var results = transform.match(/matrix(?:(3d)\(-{0,1}\d+(?:, -{0,1}\d+)*(?:, (-{0,1}\d+))(?:, (-{0,1}\d+))(?:, (-{0,1}\d+)), -{0,1}\d+\)|\(-{0,1}\d+(?:, -{0,1}\d+)*(?:, (-{0,1}\d+))(?:, (-{0,1}\d+))\))/);
        
        if(!results) {
            return [0, 0, 0];
        }
        if(results[1] == '3d') {
            return results.slice(2,5);
        }
        results.push(0);

        return results.slice(5, 8); // returns the [X,Y,Z,1] values
    };

    privateMethods.getMargin = function _getMargin ($element) {
        var marginLeft = $element.children().css('margin-left'); //event.relatedTarget.settings.margin
        var marginRight = $element.children().css('margin-right'); //event.relatedTarget.settings.margin

        marginLeft = marginLeft.replace('px', '');
        marginRight = marginRight.replace('px', '');

        return parseInt(marginLeft) + parseInt(marginRight);
    };

    privateMethods.getBoundingCoordinates = function _getBoundingCoordinates ($element) {
        var coordinates = {};
        // Get the offset of parent to add it to element
        var parentsLeft = $element.parent().position().left;

        coordinates.left = $element.position().left;
        coordinates.right = $element.outerWidth(true) - 10;
        coordinates.left += parentsLeft;
        coordinates.right += coordinates.left;

        return coordinates;
    };

    privateMethods.isElementInViewport = function _isElementInViewport ($element) {
        // Call to get bouding coordinates w.r.t grand parent
        var coordinates = privateMethods.getBoundingCoordinates($element);
        // Checking viewport against grand parent
        var viewPortWidth = $element.parent().parent().outerWidth(true);
        var isLeftVisible = coordinates.left >=0 && coordinates.left < viewPortWidth;
        var isRightVisible = coordinates.right >0 && coordinates.right <= viewPortWidth;

        // We are only concerned about horizontal visibility
        return isLeftVisible && isRightVisible;
    };

    privateMethods.setArrowVisibility = function _setArrowVisibility ($eventTarget) {
        var args = Array.prototype.slice.call(arguments, 1);
        var showPrevButton = false;
        var showNextButton = false;
        var $nextButton = $eventTarget.find('.carousel__nav .carousel__next');
        var $carouselOuterRG = $eventTarget.find('.carousel__stage__outer .carousel__right-gradient');
        var $prevButton = $eventTarget.find('.carousel__nav .carousel__prev');
        var $carouselOuterLG = $eventTarget.find('.carousel__stage__outer .carousel__left-gradient');

        if(args.length) {
            showPrevButton = args[0];
            showNextButton = args[1];
        }
        $nextButton.toggleClass("carousel__hide", !showNextButton).toggleClass("carousel__show", showNextButton);
        $carouselOuterRG.toggleClass("carousel__hide", !showNextButton).toggleClass("carousel__show", showNextButton);
        $prevButton.toggleClass("carousel__hide", !showPrevButton).toggleClass("carousel__show", showPrevButton);
        $carouselOuterLG.toggleClass("carousel__hide", !showPrevButton).toggleClass("carousel__show", showPrevButton);
    };

    privateMethods.toggleArrows = function _toggleArrows ($eventTarget) { 
        var $carouselStage = $eventTarget.find('.carousel__stage');
        var $carouselItem = $eventTarget.find(".carousel__item");
        var $carouselItemActive = $eventTarget.find(".carousel__item.active");
        var isLastItemVisible = $carouselItem.last().hasClass('active') && 
            privateMethods.isElementInViewport($carouselStage.children().last());
        var isFirstItemVisible = $carouselItemActive.index() == $carouselItem.first().index();
        var showNextButton = true;
        var showPrevButton = true;

        if (isFirstItemVisible && isLastItemVisible) {
            showNextButton = showPrevButton = false;
        } else if (isFirstItemVisible) {
            showPrevButton = false;
        } else if (isLastItemVisible) {
            showNextButton = false;
        }
        privateMethods.setArrowVisibility($eventTarget, showPrevButton, showNextButton);
    };

    privateMethods.disableCarouselItemDrag = function _disableCarouselItemDrag ($eventTarget) {
        var $carouselItem = $eventTarget.find('div.carousel__item');
        // Register touch events
        $carouselItem.on("touchstart mousedown", function(e) {
            // Prevent carousel swipe
            e.stopPropagation();
        });
    };

    privateMethods.checkCarouselItemDrag = function _checkCarouselItemDrag ($eventTarget) {
        var $carouselOuter = $eventTarget.find('div.carousel__stage__outer');
        var $carouselStage = $eventTarget.find('div.carousel__stage');

        // Disable drag if carousel outer stage has greater 
        // width than the carousel stage itself
        if ($carouselOuter.width() >= $carouselStage.width()) {
            privateMethods.disableCarouselItemDrag($eventTarget);
        }
    };

    privateMethods.getCarouselStageWidth = function _getCarouselStageWidth ($eventTarget, itemMargin) {
        var $carouselItem = $eventTarget.find('div.carousel__item');
        var itemsTotalWidth = 0;
        
        $carouselItem.each( function() {
            itemsTotalWidth += itemMargin + $(this).width();
        });

        return itemsTotalWidth;
    };

    privateMethods.setCarouselStageWidth =  function _setCarouselStageWidth ($eventTarget, itemMargin) {
        var $carouselStage = $eventTarget.find('div.carousel__stage');
        var itemsTotalWidth = privateMethods.getCarouselStageWidth($eventTarget, itemMargin);
        
        // To make sure all items are on the same line with width, 
        // if not, we may have items on the multiple lines.
        $carouselStage.width(itemsTotalWidth);
    };

    privateMethods.performTransformation = function _performTransformation ($eventTarget, itemMargin) {
        var $carouselOuter = $eventTarget.find('div.carousel__stage__outer');
        var $carouselItem = $eventTarget.find('div.carousel__item');
        var $nextButton = $eventTarget.find('div.carousel__next');
        var $prevButton = $eventTarget.find('div.carousel__prev');
        var itemsTotalWidth = privateMethods.getCarouselStageWidth($eventTarget, itemMargin);
        var translation = privateMethods.getTranslatedValue($carouselOuter.find('.carousel__stage'));
        var translationX = parseInt(translation[0]);
        var totalPxToMove = 0;
        var newTransformValue = 0;
        // Read the speed set for transformation
        var transformSpeed =  $eventTarget.data('owlCarousel').speed();
        var carouselOuterWidth = $carouselOuter.width();

        if (!$nextButton.hasClass('carousel__hide') || privateData.dragDirection === "left") {
            totalPxToMove = itemsTotalWidth + translationX - carouselOuterWidth;
            newTransformValue = translationX - totalPxToMove;
        } else if ((!$prevButton.hasClass('carousel__hide') || privateData.dragDirection === "right")  
            && privateData.autoTransformCount < 4) {
            // limits the auto transform to 3
            totalPxToMove = ($carouselItem.last().width()/Math.pow(2, privateData.autoTransformCount)) + itemMargin;
            newTransformValue = translationX + Math.floor(totalPxToMove);
            privateData.autoTransformCount++;
            $eventTarget.data('owlCarousel').speed(200);
        }
        // Edit transformation of carousel with new calculated values
        if (totalPxToMove && newTransformValue) {
            $eventTarget.data('owlCarousel').animate(newTransformValue);
            // Set back the speed to old value after animation
            $eventTarget.data('owlCarousel').speed(transformSpeed);
        }
    };

    privateMethods.carouselInitialized = function _carouselInitialized (event) {
        var $eventTarget = $(event.target);
        var $carouselOuter = $eventTarget.find('div.carousel__stage__outer');
        var itemMargin = event.relatedTarget.settings.margin; 

        // Call to set up carousel stage width
        privateMethods.setCarouselStageWidth($eventTarget, itemMargin);
        // Attach gradient along with arrows.
        $carouselOuter.prepend('<div class="carousel__left-gradient">&nbsp;</div>');
        $carouselOuter.prepend('<div class="carousel__right-gradient">&nbsp;</div>');
        // Call to check if item should be draggable or not
        privateMethods.checkCarouselItemDrag($eventTarget);
        // Call to toggle navigation buttons
        privateMethods.toggleArrows($eventTarget);
    };

    privateMethods.carouselTranslate = function _carouselTranslate (event) {
        var $eventTarget = $(event.target);

        // Re-initialize auto transform count
        privateData.autoTransformCount = 0;
        if (event.type === 'click') {
            privateData.dragDirection = $eventTarget.closest('.carousel__prev').length ? "right" : "left";
        } else if (event.type === 'dragged') {
            privateData.dragDirection = event.relatedTarget.state.direction;
        }
    };

    privateMethods.carouselTranslated = function _carouselTranslated (event) {
        var $eventTarget = $(event.target);
        var $carouselStage = $eventTarget.find('div.carousel__stage');
        var $carouselItem = $eventTarget.find('div.carousel__item');
        //var slideBy = event.relatedTarget.settings.slideBy;
        var isLastItemVisible = $carouselItem.last().hasClass('active') && 
            privateMethods.isElementInViewport($carouselStage.children().last());
        var itemMargin = event.relatedTarget.settings.margin;
        
        // Take action only when last item is visible and is completly in view port
        if(isLastItemVisible) {
            privateMethods.performTransformation($eventTarget, itemMargin); 
        }

        // Call to toggle navigation buttons
        privateMethods.toggleArrows($eventTarget);
    };

    /*privateMethods.carouselResized = function _carouselResized (event) {
        var $eventTarget = $(event.target);

        var $prevButton = $eventTarget.find('div.carousel__prev');
        var $nextButton = $eventTarget.find('div.carousel__next');
        var $carouselOuter = $eventTarget.find('div.carousel__stage__outer');
        var $carouselOuterLG = $carouselOuter.find('div.carousel__left-gradient');
        var $carouselOuterRG = $carouselOuter.find('div.carousel__right-gradient');
        var $carouselStage = $eventTarget.find('div.carousel__stage');

        var activeChidlren = $carouselStage.children('.active').length;

        var carouselOuterWidth = $carouselOuter.width();
        var currentItemIndex = event.item.index;
        var totalItems = event.relatedTarget.items().length;
        var maximumPages = event.relatedTarget.maximum();

        // Call to toggle navigation buttons
        privateMethods.toggleArrows($eventTarget);
    };*/

    privateMethods.addExtraContent = function ($carousel){
        $carousel.each( function ( index ) {
            var extraContent = '<div class="carousel__product--remove"></div>';
            $(this).append(
                [extraContent,
                extraContent].join(""));                  
        });
    };

    privateMethods.removeExtraContet = function ($carousel) {
        $carousel.each( function ( index ) {
            var $extraContent = $(this).find('.carousel__product--remove');
            if ($extraContent.length) {
                $extraContent.parent('.carousel__item').remove();
                privateMethods.toggleArrows($(this));
            }
        });
    };
    
    privateMethods.initializeCarousel = function _initializeCarousel ($carousel) {
        var prevButtonHtml = "<svg class='carousel__prev-button' viewBox='0 0 12 21' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' xmlns:sketch='http://www.bohemiancoding.com/sketch/ns'><defs></defs><g id='Page-1' stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' sketch:type='MSPage'><path d='M3.35738643,4.0642103 L3.35738643,3.09586423 L17.8582152,3.09586423 L17.8582152,5.03255637 L5.28304981,5.03255637 L5.28304981,17.6355953 L3.35738643,17.6355953 L3.35738643,4.0642103 Z' id='back-arrow' fill='#F96302' sketch:type='MSShapeGroup' transform='translate(10.607801, 10.365730) rotate(-45.000000) translate(-10.607801, -10.365730) '></path></g></svg>";
        var nextButtonHtml = "<svg class='carousel__next-button' viewBox='0 0 12 21' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' xmlns:sketch='http://www.bohemiancoding.com/sketch/ns'><defs></defs><g id='Page-1' stroke='none' stroke-width='1' fill='none' fill-rule='evenodd' sketch:type='MSPage'><path d='M-5.88468462,4.30628135 L-5.88468462,3.33793528 L8.61614419,3.33793528 L8.61614419,5.27462742 L-3.95902124,5.27462742 L-3.95902124,17.8776664 L-5.88468462,17.8776664 L-5.88468462,4.30628135 Z' id='next-arrow' fill='#F96302' sketch:type='MSShapeGroup' transform='translate(1.365730, 10.607801) rotate(-225.000000) translate(-1.365730, -10.607801) '></path></g></svg>";
        var defaults = {
            loop: false,
            nav: true,
            navText: [prevButtonHtml, nextButtonHtml],
            dots: false,
            slideBy: privateMethods.isMobile() ? 1 : 2,
            autoWidth: true,
            center: false,
            margin: 0,
            responsive: false
        };

        // Register Carousel listeners
        $carousel
            .on('initialized.owl.carousel', privateMethods.carouselInitialized)
            .owlCarousel(defaults)
            .on('translated.owl.carousel', privateMethods.carouselTranslated)
            .on('dragged.owl.carousel', privateMethods.carouselTranslate)
            //.on('resized.owl.carousel', privateMethods.carouselResized)
            .on('click', '.carousel__prev, .carousel__next', privateMethods.carouselTranslate);
    };


    /**
    * Public Methods 
    */
    thdCarousel.getPrivateInfo = function _getPrivateinfo () {
        return {
            privateMethods: privateMethods,
            privateData: privateData
        };
    };

    thdCarousel.init = function _init () {
        var $carousel = $('.carousel__wrapper');
        // Add/remove extra carousel items to fix
        // `OWL CAROUSEL ISSUE` inside small grids.
        privateMethods.addExtraContent ($carousel);
        privateMethods.initializeCarousel ($carousel);
        privateMethods.removeExtraContet ($carousel);
    };

    return thdCarousel;
});
/* global THD,jQuery,Mustache THD_VERSION */
(function closure(root, factory) {
	if (typeof define === 'function' && define.amd) {
		define('thd-overlay',['thd-event-emitter'], factory);
	} else if (typeof module !== 'undefined' && typeof module.exports !== 'undefined') {
		module.exports = factory(require('thd-event-emitter').EventEmitter);
	} else {
		/* eslint-disable */
		root["THD_OVERLAY"] = factory(root.EventEmitter);
		root.THD = typeof root.THD === 'undefined' ? {} : root.THD;
		root.THD.Global = typeof root.THD.Global === 'undefined' ? {} : root.THD.Global;
		root.THD.Global.Overlay = root["THD_OVERLAY"];
		/* eslint-enable */
	}
})(this, function factory(EventEmitter) {
	var DEFAULT_DESKTOP_WIDTH = window.document.documentElement.offsetWidth < 1000
		? window.document.documentElement.offsetWidth
		: 1000;
	var DEFAULT_DESKTOP_HEIGHT = 662;
	var OVERLAYS = [];
	var SCREEN;
	var resetTimeout;
	var INTERVAL;
	var INIT_FRAME_CALLED = false;
	var IFRAME_BOUNDS = {};
	var THD_DOMAIN_REGEX = /^http(s?):\/\/.*\.homedepot(dev)?.com(:?\d*)|http:\/\/localhost(:?\d*)+$/;//THD_DOMAIN_REGEXhttp://localhost:3000
	var ONLY_POST_MESSAGE_STRINGS = false;
	var IS_OPEN;
	var removeTo;
	var openTo;
	var FIXED_BEHIND_TO;
	var PARENT_WINDOW_POSITION;
	var CURRENT_OVERLAY_TYPE;
	var WINDOW_TOP = window.top;
	var WINDOW_SELF = window;
	var WINDOW_PARENT = window.parent;

	// ie 8 and 9 can only send strings
	try {
		window.postMessage({ toString: function ts() {
			ONLY_POST_MESSAGE_STRINGS = true;
		}}, '*');
	} catch(e) {
		// console.log(e);
	}

	function guid() {
		function s4() {
			return Math.floor((1 + Math.random()) * 0x10000)
				.toString(16)
				.substring(1);
		}
		return s4() + s4();
	}

	function addEvent(element, eventType, handler, useCapture) {
		var i;
		var capture = typeof useCapture !== 'undefined'
			? useCapture
			: true;
		if (element.length && !element.window) {
			for (i = 0; i < element.length; i++) {
				addEvent(element[i], eventType, handler);
			}
		} else {
			if (element.addEventListener) { // DOM Level 2 browsers
				element.addEventListener(eventType, handler, capture);
			} else if (element.attachEvent) { // IE <= 8
				element.attachEvent('on' + eventType, handler);
			} else { // ancient browsers
				element['on' + eventType] = handler;
			}
		}
	}

	function removeEvent(element, eventType, handler) {
		if (element.removeEventListener) { // DOM Level 2 browsers
			element.removeEventListener(eventType, handler, true);
			element.removeEventListener(eventType, handler, false);
		} else if (element.detachEvent) { // IE <= 8
			element.detachEvent('on' + eventType, handler);
		}
	}

	function debounce(func, wait, immediate) {
		var timeout;
		return function d() {
			var context = this;
			var args = arguments;
			var later = function later() {
				timeout = null;
				if (!immediate) func.apply(context, args);
			};
			var callNow = immediate && !timeout;
			clearTimeout(timeout);
			timeout = setTimeout(later, wait);
			if (callNow) func.apply(context, args);
		};
	};

	function cacheBustSrc(src) {
		var parts = src.split('#');
		var hasQuery;
		var sep;
		var bust;
		if (parts.length < 2) {
			return src;
		}
		hasQuery = parts[0].indexOf('?') === -1;

		if (hasQuery) {
			sep = '?bust=';
		} else {
			sep = '&bust=';
		}

		// iframes need to always bust with timestamp, not version number
		// this is due to ie/firefox issue of iframes no loading another frame
		// if the url is the same
		bust = new Date().getTime();
		return parts[0] + sep + bust + '#' + parts[1];
	}

	function hasClass(classNames, className) {
		var parts = classNames.split(' ');
		var i;
		var klass;
		for (i = 0; i < parts.length; i++) {
			klass = parts[i];
			if (klass === className) return true;
		}
		return false;
	}

	function addClass(element, className) {
		if (!hasClass(element.className, className)) {
			element.className += ' ' + className;
		}
	}

	function removeClass(element, className) {
		var parts = element.className.split(' ');
		var indx = parts.indexOf(className);
		if (indx !== -1) {
			parts.splice(indx, 1);
			element.className = parts.join(' ');
		}
	}

	function prefixes(arr, sty) {
		var ret = '';
		var i;
		for (i = 0; i < arr.length; i++) {
			ret += arr[i] + sty + '\n';
		}
		return ret;
	}

	function extend(target, source) {
		target = target || {};// eslint-disable-line
		for (var prop in source) {// eslint-disable-line
			if (typeof source[prop] === 'object') {
				target[prop] = extend(target[prop], source[prop]);
			} else {
				target[prop] = source[prop];
			}
		}
		return target;
	}

	function getDesktopCoords(channel, height, width) {
		var windowHeight = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;
		var windowWidth = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
		var coords = {
			x1: (windowWidth / 2) - (width / 2),
			y1: (windowHeight / 2) - (height / 2)
		};
		if (coords.y1 < 30) {
			if (channel === 'desktop-fullscreen') {
				coords.y1 = 0;
			} else {
				coords.y1 = 30;
			}
		}
		if (channel === 'tablet') {
			coords.y1 = 0;
		}
		// console.log(coords);
		return coords;
	}

	function getAbsoluteHeight(el) {
		// Get the DOM Node if you pass in a string
		var element = (typeof el === 'string')
			? document.querySelector(el)
			: el;
		var styles = window.getComputedStyle(element);
		var margin = parseFloat(styles.marginTop) + parseFloat(styles.marginBottom);

		return Math.ceil(el.offsetHeight + margin);
	}

	function postMessage(ctx, data, transfer) {
		var message;
		var trans = transfer || '*';
		if (ONLY_POST_MESSAGE_STRINGS) {
			message = JSON.stringify(data);
		} else {
			message = data;
		}
		ctx.postMessage(message, trans);
	}

	function maxHeight() {
		var body = document.body;
		var html = document.documentElement;

		var height = Math.max( body.scrollHeight, body.offsetHeight,
			html.clientHeight, html.scrollHeight, html.offsetHeight );
		return height;
	}
	function maxWidth() {
		var body = document.body;
		var html = document.documentElement;

		var width = Math.max( body.scrollWidth, body.offsetWidth,
			html.clientWidth, html.scrollWidth, html.offsetWidth );
		return width;
	}

	function frameLoad(ctx) {
		var message;
		if (this.getAttribute('src') === '') return;
		if (ctx.opts.channel !== 'mobile') {
			ctx.setIframeBounds();
		}
		ctx.toggleLoader();
		message = {
			action: 'set-bounds',
			innerHeight: ctx.height
		};
		if (ctx.opts.channel !== 'mobile') {
			message.innerWidth = ctx.width;
		}
		postMessage(ctx.iframe.contentWindow, message);
		ctx.trigger('load');
		ctx.resizeOverlayToContent();
	}

	// on mobile, if a user toggles tabs the iframe can freeze
	// to prevent this, toggle body class that controls height
	function windowFocus(e) {
		var classNames = document.body.className || '';
		if (WINDOW_TOP === WINDOW_SELF) {
			if (hasClass(classNames, 'thd-overlay__body--behind-mobile') && CURRENT_OVERLAY_TYPE === 'mobile' ) {
				removeTo = setTimeout(function to() {
					if (IS_OPEN) {
						removeClass(document.body, 'thd-overlay__body--behind-mobile');
						if (!!PARENT_WINDOW_POSITION) window.scrollTo(0, PARENT_WINDOW_POSITION);
					}
				}, 100);

				openTo = setTimeout(function to() {
					if (IS_OPEN) {
						PARENT_WINDOW_POSITION = window.pageYOffset;
						addClass(document.body, 'thd-overlay__body--behind-mobile');
					}
				}, 200);
			}
		} else {
			// so if the event is a focus event on an input field
			if (e.target !== WINDOW_SELF) {
				postMessage(WINDOW_TOP, { action: 'cancel-refocus' }, '*');
			} else {
				postMessage(WINDOW_TOP, { action: 'refocus' }, '*');
			}
		}
	}

	function cancelFocus() {
		clearTimeout(removeTo);
		clearTimeout(openTo);
	}

	addEvent(window, 'focus', windowFocus, true);

	addEvent(window, 'orientationchange', function orientationChange() {
		var i;
		var overlay;
		var width;
		var height;
		for (i = 0; i < OVERLAYS.length; i++) {
			overlay = OVERLAYS[i];
			if (overlay.isMobile && overlay.opts.useContent) {
				width = maxWidth();
				height = maxHeight();
				overlay.width = width;
				overlay.height = height;
				overlay.iframe.style.width = width + 'px';
				overlay.initialProps.width = width;
				overlay.initialProps.height = height;
				overlay.opts = overlay.opts || {};
				overlay.opts.width = width;
				overlay.opts.height = height;
				overlay.el.style.width = width + 'px';
				overlay.resizeOverlayToContent();
				overlay.resetCssProps(height, width);
			}
		}
	});

	function Overlay(opts) {
		this.initiated = 0;
		this.init(opts, true);
	}

	Overlay.prototype.init = function Init(opts, fromConstructor) {
		var title;
		var iframeSrc;
		var speed;
		var channel;
		var header;
		// var mobileDirection = 'bottom';
		var _this = this;
		var useContent = false;
		var hidden = false;
		var iframeCtx;
		var closeButton;
		var direction = opts.channel === 'desktop'
			? 'top'
			: 'bottom';

		this.initiated++;
		if (opts) {
			if (this.initiated === 1) {
				this.initialOpts = opts;
			}
			//if prop is set, then push the current page url to the browser history
			if(opts.alterBrowserHistory) {
				var stateObj = { page: "CURRENT_PAGE" };
				window.history.pushState(stateObj, null, window.location.href);
			}
			if (typeof opts.iframe !== 'undefined' && !opts.iframe || opts.htmlNode) {
				useContent = true;
				opts.useContent = true;
			}
			iframeSrc = opts.iframeSrc;
			title = opts.title || '';
			speed =  opts.speed || '0.3s';
			header = typeof opts.header !== 'undefined'
				? opts.header
				: false;
			direction = opts.mobileDirection
				? (opts.mobileDirection || direction)
				: (opts.direction || direction);
			closeButton = typeof opts.closeButton !== 'undefined'
				? opts.closeButton
				: false;

			channel = opts.channel || 'mobile';

			this.width = opts.width || DEFAULT_DESKTOP_WIDTH;
			this.height = opts.height || DEFAULT_DESKTOP_HEIGHT;

			CURRENT_OVERLAY_TYPE = channel;
			if (channel === 'desktop-fullscreen') {
				channel = 'mobile';
				this.isDesktopFullscreen = true;
				this.width = document.body.offsetWidth;
				this.height = document.body.offsetHeight || maxHeight();
			}

			if (opts.hidden) {
				hidden = true;
			}
			if (this.initiated === 1) {
				this.initialProps = {
					height: this.height,
					width: this.width,
					channel: channel,
					isDesktopFullscreen: this.isDesktopFullscreen
				};
			}
		}

		IS_OPEN = false;
		cancelFocus();
		// this.off();
		removeClass(document.body, 'u__body--fixed');
		removeClass(document.body, 'thd-overlay__body--behind-mobile');
		removeClass(document.body, 'thd-desktop');

		this.opts = opts;
		this.isOpen = false;
		this.id = this.id || guid();
		this.el = this.addHTMLTag({
			title: title,
			useContent: useContent,
			src: iframeSrc,
			direction: direction,
			channel: channel,
			header: header,
			hidden: hidden,
			closeButton: closeButton,
			iframe: opts.iframe,
			height: this.height,
			width: this.width
		});

		if (!useContent) {
			this.iframe = this.el.getElementsByClassName('thd-overlay-frame')[0];

			if (this.opts.useCustomFrameListner) {
				// customer listener is in the open method
			} else {
				this.iframe.onload = function ol() {
					iframeCtx = this;
					if (INIT_FRAME_CALLED) {
						frameLoad.call(iframeCtx, _this);
					} else {
						setTimeout(function to() {
							frameLoad.call(iframeCtx, _this);
						}, 200);
					}
				};
			}
			if (fromConstructor) {
				addEvent(window, 'message', function messageHandler(message) {
					var data = message.data;
					if (typeof data === 'string') {
						try {
							data = JSON.parse(data);
						} catch(e) {
							return;
						}
					}
					if (!THD_DOMAIN_REGEX.test(message.origin)) return;
					if (data && _this.iframe.getAttribute('src')) {
						_this.handleIframeAction(data);
					}
				}, false);
			}
		} else {
			this.iframe = this.el.getElementsByClassName('thd-overlay-content')[0];
			if (fromConstructor) {
				_this.toggleLoader();
			}
		}

		if (header) {
			this.header = this.el.getElementsByClassName('thd-overlay__header')[0];
		}
		this.writeCssProps({ speed: speed });

		setTimeout(function to() {
			_this.writeCssProps({ speed: speed });
		}, 100);

		this.bind();
		if (fromConstructor) {
			OVERLAYS.push(this);
			this._EventEmitterEvents = {};
			this._EventEmitterEventsComplete = {};
		}

		return this;
	};


	EventEmitter.extend(Overlay);

	Overlay.prototype.handleIframeAction = function handleIframeAction(data) {
		switch (data.action) {
		case 'close':
			this.trigger('close');
			this.close();
			break;
		case 'refocus':
			windowFocus();
			break;
		case 'cancel-refocus':
			cancelFocus();
			break;
		case 'change-overlay-type':
			this.changeOverlayType(data.overlayType, data.url);
			break;
		case 'scrollTop':
			this.scrollTop();
			break;
		case 'set-background-color':
			this.setBackgroundColor(data.color);
			break;
		case 'REST_OPEN_OVERLAY':
			this.loadedOnce = false;
			break;
		case 'log':
			this.log(data.message);
			break;
		case 'event':
			this.trigger('frame', data);
			if (data.type === 'iframe-ready') {
				postMessage(this.iframe.contentWindow, {
					action: 'SET_PARENT_URL',
					data: {
						pathname: window.location.pathname,
						href: window.location.href
					}
				}, '*');
			}
			break;
		case 'dimension-listner':
			this.trigger('dimension-listner', data);
			break;
		default:
		}
	};



	Overlay.prototype.resizeOverlayToContent = function resizeOverlayToContent() {
		var message = {
			action: 'dimension-listner'
		};
		var _this = this;
		var headerHeight;
		var height;
		var width;
		var desktopCoords;
		var transform;
		var once = false;
		var windowHeight = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;
		var t;
		this.preventOverlayScroll = function preventOverlayScroll(e) {
			if (_this.isOpen && window.scrollY > _this.height - window.innerHeight + 100) {
				e.preventDefault();
				t = _this.height - window.innerHeight + 100;
				// window.scrollTo(0, t);
				if (typeof window.scroll === 'function') {
					window.scroll({
						top: t,
						left: 0,
						behavior: 'smooth'
					});
				} else {
					window.scrollTo(0, t);
				}
			}
		};

		function repositionOverlayToTop(ctx) {
			ctx.el.style.position = 'absolute';
			ctx.el.style.top = '0';

			ctx.el.style.msTransform = transform;
			ctx.el.style.webkitTransform = transform;
			ctx.el.style.MozTransform = transform;
			ctx.el.style.transform = transform;
			window.scrollTo(0, 0);

			ctx.debouncedScroller = debounce(function scroller(e) {
				ctx.preventOverlayScroll(e);
			}, 50);
			addEvent(window, 'scroll', ctx.debouncedScroller);
		}
		if (!this.isOpen) return;
		// mobile is 100%;
		if (this.opts.useContent && this.opts.channel === 'desktop') {
			// this.iframe.
			// do some resizing here
			width = this.iframe.children[0].offsetWidth;
			if (width > window.innerWidth) {
				width = window.innerWidth - 50;
			}
			this.el.style.width = width + 'px';
			// calculate header height
			// after setting width
			headerHeight = (this.opts.header || 0) && getAbsoluteHeight(this.header);
			height = this.iframe.children[0].offsetHeight + headerHeight;
			this.el.style.height = height + 'px';
			this.height = height;
			this.width = width;
			var content = this.el.querySelector('.thd-overlay-content');
			content.style.width = width + 'px';
		} else {
			this.off('dimension-listner');
			this.on('dimension-listner', function dimListner(dims) {
				var h;
				var w;
				var offset = 0;

				if (!dims) return;

				if (WINDOW_SELF !== WINDOW_TOP) {
					// overlay on overlay

					if (dims.height > window.document.body.offsetHeight) {
						offset = 60;
					}
					postMessage(WINDOW_PARENT, {
						action: 'dimension-listner',
						height: dims.height + offset,
						width: dims.width
					});
					return;
				}

				h = dims.height;
				w = dims.width;
				if (h) {
					this.height = h;
				}
				if (w) {
					this.width = w;
				}
				desktopCoords = getDesktopCoords(this.opts.channel, this.height, this.width);
				transform = 'rotateX(0deg) scale(1) translate3d(' + desktopCoords.x1 + 'px, 30px, 0)';
				if (_this.opts.channel === 'desktop' && this.isOpen) {
					if (h && (h + 'px') !== this.el.style.height) {
						this.el.style.height = h + 'px';
						this.iframe.style.height = h + 'px';
						this.height = h;
						if (h) {
							IFRAME_BOUNDS.height = h;
							this.height = h;
						}
						if (w) {
							IFRAME_BOUNDS.width = w;
							this.width = w;
						}

						if (windowHeight <= (h + desktopCoords.y1)) {
							repositionOverlayToTop(this);
						} else {
							_this.writeCssProps();
						}
					}
					if (w && (w + 'px') !== this.el.style.width) {
						this.width = w;
						this.el.style.width = w + 'px';
						this.iframe.style.width = w + 'px';
						if (windowHeight <= (this.height + desktopCoords.y1)) {
							repositionOverlayToTop(this);
							once = true;
						} else {
							_this.writeCssProps();
						}
						this.writeCssProps();
					}
				} else if (_this.opts.channel !== 'desktop' && this.isOpen) {
					if (h + 'px' !== this.iframe.style.height) {
						this.iframe.style.height = h + 'px';
					}
					if (w + 'px' !== this.iframe.style.width) {
						this.iframe.style.width = w + 'px';
					}
				}
			});
			if (this.iframe.contentWindow) {
				postMessage(this.iframe.contentWindow, message);
			}
		}
	};

	Overlay.prototype.toggleLoader = function toggleLoader(r) {
		var wrapper = this.el.getElementsByClassName('thd-overlay__wrapper')[0];
		var loader = this.el.getElementsByClassName('pre-loader')[0];
		if (!r) {
			addClass(loader, 'thd-overlay--hide');
			removeClass(wrapper, 'thd-overlay--invisible');
		} else {
			removeClass(loader, 'thd-overlay--hide');
			addClass(wrapper, 'thd-overlay--invisible');
		}
	};

	Overlay.prototype.setTitle = function setTitle(title) {
		var titleEl = this.el.querySelector('.thd-overlay__title');
		titleEl.innerHTML = title;
	};

	Overlay.prototype.resetDimensionsToInitialSize = function setTitle() {
		this.height = this.initialProps.height;
		this.width = this.initialProps.width;
		// this.channel = this.initialProps.channel;
	};

	Overlay.prototype.addHTMLTag = function addHTMLTag(opts) {
		// direction, title, src, mobileDirection
		var temp;
		var el;
		var dir = '';
		var header;
		var wrapperClass;
		var contentOrFrame = '';
		var closeButton;
		var existingOverlay;
		var style = '';
		if (opts.channel === 'desktop' || opts.channel === 'tablet') {
			wrapperClass = 'thd-overlay-desktop';
		} else {
			wrapperClass = 'thd-overlay-mobile';
		}

		this.isMobile = false;

		if (opts.channel === 'mobile') {
			this.isMobile = true;
			dir = opts.direction || 'bottom';
		}

		if (opts.useContent) {
			contentOrFrame = '<div class="thd-overlay-content"></div>';
			if (opts.height) {
				style += 'height: ' + opts.height + 'px;';
			}
			if (opts.width) {
				style = 'width: ' + opts.width + 'px;';
			}
		} else {
			contentOrFrame = '<iframe allowtransparency="true" scrolling="no" class="thd-overlay-frame" data-src="' + (opts.src || '') + '"></iframe>';
		}
		if (opts.hidden) {
			style += 'display:none;';
		}
		if (opts.header) {
			header = ['<header class="thd-overlay__header">',
							'<div class="grid">',
								'<div class="col__10-12">',
									'<h2 class="u__husky thd-overlay__title">' + opts.title + '</h2>',
								'</div>',
								'<div class="col__2-12 u__text-align--right">',
									'<a href="#" class="thd-overlay__close">',
										'<svg class="" viewBox="0 0 32 32">',
											'<path d="M27.229 8.391l-3.385-3.386-7.843 7.838-7.84-7.84-3.386 3.385 7.609 7.608-7.613 7.612 3.385 3.386 7.843-7.838 7.84 7.841 3.387-3.386-7.61-7.608z"></path>',
										'</svg>',
									'</a>',
								'</div>',
							'</div>',
						'</header>'].join('');
		}
		if(opts.closeButton) {
			closeButton = ['<a href="#" class="thd-overlay__close thd-overlay__close--standAlone">',
							'<svg class="" viewBox="0 0 32 32">',
								'<path d="M27.229 8.391l-3.385-3.386-7.843 7.838-7.84-7.84-3.386 3.385 7.609 7.608-7.613 7.612 3.385 3.386 7.843-7.838 7.84 7.841 3.387-3.386-7.61-7.608z"></path>',
							'</svg>',
						'</a>'].join('');
		}

		temp = document.createElement('div');
		temp.innerHTML = ['<div data-direction="' + opts.direction + '" class="thd-overlay--hide ' + wrapperClass + ' thd-overlay thd-overlay-' + this.id + ' ' + dir + '" style="' + style + '">',
													'<div class="pre-loader"><div class="segment-spinner"></div></div>',
													'<div class="thd-overlay__wrapper thd-overlay--invisible ' + (opts.useContent ? 'thd-overlay__wrapper--content' : '') + '">',
													'<div class="thd-overlay__content col__12-12 loading' + (this.isDesktopFullscreen ? ' thd-overlay__content--fullscreen' : '') + '">',
														(header || ''),
														(closeButton || ''),
														!opts.iframe ? contentOrFrame : '',
													'</div>',
												'</div>'
										].join('');
		if (opts.iframe) {
			// maybe remove it from current spot first
			temp.querySelector('.thd-overlay__content').appendChild(opts.iframe);
		}

		el = temp.firstChild;

		if (!SCREEN && !opts.hidden) {
			SCREEN = document.createElement('div');
			SCREEN.id = 'thd-overlay__screen';
			document.body.appendChild(SCREEN);
		}
		existingOverlay = document.querySelector('.thd-overlay-' + this.id);
		if (existingOverlay) {
			existingOverlay.parentElement.removeChild(existingOverlay);
			// if (SCREEN) {
			// 	SCREEN.parentElement.removeChild(SCREEN);
			// }
		}
		document.body.appendChild(temp.firstChild);

		return el;
	};

	Overlay.prototype.changeOverlayType = function changeOverlayType(channel, url) {
		var opts = extend({}, this.opts);
		var src = url || this.iframe.src;
		opts.channel = channel;
		// opts.speed = '1s';

		if (channel === 'desktop-fullscreen') {
			opts.direction = 'top';
			opts.mobileDirection = 'top';
		}
		this.init(opts);
		this.open(src);
	};

	Overlay.prototype.bind = function bind() {
		var closeBtn = this.el.getElementsByClassName('thd-overlay__close')[0];
		var self = this;
		var opts = this.opts || {};
		var alterBrowserHistory = this.opts.alterBrowserHistory;

		this._closeOverlay = function closeOverlay(e) {
			e.preventDefault();
			// if alterBrowserHistory, then do the below before closing the overlay
			var isOpen = self.isOpen;
			if (alterBrowserHistory) {
				var state = window.history.state;
				var page = state ? state.page : '';
				if( alterBrowserHistory && isOpen && page === 'CURRENT_PAGE') {
					window.history.back();
				}
			}
			self.close();
		};
		this._resize = function resize() {
			var w;
			var h;
			if (self.isDesktopFullscreen && (self.isOpen || self.isOpening)) {
				w = maxWidth();
				h = maxHeight();
				self.el.style.height = h + 'px';
				self.iframe.style.width =  '100%';// w + 'px';
				self.postMessage({
					action: 'set-bounds',
					innerWidth: w,
					innerHeight: h
				});
			}
		};
		if (closeBtn) {
			// removeEvent(closeBtn, this._closeOverlay);
			addEvent(closeBtn, 'click', this._closeOverlay);
		}
		if(alterBrowserHistory) {
			addEvent(window, 'popstate', this._closeOverlay);
		}
		// removeEvent(window, 'resize', this._resize);
		addEvent(window, 'resize', this._resize);
		if (SCREEN) {
			// removeEvent(SCREEN, 'click', closeOverlay);
			addEvent(SCREEN, 'click', this._closeOverlay);
		}
	};

	Overlay.prototype.scrollTop = function scrollTop() {
		var content = this.el.querySelector('.thd-overlay__content');
		if (content) {
			content.scrollTop = 0;
		}
	};

	Overlay.prototype.open = function open(frameSrc, opts) {
		var options;
		var src;
		var speed;
		var self = this;
		var htmlNode;
		var desktopCoords;
		var _this = this;

		if (this.overlayCloseTimer) {
			clearTimeout(this.overlayCloseTimer);
		}

		// destroyed overlays need not be invoked again.
		if (this._destroyed) {
			console.log('you can not open an overlay after it has been destroyed');
			return;
		}
		if (typeof frameSrc === 'object') {
			options = frameSrc;
		} else {
			options = opts || {};
		}
		IS_OPEN = true;
		this.loadedOnce = false;
		if (!this.opts.useContent) {
			src = frameSrc || this.iframe.getAttribute('data-src') || this.opts.iframeSrc;
			this.on('frame', function ready(event) {
				if (event && event.type === 'iframe-ready' && !_this.loadedOnce) {
					if (_this.isOpen) {
						frameLoad.call(_this.iframe, _this);
						_this.loadedOnce = true;
					}
				}
			});
		}
		speed = parseFloat(this.opts.speed, 10);

		if (/s$/.test(this.opts.speed)) {
			speed = speed * 1000;
		}
		if (/ms$/.test(this.opts.speed)) {
			speed = speed * 10;
		}
		if (isNaN(speed)) {
			speed = 300;
		}
		if (this.isOpening) return this;
		this.isOpening = true;
		if (options.title) {
			this.setTitle(options.title);
		}

		this.setIframeBounds();

		if (this.opts.useContent) {
			// clear iframe only when new node is provided
			if (options.htmlNode) {
				self.iframe.innerHTML = '';
				htmlNode = options.htmlNode;
			} else {
				htmlNode = this.opts.htmlNode;
			}
			self.iframe.appendChild(htmlNode);
			// removeClass(self.el, 'thd-overlay--hide');
			self.toggleLoader();
		}

		removeClass(self.el, 'thd-overlay--hide');

		setTimeout(function openingTo() {
			self.isOpening = false;
		}, 2000);

		setTimeout(function to() {
			// adding remove hide class here as well for issue #1369 (mycart)
			removeClass(self.el, 'thd-overlay--hide');
			addClass(self.el, 'open');
			self.isOpen = true;
		}, 100);

		if (this.opts.useContent) {
			setTimeout(function to() {
				self.resizeOverlayToContent();
				self.resetCssProps(self.height, self.width);
			}, 100);
		}

		setTimeout(function to() {
			self.setIframeBounds();
			addClass(document.body, 'u__body--fixed');

			if (self.isMobile) {
				// the fixed behind hides the rest of the background page
				// you need to give a delay to it so that the trasition is smooth
				FIXED_BEHIND_TO = setTimeout(function TO() {
					PARENT_WINDOW_POSITION = window.pageYOffset;
					addClass(document.body, 'thd-overlay__body--behind-mobile');
					if(self.isDesktopFullscreen) {
						addClass(document.body, 'thd-desktop');
					}
				}, 1000);
			}

			if (!self.opts.useContent) {
				self.iframe.src = cacheBustSrc(src);
			}

			if (!self.isMobile && SCREEN && !self.opts.hidden) {
				addClass(SCREEN, 'thd-overlay__screen');
			}
		}, 1);

		desktopCoords = getDesktopCoords(this.opts.channel, this.height, this.width);
		if (desktopCoords.y1 === 30 && !self.opts.hidden) {
			window.scrollTo(0, 0);
		}
		this.closeOverlayAfterTimeOut();
		return this;
	};

	Overlay.prototype.closeOverlayAfterTimeOut = function closeOverlayAfterTimeOut(){
		var self = this;
		this.overlayCloseTimer = setTimeout(function (){
			if (!self.opts.useContent && self.opts.iframeSrc && !self.iframe.src) {
				self.close();
			}
		}, 10000);
	};

	Overlay.prototype.log = function log(message) {
		console.log(message);
		// @todo send to new relic;
	};

	Overlay.prototype.changeDirection = function changeDirection(opts) {
		var currentDirection;
		if (opts) {
			addClass(this.el, 'thd-overlay--hide');
			setTimeout(function to() {
				currentDirection = this.el.dataset.direction;
				this.el.dataset.direction = opts.direction;
				addClass(this.el, opts.direction || 'top');
				removeClass(this.el, currentDirection);
				removeClass(this.el, 'thd-overlay--hide');
			}, 200);
		}
	};

	Overlay.prototype.destroy = function destroy() {
		var cssStyleTag = document.getElementById('thd-overlay-style-' + this.id);
		if (cssStyleTag && cssStyleTag.parentElement) {
			cssStyleTag.parentElement.removeChild(cssStyleTag);
		}

		if (this.el && this.el.parentElement) {
			this.el.parentElement.removeChild(this.el);
		}

		this._destroyed = true;
	};

	Overlay.prototype.setBackgroundColor = function setBackgroundColor(color) {
		this.el.style.backgroundColor = color;
	};

	Overlay.prototype.close = function close() {

		var self = this;
		var events = [];
		var dimensionListeners = [];
		//
		IS_OPEN = false;
		if (this.overlayCloseTimer) {
			clearTimeout(this.overlayCloseTimer);
		}
		removeEvent(window, 'scroll', this.debouncedScroller);

		if (!this.isOpen) return this;
		this.isOpening = false;
		// this loc adds history to the stack
		// removing. if added back. test opening then closing frame
		// and then navigating back
		// if (this.iframe) this.iframe.src = '';


		this.toggleLoader('reset');
		removeClass(this.el, 'open');
		if (INTERVAL) clearInterval(INTERVAL);
		if (self._EventEmitterEvents['frame.default']) {
			events = self._EventEmitterEvents['frame.default'].slice();
		}
		if (self._EventEmitterEvents['dimension-listner.default']) {
			dimensionListeners = self._EventEmitterEvents['dimension-listner.default'].slice();
		}
		self.trigger('close');
		self.off();
		self._EventEmitterEvents['frame.default'] = events;
		self._EventEmitterEvents['dimension-listner.default'] = dimensionListeners;


		setTimeout(function to() {
			// self.resetIframeBounds();
			addClass(self.el, 'thd-overlay--hide');
			if (self.iframe && self.iframe.style) {
				self.iframe.setAttribute('style', '');
			}
			if (self.el && self.el.style) {
				self.el.setAttribute('style', '');
			}

			self.opts = self.initialOpts;
			self.isDesktopFullscreen = self.initialProps.isDesktopFullscreen;
			self.isMobile = self.initialProps.isMobile;
			self.height = self.initialProps.height;
			self.width = self.initialProps.width;
			self.resetDimensionsToInitialSize();
			self.resetCssProps(self.height, self.width);
			self.init(self.opts);
		}, 601);
		if (FIXED_BEHIND_TO) {
			clearTimeout(FIXED_BEHIND_TO);
		}
		INIT_FRAME_CALLED = false;
		// self.iframe.src = cacheBustSrc('http://www.homedepot.com/mycart/overlay');
		removeClass(document.body, 'u__body--fixed');

		if (this.isMobile) {
			removeClass(document.body, 'thd-overlay__body--behind-mobile');
			if (!!PARENT_WINDOW_POSITION) window.scrollTo(0, PARENT_WINDOW_POSITION);
		}

		if (SCREEN) {
			removeClass(SCREEN, 'thd-overlay__screen');
		}
		self.isOpen = false;
		return this;
	};

	Overlay.prototype.setIframeBounds = function setIframeBounds() {
		// only desktop sets iframe bounds. mobile is 100%
		if (this.opts.channel !== 'desktop') return;
		if (this.opts.useContent) return;
		if (!this.opts.useContent) {
			this.iframe.style.height = this.height + 'px';
			this.iframe.style.width = this.width + 'px';
		}
		this.el.style.height = this.height + 'px';
		this.el.style.width = this.width + 'px';
	};

	Overlay.prototype.resetIframeBounds = function resetIframeBounds() {
		this.el.setAttribute('style', '');
		if (!this.opts.useContent) {
			this.iframe.setAttribute('style', '');
		}
	};

	Overlay.prototype.resetCssProps = function resetCssProps(h, w) {
		var cssStyleTag = document.getElementById('thd-overlay-style-' + this.id);
		if (cssStyleTag) {
			cssStyleTag.parentElement.removeChild(cssStyleTag);
		}
		if (this.opts.channel !== 'mobile') {
			this.height = h || window.innerHeight;
			this.width = w || window.innerWidth;
		}

		this.setIframeBounds();
		this.writeCssProps();
	};

	Overlay.prototype.postMessage = function postMessageProto(message) {
		if (this.iframe && this.iframe.contentWindow) {
			postMessage(this.iframe.contentWindow, message);
		}
	};

	Overlay.prototype.writeCssProps = function writeCssProps(opts) {
		var options = {
			speed: '500ms',
		};
		var oldBrowserTpl = ['.thd-overlay.top {',
				'top: 100%;',
			'}',
			'.thd-overlay-' + this.id + '.top.open {',
					'top: 0;',
					'display:block;',
			'}',
			'.thd-overlay-' + this.id + '.right {',
				'right: 200%;',
				'left: -100%;',
			'}',
			'.thd-overlay-' + this.id + '.right.open {',
				'right: 0;',
				'left: 0;',
			'}',
			'.thd-overlay-' + this.id + '.bottom {',
				'bottom: 100%;',
			'}',
			'.thd-overlay-' + this.id + '.bottom.open {',
				'bottom: 0;',
			'}',
			'.thd-overlay-' + this.id + '.left {',
				'left: 100%;',
			'}',
			'.thd-overlay-' + this.id + '.left.open {',
				'left: 0;',
			'}',
			'.thd-overlay.thd-overlay-desktop {',
				'display:none;',
				'margin:0 auto;',
			'}',
		'.thd-overlay.thd-overlay-desktop.open {',
			'display:block;',
		'}'
		].join('\n');

		var browserPrefixes = ['-ms-', '-webkit-', ''];
		var desktopCoords = getDesktopCoords(this.opts.channel, this.height, this.width);
		var scrollable;
		var tpl;
		var transition;
		var cssStyleTag;
		var isNew = false;
		var s;

		if (typeof opts === 'string') {
			options.speed = opts;
		} else {
			options = extend(options, opts);
		}
		s = options.speed || this.opts.speed || '0.3s';

		scrollable = ['.thd-overlay-' + this.id + '.thd-overlay-desktop {',
				prefixes(browserPrefixes, 'transform: rotateX(90deg) scale(1) translate3d(' + desktopCoords.x1 + 'px, ' + desktopCoords.y1  + 'px, 200px);'),
			'}',
			'.thd-overlay-' + this.id + '.thd-overlay-desktop.open {',
				(desktopCoords.y1 === 30 ? 'position:absolute;' : ''),
				// 'position: absolute;',
				prefixes(browserPrefixes, 'transform: rotateX(0deg) scale(1) translate3d(' + desktopCoords.x1 + 'px, ' + desktopCoords.y1  + 'px, 0px);'),
			'}'
		].join('\n');

		tpl = ['.thd-overlay-' + this.id + '.bottom {',
			prefixes(browserPrefixes, 'transform: translate(0, ' + this.height + 'px);'),
		'}',
		'.thd-overlay-' + this.id + '.bottom.open {',
			prefixes(browserPrefixes, 'transform: translate(0, 0);'),
		'}',
		'.thd-overlay-' + this.id + '.right {',
			prefixes(browserPrefixes, 'transform: translate( ' + this.height + 'px, 0);'),
		'}',
		'.thd-overlay-' + this.id + '.right.open {',
			prefixes(browserPrefixes, 'transform: translate( 0, 0);'),
		'}',
		'.thd-overlay-' + this.id + '.top {',
			prefixes(browserPrefixes, 'transform: translate(0, -' + this.height + 'px);'),
		'}',
		'.thd-overlay-' + this.id + '.top.open {',
			prefixes(browserPrefixes, 'transform: translate(0, 0);'),
		'}',
		'.thd-overlay-' + this.id + '.left {',
			prefixes(browserPrefixes, 'transform: translate( -' + this.width + 'px, 0);'),
		'}',
		'.thd-overlay-' + this.id + '.left.open {',
			prefixes(browserPrefixes, 'transform: translate(0, 0);'),
		'}',
		'.thd-overlay-' + this.id + '.thd-overlay-desktop {',
			prefixes(browserPrefixes, 'transform: rotateX(90deg) scale(1) translate3d(' + desktopCoords.x1 + 'px, ' + desktopCoords.y1  + 'px, 200px);'),
		'}',
		'.thd-overlay-' + this.id + '.thd-overlay-desktop.open {',
			prefixes(browserPrefixes, 'transform: rotateX(0deg) scale(1) translate3d(' + desktopCoords.x1 + 'px, ' + desktopCoords.y1  + 'px, 0px);'),
		'}'
		].join('\n');

		transition = [
			'.thd-overlay-' + this.id + ' {',
			// prefixes(browserPrefixes, 'transition: top ' + s + ', right ' + s + ', bottom ' + s + ', left ' + s + ' !important;'),
			prefixes(browserPrefixes, 'transition: height ' + s + ', width ' + s + ', transform ' + s + ', right ' + s + ', bottom ' + s + ', left ' + s + ';'),
			'}',
			// '.thd-overlay-' + this.id + ' iframe {',
			// // prefixes(browserPrefixes, 'transition: top ' + s + ', right ' + s + ', bottom ' + s + ', left ' + s + ' !important;'),
			// prefixes(browserPrefixes, 'transition: height ' + s + ', width ' + s + ', transform ' + s + ', right ' + s + ', bottom ' + s + ', left ' + s + ';'),
			// // '}'
		].join('\n');
		cssStyleTag = document.getElementById('thd-overlay-style-' + this.id);

		if (!cssStyleTag) {
			cssStyleTag = document.createElement('style');
			cssStyleTag.id = 'thd-overlay-style-' + this.id;
			isNew = true;
		}
		if (typeof cssStyleTag.style.transform !== 'undefined') {
			cssStyleTag.innerHTML = [tpl, transition, scrollable].join('\n');
		} else {
			cssStyleTag.innerHTML = [oldBrowserTpl, transition].join('\n');
		}
		if (isNew) {
			document.body.appendChild(cssStyleTag);
		}
		// was put in place for content overlays
		// when the overlay opens back up it needs to be
		// at the top of the page. additional logic and
		// testing needed
		// if (desktopCoords.y1 === 30 && !this.opts.hidden) {
		// 	window.scrollTo(0, 0);
		// }

	};

	function reset() {
		var o = document.getElementsByClassName('thd-overlay-' + this.id)[0];

		if (o) {
			addClass(o, 'hide');
			setTimeout(function to() {
				var i = 0;
				for (i = 0; i < OVERLAYS.length; i++) {
					Overlay.prototype.resetCssProps.call(OVERLAYS[i]);
				}
				if (resetTimeout) clearTimeout(resetTimeout);
				resetTimeout = setTimeout(function t() {
					removeClass(o, 'hide');
					resetTimeout = null;
				}, 200);
			}, 100);
		}
	}


	window.onorientationchange = function or() {
		var classNames;
		try {
			// ios locks up on rotate,
			// toggling the fixed classname on the body
			// resolves the issue
			// \hack
			classNames = top.document.body.className;
			top.document.body.className = '';
			setTimeout(function to() {
				top.document.body.className = classNames;
			}, 100);
			reset();
		} catch(e) {
			// console.log(e);
		}
	};
	addEvent(window, 'resize', reset);

	// Iframe methods
	Overlay.close = function close() {
		if (window !== top) {
			// todo whitelist domains?
			postMessage(parent, {action: 'close'});
		} else {
			window.close();
		}
	};

	Overlay.resize = function overlayResize(opts) {
		var el = document.querySelector('.thd-overlay-iframe-wrapper');
		if (!opts) return;

		if (el) {
			if (opts.height) {
				el.style.height = opts.height + 'px';
			}
			if (opts.width) {
				el.style.width = opts.width + 'px';
			}
		}

		Overlay.postMessage({
			action: 'dimension-listner',
			from: 'resize',
			width: opts.width,
			height: opts.height
		});
	};

	Overlay.postMessage = function postMessageGlobal(data) {
		if (WINDOW_SELF !== WINDOW_TOP) {
			// todo whitelist domains?
			// top is better than parent
			// when overlay is iframe, it can open iframes
			// for posting atc calls
			postMessage(WINDOW_TOP, data);
			if (top !== parent) {
				postMessage(WINDOW_PARENT, data);
			}
		} else {
			// some other sort of handling tbd
		}
	};

	Overlay.setBackgroundColor = function setBackgroundColor(color) {
		Overlay.postMessage({
			action: 'set-background-color',
			color: color
		});
	};

	Overlay.resetOpenOverlay = function resetOpenOverlay() {
		var i = 0;
		var o;
		for (i = 0; i < OVERLAYS.length; i++) {
			o = OVERLAYS[i];
			if (o.isOpen) {
				o.loadedOnce = false;
			}
		}
	};

	// method to be called from iframe to listen to
	// parent posting message
	Overlay.initFrame = function initFrame(el, intervalLength, forceListner) {
		var intLength = intervalLength || 200;
		var curScrollHeight;
		var curScrollWidth;

		function interv() {
			var opts;
			var scrollHeight;
			var scrollWidth;
			var widths = [];
			var rootEl;
			scrollHeight = Math.min(
				Math.max(
					window.document.body.offsetHeight,
					window.document.body.scrollHeight
				),
				window.document.documentElement.scrollHeight
			);
			// 10 is the scroll bar
			widths = [
				Math.max(
					window.document.body.offsetWidth,
					window.document.body.scrollWidth
				),
				window.document.documentElement.scrollWidth
			];

			rootEl = document.querySelector('.thd-overlay-iframe-wrapper');
			if (rootEl) {
				widths.push(rootEl.scrollWidth || 100000);
			}

			scrollWidth = Math.min.apply(null, widths);

			opts = {
				action: 'dimension-listner'
			};
			// if scroll height is larger than winHeight, expand
			if (scrollHeight && curScrollHeight !== scrollHeight && scrollHeight > 100) {
				// need to grow the overlay
				// p = oncePadding('height');
				opts.height = scrollHeight;
				curScrollHeight = scrollHeight;
			}

			// if scroll height is larger than winHeight, expand
			if (scrollWidth && curScrollWidth !== scrollWidth && scrollWidth > 100) {
				// need to grow the overlay
				// p = oncePadding('width');
				opts.width = scrollWidth;
				curScrollWidth = scrollWidth;
			}

			if (Object.keys(opts).length > 1) {
				IFRAME_BOUNDS.height = opts.height;
				IFRAME_BOUNDS.width = opts.width;
				postMessage(parent, opts);
			}
		}
		function listener(event) {
			var data;
			if (!THD_DOMAIN_REGEX.test(event.origin) && !forceListner) return;
			data = event.data;

			if (typeof data === 'string') {
				try {
					data = JSON.parse(data);
				} catch(e) {
					return;
				}
			}

			// if (event.data.action === 'set-bounds' && event.data.innerHeight) {
			// 	el.style.height = event.data.innerHeight + 'px';
			// }
			if (data.action === 'set-bounds' && data.innerWidth) {
				el.style.width = data.innerWidth + 'px';
				// el.style.height = data.innerHeight + 'px';
				IFRAME_BOUNDS.height = data.innerHeight;
				IFRAME_BOUNDS.width = data.innerWidth;
			}
			if (data.action === 'dimension-listner') {
				// some sort of listner for height
				if (INTERVAL) clearInterval(INTERVAL);
				setTimeout(function to() {
					INTERVAL = setInterval(interv, intLength);
				}, 200);
			}
		}
		// if an overlay hidden in an overlay (certona, dont listen to the interval)
		if (WINDOW_TOP !== WINDOW_SELF && WINDOW_PARENT === WINDOW_TOP || forceListner) {
			addEvent(window, 'message', listener, false);
		}
		el.className += 'thd-overlay-iframe-wrapper';
		// el.style.overflow = 'hidden';
		INIT_FRAME_CALLED = true;
	};

	return Overlay;
});

(function closure(root, factory) {
  if (typeof define === 'function' && define.amd) {
    define('list.model',[
      'jquery'
    ], function load(jQuery) {
      return factory(root, jQuery);
    });
  } else {
    // For non-AMD module, expose this to global (will also be useful for test cases)
    /*eslint-disable*/
    factory(root, jQuery);
    /*eslint-enable*/
  }
})(this, function factory(root, $) {
  
  var sourceParams = '',
      selectorInfo = '',
      $trigger = null,
      itemParams = [],
      listName = '',
      itemParam = {},
      isMobileChannel = false;

  var getSource = function () {
    return sourceParams;
  };

  var setSource = function (source) {
    sourceParams = source || '';
  };

  var getSelectorInfo = function () {
    return selectorInfo;
  };

  var setSelectorInfo = function (value) {
    selectorInfo = value || 'body';
  };

  var getTrigger = function () {
    return $trigger;
  };

  var setTrigger = function (value) {
    $trigger = value || $('body');
  };

  var getListName = function () {
    return listName;
  };

  var setListName = function (value) {
    listName = value;
  };

  var getItems = function() {
    return itemParams;
  };

  var setItems = function(value) {
    itemParams = value;
  };
  
  var getIsMobileChannel = function () {
	    return isMobileChannel;
  };

  var setIsMobileChannel = function (value) {
	  isMobileChannel = value;
  };

  var setRequestParams = function(requestParams) {
    var itemParams = [],
        itemParam = {};

    if (requestParams.item.length) {
      itemParams = requestParams.item;
    } else {
      itemParam = {};
      itemParam.itemId = requestParams.item.itemId || '';
      itemParam.quantity = requestParams.item.quantity || 0;
      itemParam.price = requestParams.item.price || '';
      itemParam.imageURL = requestParams.item.imageURL || '';
      if (requestParams.item.blindsItemId) {
        itemParam.blindsItemId = requestParams.item.blindsItemId;
      }
      itemParams.push(itemParam);
    }
    setSource(requestParams.source);
    setSelectorInfo(requestParams.selector);
    setTrigger(requestParams.$trigger);
    setIsMobileChannel(requestParams.isMobileChannel);
    setItems(itemParams);
  };

  return {
    getSource: getSource,
    setSource: setSource,
    getSelectorInfo: getSelectorInfo,
    setSelectorInfo: setSelectorInfo,
    getTrigger: getTrigger,
    setTrigger: setTrigger,
    getListName: getListName,
    setListName: setListName,
    getItems: getItems,
    setItems: setItems,
    setRequestParams: setRequestParams,
    getIsMobileChannel: getIsMobileChannel,
    setIsMobileChannel: setIsMobileChannel,
  };
});
/**
* Holds the constants used in the AMD implementation
**/
(function closure(root, factory) {
  if (typeof define === 'function' && define.amd) {
    define('list.constants',[
      'jquery',
      'account.device.utility'
    ], function load(jQuery, deviceUtility) {
      return factory(root, jQuery, deviceUtility);
    });
  } else {
    // For non-AMD module, expose this to global (will also be useful for test cases)
    /*eslint-disable*/
    factory(root, jQuery, deviceUtility);
    /*eslint-enable*/
  }
})(this, function factory(root, $, deviceUtility) {

    var URLS = {
      GET_ALL_LIST_URL : function(memeberID) {
        return 'https://' + deviceUtility.getHostNameSecure() + '/customer/list/v1/' + memeberID + '/lists';
      },
      CREATE_LIST_URL : 'https://' + deviceUtility.getHostNameSecure() + '/customer/list/v1/createlist',
      UPDATE_LIST_URL : 'https://' + deviceUtility.getHostNameSecure() + '/customer/list/v1/additems',
      GET_FEATURE_LIST_URL : 'https://' + deviceUtility.getHostNameSecure() + '/TouchWebServices/v2/util/feature?featureId=RegistrationLiteFeature&featureId=MCMListDesktopFeature&featureId=MCMListMobileFeature',
      LIST_DETAILS_URL : function(listKey) {
        return 'https://' + deviceUtility.getHostNameSecure() + '/account/view/list/details/' + listKey;
      }
    };

    //Error codes
    var ERR_CD_EXISTING_LIST_NAME = "MYLIST_ERR_007",
        ERR_CD_LIST_NAME_MAX_LENGTH = "MYLIST_ERR_131",
        ERR_CD_LIST_NAME_SPL_CHARS = "MYLIST_ERR_006",
        ERR_CD_MANDATORY_LIST_NAME = "MYLIST_ERR_132",

        ERR_CD_EMPTY_LIST_DETAILS = "MYLIST_ERR_105",
        ERR_CD_EMPTY_LIST_OF_LISTS = "MYLIST_ERR_100",

        ERR_GENERIC = "MYLIST_GENERIC",

        MESSAGE_MAPPING = [];

    //Error code and message mapping
    MESSAGE_MAPPING[ERR_CD_EXISTING_LIST_NAME] = "You already have a list with that name. Please enter a different name.";
    MESSAGE_MAPPING[ERR_CD_LIST_NAME_MAX_LENGTH] = "You have entered more than 50 characters. Please enter a different name.";
    MESSAGE_MAPPING[ERR_CD_LIST_NAME_SPL_CHARS] = "You have entered an invalid character. Only a-z, 0-9, ! @ # $ % ^ & ( ) - _ + = , . ? \" ' \ : are allowed. Please try again.";
    MESSAGE_MAPPING[ERR_CD_MANDATORY_LIST_NAME] = "Please enter a name for your list";
    MESSAGE_MAPPING[ERR_GENERIC] = {"title": "We're sorry. ", "content" : "Please try again later."};

    /**
     * Function to get the error message based on the error code
     */
    var getMessageMapping = function(errorCode) {
      return MESSAGE_MAPPING[errorCode];
    };

    var getErrorCode = function(errorCode) {
      return eval(errorCode);
    };

    return {
      URLS : URLS,
      getError: getMessageMapping,
      getCode: getErrorCode
    };
});
(function closure(root, factory) {
  if (typeof define === 'function' && define.amd) {
    define('list.helper',[
      'jquery',
      'list.model',
      'account.utility',
      'list.constants'
    ], function load(jQuery, model, accountUtility, Constants) {
      return factory(root, jQuery, model, accountUtility, Constants);
    });
  } else {
    // For non-AMD module, expose this to global (will also be useful for test cases)
    /*eslint-disable*/
    factory(root, jQuery, model, accountUtility, Constants);
    /*eslint-enable*/
  }
})(this, function factory(root, $, model, accountUtility, Constants) {

  /**
  * @Descrption: Helps to trigger the create list call and add items into the list
  *
  * @Param: listName
  * @Return: AJAX hanlder to handle the success and error scenarios
  **/
  var triggerCreateListCall = function(listName, listId){

    var $createItem = $('.listOfLists__create-item'),
        postAction = '',
        itemInfo = {},
        items = model.getItems(),
        url = Constants.URLS.CREATE_LIST_URL;

    //Construct the request data, to create the list and update the item
    var data = {
      "ListRequest": {
        "items" : [],
        "memberId" : accountUtility.getMemberId(),
        "listName" : listName
      }
    };

    if(listId) {
      data.ListRequest.listId = listId;
      url = Constants.URLS.UPDATE_LIST_URL;
    }

    //Looping through each item and pushing to the request
    $.each(items, function(index, eachItem) {
      itemInfo.catentryId = eachItem.itemId;
      itemInfo.qty = eachItem.quantity;
      if (eachItem.blindsItemId) {
        itemInfo.configurationId = eachItem.blindsItemId;
      }
      data.ListRequest.items.push(itemInfo);
    });

    //Trigger the AJAX call
    var options = {
      type : 'POST',
      url : url,
      data : JSON.stringify(data),
      contentType : 'application/json',
      dataType : 'json',
			crossDomain : true,
			xhrFields: {
				withCredentials: true
			},
      beforeSend: function( xhr ) {
        xhr.setRequestHeader('Authorization', accountUtility.getAuthorizationToken());
      }
    };
    return accountUtility.triggerAJAXCall(options, true);
  };

  return {
    triggerCreateListCall : triggerCreateListCall
  };
});
/**
 * Local copy
* Tooltip for showing the create list tooltip on click of the following buttons
* 1) Cart -> Add to List
* 2) PIP -> Save to List
**/
(function closure(root, factory) {
  if (typeof define === 'function' && define.amd) {
    define('account.tooltip',[
      'jquery',
      'list.model'
    ], function load(jQuery, model) {
      return factory(root, jQuery, model);
    });
  } else {
    // For non-AMD module, expose this to global (will also be useful for test cases)
    factory(root, jQuery, model);
  }
})(this, function factory(root, $, model) {

  /**
  * @Description: Helps to customize the tooltip 
  *
  * @Param: $tooltip - Object that holds the tooltip content
  * @Param: options - Pass the required options for customizing the tooltip
  *   Accepted options are the following :-
  *     1) width : Width of the tooltip
  *     2) $trigger : DOM element from which the event was triggered
  *     3) tipLocation : Helps to identify the tip. Accepts right and left values
  **/
  var $tooltipGlobal,
      optionsGlobal;

  var setPosition = function () {

    //Defaulting the values, if not present
    var $tooltip = $tooltipGlobal, 
        options = optionsGlobal,
        tooltipContainerWidth = 0;
    if(model.getIsMobileChannel()){
      tooltipContainerWidth = 260;
    } else {
      tooltipContainerWidth = 345;
    }
    var defaults = {
          width : tooltipContainerWidth,
          $trigger : $('body'),
          tipLocation : 'right'
        };

    $.extend(true, defaults, options);

    var topPosition, 
        leftPosition,
        notchHeight = 40,
        notchWidth = 40,
        notchLocation = defaults.tipLocation,
        notchPosition = 0,
        $trigger = defaults.$trigger,
        itemParams = [],
        itemId = '',
        selector = model.getSelectorInfo(),
        triggerPosition;

    if ($trigger.parents('body').length === 0 && selector) {
      itemParams = model.getItems();
      itemId = itemParams[0].itemId;
      $trigger = $(selector + '[data-itemid="' + itemId + '"]:first');
      if ($trigger.length === 0) {
        $trigger = $('body');
      }
    }
    triggerPosition = $trigger.offset();

    //Evaluating the tip location and position
    $tooltip.outerWidth(defaults.width);

    if(notchLocation === 'right') {
      notchPosition = ($tooltip.outerWidth() - (($trigger.width() / 2) + notchWidth));
    } else {
      notchPosition = ((notchLocation === 'left') ? 0 : ($tooltip.outerWidth() / 2));
    }

    //Calculate the top and left position to align the tooltip
    topPosition = triggerPosition.top + $trigger.outerHeight() + notchHeight / 2;
    leftPosition = triggerPosition.left - notchPosition;
    if(leftPosition < 0) {
      leftPosition = 0;
    }

    //Customize based on the derived styles
    $tooltip.css({'top': topPosition, 'left': leftPosition})
          .addClass((notchLocation + '-notch'));
  };

  /**
  * @Description: Helps to generate the tooltip with given content
  * HTML Structure:
  *  <div class="tooltip__content">
  *    <button class="tooltip__content__btn--close">x</button>
  *    <content></content>
  *  </div>
  *
  * @Param: $content - Will be injected into the tooltip
  **/
  var injectContentToToolTipHolder = function ($content, options) {

    var $tooltip = $('.tooltip__content');

    //Checking if the Tooltip content is already present
    if ($tooltip.length > 0) {
      $tooltip.find('.content').html($content);
    } else {
      //Construct the tooltip 
      var $closeBtn = $('<button />').addClass('tooltip__content__btn--close')
                        .html('x')
                        .on('click', function() {
                          $tooltip.remove();
                        }),
          $contentDiv = $('<div />').addClass('content')
                      .html($content);

      $tooltip = $('<div />').addClass('tooltip__content u__text-align--left account--global__patch')
                  .html($closeBtn)
                  .append($contentDiv);

      $('body').append($tooltip);

    }
    $tooltipGlobal = $tooltip;
    optionsGlobal = options;

    //Customize the tooltip
    setPosition();
  };

  $(document).off('accountTooltipPosition').on('accountTooltipPosition', setPosition);

  $(window).resize(function() {
    if($('.tooltip__content').length > 0) {
      setTimeout(function() {
        $(document).trigger('accountTooltipPosition');
      }, 100);
    }
  });

  /**
  * @Description: Helps to hide the tooltip
  **/
  var hideTooltip = function() {
    $('.tooltip__content').remove();
  };

  return {
    showTooltip : injectContentToToolTipHolder,
    hideTooltip : hideTooltip
  };
});
/**
* Helps to get the success and error messages
**/
(function closure(root, factory) {
  if (typeof define === 'function' && define.amd) {
    define('list.message',[
      'jquery',
      'account.utility',
      'account.tooltip',
      'account.modal',
      'list.constants',
      'list.model'
    ], function load(jQuery, accountUtility, toolTip, dialog, Constants, model) {
      return factory(root, jQuery, accountUtility, toolTip, dialog, Constants, model);
    });
  } else {
    // For non-AMD module, expose this to global (will also be useful for test cases)
    /*eslint-disable*/
    factory(root, jQuery, accountUtility, toolTip, dialog, Constants, model);
    /*eslint-enable*/
  }
})(this, function factory(root, $, accountUtility, toolTip, dialog, Constants, model) {

  /**
  * @Description: Helps to display the generic error tooltip
  *
  * @Param: $this - Element displaying the error message
  **/
  var showGenericErrorTooltip = function ($this) {
      var errorMessage = Constants.getError(Constants.getCode('ERR_GENERIC')),
          $title = $('<span />', {'class': 'alert-inline__title'}).html(errorMessage.title),
          $content = $('<span />', {'class': 'alert-inline__message u__block'}).html($title).append(errorMessage.content),
          $divError = $('<div />', {'class': 'alert-inline alert-inline--danger'}).html($content),
          $header = $('<h2 />',{'class': ''}).html('Error'),
          options = {'height': 'auto; min-height: 60px;'};
      
      if(model.getSource() === "checkavailability") {
    	  dialog.showModal($divError, $header, false, options, model.getIsMobileChannel());
      } else {
    	  toolTip.showTooltip($divError, {
    	        $trigger : $this
    	  }); 
      }
 };

  /**
  * @Description: Helps to show the success tooltip
  *
  * @Param: response - Response from the API
  * @Param: $this - Element from model
  **/
  var showSuccessMessageTooltip = function (response, $this, listNameFromUI) {

    //Close the previous modal
    dialog.hideModal();
    if (!response || !response.ListResponse || response.ListResponse.errorData) {
      showGenericErrorTooltip($this);
    } else {

      var listName = response.ListResponse.listName || listNameFromUI,
          successMessage = 'Item has been saved to ';

      var $listConfirmTitle = $('<span />').addClass('alert-inline__title').html(listName),
          $listConfirmMessage = $('<span />', {'title': listName}),
          $listSuccess = $('<div />').addClass('alert-inline alert-inline--success').html($listConfirmMessage),
          $viewList = $('<a />', {'href': Constants.URLS.LIST_DETAILS_URL(response.ListResponse.listId)}).addClass('u__default-link').html('View List'),
          $content = $('<div />'),
          $header = $('<h2 />').html('Save to List Confirmation'),
          options = {'height': 'auto; min-height: 60px;'};
         
      $listConfirmMessage
        .addClass('alert-inline__message')
        .html(successMessage)
        .append($listConfirmTitle);

      $content
        .addClass('create-list__confirm')
        .html($listSuccess)
        .append($viewList);

      if(model.getSource() === "checkavailability") {
      	  dialog.showModal($content, $header, false, options, model.getIsMobileChannel());
      } else {
	      toolTip.showTooltip($content,{
	        $trigger : $this
	      });
      }
    }
  };

  return {
    'showSuccessMessage' : showSuccessMessageTooltip,
    'showGenericError' : showGenericErrorTooltip
  };

});
/**
* Analytics AMD for pushing the events into the DDO object
**/
(function closure(root, factory) {
  if (typeof define === 'function' && define.amd) {
    define('list.analytics',[], function load() {
      return factory(root);
    });
  } else {
    // For non-AMD module, expose this to global (will also be useful for test cases)
    /*eslint-disable*/
    factory(root);
    /*eslint-enable*/
  }
})(this, function factory(root) {

  /**
  * @Description: Helps to push the events info, when the digital data is present
  *
  * @Param: analyticsEventInfo
  **/
  var pushEventInfo = function(analyticsEventInfo) {
    if(digitalData !== null && digitalData !== undefined && digitalData.event !== undefined) {
      digitalData.event.push(analyticsEventInfo);
    }
  };

  /**
  * @Description: Helps to push the event object for save to list modal
  *
  **/
  var pushSaveToListEventInfo = function() {
    try{
      var thdAnalyticsEvent = {
        category : {
          primaryCategory : "overlay"
        },
        eventInfo : {
          eventName : "save to your list"
        }
      };
      pushEventInfo(thdAnalyticsEvent);
    } catch(err) {
      //Suppress the error, so that functionality is not broken
      console.warn('DDO: Error in pushing the save to list event info');
    }
  };

  /**
  * @Description: Helps to push the event object for sign-in prompt overlay
  *               for non authenticated users
  *
  **/
  var pushSignInPromptOverlayEventInfo = function() {
    try{
      var thdAnalyticsEvent = {
        category : {
          primaryCategory : "overlay"
        },
        eventInfo : {
          eventName : "sign in prompt"
        }
      };
      pushEventInfo(thdAnalyticsEvent);
    }catch(err) {
      //Suppress the error, so that functionality is not broken
      console.warn('DDO: Error in pushing the sign-in overlay event info');
    }
  };

  /**
  * @Description: Helps to push the event object for create a list
  *
  **/
  var pushCreateListEventInfo = function() {
    try{
      var thdAnalyticsEvent = {
        category : {
          primaryCategory : "overlay"
        },
        eventInfo : {
          eventName : "create a list"
        }
      };
      pushEventInfo(thdAnalyticsEvent);
    } catch(err) {
      //Suppress the error, so that functionality is not broken
      console.warn('DDO: Error in pushing the create list event info');
    }
  };

  var formatPrice = function(price) {
    return  price ? (price + "").replace('$',"") : "0";
  };

  /**
  * @Description: Helps to push the item details when the add to list functionality is sucessfull.
  *
  **/
  var pushItemDetailsEventInfo = function(primaryCategory, eventName, listLocation, item, isCallFromTooltip) {
    try{
      var thdAnalyticsEvent = {
        category : {
          primaryCategory : primaryCategory
        },
        eventInfo : {
          eventName : eventName
        },
        item : [
          {
            listLocation : listLocation,
            quantity : item.quantity,
            price : {
              basePrice : formatPrice(item.price)
            },
            productInfo : {
              sku : item.itemId
            }
          }
        ]
      };
      var creationLocation = null;
      if(eventName === "list add") { //Adding the item to existing list
          creationLocation = "save to your list overlay";
      } else if(eventName === "create list") {
        if(isCallFromTooltip) { //Creating the list from tooltip
          creationLocation = "create a list overlay";
        } else { //Creating the list from modal
          creationLocation = "save to your list overlay";
        }
      }

      if(null !== creationLocation) {
        $.extend(true, thdAnalyticsEvent, {
          myList : {
            creationLocation : creationLocation
          },
        });
      }

      pushEventInfo(thdAnalyticsEvent);
    } catch(err) {
      //Suppress the error, so that functionality is not broken
      console.warn('DDO: Error in pushing the item details event info');
    }
  };

  return {
    pushSaveToListEventInfo : pushSaveToListEventInfo,
    pushSignInEventInfo : pushSignInPromptOverlayEventInfo,
    pushCreateListEventInfo : pushCreateListEventInfo,
    pushItemDetailsEventInfo : pushItemDetailsEventInfo
  };
});
/**
* The JS holds the functionality related to Save to List. 
* Do not duplicate the functions or http calls, if available in another file.
* Make sure, it is added as a service function in the account.global.js
**/
(function closure(root, factory) {
  if (typeof define === 'function' && define.amd) {
    define('list.create',[
      'jquery',
      'list.constants',
      'list.model',
      'list.helper',
      'list.message',
      'account.modal',
      'list.analytics'
    ], function load(jQuery, Constants, model, helper, message, dialog, analytics) {
      return factory(root, jQuery, Constants, model, helper, message, dialog, analytics);
    });
  } else {
    // For non-AMD module, expose this to global (will also be useful for test cases)
    /*eslint-disable*/
    factory(root, jQuery, Constants, model, helper, message, dialog, analytics);
    /*eslint-enable*/
  }
})(this, function factory(root, $, Constants, model, helper, message, dialog, analytics) {

  /**
  * @Description: Helps to display error scenario for the create list
  *
  * @Param: $this - Current input element
  * @Param: errorMessage 
  **/
  var displayErrorMessage = function ($this, errorMessage) {
    
    var $input = $this.find('.form-input'),
        errorClass = 'form-input--error',
        $btn = $input.parents('form').find('#createList');

    //Flushing out the previous error message
    $this.find('.form-input-error__message').remove();

    if (errorMessage) {

      $input
        .addClass(errorClass)
        .append($('<span />').addClass('form-input-error__message').html(errorMessage));

      $input.find('input').focus();
      $btn.attr({'disabled': 'disabled'}).addClass('disabled');

    } else {
      //If no error, clean up the previous error message
      $input.removeClass(errorClass);
      $btn.removeAttr('disabled').removeClass('disabled');
    }
  };

  /**
  * @Descrption: Helps to validate the list name
  *
  * @Param: $this - Handler to the current input element
  **/
  var validateListName = function ($this) {
    var errMsg,
       listName = $.trim($this.find('#listName').val()),   
        errorStatus = false;
    if (listName === "") {
      errMsg = Constants.getError(Constants.getCode('ERR_CD_MANDATORY_LIST_NAME'));
    } else if (listName.length > 50) {
      errMsg = Constants.getError(Constants.getCode('ERR_CD_LIST_NAME_MAX_LENGTH'));
    } else if (listName.match(/[`<>\/~]+.*$/)) {
      errMsg = Constants.getError(Constants.getCode('ERR_CD_LIST_NAME_SPL_CHARS'));
    }
    displayErrorMessage($this.parent(), errMsg);

    return (!errMsg);
  };


  /**
  * @Descprion: Helps tp create the list
  **/
  var createList = function (event) {
    event.preventDefault();
    var $this = $(this),
        listName = $('#createForm').find('#listName').val(),
        isTooltip = $('#listName').data('tooltip') === true;

    if (validateListName($this)) {
      model.setListName(listName);

      //Trigger the create list call and handle it for success and error
      var ajaxHandler = helper.triggerCreateListCall(listName);

      ajaxHandler.done(function(responseData){
        //Clear the list name from model and show the success message 
        model.setListName('');
        message.showSuccessMessage(responseData, model.getTrigger(),listName);

        var items = model.getItems();
            item = {};
        if(items && items.length > 0) {
          item = model.getItems()[0];
        }

        analytics.pushItemDetailsEventInfo("interaction", "create list", model.getSource(), item, isTooltip);

      }).fail(function(errorData){

        //Extracting the error json from response
        var errorJson = (errorData && errorData.responseText) ? $.parseJSON(errorData.responseText) : {};
        errorJson = (errorJson && errorJson.ListResponse && errorJson.ListResponse.errorData && errorJson.ListResponse.errorData.errors) ? errorJson.ListResponse.errorData.errors : {},
            duplicateErrorCode = 'ERR_CD_EXISTING_LIST_NAME';
            duplicateErrorMessage = Constants.getError(Constants.getCode(duplicateErrorCode));

        if (errorJson && errorJson.length > 0 && errorJson[0].id === Constants.getCode(duplicateErrorCode)) {
          displayErrorMessage($('.listOfLists__create-item'), duplicateErrorMessage);
        } else {
          dialog.hideModal();
          message.showGenericError(model.getTrigger());
        }
      });
    }
  };

  /**
  * @Description: Helps to enable the button based on the validation of list name
  *
  * @Param: event
  * @Param: $this - Input element
  * @Param: $buttonToDisable - Button to be disabled
  **/
  var enableButton = function (event, $this, $buttonToDisable) {
    
    //Enable and disable the button based on the validation of list name
    if(validateListName($this)) {
      $buttonToDisable.removeAttr('disabled').removeClass('disabled');
    } else {
      $buttonToDisable.attr({'disabled': 'disabled'}).addClass('disabled');
    }
  };

  /**
  * @Description: Helps to create content for create new list
  *
  * @Param: isModal - Helps to identify, if the request is from modal or not
  * @Param: buttonToDisable
  **/
  var getContentForCreateList = function (isModal, buttonToDisable) {
    
    //Default to false for isModal, if not passed
    isModal = isModal || false;

    var $listLabelText = $('<span />').addClass('form-input__label-content').html('Name Your List'),
        $listLabel = $('<label />', {'for': 'listName'}).addClass('form-input__label').html($listLabelText),
        $listInput = $('<input />', {'type': 'text', 'id': 'listName', 'maxlength': '50', 'autofocus': 'true', 'autocomplete': 'off','data-tooltip' : !isModal}).addClass('form-input__field'),
        $listParent = $('<div />').addClass('form-input create-list').html($listLabel).append($listInput),
        $content = $('<form />', {'method': 'post', 'name': 'createForm', 'id': 'createForm'}),
        $buttonText = $('<span />').addClass('bttn__content').html('CREATE A LIST'),
        $button = $('<button />', {'id': 'createList', 'disabled': 'disabled'}).addClass('bttn bttn--primary disabled').html($buttonText);

    $content
      .html($listParent)
      .on('input', function(event){
        event.preventDefault();
        buttonToDisable = buttonToDisable || $button;
        enableButton(event, $(this), buttonToDisable);
      })
      .on('submit', createList);

    //Append the button, if the content is for tooltip
    if (!isModal) {
      $content.append($button);
    } 

    return $content;
  };

  return {
    getContentForCreateList : getContentForCreateList,
    displayErrorMessage: displayErrorMessage
  };

});

/**
* Helps to diplay the modal for all lists when the user has lists in his account
**/
(function closure(root, factory) {
  if (typeof define === 'function' && define.amd) {
    define('list.show',[
      'jquery',
      'account.utility',
      'list.create',
      'account.modal',
      'list.helper',
      'list.model',
      'list.constants',
      'list.message',
      'list.analytics'
    ], function load(jQuery, accountUtility, createList, dialog, helper, model, Constants, message, analytics) {
      return factory(root, jQuery, accountUtility, createList, dialog, helper, model, Constants, message, analytics);
    });
  } else {
    // For non-AMD module, expose this to global (will also be useful for test cases)
    /*eslint-disable*/
    factory(root, jQuery, accountUtility, createList, dialog, helper, model, Constants, message, analytics);
    /*eslint-enable*/
  }
})(this, function factory(root, $, accountUtility, createList, dialog, helper, model, Constants, message, analytics) {

  var focusPosition = function ($this) {
    var outerHeightValue = 0,
        scrollPosition = 0,
        topPosition = $this.position().top,
        $parentContent = $this.parents('.content'),
        parentContentHeight = $parentContent.outerHeight(),
        thisOuterHeight = $this.outerHeight();
    if (topPosition < 0 || (parentContentHeight < (topPosition + thisOuterHeight))) {
      outerHeightValue = (parentContentHeight < (topPosition + thisOuterHeight)) ? thisOuterHeight : 0;
      scrollPosition = $parentContent.scrollTop() + (outerHeightValue - (parentContentHeight - topPosition));
      $parentContent.animate({'scrollTop': scrollPosition}, accountUtility.getAnimatePace());
    }
    $this.find('input').focus();
  };

  /**
  * @Description: Helps to select the tile for adding the item to list
  *               or create a new list and save the item into it
  *
  * @Param: $this - current tile
  * @Param: $saveListbtn - Handler to the SAVE button
  **/
  var selectListTile = function ($this, $saveListBtn) {
    var selected = 'listOfLists__selected',
        hasSelected = $this.hasClass(selected),
        $child,
        $selected = $('.' + selected),
        modelImage;

    if (!hasSelected) {
      if ($('.listOfLists__create-item').hasClass(selected)) {
        $('.listOflists__input').empty();
      }
      if ($selected.length > 0) {
        $selected.removeClass(selected);
        $selected = $selected.find('.listOfLists__thumbspace');
        if ($selected.data('src') !== '') {
          if ($selected.data('src') === 'noimage') {
            $selected.addClass('noimage').find('img').remove();
            $selected.children().show();
          } else {
            $selected.children().attr('src', $selected.data('src'));
          }
          $selected.removeAttr('data-src');
        }
      }
      $this.addClass(selected);

      $child = $this.find('.listOfLists__thumbspace');
      modelImage = model.getItems()[0].imageURL;
      if ($child.children().length !== 1) {
        $child.removeClass('noimage').attr('data-src', 'noimage');
        $child.children().hide();
        $('<img />', {'src': modelImage, 'style' : 'max-height:100px;max-width:100px'}).appendTo($child);
      } else {
        $child.attr('data-src', $child.children().attr('src'));
        $child.children().attr('src', modelImage);
        $child.children().attr('style' , 'max-height:100px;max-width:100px');
      }
      if(!$('.listOfLists__create-item').hasClass(selected)) {
        $saveListBtn.removeAttr('disabled').removeClass('disabled');
      } else {
        $saveListBtn.attr({'disabled': 'disabled'}).addClass('disabled');
      }
    }
    return (!hasSelected);
  };


  /**
  * @Description: Helps to create the "Create List" input at the end of list
  *
  * @Param: $this - Handler to create list input
  * @Parama: $saveListBtn - Handler to save list button
  **/
  var showCreateList = function ($this, $saveListBtn) {
    if (selectListTile($this, $saveListBtn)) {
      $this.find('.listOflists__input').html(createList.getContentForCreateList(true, $saveListBtn));
    }
    focusPosition($this);
  };

  /**
  * @Description: Helps to add item to list
  **/
  var addItemToList = function () {
    var $selectedList = $('.listOfLists__selected'),
        listObject = {};
    if ($selectedList.hasClass('listOfLists__create-item')) {
      $selectedList.find('#createForm').submit();
    } else {
      //Trigger AJAX call
      var ajaxHandler = helper.triggerCreateListCall($selectedList.data('list-name'), $selectedList.data('list-id'));

      ajaxHandler.done(function(responseData){
        //Clear the list name from model and show the success message
        model.setListName('');
        message.showSuccessMessage(responseData, model.getTrigger(),$selectedList.data('list-name'));

        var items = model.getItems();
            item = {};
        if(items && items.length > 0) {
          item = model.getItems()[0];
        }

        analytics.pushItemDetailsEventInfo("button submission", "list add", model.getSource(), item, false);

      }).fail(function(errorData){

        //Extracting the error json from response
        var errorJson = (errorData && errorData.responseJSON && errorData.responseJSON.ListResponse && errorData.responseJSON.ListResponse.errorData && errorData.responseJSON.ListResponse.errorData.errors) ? errorData.responseJSON.ListResponse.errorData.errors : {},
            duplicateErrorCode = 'ERR_CD_EXISTING_LIST_NAME';
            duplicateErrorMessage = Constants.getError(Constants.getCode(duplicateErrorCode));

        if (errorJson && errorJson.length > 0 && errorJson[0].id === Constants.getCode(duplicateErrorCode)) {
          createList.displayErrorMessage($('.listOfLists__create-item'), duplicateErrorMessage);
        } else {
          dialog.hideModal();
          message.showGenericError(model.getTrigger());
        }
      });
    }
  };

  /**
  * @Description: Helps to get the modal and show the list
  *
  * @Param: lists - List of lists 
  **/
  var displayAllList = function (lists) {
    /**
     * Inserting the "Create a new List" button
     */
    var $listThumbImage,
        $createSign = $('<span />').html('&#10133;').addClass('listOfLists__createSign'),
        $createText = $('<h4 />').html('CREATE A NEW LIST').addClass('body__p-top-small'),
        $listThumb = $('<div />').addClass('listOfLists__thumbspace noimage').html($createSign).append($createText),
        $listItem,
        $listInputContainer = $('<div />').addClass('listOflists__input body__p-top-small'),
        $listItemCreate = $('<div />').addClass('listOfLists__item body__m-right-medium body__m-bottom-medium listOfLists__create-item').html($listThumb).append($listInputContainer),
        $listDiv = $('<div />').addClass('listOfLists'),
        $listName,
        $header = $('<h2 />').html('Save to Your List'),
        $saveListText = $('<span />').addClass('bttn__content').html('SAVE TO LIST'),
        $saveListBtn = $('<button />', {'disabled': 'disabled', 'id': 'listSaveControl'}).addClass('bttn bttn--primary bttn--inline disabled').html($saveListText),
        $listCount,
        modelHeight = ($(window).height() - 200),
        finalHeight = ((modelHeight > 450) ? 450 : modelHeight ),
        options = {'height': finalHeight + 'px', 'min-height': finalHeight + 'px', 'width' : 'auto'};

    $listItemCreate.on('click', function() { 
      showCreateList($(this), $saveListBtn); 
    });

    /**
     * Looping through the list and pushing into the list items (sort by descending with last item as create list)
     */
    $.each(lists, function(index, eachList) {
      $listThumbImage = $('<img />', {'src': eachList.firstOrderItemURL, 'style' : 'max-height:100px;max-width:100px'});
      $listThumb = $('<div />').addClass('listOfLists__thumbspace');
      $listName = $('<strong />').addClass('listOfLists__name').html(eachList.listName);
      $listCount = $('<p />').addClass('listOfLists__count').html(((eachList.noOfItems) ? eachList.noOfItems : 0) + ' items');
      $listItem = $('<div />', {'data-list-id': eachList.listId, 'data-list-name': eachList.listName}).addClass('listOfLists__item body__m-right-medium body__m-bottom-medium');

      /**
       * Adding the image url based on the firstOrderItemURL. If not this will add the grey background with "noimage" class
       */
      if (eachList.firstOrderItemURL) {
        $listThumb.html($listThumbImage);
      } else {
        $listThumb.addClass('noimage');
      }

      /**
       * Appending the existing list image, name, count in list item and prepending in list items
       */
      $listItem
        .html($listThumb)
        .append($listName)
        .append($listCount);

      $listItem.on('click', function() { 
        selectListTile($(this), $saveListBtn); 
        focusPosition($(this));
      });
      $listDiv.append($listItem);
    });
    $listDiv.append($listItemCreate);

    $saveListBtn.on('click',addItemToList);

    dialog.showModal($listDiv, $header, $saveListBtn, options, model.getIsMobileChannel());
    
    if(model.getIsMobileChannel()){
         var widthOfItems = ($('.account-modal__content').width() - 40) + "px";
         $('.listOfLists__item').attr('style','width:'+ widthOfItems);
         var heightOfContent = (window.innerHeight - ($('.account-modal__footer').outerHeight() + $('.account-modal__header').outerHeight() + 80)) + "px";
       $('.content').attr('style','overflow-y: auto; height:'+ heightOfContent);
    }

    
  };

  return {
    showListModal : displayAllList
  };
  
});
(function closure(root, factory) {
	if (typeof define === 'function' && define.amd) {
		define('list.view',[
			'jquery',
			'cookie-utils',
			'thd-overlay',
			'auth.service'
		], function load(jQuery, cookieUtils, Overlay, authService) {
			return factory(root, jQuery, cookieUtils, Overlay, authService);
		});
	} else {
		// For non-AMD module, expose this to global (will also be useful for test cases)
		/*eslint-disable*/
		factory(root, jQuery, cookieUtils, Overlay, authService);
		/*eslint-enable*/
	}
})(this, function factory(root, $, cookieUtils, Overlay, authService) {

	var overlay = null,
		isMobile = false,
		analytics = null,
		parameters = {};

	var privateMethods = {};

	const COOKIE_AUTH_TOKEN = "THD_AUTHORIZATION_TOKEN",
		COOKIE_USER_SESSION = "THD_USER_SESSION",
		COOKIE_CUSTOMER = "THD_CUSTOMER",
		COOKIE_USER = "THD_USER",
		COOKIE_GUESTLIST = "THD_GUESTLIST",
		secureHostName = (THD_GLOBAL.nonSecureHostName) ? ('https://' + THD_GLOBAL.nonSecureHostName) : 'https://www.homedepot.com',
		OP_CODE_CREATE = 1,
		OP_CODE_UPDATE = 2,
		ERR_CD_EMPTY_LIST = 'MYLIST_ERR_100',
		ERR_CD_DUPLICATE_LIST = 'MYLIST_ERR_007',
		ERR_CD_INVALID_AUTH = 'AUTH_ERR_106',
		MY_FAVORITES = 'My Favorites',
		GUEST_MEMBER_ID = 'GUEST_MEMBER_ID',
		GUESTLIST_HMAC_ENABLED = 'GUESTLIST_HMAC_ENABLED',
		GUESTLIST_ENABLED = 'GUESTLIST_ENABLED';

	var CLIENT_ID = '',
		TIMESTAMP = 0,
		ENV = '';

	//Content holder. Will append the remaining contents inside this
	const template = $([
		'<div class="list--save grid col__12-12" id="listSaveExternal" style="width:512px;height:275px">',
		'</div>'
	].join(""));

	const listViewTemplate = $([
		'<div class="col__5-12 list--save__thumbnail">',
		'<div>',
		'<div class="list--save__holder" id="holder"></div>',
		'</div>',
		'</div>',
		'<div class="col__7-12 list--save__content">',
		'<div>',
		'<div class="list--save__holder" id="listContent"></div>',
		'</div>',
		'</div>'
	].join(""));

	const createListLink = [
		'<div class="list--save__create" id="twoClickCreateList">',
		'<div><span>+</span></div>',
		'<a class="u__default-link" href="#">Create New</a>',
		' </div>'
	].join("");

	const createListTemplate = [
		'<span class="form-input list--save__content-form" id="twoClickCreateListForm">',
		'<label class="form-input__label" for="twoClickListName" data-content="List Name">',
		'<span class="form-input__label-content">List Name</span>',
		'</label>',
		'<input class="form-input__field" type="text" id="twoClickListName">',
		'<span class="form-input-error__message"></span>',
		'</span>',
		'<button class="bttn bttn--primary bttn--inline btnSave" id="twoClickSave">',
		'<span class="bttn__content">' + (isB2BUser() ? 'Save to List' : 'Save to Favorites') + '</span>',
		'</button>'
	].join("");

	function generateMessageContent(isSuccessMsg, title, content, listId, requestParams) {
		const msgClass = isSuccessMsg ? 'alert-inline--success' : 'alert-inline--danger',
			viewListEnabled = isSuccessMsg ? 'u--show' : 'u--hide',
			redirectUrl = isB2BUser() ? '/b2b/account/view/list/details/' : '/list/view/details/';
		const messageTemplate = [
			'<div class="alert-inline ' + msgClass + '">',
			'<span class="alert-inline__message">',
			'<span class="alert-inline__title">' + title + '! </span>',
			content,
			'</span>',
			'</div>',
			'<div class="list--link ' + viewListEnabled + '">',
			'<a class="u__default-link" href="' + secureHostName + redirectUrl + listId + '">' + (isB2BUser() ? 'View List' : 'View Favorites') + '</a>', //TODO: Change the list URL to new Github once deployed
			'</div>'
		].join("");


		const overlayContent = $(overlay.iframe).find('div#listSaveExternal');
		overlayContent.find('div#listContent').html(messageTemplate);

		if (isGuestUser()) {
			$(overlay.iframe).append(generateConfirmationFooter(requestParams));
			if (isMobile) {
				$(overlay.iframe).find('div#listSaveFooter').removeClass('list--save__footer');
			}
		} else {
			if (!isMobile) {
				overlayContent.css('height', '200px');
				overlay.resizeOverlayToContent();
			}
		}

		if (isSuccessMsg && !isMobile) {
			overlayContent.find('div#listContent').find('div.alert-inline--success').css({ 'max-width': '275px' });
		}

		isSuccessMsg && overlay.setTitle('Save Confirmed');
	};

	function generateConfirmationFooter(requestParams) {
		const template = [
			'<div class="col__12-12 list--save__footer" id="listSaveFooter">',
			'<span class="u__bold">Don\'t lose track of your favorites!</span> Save items to your favorites to come back to later from any device. ',
			'Just <a href="#" class="u__default-link" data-action="signin">sign in</a> or ',
			'<a href="#" class="u__default-link" data-action="register">create an account</a>.',
			'</div>'
		].join("");
		return template;
	};

	function generateGenericErrorMessage() {
		const errorMessageTitle = 'We\'re Sorry.',
			errorMessageContent = 'We are currently unable to save this item to your list. Please try again later.';
		const errorMessageTemplate = [
			'<div class="alert-inline alert-inline--danger" style="margin-bottom: 25px;">',
			'<span class="alert-inline__message">',
			'<span class="alert-inline__title">' + errorMessageTitle + '</span>',
			errorMessageContent,
			'</span>',
			'</div>',
		].join("");

		const content = $(overlay.iframe).find('div#listSaveExternal');
		content.html($(errorMessageTemplate));
		content.css({
			width: '415px',
			height: 'auto'
		});
		$(overlay.header).removeClass('thd-overlay__header');
		overlay.setTitle('');
		overlay.resizeOverlayToContent();

		analytics.trackOverlayLoadError('', (errorMessageTitle + ' ' + errorMessageContent)); //TODO: To get the genric error code
	}

	function generateListSummary(listName, listId) {
		return ['<div class="list--save__summary" data-name="' + listName + '" data-id="' + listId + '">',
			'<span>',
			listName,
			'</span>',
			'<button class="bttn bttn--primary bttn--inline"><span class="bttn__content">Save</span></button>',
			'</div>'
		].join("");
	};

	/**
	 * Check if the favorites are present or not
	 */
	function checkForMyFav(data) {
		var listId = null;
		if (data) {
			var matchingElement = data.filter(function (element) {
				return element && $.trim(element.listName) === MY_FAVORITES;
			});
			listId = (matchingElement && matchingElement.length === 1) ? matchingElement[0].listId : null;
		}
		return listId;
	}

	/**
	 * Generate the content for single and multiple list for the registered user
	 */
	function generateContent(requestParams, data, isPersistentFromAPI) {
		
		isPersistentFromAPI = isPersistentFromAPI || false;
		openOverlay(isPersistentFromAPI);

		const overlayContent = $(overlay.iframe);

		overlayContent.find('div.list--save__thumbnail div#holder').html('<img src="' + requestParams.item.imageURL + '" />');
		var listItem = ['<div id="listSummaryContainer" class="list--save__scroll">'];
		if (data !== null) {
			var favListId = checkForMyFav(data);
			listItem.push(generateListSummary(MY_FAVORITES, (favListId !== null) ? favListId : ''));
			for (var count = 0; count < data.length; count++) {
				var listName = (data[count] ? data[count].listName : '') || '', // Error happens gracefully handle
					listId = (data[count] ? data[count].listId : '') || ''; // Error happens gracefully handle

				if (listName !== MY_FAVORITES) {
					listItem.push(generateListSummary(listName, listId));
				}
			}

		} else {
			listItem.push(generateListSummary(MY_FAVORITES, ''));
		}
		listItem.push('</div>');

		!isGuestUser() && listItem.push(createListLink);

		overlayContent.find('div#listSaveExternal div#listContent').html(listItem.join(""));

		!isMobile && overlayContent.find('div#listSaveExternal').css('width', '510px');

		overlayContent.find('div#listSummaryContainer > div:first').addClass('selected');

		//If no scrollbar, remove the faded effect at the bottom
		removeScrollEffects(overlayContent.find('div#listSummaryContainer'));


		overlay.resizeOverlayToContent();

		eventListSelection(requestParams, isPersistentFromAPI);

		//Analytics
		analytics.trackChooseAListOverlay();
	};

	/**
	 * Function helps to remove the scroll faded effect at the bottom of the container
	 */
	function removeScrollEffects(element) {
		if (element && (element.get(0).scrollHeight <= element.height())) {
			element.removeClass('list--save__scroll');
		}
	}

	/**
	 * Bind the events for adding an item to a list
	 */
	function eventListSelection(requestParams, isPersistentFromAPI) {
		const overlayContent = $(overlay.iframe);

		$(document).off('mouseover touchend', 'div#listSummaryContainer > div')
			.on('mouseover touchend', 'div#listSummaryContainer > div', function (event) {
				event.preventDefault();
				overlayContent.find('div#listSummaryContainer > div').removeClass('selected');
				$(this).addClass('selected');
			});

		$(document).off('click touchend', 'div#listSummaryContainer > div > button')
			.on('click touchend', 'div#listSummaryContainer > div > button', function (event) {
				event.preventDefault();
				var $parent = $(this).parent(),
					listName = $.trim($parent.data('name')),
					listId = $.trim($parent.data('id'));
				if ($parent.hasClass('selected')) {
					if (listId !== '') {
						addItemToList(OP_CODE_UPDATE, {
							listName: listName,
							listId: listId
						}, requestParams);
					} else {
						addItemToList(OP_CODE_CREATE, {
							listName: listName
						}, requestParams);
					}
				}

			});

		$(document).off('click', 'div#twoClickCreateList')
			.on('click', 'div#twoClickCreateList', function (event) {
				event.preventDefault();

				// Modifying the overlay title
				overlay.setTitle('Create a List');
				overlayContent.find('div#listSaveExternal div#listContent').html($(createListTemplate));

				overlayContent.find('div#listSaveExternal div#listContent')
					.find('input#twoClickListName').focus();

				//Analytics
				analytics.trackCreateListOverlay();
			});

		//Handling the enter in the create list field
		$(document).off('keypress', 'input#twoClickListName')
			.on('keypress', 'input#twoClickListName', function (event) {
				if (event.keyCode === 13) {
					overlayContent.find('button#twoClickSave').trigger('click');
					event.preventDefault();
				}
			});

		$(document).off('click', 'button#twoClickSave')
			.on('click', 'button#twoClickSave', function (event) {
				event.preventDefault();
				overlayContent.find('span#twoClickCreateListForm').removeClass('form-input--error');
				var listName = $('#twoClickListName').val();
				if (validateListName(listName)) {
					addItemToList(OP_CODE_CREATE, {
						listName: listName
					}, requestParams);
				}
			});

		$('div#listSummaryContainer').scroll(function (event) {
			if (Math.floor($(this)[0].scrollHeight - $(this).scrollTop()) <= ($(this).outerHeight() + 5)) {
				$(this).removeClass('list--save__scroll');
			} else if (!$(this).hasClass('list--save__scroll')) {
				$(this).addClass('list--save__scroll');
			}
		});

		$(document).off('click', 'div#listSaveFooter a')
			.on('click', 'div#listSaveFooter a', function (event) {
				event.preventDefault();
				var isRegisterTab = ($(this).data('action') === 'register') ? true : false;
				authenticateUser(isMobile, parameters, isRegisterTab);
			});
	};

	/**
	 * Helps to show the inline error message
	 */
	function showInlineError(message) {
		const overlayContent = $(overlay.iframe);
		overlayContent.find('span#twoClickCreateListForm').addClass('form-input--error');
		overlayContent.find('span#twoClickCreateListForm').find('span.form-input-error__message').html(message);
	}

	/**
	 * Validates the list name provided by user
	 */
	function validateListName(name) {
		var isValid = true;

		name = $.trim(name);

		if (name === "") {
			// (Please enter a name for your list)
			showInlineError('Please enter a name for your list');
			isValid = false;
		} else if (name.length > 50) {
			// (You have entered more than 50 characters. Please enter a different name.)
			showInlineError('You have entered more than 50 characters. Please enter a different name.');
			isValid = false;
		} else if (name.match(/[`<>\/~]+.*$/)) {
			// (You have entered an invalid character. Only a-z, 0-9, ! @ # $ % ^ & ( ) - _ + = , . ? \" ' \ : are allowed. Please try again.)
			showInlineError('You have entered an invalid character. Only a-z, 0-9, ! @ # $ % ^ & ( ) - _ + = , . ? " \' \ : are allowed. Please try again.');
			isValid = false;
		}
		return isValid;
	};

	/**
	 * Generates the payload for adding item
	 * @param operation
	 * @param metaInfo
	 * @param requestParams
	 * @returns
	 */
	function getPayLoad(operation, metaInfo, requestParams) {
		var data,itemInfo;
		var type = 'item';
		if(requestParams && requestParams.item){
			if(requestParams.item.type !== undefined){
			    type = requestParams.item.type;
			}
		}
		if (type === 'collection') {
            data = {
				"ListRequestV2": {
					"collections": [],
					"memberId": privateMethods.getMemberId(),
					"listName": metaInfo.listName
				}
			};
			itemInfo = {
				collectionId: requestParams.item.itemId,
				collectionType: 'Space'
			};
			
			if (operation === OP_CODE_UPDATE) {
				data.ListRequestV2.listId = metaInfo.listId;
			} 
			if (isGuestUser()) {
                data.ListRequestV2.listType = 'GuestList';
			}	
			data.ListRequestV2.collections.push(itemInfo);
        } else {
            data = {
				"ListRequest": {
					"items": [],
					"memberId": privateMethods.getMemberId(),
					"listName": metaInfo.listName
				}
			};
			itemInfo = {
				catentryId: requestParams.item.itemId,
				qty: requestParams.item.quantity
			}; 
			if (requestParams.item.blindsItemId) {
			    itemInfo.configurationId = requestParams.item.blindsItemId;
		    }
			if (operation === OP_CODE_UPDATE) {
				data.ListRequest.listId = metaInfo.listId;
			}
			if (isGuestUser()) {
                data.ListRequest.listType = 'GuestList';
			} 
			data.ListRequest.items.push(itemInfo);
		}
	    return JSON.stringify(data);
	}

	/**
	 * Helps to add the items to list. If user selects a new list,
	 * it is created and then add the item
	 * @param operation
	 * @param metaData
	 * @param requestParams
	 */
	function addItemToList(operation, metaData, requestParams) {

        var type = 'item';
		if(requestParams && requestParams.item){
			if(requestParams.item.type !== undefined){
			    type = requestParams.item.type;
			}
		}
        var createListUrl , addToListUrl ;
        if(type === 'collection'){
        	createListUrl = '/customer/list/v2/createlist';
        	addToListUrl = '/customer/list/v1/addcollections'
        }else{
        	createListUrl = '/customer/list/v1/createlist';
        	addToListUrl = '/customer/list/v1/additems';
        }
		var isCreateOperation = (operation === OP_CODE_CREATE) ? true : false,
			url = (isCreateOperation) ? createListUrl : addToListUrl;

		overlay.toggleLoader(true);

		$.support.cors = true; //Fix for IE8
		var $promise = $.ajax({
			type: 'POST',
			url: secureHostName + url,
			contentType: 'application/json',
			dataType: 'json',
			xhrFields: {
				withCredentials: true
			},
			data: getPayLoad(operation, metaData, requestParams),
			beforeSend: function (xhr) {
				xhr.setRequestHeader('Authorization', privateMethods.getAuthToken());
				if (isGuestUser() && isFeatureSwitchEnabled(GUESTLIST_HMAC_ENABLED)) {
					xhr.setRequestHeader('clientId', CLIENT_ID);
					xhr.setRequestHeader('timestamp', TIMESTAMP);
					xhr.setRequestHeader('clientDelay', 0);
				}
			}
		});

		$promise.then(function (response) {
			window.dispatchEvent(new CustomEvent('ADD_TO_LIST_SUCCESS', { detail: requestParams.item.itemId}));
            var listId = '';
            if(response){
            	if(response.ListResponse){
                  listId = response.ListResponse.listId;
            	}else if(response.ListResponseV2) {
            	  listId = response.ListResponseV2.listId;
            	}
			}
			
			if(isB2BUser()){
				generateMessageContent(true, 'Nice choice', 'We\'ve saved this ' + type + ' to your list.', (isCreateOperation ? listId : metaData.listId), requestParams);
			} else {
				generateMessageContent(true,
					(isCreateOperation && (MY_FAVORITES === requestParams.listName) ? 'Great' : 'Nice choice'),
					(isCreateOperation && (MY_FAVORITES === requestParams.listName) ? 'We\'ve saved this ' + type + ' to your new favorites.' : 'We\'ve saved this ' + type + ' to your favorites.'),
					(isCreateOperation ? listId : metaData.listId),
					requestParams);
			}
			//Analaytics
			if(type === 'collection'){
				analytics.trackAddCollection(isGuestUser(), isCreateOperation, requestParams.item.itemId);
			}
			else
			analytics.trackAddItem(isGuestUser(), isCreateOperation, requestParams.source, requestParams.item.quantity,
				requestParams.item.price, requestParams.item.itemId);
		}, function (error) {
			//Extracting the error json from response
			var responseJSON = (error && error.responseText) ? JSON.parse(error.responseText) : {},
				errorJson = (responseJSON && responseJSON.ListResponse
					&& responseJSON.ListResponse.errorData && responseJSON.ListResponse.errorData.errors)
					? responseJSON.ListResponse.errorData.errors : {};

			if (errorJson && errorJson.length > 0 && errorJson[0].id === ERR_CD_DUPLICATE_LIST) {
				const errorMessage = 'You already have a list with that name. Please enter a different name.';
				showInlineError(errorMessage);
				analytics.trackInlineErrors(errorJson[0].id, errorMessage);
			} else {
				generateGenericErrorMessage();
			}
		});

		$promise.always(function () {
			overlay.toggleLoader(false);
		});
	}

	/**
	 * Loads the overlay
	 */
	function configureOverlay(callBackFn) {

		if (isFeatureSwitchEnabled(GUESTLIST_HMAC_ENABLED)) {

			var saveToListTemplate = template.get(0);

			$.support.cors = true; //Fix for IE8
			var $promise = $.ajax({
				type: 'GET',
				url: secureHostName + '/list/view/savetolist',
				xhrFields: {
					withCredentials: true
				}
			});

			$promise.then(function (data) {
				if (data) {
					saveToListTemplate = $(data).get(0);
					var html = $.parseHTML(data);
					$.each(html, function (count, el) {
						var id = $(el).attr('id');
						if (id === 'l_hat_env') {
							ENV = $(el).val() || '';
						} else if (id === 'l_hat_env_ts') {
							TIMESTAMP = $(el).val() || '';
						} else if (id === 'l_hat_env_id') {
							CLIENT_ID = $(el).val() || '';
						}
					});
				}
			}, function (error) { });

			$promise.always(function () {
				overlay = new Overlay({
					speed: '500ms',
					useContent: true,
					channel: isMobile ? 'mobile' : 'desktop',
					header: true,
					title: isB2BUser() ? 'Save to Lists' : 'Save to Favorites',
					htmlNode: saveToListTemplate
				});

				if (typeof callBackFn === 'function') {
					callBackFn();
				}
			});

		} else {
			overlay = new Overlay({
				speed: '500ms',
				useContent: true,
				channel: isMobile ? 'mobile' : 'desktop',
				header: true,
				title: isB2BUser() ? 'Save to Lists' : 'Save to Favorites',
				htmlNode: template.get(0) // This is to get the element of type Node
			});

			if (typeof callBackFn === 'function') {
				callBackFn();
			}
		}
	};

	/**
	 * Helps to get the auth token
	 */
	function getAuthToken() {
		if (isB2BUser()) {
			if (cookieUtils.readCookie(COOKIE_CUSTOMER)) {
				return encodeURIComponent(cookieUtils.readCookie(COOKIE_CUSTOMER));
			}
		} else if (isGuestUser()) {
			//Return the token
			return isFeatureSwitchEnabled(GUESTLIST_HMAC_ENABLED) ? ENV : (Math.random().toString(36).slice(2));
		} else {
			if (cookieUtils.readCookie(COOKIE_USER_SESSION)) {
				return encodeURIComponent(cookieUtils.readCookie(COOKIE_USER_SESSION));
			} else {
				return encodeURIComponent(cookieUtils.readCookie(COOKIE_AUTH_TOKEN));
			}
		}
	};
	privateMethods.getAuthToken = getAuthToken;

	/**
	 * @description Helps to get the user information from the THD_CUSTOMER cookie
	 */
	function extraCustomerCookie() {
		if (cookieUtils.readCookie(COOKIE_CUSTOMER)
			&& cookieUtils.readCookie(COOKIE_CUSTOMER) !== 'null') {

			var name = 'THD_CUSTOMER=',
				decodedCookie = decodeURIComponent(document.cookie),
				ca = decodedCookie.split(';');

			for (var i = 0; i < ca.length; i++) {
				var c = ca[i];
				while (c.charAt(0) === ' ') {
					c = c.substring(1);
				}
				if (c.indexOf(name) === 0) {
					COOKIE_THD_CUSTOMER_VALUE = c.substring(name.length, c.length);
					break;
				}
			}

			var COOKIE_THD_CUSTOMER_VALUE = COOKIE_THD_CUSTOMER_VALUE.replace(/"/g, '')
				.substring(0, COOKIE_THD_CUSTOMER_VALUE.indexOf('.'));

			return JSON.parse(atob(COOKIE_THD_CUSTOMER_VALUE));
		}
		return null;
	};

	/**
	 * @description Helps to get the user info
	 */
	function getUserInfo() {
		const cookieValue = extraCustomerCookie() || {};
		return {
			svocId: cookieValue.t,
			userId: cookieValue.u,
			type: cookieValue.c,
			tradeType: cookieValue.g,
			email: cookieValue.e,
			role: cookieValue.r,
			lastValidatedTs: cookieValue.v,
			ldapId: cookieValue.l
		};
	};

	/**
	 * Helps to get the member ID
	 */
	function getMemberId() {

		var memberId = '';
		if (isB2BUser()) {
			return getUserInfo().svocId;
		} else if (privateMethods.isGuestUser()) {
			//If guest user pass the member id for guest
			memberId = sessionStorage.getItem(GUEST_MEMBER_ID) || '';
		} else {
			memberId = cookieUtils.getSVOCID();
		}
		return memberId;
	};

	privateMethods.getMemberId = getMemberId;

	/**
	 * Helps to get all the list for the logged in user
	 */
	function getAllLists(requestParams) {
		var memberId = privateMethods.getMemberId(),
			authToken = privateMethods.getAuthToken();

		if (memberId) {

			overlay.toggleLoader(true);

			$.support.cors = true; //Fix for IE8
			var $promise = $.ajax({
				type: 'GET',
				url: secureHostName + '/customer/list/v1/' + memberId + '/lists',
				contentType: 'application/json',
				dataType: 'json',
				xhrFields: {
					withCredentials: true
				},
				beforeSend: function (xhr) {
					xhr.setRequestHeader('Authorization', authToken);
					if (privateMethods.isGuestUser() && isFeatureSwitchEnabled(GUESTLIST_HMAC_ENABLED)) {
						xhr.setRequestHeader('clientId', CLIENT_ID);
						xhr.setRequestHeader('timestamp', TIMESTAMP);
						xhr.setRequestHeader('clientDelay', 0);
					}
				}
			});

			$promise.then(function (response) {
				if (response && response.ListResponse && response.ListResponse.list) {
					generateContent(requestParams, response.ListResponse.list);
				}
			}, function (error) {
				//Get the error JSON from response
				var errorJson = (error && error.responseText && JSON.parse(error.responseText)) ? JSON.parse(error.responseText) : null,
					errors = errorJson ? errorJson.ListResponse.errorData.errors : [];

				//Check for no list scenario and show the create list tooltip
				if (errors.length > 0 && errors[0].id === ERR_CD_EMPTY_LIST) {
					generateContent(requestParams, null);
				} else if (errors.length > 0 && errors[0].id === ERR_CD_INVALID_AUTH) {
					var isPersistentFromAPI = true;
					if (isPersistentUser(isPersistentFromAPI)) {
						generateContent(requestParams, null, isPersistentFromAPI);
					} else {
						//Invalid credentails, show the dual sign-in again
						authenticateUser(isMobile, requestParams);
					}
				} else {
					generateGenericErrorMessage();
				}
			});

			$promise.always(function () {
				overlay.toggleLoader(false);
			});
		} else {
			generateGenericErrorMessage();
		}
	};

	function openOverlay(isPersistentFromAPI) {
		overlay && overlay.open();
		$(overlay.iframe).find('div#listSaveExternal').html(listViewTemplate);

		if (isMobile) {
			$(overlay.iframe).find('div#listSaveExternal').css({ 'width': '100%', 'height': 'auto' });
			$(overlay.iframe).find('div#listSaveExternal').find('div.list--save__thumbnail').removeClass('col__5-12');
			$(overlay.iframe).find('div#listSaveExternal').find('div.list--save__thumbnail').addClass('col__12-12');

			$(overlay.iframe).find('div#listSaveExternal').find('div.list--save__content').removeClass('col__7-12');
			$(overlay.iframe).find('div#listSaveExternal').find('div.list--save__content').addClass('col__12-12');
		} else {
			var overlayHeight = ((privateMethods.isGuestUser() || isPersistentUser(isPersistentFromAPI)) ? '225px' : '275px');
			$(overlay.iframe).find('div#listSaveExternal').css({ 'height': '250px' });
		}
	};

	//Display the overlay and show the list
	function showList(requestParams) {

		configureOverlay(function () {
			getAllLists(requestParams);
			//Remove the style for mobile and update the height
			if (isMobile) {
				$(overlay.iframe).find('div#listSaveExternal').removeAttr('style');
				overlay.resetCssProps();
			}
		});
	};

	//Helps to show the dual sign and gets the user authenticated
	function authenticateUser(isMobileChannel, requestParams, isRegisterEnabled) {

		isRegisterEnabled = isRegisterEnabled || false;
		requestParams = requestParams || parameters;

		if (overlay && overlay.isOpen) {
			overlay.close();
		}
		//Wait for sometime for the overlay to close
		setTimeout(function () {
			var successCallback = privateMethods.isGuestUser() ? undefined : function () {
				authService.hideDualSignInModal();
				showList(requestParams);
			};
			authService.showDualSignInModal(isRegisterEnabled, successCallback, undefined, isMobileChannel);
		}, 100);
	}

	function validateItemQuantity(requestParams) {
		if (requestParams) {
			requestParams['item']['quantity'] = (requestParams.item && requestParams.item.quantity)
				? requestParams.item.quantity
				: 1;
		}
		return requestParams;
	};

	//Helps to get the feature switches
	function getFeatureSwitches(callBackFn) {


		var FEATURE_SWITCHES = [GUESTLIST_HMAC_ENABLED, GUESTLIST_ENABLED];

		$.support.cors = true; //Fix for IE8
		var $promise = $.ajax({
			type: 'GET',
			url: secureHostName + '/customer/list/v1/featureswitch',
			contentType: 'application/json',
			xhrFields: {
				withCredentials: true
			}
		});

		$promise.then(function (response) {
			if (response && response.RegistryResponse) {
				var features = response.RegistryResponse.feature;
				var featureSwtiches = features && features.filter(function (data) { return FEATURE_SWITCHES.indexOf(data.featureName) >= 0 });
				for (var prop in featureSwtiches) {
					sessionStorage.setItem(featureSwtiches[prop].featureName, featureSwtiches[prop].integerValue);
				}
			}
		}, function (error) {

		});

		$promise.always(function () {
			if (typeof callBackFn === 'function') {
				callBackFn();
			}
		});
	}

	//Helps to get the feature switch value
	function isFeatureSwitchEnabled(key) {
		if (isB2BUser()) {
			return false;
		}
		return key && sessionStorage.getItem(key) == 1;
	}

	//Helps to get the member ID
	function getGuestMemeberID(requestParams) {

		var guestMemberId = sessionStorage.getItem(GUEST_MEMBER_ID);

		// Make the call only if, guest member ID is not there in the
		// session store
		if (!guestMemberId || !cookieUtils.readCookie(COOKIE_GUESTLIST)) {
			$.support.cors = true; //Fix for IE8
			var $promise = $.ajax({
				type: 'GET',
				url: secureHostName + '/customer/list/v1/guestlistid',
				xhrFields: {
					withCredentials: true
				}
			});

			$promise.then(function (response) {
				if (response && response.String) {
					sessionStorage.setItem(GUEST_MEMBER_ID, response.String);
					requestParams && showList(requestParams);
				}
			}, function (error) {
				//TODO:Need to decide on the failure scenario
				//Consider no guest user and do the normal auth flow
				requestParams && executeAuthFlow(requestParams)
			});
		} else {
			//Already have member ID, show the overlay
			requestParams && showList(requestParams);
		}
	};

	// Helps to know, if the user is a guest user
	function isGuestUser() {
		var isGuest = false;
		if (isFeatureSwitchEnabled(GUESTLIST_ENABLED)) {
			if (!cookieUtils.readCookie(COOKIE_GUESTLIST)) {
				sessionStorage.removeItem(GUEST_MEMBER_ID);
			}
			isGuest = !cookieUtils.readCookie(COOKIE_USER) && !cookieUtils.readCookie(COOKIE_USER_SESSION);
		}

		return isGuest;
	};
	privateMethods.isGuestUser = isGuestUser;

	//Helps to know, for b2b user
	function isB2BUser() {
		return cookieUtils.readCookie(COOKIE_CUSTOMER);
	}

	//Helps to know if the user is persistent
	function isPersistentUser(isPersistentFromAPI) {
		var isPersistentFromAPI = isPersistentFromAPI || false,
			isPersistent = false;
		//Enable this scenario only for guest flow
		if (isFeatureSwitchEnabled(GUESTLIST_ENABLED)) {
			isPersistent = isPersistentFromAPI || !cookieUtils.readCookie(COOKIE_USER_SESSION) && cookieUtils.readCookie(COOKIE_USER);
		}
		return isPersistent;
	}

	//Helps to execute the auth flow
	function executeAuthFlow(requestParams) {
		if (privateMethods.getAuthToken()) {
			showList(requestParams);
		} else {
			authenticateUser(isMobile, requestParams);
		}
	};

	//init function to start the save to list
	function init(requestParams) {

		//Assign the channel to global variable
		isMobile = requestParams.isMobileChannel;
		requestParams = validateItemQuantity(requestParams);

		//Initialize the analytics class
		analytics = new Analytics(isMobile);
		const source = requestParams.source ? requestParams.source.toLowerCase() : '';
		analytics.trackClick(source);
		
		parameters = requestParams;
		
		getFeatureSwitches(function () {
			if (!isB2BUser() && isFeatureSwitchEnabled(GUESTLIST_ENABLED)) {
				if (isGuestUser()) {
					//Get the guest member ID and show the modal
					getGuestMemeberID(requestParams);
				} else if (isPersistentUser()) {
					//Show the modal with My Favorites and disable the state. Enable only sign-in and register
					requestParams && showList(requestParams);
				} else {
					//Executes the auth flow
					executeAuthFlow(requestParams);
				}
			} else {
				//Executes the auth flow
				executeAuthFlow(requestParams);
			}
		});
	};

	//Analytics class for tracking save to list functionality
	function Analytics(isMobile) {

		function pushEvent(analyticsEventInfo) {
			if (digitalData && digitalData.event) {
				digitalData.event.push(analyticsEventInfo);
			}
		};

		Analytics.prototype.trackClick = function trackSaveToListClick(source) {
			pushEvent({
				category: { primaryCategory: 'interaction' },
				eventInfo: { eventName: source + ' sub-content' },
				subContent: { section: 'sharing', component: 'system', target: 'save', position: 'n/a' }
			});
		};

		//Track the create list view is displayed
		Analytics.prototype.trackCreateListOverlay = function trackCreateListOverlay() {
			pushEvent({
				category: { primaryCategory: 'overlay' },
				eventInfo: { eventName: 'create a list' }
			});
		};

		//Track the choose a list is displayed
		Analytics.prototype.trackChooseAListOverlay = function trackChooseAListOverlay() {
			pushEvent({
				category: { primaryCategory: 'overlay' },
				eventInfo: { eventName: 'choose a list' }
			});
		};

		//Track the New list created w/ product add and add item to existing list
		Analytics.prototype.trackAddItem = function trackAddItem(isGuestList, isCreateOperation, source, quantity, price, sku) {
			if (isGuestList) {
				pushEvent({
					category: { primaryCategory: 'button submission' },
					eventInfo: { eventName: 'list add' },
					myList: { creationLocation: 'guest lists' },
					item: [{ listLocation: source, quantity: quantity, price: { basePrice: price }, productInfo: { sku: sku } }]
				});
			} else {
				if (isCreateOperation) { // This is for create a list and add product
					pushEvent({
						category: { primaryCategory: 'interaction' },
						eventInfo: { eventName: 'create list' },
						myList: { creationLocation: 'create a list overlay' },
						item: [{ listLocation: source, quantity: quantity, price: { basePrice: price }, productInfo: { sku: sku } }]
					});
				} else { // Adding the product to existing list
					pushEvent({
						category: { primaryCategory: 'button submission' },
						eventInfo: { eventName: 'list add' },
						item: [{ listLocation: source, quantity: quantity, price: { basePrice: price }, productInfo: { sku: sku } }]
					});
				}
			}
		};

		//Track the New list created w/ collection add and add item to existing list
		Analytics.prototype.trackAddCollection = function trackAddCollection(isGuestList, isCreateOperation, collectionId) {
			if (isGuestList) {
				pushEvent({
					category: { primaryCategory: 'button submission' },
					eventInfo: { eventName: 'list add' },
					myList: { creationLocation: 'guest lists' },
					content: {collection: {collectionID: collectionId}},
					item: [{ listLocation: 'collections:space', quantity: 'n/a', price: { basePrice: 'n/a' }, productInfo: { sku: 'n/a' } }]
				});
			} else {
				if (isCreateOperation) { // This is for create a list and add collection
					pushEvent({
						category: { primaryCategory: 'interaction' },
						eventInfo: { eventName: 'create list' },
						myList: { creationLocation: 'create a list overlay' },
						content: {collection: {collectionID: collectionId}},
						item: [{ listLocation: 'collections:space', quantity: 'n/a', price: { basePrice: 'n/a' }, productInfo: { sku: 'n/a' } }]
					});
				} else { // Adding the collection to existing list
					pushEvent({
						category: { primaryCategory: 'button submission' },
						eventInfo: { eventName: 'list add' },
						content: {collection: {collectionID: collectionId}},
						item: [{ listLocation: 'collections:space', quantity: 'n/a', price: { basePrice: 'n/a' }, productInfo: { sku: 'n/a' } }]
					});
				}
			}
		};

		//Track the inline error
		Analytics.prototype.trackInlineErrors = function trackInlineErrors(errorCode, errorMessage) {
			pushEvent({
				category: { primaryCategory: 'error' },
				eventInfo: {
					eventName: 'post page error', error: [{
						type: 'advisory',
						displayType: 'inline', pageSection: 'mylist',
						message: errorMessage, code: errorCode
					}]
				}
			});
		};

		//Track page/overlay load error
		Analytics.prototype.trackOverlayLoadError = function trackOverlayLoadError(errorCode, errorMessage) {
			if (digitalData && digitalData.page && digitalData.page.error) {
				if (!$.isArray(digitalData.page.error)) {
					digitalData.page.error = [];
				}
				digitalData.page.error.push({
					type: 'advisory', displayType: 'page', pageSection: 'mylist',
					message: errorMessage, code: errorCode
				});
			}
		};
	}

	return {
		init: init,
		privateMethods: privateMethods
	};
});
/**
* Does the following functionality
* 1) Check for C45 cookie
* 2) Show logon modal, if the cookie is not present
* 3) Cookie is there, trigger the API call to check for existing lists
* 4) Show the success and error tooltip
**/
(function closure(root, factory) {
  if (typeof define === 'function' && define.amd) {
    define('list.service',[
      'jquery',
      'account.utility',
      'list.model',
      'list.create',
      'account.tooltip',
      'list.message',
      'list.show',
      'auth.service',
      'list.constants',
      'account.modal',
      'list.analytics',
      'list.view'
    ], function load(jQuery, accountUtility, model, createList, toolTip, message, dialog, authentication, Constants, modal, analytics, view) {
      return factory(root,jQuery, accountUtility, model, createList, toolTip, message, dialog, authentication, Constants, modal, analytics, view);
    });
  } else {
    // For non-AMD module, expose this to global (will also be useful for test cases)
    /*eslint-disable*/
    factory(root, jQuery,accountUtility, model, createList, toolTip, message, dialog, authentication, Constants, modal, analytics, view);
    /*eslint-enable*/
  }
})(this, function factory(root, $, accountUtility, model, createList, toolTip, message, dialog, authentication, Constants, modal, analytics, view) {

  var isAJAXCallInProgress = false;
  var hideHeaderDropDowns = function() {
    $(document).trigger({
      type: 'hideHeaderDropdowns'
    });
  };

  /**
  * @Description: Entry point for Add to List/Save to List
  *               Accepts the request parameters and get the tooltip/modal
  *
  * @Param: requestParams
  **/
  var init = function (requestParams) {
    //Setting the request parameters to the model
    model.setRequestParams(requestParams);

    //Hide the header dropdowns before showing the tooltip and modals
    hideHeaderDropDowns();

    /*if (accountUtility.verifyAuthorizationToken()) {
    	view.init(requestParams);
    } else {
      showGuestTooltip();
    }*/
    view.init(requestParams);
  };

  var triggerFeatureSwitchCall = function () {
    var options = {
      type: 'GET',
      url: Constants.URLS.GET_FEATURE_LIST_URL,
      contentType: 'application/json',
      accept: 'application/json',
      dataType: 'json',
			crossDomain : true,
			xhrFields: {
				withCredentials: true
			}
    };

    var ajaxHandler = accountUtility.triggerAJAXCall(options, true);

    //Handling the success and error scenarios
    ajaxHandler.done(function(response) {
      var featureSwitch = [];
      if (response && response.FeatureResponse && response.FeatureResponse.featureSwitch) {
        featureSwitch = response.FeatureResponse.featureSwitch;
        $.each(featureSwitch, function(index, value) {
          sessionStorage.setItem(value.featureName, value.intValue);
        });
      }
    });
  };

  /**
  * @Description: Helps the user to show the guest tool tip and ask him to
  *               sign in or register before saving to list
  **/
  var showGuestTooltip = function () {
    if (sessionStorage && !sessionStorage.getItem('RegistrationLiteFeature')) {
      triggerFeatureSwitchCall();
    }

    var $signIn = $('<a />').addClass('u__default-link').html('signing in'),
        $createAccount = $('<a />').addClass('u__default-link').html('creating an account'),
        $content = $('<div />', {'id': 'authenticationOptions'}).addClass('auth-content');

    $content
      .html('Save to your list by ')
      .append($signIn)
      .append(' or ')
      .append($createAccount)
      .append(' today.');

    var $header = $('<h2 />').html('Save to List'),
        options = {'height': 'auto; min-height: 60px;'};

    //Display the tooltip with signin and create account option
    if(model.getSource() === "checkavailability") {
      modal.showModal($content, $header, false, options, model.getIsMobileChannel());
    } else {
      toolTip.showTooltip($content, {
        $trigger : model.getTrigger()
      });
    }

    analytics.pushSignInEventInfo();

    //Define the click event for sign-in link
    $signIn.on('click', function(event) {
      event.preventDefault();
      toolTip.hideTooltip();
      modal.hideModal();
      //Show the Dual Sign in modal
      authentication.showDualSignInModal(false, function() {
        modal.hideModal();
        if (accountUtility.verifyAuthorizationToken()) {
          getAllLists();
        } else {
          message.showGenericError(model.getTrigger());
        }
      }, undefined, model.getIsMobileChannel());
    });

    //Define the click event for create an account link
    $createAccount.on('click', function(event) {
      event.preventDefault();
      toolTip.hideTooltip();
      modal.hideModal();
      //Show the Dual Sign in modal
      authentication.showDualSignInModal(true, function() {
        modal.hideModal();
        if (accountUtility.verifyAuthorizationToken()) {
          getAllLists();
        } else {
          message.showGenericError(model.getTrigger());
        }
      },undefined, model.getIsMobileChannel());
    });
  };

  /**
  * @Description: Helps to get all the list for the user
  **/
  var getAllLists = function() {

    if(!isAJAXCallInProgress) {
      //Get the member ID
      var memberID = accountUtility.getMemberId(),
          authorizationToken = accountUtility.getAuthorizationToken();

      if (memberID && authorizationToken) {
        isAJAXCallInProgress = !isAJAXCallInProgress;
        var options = {
          type: 'GET',
          url: Constants.URLS.GET_ALL_LIST_URL(memberID),
          contentType: 'application/json',
          dataType: 'json',
					crossDomain : true,
					xhrFields: {
						withCredentials: true
					},
          beforeSend: function( xhr ) {
            xhr.setRequestHeader('Authorization', authorizationToken);
          }
        };

        var ajaxHandler = accountUtility.triggerAJAXCall(options, true);

        //Handling the success and error scenarios
        ajaxHandler.done(function(response) {
          getAllListSuccessCallback(response);
        }).fail(function(errorData) {
          getAllListErrorCallback(errorData);
        }).always(function() {
          isAJAXCallInProgress = !isAJAXCallInProgress;
        });
      } else {
        showGuestTooltip();
      }
    }
  };

  /**
  * @Description: Helps to handle the success scenario for get all list
  *
  * @Param: response - Response from the API
  **/
  var getAllListSuccessCallback = function(response) {

    if (response && response.ListResponse && response.ListResponse.list) {
      var $list = response.ListResponse.list;

      //Show the dialog with the lists populated
      dialog.showListModal($list);

      analytics.pushSaveToListEventInfo();
    }
  };

  /**
  * @Desceiption: Helps to handle the error scenario for get all list
  *
  * @Param: errorData - Error response from the API call
  **/
  var getAllListErrorCallback = function(errorData) {

    //Get the error JSON from response
    var errorJson = (errorData && errorData.responseText && JSON.parse(errorData.responseText)) ? JSON.parse(errorData.responseText) : null,
        errors = [];

    //Check for no list scenario and show the create list tooltip
    if (errorJson && errorJson.ListResponse && errorJson.ListResponse.errorData && 
          errorJson.ListResponse.errorData.errors && errorJson.ListResponse.errorData.errors.length > 0 &&
          errorJson.ListResponse.errorData.errors[0].id === Constants.getCode('ERR_CD_EMPTY_LIST_OF_LISTS')) {

        //Get the content for create list and show the tooltip
        var createListContent = createList.getContentForCreateList(false);
        if(model.getSource() === "checkavailability"){
        	var $header = $('<h2 />').html('Create a List'),
        	options = {'height': 'auto', 'min-height': '60px'};
        	modal.showModal(createListContent, $header, false, options, model.getIsMobileChannel());
        } else { 
	        toolTip.showTooltip(createListContent,{
	          $trigger : model.getTrigger()
	        });
		}	
		analytics.pushCreateListEventInfo();
    } else  if(errorData.status === 401){
      showGuestTooltip();
    } else {
      message.showGenericError(model.getTrigger());
    }
  };

  var createNameSpace = function() {
    //Exposing it globally
    var listService = THD.MyAccount.List = THD.MyAccount.List || {};
    listService.saveToList = init;
  };

  var hasMCMListThrottle = accountUtility.getThrottleStatus();

  return {
    save : init,
    hasMCMListThrottle : hasMCMListThrottle,
    createNameSpace : createNameSpace
  };
});
/**
* @Description: Entry point of the Save To List functionlity
* 				The function "saveToList", helps to trigger the list modal for authenticated users
*				and the non-authenticated users, the sign-in/create account tooltip is shown.
*				The user has the previledge to create a list and add the item. He also can add item
*				to existing list
*
* @Param: listParams - This is the JSON parameter with the values required for processing 
*						the save to list funcationlity
*						Accepted values in the JSON object are:-
*					1) source : Helps to identify the entry point. The accepted values are 'PIP' and 'CART'
*					2) $trigger : DOM element from which the service is invoked. Based on this element, 
*									we will show the tooltip and the messages
*					3) item.itemId : Item ID of the item
*					4) item.quantity : Quantity of the item that is to be added
*					5) item.imageURL : Absolute URL of the image of the item. It accepts maximum image size of 100px - 145px
*					6) item.blindsItemId : Blinds GUID. This is an optional parameter. Required only for the blinds item
*					7) item.isMobileChannel : Helps to identify the device. Accepts boolean (true/false) - Optional Parameter
*
*			Example:- {
*				source : 'PIP',
*				$trigger : $(this),
*				item : {
*					itemId : '100200300',
*					quantity : 2,
*					imageURL : 'http://www.homedepot.com/.../thumb_image_100_px',
*					//blindsItemId : ''
*				}
*			}
**/
(function closure(root, factory) {
	if (typeof define === 'function' && define.amd) {
		define('account.list',[
			'jquery',
			'list.service'
		], factory);
	} else {
		// For non-AMD module, expose this to global (will also be useful for test cases)
		/*eslint-disable*/
		factory(jQuery, listService);
		/*eslint-enable*/
	}
})(this, function factory($, listService) {
	return {
		saveToList: function saveToList(listParams) {
			listService.save( listParams );
		},
		isMyListThrottled : listService.hasMCMListThrottle
	};
});
define('thd-cart-bindings',["thd-overlay","cookie-utils","account.list","jquery"], function(__WEBPACK_EXTERNAL_MODULE_1__, __WEBPACK_EXTERNAL_MODULE_2__, __WEBPACK_EXTERNAL_MODULE_3__, __WEBPACK_EXTERNAL_MODULE_4__) { return /******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId])
/******/ 			return installedModules[moduleId].exports;
/******/
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			exports: {},
/******/ 			id: moduleId,
/******/ 			loaded: false
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.loaded = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(0);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ (function(module, exports, __webpack_require__) {

	var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;'use strict';
	
	var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };
	
	/* globals define digitalData, THD_VERSION */
	(function closure(root, factory) {
	  if (true) {
	    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(1), __webpack_require__(2), __webpack_require__(3), __webpack_require__(4)], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory), __WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ? (__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));
	  } else {
	    root.cookieUtils = factory(THD.Global.Overlay, cookieUtils, myList, $); // eslint-disable-line
	  }
	})(undefined, function factory(Overlay, cookieUtils, myList, $) {
	
	  var CHANNEL = void 0;
	  var ATC_OVERLAY = void 0;
	  var SELECT_A_STORE_OVERLAY = void 0;
	  var CHECK_AVAILABILITY_OVERLAY = void 0;
	  var PARTS_AND_SERVICES = void 0;
	
	  function addEvent(element, eventType, handler, useCapture) {
	    var i = void 0;
	    var capture = typeof useCapture !== 'undefined' ? useCapture : true;
	    if (element.length && !element.window) {
	      element.forEach(function (el) {
	        return addEvent(el, eventType, handler);
	      });
	    } else {
	      if (element.addEventListener) {
	        // DOM Level 2 browsers
	        element.addEventListener(eventType, handler, capture);
	      } else if (element.attachEvent) {
	        // IE <= 8
	        element.attachEvent('on' + eventType, handler);
	      } else {
	        // ancient browsers
	        element['on' + eventType] = handler; // eslint-disable-line
	      }
	    }
	  }
	
	  function hasClass(classNames, className) {
	    var parts = void 0;
	    var i = void 0;
	    var klass = void 0;
	
	    if ((typeof classNames === 'undefined' ? 'undefined' : _typeof(classNames)) === 'object' && classNames.getAttribute) {
	      if (typeof classNames.className.baseVal !== 'undefined') {
	        parts = classNames.className.baseVal.split(' ');
	      } else {
	        parts = classNames.className.split(' '); // baseVal is for svg
	      }
	    } else {
	      parts = classNames.split(' ');
	    }
	
	    for (i = 0; i < parts.length; i++) {
	      klass = parts[i];
	      if ((typeof className === 'undefined' ? 'undefined' : _typeof(className)) === 'object' && className.test) {
	        if (className.test(klass)) return true;
	      } else {
	        if (klass === className) return true;
	      }
	    }
	    return false;
	  }
	
	  function addLoaderToDOM() {
	    var loader = document.createElement('div');
	    loader.id = 'thd-cart-loader';
	    loader.innerHTML = '<div class="pre-loader"><div class="segment-spinner"></div></div>';
	    document.body.appendChild(loader);
	  }
	
	  function removeLoaderFromDOM() {
	    var el = document.querySelector('#thd-cart-loader');
	    if (el) {
	      document.body.removeChild(el);
	    }
	  }
	
	  function fallbackHost(host) {
	    if (host) return host;
	    return window.location.protocol + '//' + window.location.host;
	  }
	
	  function tabletToDesktop(channel) {
	    if (channel === 'tablet') {
	      return 'desktop';
	    }
	    return channel;
	  }
	
	  function cacheBustSrc(src) {
	    var parts = src.split('#');
	    var hasQuery = void 0;
	    var sep = void 0;
	    var bust = void 0;
	    if (parts.length < 2) {
	      return src;
	    }
	    hasQuery = parts[0].indexOf('?') === -1;
	
	    if (hasQuery) {
	      sep = '?bust=';
	    } else {
	      sep = '&bust=';
	    }
	
	    if (typeof THD_VERSION !== 'undefined' && THD_VERSION.VERSION) {
	      bust = THD_VERSION.VERSION;
	    } else {
	      bust = new Date().getTime();
	    }
	    return parts[0] + sep + bust + '#' + parts[1];
	  }
	
	  function bindOverlay(overlay, elClassName) {
	    addEvent(document, 'click', function (e) {
	      var target = e.target || e.srcElement;
	      if (hasClass(target, /^js-atc/) && hasClass(target, elClassName)) {
	        e.preventDefault();
	        var src = target.getAttribute('href');
	        if (!src) {
	          src = target.getAttribute('data-href');
	        }
	        if (/open\(/.test(src)) {
	          var parts = /open\(["']([^['"]*)/.exec(src);
	          src = parts[1];
	        }
	        var opts = Object.assign({}, {
	          width: target.getAttribute('data-width') || overlay.opts.width,
	          height: target.getAttribute('data-height') || overlay.opts.height
	        });
	
	        if (window.top === window.self) {
	          overlay.open(src, opts);
	        } else {
	          // if its not an iframe assume im already on the overlay app
	          window.location.href = cacheBustSrc(src);
	        }
	      }
	    });
	  }
	
	  var LOCAL_STORAGE_AVAILABLE = void 0;
	  function storageAvailable(type) {
	    var storage = void 0;
	    var keyVal = '__storage_test';
	    if (typeof LOCAL_STORAGE_AVAILABLE === 'boolean') {
	      return LOCAL_STORAGE_AVAILABLE;
	    }
	    try {
	      storage = window[type];
	      storage.setItem(keyVal, keyVal);
	      storage.removeItem(keyVal);
	      LOCAL_STORAGE_AVAILABLE = true;
	      return true;
	    } catch (e) {
	      LOCAL_STORAGE_AVAILABLE = false;
	      return false;
	    }
	  }
	
	  function frameCb(response, ddFlag) {
	    var jq = void 0;
	    if ($ && $.fn) {
	      jq = $;
	    } else if (typeof window.jQuery !== 'undefined') {
	      jq = window.jQuery;
	    }
	    if (response && response.type === 'receive_cart') {
	      var resp = response.resp;
	      if (!resp || !resp.CartModel) {
	        this.trigger('error', resp);
	        return;
	      }
	      if (resp.CartModel.errorModel) {
	        this.trigger('error', resp);
	        return;
	      }
	      if (resp.CartModel) {
	        cookieUtils.initializeCookieManager();
	        if (jq) {
	          jq(document).trigger({ type: 'cartUpdated' });
	        }
	        this.trigger('success', resp);
	      }
	    }
	    if (response && response.type === 'add-to-list') {
	      if (!myList.saveToList) {
	        // console.warn('myList module not installed');
	      } else if (jq) {
	        var listParams = { item: {} };
	        listParams.$trigger = jq('body');
	        listParams.item.itemId = response.itemId;
	        listParams.item.quantity = response.quantity;
	        listParams.item.imageURL = response.imageUrl;
	
	        if (response.source) {
	          listParams.source = response.source;
	        } else {
	          listParams.source = 'cart';
	        }
	        // listParams.item.blindsItemId = 'blinds-config-id';
	        myList.saveToList(listParams);
	      }
	    }
	
	    if (response && response.type === 'dd_event_cart' && ddFlag) {
	      try {
	        digitalData.cart = response.data.cart;
	        if (response.data.legacy) {
	          digitalData.legacy = response.data.legacy;
	        }
	      } catch (e) {
	        if (console && console.error) console.error(e);
	      }
	    }
	
	    if (response && response.type === 'dd_event' && ddFlag) {
	      try {
	        digitalData.event.push(response.data);
	      } catch (e) {
	        if (console && console.error) console.error(e);
	      }
	    }
	
	    if (response && response.type === 'localized') {
	      this.trigger(response.type, response.data);
	    }
	
	    if (response && response.type === 'paypal') {
	      this.trigger(response.type, response.data);
	    }
	
	    if (response && response.type === 'dd_event_error' && ddFlag) {
	      try {
	        if (!digitalData.page.error || !digitalData.page.error.length) {
	          digitalData.page.error = [];
	        }
	        digitalData.page.error.push(response.data);
	      } catch (e) {
	        if (console && console.error) console.error(e);
	      }
	    }
	  }
	
	  function paypalCb(response) {
	    if (response && response.status === 'success') {
	      window.location.href = response.url;
	    } else if (!response || response.status === 'error') {
	      // todo remove loader
	      removeLoaderFromDOM();
	      this.trigger('error', response.errorModel);
	    }
	  }
	
	  function shouldRouteToCheckAvailabilty(cartModel) {
	    var caMethods = ['DeliverFromStore', 'DirectDelivery'];
	    var model = cartModel;
	    // dont call ca for multi-item
	    if (typeof cartModel.length !== 'undefined') {
	      if (cartModel.length > 1) {
	        return false;
	      }
	      model = cartModel[0];
	    }
	
	    if (caMethods.indexOf(model.fulfillmentMethod) !== -1) {
	      return true;
	    }
	    return false;
	  }
	
	  function shouldRouteToBSSoverlay(cartModel) {
	    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
	
	    var bssMethods = ['BOPIS', 'ShipToStore'];
	    var model = cartModel.length ? cartModel[0] : cartModel;
	    var channel = options.channel;
	    if (channel !== 'mobile') return false;
	    if (bssMethods.indexOf(model.fulfillmentMethod) !== -1) {
	      return true;
	    }
	    return false;
	  }
	
	  function preload(url) {
	    var cb = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function () {};
	
	    var THD_CART_PRELOAD = 'THD_CART_PRELOAD';
	    var loaded = false;
	
	    if (!storageAvailable('localStorage')) {
	      cb();
	      return;
	    }
	    var ts = window.localStorage.getItem(THD_CART_PRELOAD);
	    var d = new Date().getTime();
	    if (ts && (d - ts) / 1000 < 86400) {
	      cb();
	      return;
	    }
	    var iframe = document.createElement('iframe');
	    iframe.style.display = 'none';
	    iframe.onload = function () {
	      if (storageAvailable('localStorage')) {
	        window.localStorage.setItem(THD_CART_PRELOAD, d);
	      }
	      document.body.removeChild(iframe);
	      iframe = null;
	      cb();
	      return;
	    };
	    iframe.src = cacheBustSrc(url);
	    document.body.appendChild(iframe);
	  }
	
	  function checkAvailability(_ref) {
	    var itemId = _ref.itemId,
	        _ref$channel = _ref.channel,
	        channel = _ref$channel === undefined ? 'mobile' : _ref$channel,
	        _ref$zipCode = _ref.zipCode,
	        zipCode = _ref$zipCode === undefined ? 'zip' : _ref$zipCode,
	        host = _ref.host,
	        _ref$submit = _ref.submit,
	        submit = _ref$submit === undefined ? false : _ref$submit,
	        _ref$height = _ref.height,
	        height = _ref$height === undefined ? 277 : _ref$height,
	        _ref$fulfillmentMetho = _ref.fulfillmentMethod,
	        fulfillmentMethod = _ref$fulfillmentMetho === undefined ? 'DirectDelivery' : _ref$fulfillmentMetho,
	        _ref$ignoreThrottle = _ref.ignoreThrottle,
	        ignoreThrottle = _ref$ignoreThrottle === undefined ? false : _ref$ignoreThrottle,
	        _ref$noIframe = _ref.noIframe,
	        noIframe = _ref$noIframe === undefined ? false : _ref$noIframe,
	        _ref$digitalDataFlag = _ref.digitalDataFlag,
	        digitalDataFlag = _ref$digitalDataFlag === undefined ? true : _ref$digitalDataFlag,
	        warrantyItemId = _ref.warrantyItemId,
	        _ref$quantity = _ref.quantity,
	        quantity = _ref$quantity === undefined ? '1' : _ref$quantity;
	
	
	    var action = 'action';
	    if (submit && zipCode) {
	      action = 'submit';
	    }
	
	    var params = [];
	    if (zipCode) {
	      params.push(zipCode);
	    }
	    if (action) {
	      params.push(action);
	    }
	    if (quantity) {
	      params.push(quantity);
	    }
	
	    if (warrantyItemId) {
	      params.push(warrantyItemId);
	    }
	
	    params.push(tabletToDesktop(channel));
	
	    var url = fallbackHost(host) + '/mycart/overlay#/check-availability/add/' + itemId + '/' + fulfillmentMethod + '/' + params.join('/'); // eslint-disable-line max-len
	    if (window.top !== window.self || noIframe) {
	      Overlay.postMessage({
	        action: 'REST_OPEN_OVERLAY'
	      });
	      window.location.href = cacheBustSrc(url);
	      return null;
	    }
	
	    if (!CHECK_AVAILABILITY_OVERLAY) {
	      CHECK_AVAILABILITY_OVERLAY = new Overlay({
	        channel: channel,
	        mobileDirection: 'bottom',
	        height: height,
	        useCustomFrameListner: true
	      });
	    }
	    CHECK_AVAILABILITY_OVERLAY.off('frame.cart');
	    CHECK_AVAILABILITY_OVERLAY.on('frame.cart', function f(resp) {
	      frameCb.call(this, resp, digitalDataFlag);
	    });
	
	    CHECK_AVAILABILITY_OVERLAY.open(url); // eslint-disable-line max-len
	
	    return CHECK_AVAILABILITY_OVERLAY;
	  }
	
	  function selectAStore(_ref2) {
	    var itemId = _ref2.itemId,
	        lineItemId = _ref2.lineItemId,
	        _ref2$channel = _ref2.channel,
	        channel = _ref2$channel === undefined ? 'mobile' : _ref2$channel,
	        host = _ref2.host,
	        _ref2$isShipToHomeEli = _ref2.isShipToHomeEligible,
	        isShipToHomeEligible = _ref2$isShipToHomeEli === undefined ? false : _ref2$isShipToHomeEli,
	        _ref2$keyword = _ref2.keyword,
	        keyword = _ref2$keyword === undefined ? '' : _ref2$keyword,
	        height = _ref2.height,
	        _ref2$localStore = _ref2.localStore,
	        localStore = _ref2$localStore === undefined ? false : _ref2$localStore,
	        _ref2$ignoreThrottle = _ref2.ignoreThrottle,
	        ignoreThrottle = _ref2$ignoreThrottle === undefined ? false : _ref2$ignoreThrottle,
	        _ref2$digitalDataFlag = _ref2.digitalDataFlag,
	        digitalDataFlag = _ref2$digitalDataFlag === undefined ? true : _ref2$digitalDataFlag,
	        _ref2$quantity = _ref2.quantity,
	        quantity = _ref2$quantity === undefined ? null : _ref2$quantity;
	
	
	    if (!SELECT_A_STORE_OVERLAY) {
	      SELECT_A_STORE_OVERLAY = new Overlay({
	        channel: channel,
	        mobileDirection: 'bottom',
	        height: height || (!localStore ? 660 : 355),
	        width: 1000,
	        useCustomFrameListner: true
	      });
	    }
	
	    var id = void 0;
	    var m = void 0;
	    if (lineItemId) {
	      m = 'edit';
	      id = lineItemId;
	    } else {
	      m = 'add';
	      id = itemId;
	    }
	    var shipToHome = '';
	    if (isShipToHomeEligible) {
	      shipToHome = 'shipToHome';
	    }
	
	    var url = void 0;
	    var params = [];
	    if (keyword) {
	      params.push(keyword.trim());
	    }
	    if (localStore) {
	      params.push('local');
	    }
	    if (shipToHome) {
	      params.push(shipToHome);
	    }
	
	    if (quantity) {
	      params.push('q/' + quantity);
	    }
	
	    params.push(tabletToDesktop(channel.trim()));
	
	    url = fallbackHost(host) + '/mycart/overlay#select-a-store/' + m.trim() + '/' + id.trim() + '/' + params.join('/'); // eslint-disable-line max-len
	    // helpers for success and failure
	    SELECT_A_STORE_OVERLAY.off('frame.cart');
	    SELECT_A_STORE_OVERLAY.on('frame.cart', function f(resp) {
	      frameCb.call(this, resp, digitalDataFlag);
	    });
	    SELECT_A_STORE_OVERLAY.open(url);
	
	    return SELECT_A_STORE_OVERLAY;
	  }
	
	  function addToCart(cartModel) {
	    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {
	      channel: 'mobile',
	      host: host,
	      paypal: false,
	      ignoreThrottle: false,
	      noIframe: false,
	      digitalDataFlag: true,
	      hidden: false,
	      open: true,
	      bypassBss: false,
	      misship: false,
	      directCheckout: false
	    };
	
	    var hidden = typeof options.hidden !== 'undefined' ? options.hidden : false;
	    var open = typeof options.open !== 'undefined' ? options.open : true;
	    var ddFlag = typeof options.digitalDataFlag !== 'undefined' ? options.digitalDataFlag : true;
	    var bypassBss = typeof options.bss !== 'undefined' ? options.bypassBss : false;
	    var misship = typeof options.misship !== 'undefined' ? options.misship : false;
	    var directCheckout = typeof options.directCheckout !== 'undefined' ? options.directCheckout : false;
	
	    if (options.paypal) {
	      hidden = true;
	      addLoaderToDOM();
	    }
	
	    if (shouldRouteToCheckAvailabilty(cartModel)) {
	      var model = cartModel;
	      if (model.length) {
	        model = cartModel[0];
	      }
	      var caParams = {
	        itemId: model.itemId,
	        host: options.host,
	        fulfillmentMethod: model.fulfillmentMethod,
	        channel: options.channel,
	        digitalDataFlag: ddFlag,
	        paypal: options.paypal,
	        noIframe: options.noIframe,
	        ignoreThrottle: options.ignoreThrottle,
	        hidden: hidden,
	        open: open
	      };
	      if (model.fulfillmentLocation) {
	        caParams.submit = true;
	        caParams.zipCode = model.fulfillmentLocation;
	      }
	      if (model.warrantyItem) {
	        caParams.warrantyItemId = model.warrantyItem.itemId;
	      }
	
	      if (model.quantity) {
	        caParams.quantity = model.quantity;
	      }
	
	      return checkAvailability(caParams);
	    }
	
	    if (!bypassBss && shouldRouteToBSSoverlay(cartModel, options)) {
	      var _model = cartModel.length ? cartModel[0] : cartModel;
	      var bssOptions = {
	        itemId: _model.itemId,
	        channel: options.channel,
	        host: options.host,
	        digitalDataFlag: options.digitalDataFlag,
	        ignoreThrottle: options.ignoreThrottle,
	        quantity: _model.quantity
	      };
	      return selectAStore(bssOptions);
	    }
	
	    if (!ATC_OVERLAY) {
	      ATC_OVERLAY = new Overlay({
	        iframeSrc: cacheBustSrc(fallbackHost(options.host) + '/mycart/overlay#add-to-cart/' + tabletToDesktop(options.channel)),
	        height: 588,
	        speed: '500ms',
	        header: false,
	        hidden: hidden,
	        channel: options.channel,
	        useCustomFrameListner: true
	      });
	    }
	
	    ATC_OVERLAY.off('load.cart');
	    ATC_OVERLAY.on('load.cart', function load() {
	      ATC_OVERLAY.off('load.cart');
	      if (cartModel.length) {
	        ATC_OVERLAY.postMessage({
	          type: 'atc-add-items',
	          items: cartModel
	        });
	      } else {
	        ATC_OVERLAY.postMessage({
	          type: 'atc-add-item',
	          item: cartModel
	        });
	      }
	
	      ATC_OVERLAY.postMessage({
	        type: 'atc-submit',
	        payPal: options.paypal,
	        misship: misship,
	        directCheckout: directCheckout
	      });
	    });
	    ATC_OVERLAY.off('success.cart');
	    ATC_OVERLAY.on('success.cart', function success() {
	      var jq = void 0;
	      if ($ && $.fn) {
	        jq = $;
	      } else if (typeof window.jQuery !== 'undefined') {
	        jq = window.jQuery;
	      }
	      cookieUtils.initializeCookieManager();
	      if (jq) {
	        jq(document).trigger({ type: 'cartUpdated' });
	      }
	    });
	    // helpers for success and failur
	    ATC_OVERLAY.off('frame.cart');
	    ATC_OVERLAY.on('frame.cart', function f(resp) {
	      frameCb.call(this, resp, ddFlag);
	    });
	    if (options.paypal) {
	      ATC_OVERLAY.off('paypal.cart');
	      ATC_OVERLAY.on('paypal.cart', function f(resp) {
	        removeLoaderFromDOM();
	        paypalCb.call(this, resp, ddFlag);
	      });
	    }
	
	    if (open) {
	      ATC_OVERLAY.open();
	    }
	    return ATC_OVERLAY;
	  }
	
	  function partsAndServices(_ref3) {
	    var lineItemId = _ref3.lineItemId,
	        _ref3$channel = _ref3.channel,
	        channel = _ref3$channel === undefined ? 'mobile' : _ref3$channel,
	        _ref3$tab = _ref3.tab,
	        tab = _ref3$tab === undefined ? 'required-parts' : _ref3$tab,
	        host = _ref3.host,
	        _ref3$ignoreThrottle = _ref3.ignoreThrottle,
	        ignoreThrottle = _ref3$ignoreThrottle === undefined ? false : _ref3$ignoreThrottle,
	        _ref3$digitalDataFlag = _ref3.digitalDataFlag,
	        digitalDataFlag = _ref3$digitalDataFlag === undefined ? true : _ref3$digitalDataFlag;
	
	
	    if (!PARTS_AND_SERVICES) {
	      PARTS_AND_SERVICES = new Overlay({
	        channel: channel,
	        mobileDirection: 'bottom',
	        height: 660,
	        useCustomFrameListner: true
	      });
	    }
	    PARTS_AND_SERVICES.off('frame.cart');
	    PARTS_AND_SERVICES.on('frame.cart', function f(resp) {
	      frameCb.call(this, resp, digitalDataFlag);
	    });
	    var url = fallbackHost(host) + '/mycart/overlay#/parts-and-services/' + lineItemId + '/' + tab + '/' + tabletToDesktop(channel);
	    PARTS_AND_SERVICES.open(url); // eslint-disable-line max-len
	
	    return PARTS_AND_SERVICES;
	  }
	
	  function bind(_ref4) {
	    var _ref4$channel = _ref4.channel,
	        channel = _ref4$channel === undefined ? 'mobile' : _ref4$channel,
	        _ref4$env = _ref4.env,
	        env = _ref4$env === undefined ? 'http://www.homedepot.com' : _ref4$env,
	        _ref4$digitalDataFlag = _ref4.digitalDataFlag,
	        digitalDataFlag = _ref4$digitalDataFlag === undefined ? true : _ref4$digitalDataFlag,
	        _ref4$ps = _ref4.ps2,
	        ps2 = _ref4$ps === undefined ? false : _ref4$ps;
	
	
	    var selectAStoreOverlay = new Overlay({
	      channel: channel,
	      mobileDirection: 'bottom',
	      height: 660,
	      useCustomFrameListner: true
	    });
	    selectAStoreOverlay.off('frame.cart');
	    selectAStoreOverlay.on('frame.cart', function f(resp) {
	      frameCb.call(this, resp, digitalDataFlag);
	    });
	    bindOverlay(selectAStoreOverlay, 'js-atc-select-store');
	
	    var atc = new Overlay({
	      channel: channel,
	      mobileDirection: 'bottom',
	      height: 660,
	      useCustomFrameListner: true
	    });
	    ATC_OVERLAY = atc;
	    atc.off('frame.cart');
	    atc.on('frame.cart', function f(resp) {
	      frameCb.call(this, resp, digitalDataFlag);
	    });
	    bindOverlay(atc, 'js-atc');
	
	    var ca = new Overlay({
	      channel: channel,
	      mobileDirection: 'bottom',
	      height: 277,
	      useCustomFrameListner: true
	    });
	    ca.off('frame.cart');
	    ca.on('frame.cart', function f(resp) {
	      frameCb.call(this, resp, digitalDataFlag);
	    });
	    bindOverlay(ca, 'js-atc-check-availability');
	
	    var psChannel = void 0;
	
	    if (ps2) {
	      psChannel = channel === 'desktop' ? 'desktop-fullscreen' : channel;
	    } else {
	      psChannel = channel;
	    }
	    var pas = new Overlay({
	      channel: psChannel,
	      direction: channel === 'mobile' ? 'bottom' : 'top',
	      height: 583,
	      useCustomFrameListner: true
	    });
	    pas.off('frame.cart');
	    pas.on('frame.cart', function f(resp) {
	      frameCb.call(this, resp, digitalDataFlag);
	    });
	    // pas.on('frame', eventHandler.bind('parts-and-services'));
	    bindOverlay(pas, 'js-atc-parts-and-services');
	
	    return {
	      selectAStore: selectAStoreOverlay,
	      atc: atc,
	      checkAvailability: ca,
	      partsAndServices: pas
	    };
	  }
	
	  return {
	    addToCart: addToCart,
	    selectAStore: selectAStore,
	    checkAvailability: checkAvailability,
	    partsAndServices: partsAndServices,
	    preload: preload,
	    bind: bind,
	    bindOverlay: bindOverlay
	  };
	});

/***/ }),
/* 1 */
/***/ (function(module, exports) {

	module.exports = __WEBPACK_EXTERNAL_MODULE_1__;

/***/ }),
/* 2 */
/***/ (function(module, exports) {

	module.exports = __WEBPACK_EXTERNAL_MODULE_2__;

/***/ }),
/* 3 */
/***/ (function(module, exports) {

	module.exports = __WEBPACK_EXTERNAL_MODULE_3__;

/***/ }),
/* 4 */
/***/ (function(module, exports) {

	module.exports = __WEBPACK_EXTERNAL_MODULE_4__;

/***/ })
/******/ ])});;
//# sourceMappingURL=thd-cart-bindings.amd.js.map;
define('thd-client-throttle',["cookie-utils"], function(__WEBPACK_EXTERNAL_MODULE_2__) { return /******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId])
/******/ 			return installedModules[moduleId].exports;
/******/
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			exports: {},
/******/ 			id: moduleId,
/******/ 			loaded: false
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.loaded = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(0);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ (function(module, exports, __webpack_require__) {

	'use strict';
	
	var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };
	
	var _helpers = __webpack_require__(1);
	
	var helpers = _interopRequireWildcard(_helpers);
	
	function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }
	
	function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } } /* globals THD_GLOBAL */
	
	// import { cookieUtils } from 'cookieUtils';
	var cookieUtils = __webpack_require__(2);
	
	var config = {
	  cart_throttle_desktop: {
	    globalName: 'desktopCartThrottle',
	    key: 30
	  },
	  cart_throttle_mobile: {
	    globalName: 'mobileCartThrottle',
	    key: 29
	  },
	  data_collection: {
	    throttle: 'dataCapture',
	    key: 31
	  }
	};
	
	var ClientThrottle = function () {
	  function ClientThrottle(_ref) {
	    var throttlePercent = _ref.throttlePercent,
	        key = _ref.key;
	
	    _classCallCheck(this, ClientThrottle);
	
	    this.key = key;
	    this.throttlePercent = typeof throttlePercent === 'undefined' ? 0 : throttlePercent;
	  }
	
	  ClientThrottle.prototype.getThrottleValue = function getThrottleValue() {
	    /* istanbul ignore if */
	    if (!cookieUtils.cookieManager) {
	      // Must initialize first to avoid issues during load
	      cookieUtils.initializeCookieManager();
	    }
	
	    cookieUtils.initializeMasterCookie();
	
	    var key = this.key;
	    var throttleValueFromCookie = helpers.getThrottleFromCookie({ key: key });
	    var randomNumber = Math.floor(Math.random() * 100);
	    // if no throttle cookie, set to 0
	    var throttlePercent = typeof this.throttlePercent !== 'undefined' ? this.throttlePercent : 0;
	    var throttleValue = 0;
	
	    if (throttlePercent === 0 || throttlePercent === 100) {
	      throttleValue = throttlePercent === 100 ? 1 : 0;
	    } else if (typeof throttleValueFromCookie === 'number') {
	      console.log('cookie value is a number');
	      throttleValue = throttleValueFromCookie;
	    } else if (throttlePercent > randomNumber) {
	      console.log('throttle percent is >');
	      throttleValue = 1;
	    }
	
	    helpers.setThrottleForCookie({ key: key, throttleValue: throttleValue });
	
	    return throttleValue;
	  };
	
	  return ClientThrottle;
	}();
	
	var isOn = function isOn(throttleConfig) {
	  var argType = typeof throttleConfig === 'undefined' ? 'undefined' : _typeof(throttleConfig);
	  var result = null;
	  var localConfig = throttleConfig;
	
	  // find the config object if given a name string
	  if (argType === 'string') {
	    localConfig = config[throttleConfig];
	  }
	
	  // Use config info to find the current throttle value
	  if (localConfig && localConfig.globalName) {
	    localConfig.throttlePercent = window.THD_GLOBAL[localConfig.globalName];
	  } else if (localConfig && localConfig.throttle) {
	    localConfig.throttlePercent = window.THD_GLOBAL.throttle[localConfig.throttle];
	  }
	
	  // assuming we have a valid config, get the real value
	  if (localConfig && localConfig.hasOwnProperty('key') && localConfig.hasOwnProperty('throttlePercent')) {
	    var throttle = new ClientThrottle(localConfig);
	    result = Boolean(throttle.getThrottleValue());
	  }
	
	  return result;
	};
	
	module.exports = {
	  ClientThrottle: ClientThrottle,
	  isOn: isOn,
	  config: config
	};

/***/ }),
/* 1 */
/***/ (function(module, exports, __webpack_require__) {

	'use strict';
	
	var cookieUtils = __webpack_require__(2);
	
	var getThrottleFromCookie = function getThrottleFromCookie(_ref) {
	  var key = _ref.key;
	
	  var throttle = cookieUtils.readCookie('FEATURE_THROTTLE');
	  if (!throttle) return null;
	  var index = throttle.split('-').indexOf(key + '.0');
	  index = index === -1 ? throttle.split('-').indexOf(key + '.1') : index;
	  if (index === -1) return null;
	  var throttleValue = throttle.split('-')[index];
	  var value = parseInt(throttleValue.split('.')[1], 10);
	  return parseInt(throttleValue.split('.')[1], 10);
	};
	
	var setThrottleForCookie = function setThrottleForCookie(_ref2) {
	  var key = _ref2.key,
	      throttleValue = _ref2.throttleValue;
	
	  var throttle = cookieUtils.readCookie('FEATURE_THROTTLE');
	  var throttleArr = [];
	  var throttleString = key + '.' + throttleValue;
	  if (throttle) {
	    throttleArr = throttle.split('-');
	    throttleArr = throttleArr.map(function (throttleIndex) {
	      return throttleIndex.indexOf(key + '.') !== -1 ? throttleString : throttleIndex;
	    });
	    throttle = throttleArr.join('');
	  } else {
	    throttle += throttleString;
	  }
	  cookieUtils.createCookie('FEATURE_THROTTLE', throttle, 1);
	};
	
	module.exports = {
	  getThrottleFromCookie: getThrottleFromCookie,
	  setThrottleForCookie: setThrottleForCookie
	};

/***/ }),
/* 2 */
/***/ (function(module, exports) {

	module.exports = __WEBPACK_EXTERNAL_MODULE_2__;

/***/ })
/******/ ])});;
//# sourceMappingURL=main.amd.js.map;
(function webpackUniversalModuleDefinition(root, factory) {
	if(typeof exports === 'object' && typeof module === 'object')
		module.exports = factory(require("thd-client-throttle"));
	else if(typeof define === 'function' && define.amd)
		define('thd-recently-viewed',["thd-client-throttle"], factory);
	else {
		var a = typeof exports === 'object' ? factory(require("thd-client-throttle")) : factory(root["thd-client-throttle"]);
		for(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];
	}
})(this, function(__WEBPACK_EXTERNAL_MODULE_3__) {
return /******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId])
/******/ 			return installedModules[moduleId].exports;
/******/
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			exports: {},
/******/ 			id: moduleId,
/******/ 			loaded: false
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.loaded = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(0);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ (function(module, exports, __webpack_require__) {

	'use strict';
	
	var _storage = __webpack_require__(1);
	
	var _helpers = __webpack_require__(2);
	
	var helpers = _interopRequireWildcard(_helpers);
	
	var _thdClientThrottle = __webpack_require__(3);
	
	var THD_CLIENT_THROTTLE = _interopRequireWildcard(_thdClientThrottle);
	
	function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }
	
	var cameFromPIP = false; /* globals resx, mockRVData */
	
	var setDataInStorage = function setDataInStorage(data) {
	  return (0, _storage.setSessionStorage)(helpers.mergeLocalData(data), 'rvData');
	};
	
	var expireDataInStorage = function expireDataInStorage() {
	  return (0, _storage.setSessionStorage)(0, 'RVDateStamp');
	};
	
	var getDataFromStorage = function getDataFromStorage() {
	  var rvData = (0, _storage.getSessionStorage)('rvData');
	  return rvData;
	};
	
	var shouldLoadFromStorage = function shouldLoadFromStorage() {
	  var loadFromStorage = true;
	  var domainMismatch = helpers.checkHost(document.referrer);
	  var dataExpired = (0, _storage.getDataTimeOut)((0, _storage.getSessionStorage)('RVDateStamp'));
	  cameFromPIP = helpers.getProductPageStatus(document.referrer);
	
	  /*
	    logic:
	      referrer is pip = get Data from API
	      Expired date stamp = get Data from API
	      Domain mismatch = get Data from API
	  */
	
	  loadFromStorage = cameFromPIP ? false : loadFromStorage;
	  loadFromStorage = domainMismatch ? loadFromStorage : false;
	  loadFromStorage = dataExpired ? false : loadFromStorage;
	
	  return loadFromStorage;
	};
	
	var checkThrottle = function checkThrottle(channel) {
	  var throttleKey = channel === 'mobile' ? 33 : 32;
	  var throttlePercent = channel === 'mobile' ? THD_GLOBAL.mobileRVThrottle : THD_GLOBAL.desktopRVThrottle;
	  var rvThrottle = new THD_CLIENT_THROTTLE.ClientThrottle({
	    throttlePercent: throttlePercent,
	    key: throttleKey
	  });
	  return rvThrottle.getThrottleValue() === 1;
	};
	
	module.exports = {
	  shouldLoadFromStorage: shouldLoadFromStorage,
	  checkThrottle: checkThrottle,
	  setDataInStorage: setDataInStorage,
	  getDataFromStorage: getDataFromStorage,
	  expireDataInStorage: expireDataInStorage
	};

/***/ }),
/* 1 */
/***/ (function(module, exports) {

	'use strict';
	
	// Feature detect + local reference
	var testStorage = function testStorage() {
	  var testString = 'test';
	  try {
	    sessionStorage.setItem(testString, testString);
	    sessionStorage.removeItem(testString);
	    return true;
	  } catch (e) {
	    return false;
	  }
	};
	
	var getDataTimeOut = function getDataTimeOut(date) {
	  /* current logic = > 5 minute = true*/
	  var dataDateObject = new Date(date.timestamp);
	  var timeLimit = 60 * 1000 * 5; /* ms - currently five minutes */
	  var dateDifference = new Date() - dataDateObject;
	  return dateDifference > timeLimit;
	};
	
	var setSessionStorage = function setSessionStorage(data, key) {
	  var storageStatus = false;
	  var storageString = JSON.stringify(data);
	  var dateObject = {
	    timestamp: new Date().toString()
	  };
	
	  if (testStorage()) {
	    sessionStorage.setItem(key, storageString);
	    sessionStorage.setItem('RVDateStamp', JSON.stringify(dateObject));
	    storageStatus = true;
	  }
	
	  return storageStatus;
	};
	
	var getSessionStorage = function getSessionStorage(key) {
	  var dataSet = [];
	  if (testStorage()) {
	    dataSet = JSON.parse(sessionStorage.getItem(key));
	  } else {
	    dataSet = false;
	  }
	
	  return dataSet || false;
	};
	
	module.exports = {
	  setSessionStorage: setSessionStorage,
	  getSessionStorage: getSessionStorage,
	  testStorage: testStorage,
	  getDataTimeOut: getDataTimeOut
	};

/***/ }),
/* 2 */
/***/ (function(module, exports, __webpack_require__) {

	'use strict';
	
	var _storage = __webpack_require__(1);
	
	var getProductPageStatus = function getProductPageStatus(location) {
	  return location.indexOf('/p/') > -1;
	};
	
	var mergeLocalData = function mergeLocalData(data) {
	  var localData = (0, _storage.getSessionStorage)('rvData');
	  var mergedArr = [].concat(data, localData);
	  var dedupedArr = [];
	  var isDuplicate = false;
	  for (var _iterator = mergedArr, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _iterator[Symbol.iterator]();;) {
	    var _ref;
	
	    if (_isArray) {
	      if (_i >= _iterator.length) break;
	      _ref = _iterator[_i++];
	    } else {
	      _i = _iterator.next();
	      if (_i.done) break;
	      _ref = _i.value;
	    }
	
	    var product = _ref;
	
	    isDuplicate = false;
	    for (var _iterator2 = dedupedArr, _isArray2 = Array.isArray(_iterator2), _i2 = 0, _iterator2 = _isArray2 ? _iterator2 : _iterator2[Symbol.iterator]();;) {
	      var _ref2;
	
	      if (_isArray2) {
	        if (_i2 >= _iterator2.length) break;
	        _ref2 = _iterator2[_i2++];
	      } else {
	        _i2 = _iterator2.next();
	        if (_i2.done) break;
	        _ref2 = _i2.value;
	      }
	
	      var i = _ref2;
	
	      if (i.productId === product.productId) {
	        isDuplicate = true;
	      }
	    }
	    if (!isDuplicate && product) {
	      dedupedArr.push(product);
	    }
	  }
	  return dedupedArr;
	};
	
	var checkHost = function checkHost(referrer) {
	  var mismatch = false;
	  var location = window.location;
	  var referringHost = referrer;
	  var protocolMatch = true;
	  var hostMatch = true;
	  if (referringHost !== '') {
	    protocolMatch = referrer.indexOf(location.protocol) > -1;
	    referringHost = referringHost.match(/:\/\/(.[^/]+)/)[1];
	    hostMatch = referringHost === location.host;
	    mismatch = protocolMatch || hostMatch;
	  }
	  return mismatch;
	};
	
	module.exports = {
	  getProductPageStatus: getProductPageStatus,
	  mergeLocalData: mergeLocalData,
	  checkHost: checkHost
	};

/***/ }),
/* 3 */
/***/ (function(module, exports) {

	module.exports = __WEBPACK_EXTERNAL_MODULE_3__;

/***/ })
/******/ ])
});
;
//# sourceMappingURL=main.amd.js.map;
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("jquery"),require("cookie-utils"),require("thd-carousel"),require("digitalData"),require("thd-cart-bindings"),require("utils.url"),require("thd-recently-viewed"),require("Localizer")):"function"==typeof define&&define.amd?define('thd.certona',["jquery","cookie-utils","thd-carousel","digitalData","thd-cart-bindings","utils.url","thd-recently-viewed","Localizer"],t):"object"==typeof exports?exports.thd_recommendations_all=t(require("jquery"),require("cookie-utils"),require("thd-carousel"),require("digitalData"),require("thd-cart-bindings"),require("utils.url"),require("thd-recently-viewed"),require("Localizer")):e.thd_recommendations_all=t(e.$,e["cookie-utils"],e["thd-carousel"],e.digitalData,e["thd-cart-bindings"],e["utils.url"],e["thd-recently-viewed"],e.Localizer)}("undefined"!=typeof self?self:this,function(e,t,r,n,o,a,i,c){return function(e){function t(e){delete installedChunks[e]}function r(e){var t=document.getElementsByTagName("head")[0],r=document.createElement("script");r.type="text/javascript",r.charset="utf-8",r.src=m.p+""+e+"."+I+".hot-update.js",t.appendChild(r)}function n(e){return e=e||1e4,new Promise(function(t,r){if("undefined"==typeof XMLHttpRequest)return r(Error("No browser support"));try{var n=new XMLHttpRequest,o=m.p+""+I+".hot-update.json";n.open("GET",o,!0),n.timeout=e,n.send(null)}catch(e){return r(e)}n.onreadystatechange=function(){if(4===n.readyState)if(0===n.status)r(Error("Manifest request to "+o+" timed out."));else if(404===n.status)t();else if(200!==n.status&&304!==n.status)r(Error("Manifest request to "+o+" failed."));else{try{var e=JSON.parse(n.responseText)}catch(e){return void r(e)}t(e)}}})}function o(e){var t=M[e];if(!t)return m;var r=function(r){return t.hot.active?(M[r]?0>M[r].parents.indexOf(e)&&M[r].parents.push(e):(b=[e],f=r),0>t.children.indexOf(r)&&t.children.push(r)):(console.warn("[HMR] unexpected require("+r+") from disposed module "+e),b=[]),m(r)};for(var n in m)Object.prototype.hasOwnProperty.call(m,n)&&"e"!==n&&Object.defineProperty(r,n,function(e){return{configurable:!0,enumerable:!0,get:function(){return m[e]},set:function(t){m[e]=t}}}(n));return r.e=function(e){function t(){T--,"prepare"===C&&(k[e]||l(e),0===T&&0===R&&u())}return"ready"===C&&i("prepare"),T++,m.e(e).then(t,function(e){throw t(),e})},r}function a(e){var t={_acceptedDependencies:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_disposeHandlers:[],_main:f!==e,active:!0,accept:function(e,r){if(void 0===e)t._selfAccepted=!0;else if("function"==typeof e)t._selfAccepted=e;else if("object"==typeof e)for(var n=0;e.length>n;n++)t._acceptedDependencies[e[n]]=r||function(){};else t._acceptedDependencies[e]=r||function(){}},decline:function(e){if(void 0===e)t._selfDeclined=!0;else if("object"==typeof e)for(var r=0;e.length>r;r++)t._declinedDependencies[e[r]]=!0;else t._declinedDependencies[e]=!0},dispose:function(e){t._disposeHandlers.push(e)},addDisposeHandler:function(e){t._disposeHandlers.push(e)},removeDisposeHandler:function(e){var r=t._disposeHandlers.indexOf(e);0>r||t._disposeHandlers.splice(r,1)},check:s,apply:p,status:function(e){if(!e)return C;S.push(e)},addStatusHandler:function(e){S.push(e)},removeStatusHandler:function(e){var t=S.indexOf(e);0>t||S.splice(t,1)},data:x[e]};return f=void 0,t}function i(e){C=e;for(var t=0;S.length>t;t++)S[t].call(null,e)}function c(e){return+e+""===e?+e:e}function s(e){if("idle"!==C)throw Error("check() is only allowed in idle status");return y=e,i("check"),n(w).then(function(e){if(!e)return i("idle"),null;O={},k={},D=e.c,_=e.h,i("prepare");var t=new Promise(function(e,t){v={resolve:e,reject:t}});g={};return l(0),"prepare"===C&&0===T&&0===R&&u(),t})}function d(e,t){if(D[e]&&O[e]){O[e]=!1;for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(g[r]=t[r]);0==--R&&0===T&&u()}}function l(e){D[e]?(O[e]=!0,R++,r(e)):k[e]=!0}function u(){i("ready");var e=v;if(v=null,e)if(y)Promise.resolve().then(function(){return p(y)}).then(function(t){e.resolve(t)},function(t){e.reject(t)});else{var t=[];for(var r in g)Object.prototype.hasOwnProperty.call(g,r)&&t.push(c(r));e.resolve(t)}}function p(r){function n(e,t){for(var r=0;t.length>r;r++){var n=t[r];0>e.indexOf(n)&&e.push(n)}}if("ready"!==C)throw Error("apply() is only allowed in ready status");r=r||{};var o,a,s,d,l,u={},p=[],h={},f=function(){console.warn("[HMR] unexpected require("+y.moduleId+") to disposed module")};for(var v in g)if(Object.prototype.hasOwnProperty.call(g,v)){l=c(v);var y;y=g[v]?function(e){for(var t=[e],r={},o=t.slice().map(function(e){return{chain:[e],id:e}});o.length>0;){var a=o.pop(),i=a.id,c=a.chain;if((d=M[i])&&!d.hot._selfAccepted){if(d.hot._selfDeclined)return{type:"self-declined",chain:c,moduleId:i};if(d.hot._main)return{type:"unaccepted",chain:c,moduleId:i};for(var s=0;d.parents.length>s;s++){var l=d.parents[s],u=M[l];if(u){if(u.hot._declinedDependencies[i])return{type:"declined",chain:c.concat([l]),moduleId:i,parentId:l};0>t.indexOf(l)&&(u.hot._acceptedDependencies[i]?(r[l]||(r[l]=[]),n(r[l],[i])):(delete r[l],t.push(l),o.push({chain:c.concat([l]),id:l})))}}}}return{type:"accepted",moduleId:e,outdatedModules:t,outdatedDependencies:r}}(l):{type:"disposed",moduleId:v};var w=!1,P=!1,S=!1,R="";switch(y.chain&&(R="\nUpdate propagation: "+y.chain.join(" -> ")),y.type){case"self-declined":r.onDeclined&&r.onDeclined(y),r.ignoreDeclined||(w=Error("Aborted because of self decline: "+y.moduleId+R));break;case"declined":r.onDeclined&&r.onDeclined(y),r.ignoreDeclined||(w=Error("Aborted because of declined dependency: "+y.moduleId+" in "+y.parentId+R));break;case"unaccepted":r.onUnaccepted&&r.onUnaccepted(y),r.ignoreUnaccepted||(w=Error("Aborted because "+l+" is not accepted"+R));break;case"accepted":r.onAccepted&&r.onAccepted(y),P=!0;break;case"disposed":r.onDisposed&&r.onDisposed(y),S=!0;break;default:throw Error("Unexception type "+y.type)}if(w)return i("abort"),Promise.reject(w);if(P){h[l]=g[l],n(p,y.outdatedModules);for(l in y.outdatedDependencies)Object.prototype.hasOwnProperty.call(y.outdatedDependencies,l)&&(u[l]||(u[l]=[]),n(u[l],y.outdatedDependencies[l]))}S&&(n(p,[y.moduleId]),h[l]=f)}var T=[];for(a=0;p.length>a;a++)l=p[a],M[l]&&M[l].hot._selfAccepted&&T.push({module:l,errorHandler:M[l].hot._selfAccepted});i("dispose"),Object.keys(D).forEach(function(e){!1===D[e]&&t(e)});for(var k,O=p.slice();O.length>0;)if(l=O.pop(),d=M[l]){var A={},j=d.hot._disposeHandlers;for(s=0;j.length>s;s++)(o=j[s])(A);for(x[l]=A,d.hot.active=!1,delete M[l],delete u[l],s=0;d.children.length>s;s++){var L=M[d.children[s]];L&&(0>(k=L.parents.indexOf(l))||L.parents.splice(k,1))}}var N,E;for(l in u)if(Object.prototype.hasOwnProperty.call(u,l)&&(d=M[l]))for(E=u[l],s=0;E.length>s;s++)N=E[s],0>(k=d.children.indexOf(N))||d.children.splice(k,1);i("apply"),I=_;for(l in h)Object.prototype.hasOwnProperty.call(h,l)&&(e[l]=h[l]);var H=null;for(l in u)if(Object.prototype.hasOwnProperty.call(u,l)&&(d=M[l])){E=u[l];var U=[];for(a=0;E.length>a;a++)if(N=E[a],o=d.hot._acceptedDependencies[N]){if(U.indexOf(o)>=0)continue;U.push(o)}for(a=0;U.length>a;a++){o=U[a];try{o(E)}catch(e){r.onErrored&&r.onErrored({type:"accept-errored",moduleId:l,dependencyId:E[a],error:e}),r.ignoreErrored||H||(H=e)}}}for(a=0;T.length>a;a++){var F=T[a];l=F.module,b=[l];try{m(l)}catch(e){if("function"==typeof F.errorHandler)try{F.errorHandler(e)}catch(t){r.onErrored&&r.onErrored({type:"self-accept-error-handler-errored",moduleId:l,error:t,orginalError:e,originalError:e}),r.ignoreErrored||H||(H=t),H||(H=e)}else r.onErrored&&r.onErrored({type:"self-accept-errored",moduleId:l,error:e}),r.ignoreErrored||H||(H=e)}}return H?(i("fail"),Promise.reject(H)):(i("idle"),new Promise(function(e){e(p)}))}function m(t){if(M[t])return M[t].exports;var r=M[t]={i:t,l:!1,exports:{},hot:a(t),parents:(P=b,b=[],P),children:[]};return e[t].call(r.exports,r,r.exports,o(t)),r.l=!0,r.exports}var h=window.webpackHotUpdatethd_recommendations__name_;window.webpackHotUpdatethd_recommendations__name_=function(e,t){d(e,t),h&&h(e,t)};var f,v,g,_,y=!0,I="bb8a09b70ce11e707a1b",w=1e4,x={},b=[],P=[],S=[],C="idle",R=0,T=0,k={},O={},D={},M={};return m.m=e,m.c=M,m.d=function(e,t,r){m.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},m.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return m.d(t,"a",t),t},m.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},m.p="",m.h=function(){return I},o(55)(m.s=55)}([function(t,r){t.exports=e},function(e,r){e.exports=t},function(e,t,r){"use strict";e.exports={addToCartText:"Add To Cart",addedToCartText:"Added To Cart",itemNotAddedText:"Item Not Added",customizeText:"Build & Buy"}},function(e,t,r){"use strict";var n=r(26),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(n);e.exports={render:function(e){var t=void 0;if("0"===e.price.dollars){t=parseInt(e.price.cents)+"<span class='price__format'>&#162;</span>"+(e.uom&&"each"!==e.uom?"<span class='price__unit'>/"+e.uom+"</span>":"")}else t="<span class='price__format'>$</span>"+e.price.dollars+"<span class='price__format'>"+e.price.cents+"</span>"+(e.uom&&"each"!==e.uom?"<span class='price__unit'>/"+e.uom+"</span>":"");return'\n    <span class="u__normal u__text--alternate '+(e.MAPFlag?"":"u--hide")+'">\n      See Lower Price in Cart\n    </span>\n    <div class="price '+(e.MAPFlag?"u--hide":"")+'">\n      '+t+"\n    </div>\n\n    "+(e.discountFlag?""+o.render(e):"")+"\n  "}}},function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}var o=r(2),a=n(o),i=r(13),c=n(i),s=r(27),d=n(s),l=r(28),u=n(l);e.exports={render:function(e,t){return"\n    "+(e.isMobile?"":'\n        <div class="certona__productbttnwrapper">\n        '+(e.showATCFlag?""+c.render(e,t,a):"")+"\n        "+(e.cartModalFlag?""+d.render(e,t,a):"")+"\n        "+(e.showATLFlag?""+u.render(e,t):"")+"\n        </div>\n      ")+"\n  "}}},function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.initCookieManager=t.isPipAlternativerecs=t.getProductionURL=t.isMobileSchema=t.searchInGivenSchemas=t.getTemplateElements=t.splitPrice=t.constructPrice=t.log=t.getmcvisId=t.getSkuFromProducts=t.getSku=t.getHost=t.getStoreID=t.getChannel=t.getGlobalObject=t.pageType=t.getPIIDkey=t.getRVPath=t.isInt=t.getRecommendationsHost=t.formatUOM=t.detectDevice=void 0;var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=r(1),i=n(a),c=r(6),s=n(c),d=r(0),l=function(e){return e&&e.__esModule?e:{default:e}}(d),u=["PIPHorizontal1_rr","mobileweb_pip_rr"],p=function(e){var t=void 0!==e?e:navigator.userAgent,r=null!==t.match(/iPad/g);return r?"tablet":null!==t.match(/iPhone|(Android)|THDConsumer/g)?"mobileweb":"Desktop"},m=function(e,t){var r="n/a";return t&&e&&(e.itemid?r=e.itemid:e.products&&(r=e.products)),r},h=function(e,t){return t&&e&&e.products?e.products:"n/a"},f=function(e){var t=e.parents(".certona__carousel").length,r=t?e.parents(".certona__carousel").parent().attr("id"):e.parents(".certona__wrapper--nofill, .certona__wrapper--withfill").parent().attr("id");return void 0!==r?r:"n/a"},v=function(e,t){e&&e.logging&&console.log(t)},g=function(e){return"undefined"!=typeof THD_TOUCH_GLOBALS?THD_TOUCH_GLOBALS:THD_GLOBAL},_=function(e){return e%1==0},y=function(){var e=g();return e&&e.thdRecommendationsApiHost},I=function(){return"//"+window.location.host},w=function(e){var t=e;return e.channel||(t.channel="undefined"!=typeof THD_TOUCH_GLOBALS?"mobile":"desktop"),t.channel},x=function(){var e=document.cookie.split("; ").filter(function(e){return 0===e.indexOf("thda.u=")}),t=e[0];return t=void 0!==t&&t.replace("thda.u=","")},b=function(e){var t=l.default.Deferred(),r=e.uid;if(void 0===r)var n=0,o=setInterval(function(){r=x(),++n>=5||r?(window.clearInterval(o),t.resolve(r)):++n>5&&!r&&t.reject()},150);else t.resolve(r);return t.promise()},P=function(){i.cookieManager||i.initializeCookieManager()},S=function(e){var t=g(),r=void 0!==e?e:t.nonSecureHostName;document.cookie.split("; ").filter(function(e){return 0===e.indexOf("HD_DC")});return"https://"+r},C=function(e){var t=e.storeID;return""!==t?"&storeid="+t:""},R=function(e,t){var r=l.default.Deferred(),n=S();return b(t).then(function(e){n=!!e&&n+"/uds/v1/"+e+"/data?unique=true&filters=rv&key=2zSR74pj5Rq6zDtHENHkAScT4RWsl0pg"+C(t),r.resolve(n)}).fail(function(e){r.reject("No PIID")}),r.promise()},T=function(){P();var e=i.getAdobeCrumbs()||{};return e.MCMID?e.MCMID:""},k=function(e){var t={};if(_(e))t.dollars=e,t.cents="00";else{var r=parseFloat(e);if(isNaN(r))return t;r=r.toFixed(2),r=r.split("."),t.dollars=r[0],t.cents=r[1]}return t},O=function(e){var t=e.price||"";return t&&"object"!==(void 0===t?"undefined":o(t))?k(t):t},D=function(e,t){return{imagePath:void 0!==e.imageURL?e.imageURL.replace("<SIZE>",300):"",URL:t?e.canonicalURL:e.categoryURL,name:t?e.productName:e.categoryName,productId:e.productId||e.similarProductId,rating:e.rating,reviews:e.reviews?e.reviews:0,canonicalURL:e.canonicalURL,ratingPercentage:e.rating&&e.rating/5*100||0,recomendingOMSID:"NA",showRatings:t,price:e.price?O(e):"",brand:e.brand?e.brand:"",uom:e.uom?e.uom:"",mapAboveOriginalPrice:e.hasOwnProperty("mapAboveOriginalPrice"),pricingMessage:e.pricingMessage,originalPrice:e.originalPrice,merchFlag:"MERCHANDISE"===e.itemType,hidePriceFlag:!e.hasOwnProperty("hidePrice")}},M=function(e){var t=e;if(t&&void 0!==t&&t.length){var r=l.default.trim(t).indexOf("-");r>0&&t.length-1>r&&(t=t.substring(r+1)),t=l.default.trim(t.toLowerCase()),"square yard"===t?t="sq. yd.":"square foot"===t?t="sq. ft.":"pallet(lift)"!==t&&"pallet(unit load)"!==t||(t="pallet")}else t="each";return t},A=function(e,t){return t.indexOf(e)>-1},j=function(){return"https://"+s.hosts.prod},L=function(e){return!(!e||-1===e.toLowerCase().indexOf("mobile"))},N=function(e,t){if(e&&t)return u.indexOf(e)>-1&&"pipmodel"===t};t.detectDevice=p,t.formatUOM=M,t.getRecommendationsHost=y,t.isInt=_,t.getRVPath=R,t.getPIIDkey=b,t.pageType=f,t.getGlobalObject=g,t.getChannel=w,t.getStoreID=C,t.getHost=I,t.getSku=m,t.getSkuFromProducts=h,t.getmcvisId=T,t.log=v,t.constructPrice=O,t.splitPrice=k,t.getTemplateElements=D,t.searchInGivenSchemas=A,t.isMobileSchema=L,t.getProductionURL=j,t.isPipAlternativerecs=N,t.initCookieManager=P},function(e,t,r){"use strict";e.exports={PIP_ALTERNATIVE_ENDPOINT:"/dynamicrecs/pip_alternatives",DEFAULT_ALT_API_KEY:"aGAQFG4j6QtVTSWqujfFYWeIU6BR5Mee",certonaPodSelector:".certona__wrapper--nofill .certona__productimagewrapper a, .certona__wrapper--nofill .certona__productdescriptionwrapper a, .certona__wrapper--withfill .certona__productimagewrapper a, .certona__wrapper--withfill .certona__productdescriptionwrapper a, .certona__wrapper--nofill certona__atcproductimagewrapper a",sponsoredSchemas:["hp_sponsored","search_sponsored","browse_sponsored","cat_sponsored","pip_sponsored","oc_sponsored","storepage_sponsored","thankyoupage_sponsored"],PLP_Schemas:["search_sponsored","browse_sponsored","cat_sponsored"],FBR_Schemas:["SearchPLPHorizontal1_rr","NavPLPHorizontal1_rr","mobileweb_search_rr","mobileweb_navplp_rr"],hosts:{dev:"hd-qa71.homedepotdev.com",stage:"hd-qa74.homedepotdev.com",prod:"www.homedepot.com"},sponsoredProductsTitle:"Sponsored Products",pipSponsoredSchema:"pip_sponsored",PIQPixel:"https%3A%2F%2Fcdn.tagdelivery.com%2Fpixel.gif",nonModel2Categories:{siding:!0,"roofing & gutters":!0,"smart locks":!0,carpet:!0,"vinyl flooring & resilient flooring":!0,"smart home":!1,"light bulbs":!0,bath:!0,kitchen:!0,appliances:!0}}},function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.schema=t.schemeBuilder=t.recommendationAnalytics=t.recommendationConfig=t.logger=t.helpers=void 0;var o=r(5),a=n(o),i=r(6),c=n(i),s=r(36),d=n(s),l=r(37),u=n(l),p=r(38),m=n(p),h=r(39),f=n(h);t.helpers=a,t.logger=f,t.recommendationConfig=c,t.recommendationAnalytics=d,t.schemeBuilder=m,t.schema=u},function(e,t,r){"use strict";function n(e){return[{x:e.left,y:e.top},{x:Math.max(e.right-1,0),y:e.top},{x:e.left+Math.floor((e.right-e.left)/2),y:e.top+Math.floor((e.bottom-e.top)/2)-1},{x:e.left,y:e.bottom-1},{x:e.right-1,y:e.bottom-1}]}function o(e,t){var r=void 0;if(t===e)r={top:0,left:0,bottom:e.innerHeight,right:e.innerWidth,width:e.innerWidth,height:e.innerHeight};else if(t.getBoundingClientRect){var n=t.getBoundingClientRect(),o=n.bottom,a=n.height,i=n.left,c=n.right,s=n.top,d=n.width;r={bottom:o,height:a,left:i,right:c,top:s,width:d}}else r={bottom:t.offsetTop+t.offsetHeight,height:t.offsetHeight,left:t.offsetLeft,right:t.offsetLeft+t.offsetWidth,top:t.offsetTop,width:t.offsetWidth};return r}function a(e,t){var r=!1;return e===t?r=!0:e&&e.parentElement&&(r=a(e.parentElement,t)),r}function i(e,t){return n(o(e,t)).map(function(e){return document.elementFromPoint(e.x,e.y)}).filter(function(e){return!a(e,t)}).length>2}function c(e){var t=e&&e.style&&"0"===e.style.opacity;return!t&&e.parentElement&&(t=c(e.parentElement)),t}function s(e,t){var r=null!==t.offsetParent;return r&&(r=!c(t)),r&&(r=!i(e,t)),r}function d(e,t){var r=t,n=e.getAttribute("onview-beacon");if(n){(0,m.default)('<img class="onviewbeacon" style="display:none;" src="https:'+n+'">').appendTo("body"),e.setAttribute("data-hl-beacon","sent"),r-=1}return r}function l(){for(var e=document.querySelectorAll('[class="certona__productpod"]'),t=[],r=0;e.length>r;r++)(function(e){return e.hasAttribute("data-hl-beacon")})(e[r])||t.push(e[r]);for(var n=0;t.length>n;n++){var o=t[n];s(window,o)&&(h=(0,m.default)(o.closest("[id]")).attr("id")||"",f.indexOf(h)>-1&&d(o,t.length))}}function u(){(0,m.default)(".certona__wrapper").is(":visible")||(0,m.default)(".visually-similar").is(":visible")?l():setTimeout(u,50)}var p=r(0),m=function(e){return e&&e.__esModule?e:{default:e}}(p),h="",f=["hp_sponsored","search_sponsored","browse_sponsored","cat_sponsored","pip_sponsored","oc_sponsored","storepage_sponsored","thankyoupage_sponsored"];window.addEventListener("resize",l),(0,m.default)(window).bind("load",function(){u()}),window.addEventListener("scroll",l),(0,m.default)(document).on("click",".carousel__prev",function(){(0,m.default)(".carousel__wrapper").on("translated.owl.carousel",l)}),(0,m.default)(document).on("click",".carousel__next",function(){(0,m.default)(".carousel__wrapper").on("translated.owl.carousel",l)}),e.exports={checkVisibility:l,isTransparent:c,isVisible:s,isNotOnTop:i,triggerBeacon:d}},function(e,t){e.exports=r},function(e,t,r){"use strict";e.exports={render:function(e,t){return'\n    <div class="certona__productimagewrapper">\n      '+(e.isSponsoredSchema?'<a href="'+e.productPage+"?MERCH=REC-_-"+t.schemaId+"-_-"+e.recomendingOMSID+"-_-"+e.productId+'-_-N" rel="nofollow" data-product-id="'+e.productId+'">':'<a href="'+t.host+e.canonicalURL+"?MERCH=REC-_-"+t.schemaId+"-_-"+e.recomendingOMSID+"-_-"+e.productId+'-_-N" data-product-id="'+e.productId+'">')+'\n      <img class="certona__productimg" src=\''+e.productimage+"' alt='"+e.productName+"' />\n      </a>\n      "+(e.configurableFlag?'<span class="product-imagelabel certona__customlabel large"> \x3c!-- change to global css --\x3eCUSTOM</span>':"")+"\n    </div>\n  "}}},function(e,t,r){"use strict";e.exports={render:function(e,t){return'\n    <div class="certona__productdescriptionwrapper">\n    <a class=""\n    '+(e.isSponsoredSchema?'href="'+e.productPage+"?MERCH=REC-_-"+t.schemaId+"-_-"+e.recomendingOMSID+"-_-"+e.productId+'-_-N" rel="nofollow" data-product-id="'+e.productId+'">':'href="'+t.host+e.canonicalURL+"?MERCH=REC-_-"+t.schemaId+"-_-"+e.recomendingOMSID+"-_-"+e.productId+'-_-N" data-product-id="'+e.productId+'">')+'\n       <span class="certona__brand">'+e.brand+"</span>\n          <span>"+e.productName+"</span>\n        </a>\n    </div>\n  "}}},function(e,t,r){"use strict";e.exports={render:function(e,t){return'\n    <div class="certona__productratingwrapper">\n      <a class="reviews\n          '+(void 0!==e.reviews?"":"not_rated")+"\n        "+(e.isSponsoredSchema?'" href="'+e.productPage+"?MERCH=REC-_-"+t.schemaId+"-_-"+e.recomendingOMSID+"-_-"+e.productId+'-_-N" rel="nofollow">\n        ':'" href="'+t.host+e.canonicalURL+"?MERCH=REC-_-"+t.schemaId+"-_-"+e.recomendingOMSID+"-_-"+e.productId+'-_-N">')+'\n        <span class="stars" rel="'+e.rating+'" title="Rating '+e.rating+' out of 5" style="width:'+e.ratingPercentage+'%""></span>\n      </a>\n      '+(void 0===e.reviews||e.isSponsoredSchema?"":'<a href="'+t.host+e.canonicalURL+"?MERCH=REC-_-"+t.schemaId+"-_-"+e.recomendingOMSID+'-_-{{productId}}-_-N#product-reviews">('+e.reviews+")</a>")+"\n      "+(void 0!==e.reviews&&e.isSponsoredSchema?'<a href="'+e.productPage+"?MERCH=REC-_-"+t.schemaId+"-_-"+e.recomendingOMSID+'-_-{{productId}}-_-N#product-reviews" rel="nofollow">('+e.reviews+")</a>":"")+"\n    </div>\n  "}}},function(e,t,r){"use strict";var n=r(13);!function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);t.default=e}(n);e.exports={render:function(e,t,r){return"\n    "+(e.configurableFlag?'\n        <a target="_top" class="bttn-outline bttn-outline--primary" href="'+t.host+e.canonicalURL+"?MERCH=REC-_-"+t.schemaId+"-_-"+e.recomendingOMSID+"-_-"+e.productId+"-_-N\">\n          <span class='bttn__content'>"+r.customizeText+"</span>\n        </a>\n        ":"")+"\n    "+(e.hidePriceFlag&&e.merchFlag?'\n        <a class="js-certona-atc bttn-outline bttn-outline--primary" data-onclickbeacon="'+e.onClickBeacon+'" href="javascript.open(\'/mycart/overlay#/add-to-cart/'+e.productId+"/1/ShipToHome/DirectShip/"+t.channel+'\')" data-quantity="1" data-item-id="'+e.productId+'">\n            <span class="bttn__content">'+r.addToCartText+"</span>\n        </a>\n        ":"")+"\n    "+(e.applianceFlag?'\n        <a class="js-certona-atc-appliance bttn-outline bttn-outline--primary" data-item-id="'+e.productId+'"\n          href="javascript:window.open(\'/mycart/overlay#/check-availability/'+e.productId+"/$data.{channel}')\">\n          <span class='bttn__content'>"+r.addToCartText+"</span>\n        </a>\n        ":"")+"\n  "}}},function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}var o=r(16),a=n(o),i=r(17),c=n(i),s=r(20),d=n(s),l=r(21),u=n(l),p=r(22),m=n(p),h=r(23),f=n(h),v=r(24),g=n(v),_=r(25),y=n(_),I=r(29),w=n(I),x=r(33),b=n(x),P=r(34),S=n(P),C=r(35),R=n(C),T={};T.withfill=m,T.irpgPod=R,T.atcnofill=g,T.nofill=c,T.categoryrecspod=d,T.internalCategoryrecspod=u,T.topsellerpod=b,T.productspod=y,T.atcproductpod=w,T.topSellerInternal=a,T.reorderTemplate=f,T.visuallySimilar=S,e.exports={templates:T}},function(e,t){e.exports=n},function(e,t,r){"use strict";e.exports={render:function(e){return'\n  <meta itemprop="name" content = '+e.schemaId+" >\n  <div class='grid isBound'>\n    <div class='col__12-12'>\n      <div class='row-header'>\n          <div class='row-header__title'>\n            <h2 class=\"row-header__text\n            "+(e.isMobile?"row-header__text--medium":"")+'\n            ">'+e.title+"\n              </h2>\n          </div>\n      </div>\n      <div>\n      <div class='carousel__wrapper'>\n    "+e.products.map(function(t){return'\n        <div class="certona__productpod">\n          <div class="certona__productimagewrapper">\n            <a href="'+e.host+t.URL+'" data-product-id="'+t.productId+'"">\n              <img class="certona__productimg" src="'+t.imagePath+'"  title="'+t.name+'"/>\n            </a>\n            <div class="product-title u__text-align--center"><a class="" href="'+e.host+t.URL+'" data-product-id="'+t.productId+'">'+t.name+"</a>\n            </div>\n          </div>\n          "+(!0===t.showRatings?'\n          <div class="certona__productratingwrapper">\n            <a class="reviews\n              '+(void 0!==t.reviews?"":"not_rated")+'" href="'+e.host+t.canonicalURL+"?MERCH=REC-_-"+t.schemaId+"-_-"+t.recomendingOMSID+"-_-"+t.productId+'-_-N">\n              <span class="stars" rel="'+t.rating+'" title="Rating '+t.rating+' out of 5" style="width:'+t.ratingPercentage+'%""></span>\n            </a> '+(void 0!==t.reviews?'<a href="'+e.host+t.canonicalURL+"?MERCH=REC-_-"+e.schemaId+"-_-"+t.recomendingOMSID+"-_-"+t.productId+'-_-N#product-reviews">('+t.reviews+")</a>":"")+"\n          </div>":"")+"\n        </div>\n    "}).join("")+"\n    </div>\n  </div>\n  "}}},function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}var o=r(18),a=n(o),i=r(19),c=n(i);e.exports={render:function(e){return'\n  <meta itemprop="name" content = '+e.schemaId+' >\n    <div class="grid isBound certona__wrapper certona__wrapper--nofill '+(e.minimal?"certona__wrapper--minimal":"")+'">\n      '+(e.minimal?""+a.render(e):""+c.render(e))+"\n      <div class='col__12-12'>\n          <div class=\"carousel__wrapper\">\n            "+e.productPartial.render(e)+"\n          </div>\n          <div class='certona-atc__error certona-atc__hide'></div>\n      </div>\n    </div>\n  "}}},function(e,t,r){"use strict";e.exports={render:function(e){return'\n    <div class="col__12-12">\n        <span class="certona__header">'+e.title+"\n        "+(e.seeAllLink?'<a class="certona-seeAll__link u__text--alternate" href="'+e.seeAllLink+'">See All</a>':"")+"\n        </span>\n    </div>\n  "}}},function(e,t,r){"use strict";e.exports={render:function(e){return"\n    <div class='col__12-12'>\n        <div class='row-header'>\n            <div class='row-header__title'>\n              <h2 class=\"row-header__text\n              "+(e.isMobile?"row-header__text--medium":"")+'\n              ">'+e.title+"\n                </h2>\n            </div>\n        </div>\n    </div>\n  "}}},function(e,t,r){"use strict";e.exports={render:function(e){return"\n  "+e.contents.map(function(t){return"\n    <div class='certona__categoryrecpod u__text-align--center'>\n        <a href='"+e.host+t.contentId.linkUrl+"?MERCH=CON1-_-"+e.schemaId+"-_-"+t.contentId.id+"-_-N'>\n          <img src='"+t.contentId.imagePath+"' alt='Category Recommendations "+t.contentId.title+"' class='certona__pcrimg'>\n        <span class='certona__categoryrecstitle'>\n          "+t.contentId.title+"\n        </span>\n      </a>\n    </div>\n  "}).join("")+"\n  "}}},function(e,t,r){"use strict";e.exports={render:function(e){return"\n  "+e.products.map(function(t){return"\n    <div class='certona__categoryrecpod u__text-align--center'>\n        <a href='"+e.host+t.catUrl+"?MERCH=CON1-_-"+e.schemaId+"-_-"+t.catId+"-_-N'>\n          <img src='"+t.productimage+"' alt='Category Recommendations "+t.catName+"' class='certona__pcrimg'>\n        <span class='certona__categoryrecstitle'>\n          "+t.catName+"\n        </span>\n      </a>\n    </div>\n  "}).join("")+"\n  "}}},function(e,t,r){"use strict";e.exports={render:function(e){return'\n  <meta itemprop="name" content = '+e.schemaId+' >\n  <div class="grid isBound certona__wrapper certona__wrapper--withfill '+(e.minimal?"certona__wrapper--minimal":"")+'">\n      <div class="col__12-12">\n          <span class="certona__header">'+e.title+'</span>\n      </div>\n      <div class="col__12-12">\n          <div class="carousel__wrapper">\n            '+e.productPartial.render(e)+'\n          </div>\n          <div class="certona-atc__error certona-atc__hide"></div>\n      </div>\n  </div>\n  '}}},function(e,t,r){"use strict";var n=r(2),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(n);e.exports={render:function(e){return'\n  <meta itemprop="name" content = '+e.schemaId+' >\n    <div class="grid isBound reorder">\n      <div class="col__12-12">\n        \x3c!-- Row Header --\x3e\n        <div class="row-header">\n          <div class="row-header__title">\n            <h2 class="row-header__text\n            '+(e.isMobile?"row-header__text--medium":"")+'\n            ">'+e.title+'\n            </h2>\n          </div>\n        </div>\n      </div>\n      <div class="carousel__wrapper">\n      '+e.products.map(function(t){return'\n      <div>\n        <meta itemprop="productID" content="'+t.productId+'" />\n        \x3c!-- reorder Pod --\x3e\n        <div class="reorder__pod">\n          <div class="reorder-left col__4-12">\n            \x3c!-- reorder Media --\x3e\n            <div class="reorder__media">\n              <a class="reorder__media--link" data-product-id="'+t.productId+'" href="'+e.host+t.URL+'" data-product-interval="'+t.interval+'">\n                <img class="reorder__img stretchy" src="'+t.imagePath+'" title="'+t.name+'">\n              </a>\n            </div>\n          </div>\n          <div class="reorder-right  col__8-12">\n            \x3c!-- reorder Details --\x3e\n            <div class="reorder__details lineClamp--2lines">\n              \x3c!-- Brand --\x3e\n              '+(void 0!==t.brand?'<span class="reorder__details__brand u__bold">'+t.brand+"</span>":"")+'\n              \x3c!-- Description --\x3e\n              <span class="reorder__details__description">'+t.productName+'</span>\n            </div>\n            \x3c!-- reorder Price --\x3e\n            <div class="reorder__price">\n              <span class="reorder__price__message u__normal u__text--alternate price\n                '+(e.MAPFlag?"":"u--hide")+'\n              ">Add to Cart to See Price</span>\n              <div class="price\n                '+(e.MAPFlag?"u--hide":"")+'\n              ">\n                <span class="price__format">$</span>'+t.price.dollars+'<span class="price__format">'+t.price.cents+"</span>"+(t.uom&&"each"!==t.uom?'<span class="price__unit">/'+t.uom+"</span>":"")+'\n              </div>\n            </div>\n            \x3c!-- reorder ATC --\x3e\n            <div class="reorder__atc reorder__hidden-xs-below">\n                <button class="js-reorder-atc bttn-outline bttn-outline--primary" data-item-id="'+t.productId+'">'+o.addToCartText+'</button>\n            </div>\n         </div>\n        </div>\n        \x3c!-- reorder ATC --\x3e\n          <div class="grid isFlush reorder__hidden-sm-above"</div>\n           <div class="col__12-12"</div>\n              <div class="reorder__atc">\n              <button class="js-reorder-atc bttn-outline bttn-outline--primary" data-item-id="'+t.productId+'">'+o.addToCartText+"</button>\n               </div>\n            </div>\n          </div>\n      </div>\n      "}).join("")+"\n      </div>\n    </div>\n  "}}},function(e,t,r){"use strict";e.exports={render:function(e){return'\n    <meta itemprop="name" content = '+e.schemaId+' >\n    <div class="grid isBound certona__wrapper certona__wrapper--nofill">\n      <div class="col__12-12">\n        <span class="certona__atcheader u__husky">'+e.title+"</span>\n      </div>\n      <div class='col__12-12'>\n        <div class='carousel__wrapper'>\n          "+e.productPartial.render(e)+"\n        </div>\n        <div class='certona-atc__error certona-atc__hide'></div>\n      </div>\n    </div>\n  "}}},function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}var o=r(10),a=n(o),i=r(11),c=n(i),s=r(12),d=n(s),l=r(3),u=n(l),p=r(4),m=n(p);e.exports={render:function(e){return"\n    "+e.products.map(function(t){return'\n    <div class="'+(e.minimal?"certona__productpod--minimal":"certona__productpod")+'"\n      '+(t.isSponsoredSchema?' onView-beacon="'+t.onViewBeacon+'" ':"")+">\n        "+a.render(t,e)+"\n        "+c.render(t,e)+"\n        "+d.render(t,e)+"\n        "+(e.isRVSchema?t.price?"<div class='certona__productpricingwrapper'>\n              "+u.render(t)+"\n              </div>":"":"<div class='certona__productpricingwrapper'>\n            "+(t.price?""+u.render(t):"")+"\n            </div>")+"\n        "+(e.showATCButton?""+m.render(t,e):"")+"\n      </div>\n    "}).join("")+"\n  "}}},function(e,t,r){"use strict";e.exports={render:function(e){return"\n    "+(e.originalPrice?'\n        <div class="price__special \n            '+(e.MAPFlag?"u--hide":"")+'\n        ">Was&nbsp;<span class="u__strike">$'+e.originalPrice+"</span></div>\n        ":"")+"\n  "}}},function(e,t,r){"use strict";e.exports={render:function(e,t,r){return"\n    "+(e.hidePriceFlag&&e.merchFlag?'\n      <div id=\'cartModalBtnContainer\'>\n        <div class="alert-inline alert-inline--success added-to-cart-label certona-atc__hide">\n            <span class="alert-inline__message">\n            <span class="alert-inline__title"></span>\n            '+r.addedToCartText+'</span>\n        </div>\n        <div class="certona-atc__hide item-not-added-to-cart alert-inline alert-inline--danger\'><span class=\'alert-inline__message">\n          <span class="alert-inline__title">Error!</span>'+r.itemNotAddedText+'</span>\n        </div>\n          <a class="bttn-outline bttn-outline--primary js-certona-atc"\n            href="javascript:window.open(\'/mycart/overlay#/add-to-cart/{{productId}}/1/ShipToHome/DirectShip/'+t.channel+'\')"\n            data-quantity="1" data-item-id="'+e.productId+'">\n          <span class="bttn__content">'+r.addToCartText+"</span>\n          </a>\n      </div>\n      ":"")+"\n\n    "+(e.applianceFlag?'\n      <div id=\'cartModalBtnContainer\'>\n        <div class="alert-inline alert-inline--success added-to-cart-label certona-atc__hide">\n            <span class="alert-inline__message">\n            <span class="alert-inline__title"></span>\n            '+r.addedToCartText+'</span>\n        </div>\n        <div class="certona-atc__hide item-not-added-to-cart alert-inline alert-inline--danger\'><span class=\'alert-inline__message">\n          <span class="alert-inline__title">Error!</span>'+r.itemNotAddedText+'</span>\n        </div>\n        <a class="js-certona-atc-appliance bttn-outline bttn-outline--primary" data-item-id="'+e.productId+'"\n          href="javascript:window.open(\'/mycart/overlay#/check-availability/{{productId}}/'+t.channel+"')\">\n          <span class='bttn__content'>"+r.addToCartText+"</span>\n        </a>\n      </div>\n      ":"")+"\n\n    "+(e.configurableFlag?'\n      <a target="_top" class="bttn-outline bttn-outline--primary" href="'+t.host+e.canonicalURL+"?MERCH=REC-_-"+t.schemaId+"-_-"+e.recomendingOMSID+"-_-"+e.productId+'-_-N">\n        <span class="bttn__content">'+r.customizeText+"</span>\n      </a>\n      ":"")+"\n  "}}},function(e,t,r){"use strict";e.exports={render:function(e,t){return'\n    <input type="hidden" id="catEntryId" value="'+e.productId+'}" />\n    <input type="hidden" id="productName" value="'+e.productName+'" />\n    <a id="addToMyList" class="bttn-outline bttn-outline--dark myListAddToList" name="AddToList" alt="Add To List">Add to My List</a>\n  '}}},function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}var o=r(30),a=n(o),i=r(31),c=n(i),s=r(32),d=n(s),l=r(3),u=n(l),p=r(4),m=n(p);e.exports={render:function(e){return"\n    "+e.products.map(function(t){return'\n      <div class="certona__pod">\n        <meta itemprop="productID" content="'+t.productId+'" />\n        '+a.render(t,e)+'\n        <div class="certona__atcproductdetails">\n          '+c.render(t,e)+"\n          "+d.render(t,e)+"\n          <div class='certona__productpricingwrapper'>\n            "+(t.price?""+u.render(t):"")+"\n          </div>\n          "+(t.isRVSchema?"":""+m.render(t,e))+"\n        </div>\n      </div>\n    "}).join("")+"\n  "}}},function(e,t,r){"use strict";e.exports={render:function(e,t){return'\n    <div class="certona__atcproductimagewrapper">\n      <a target="_top" href="'+t.host+e.canonicalURL+"?MERCH=REC-_-"+t.schemaId+"-_-"+e.recomendingOMSID+"-_-"+e.productId+'-_-N">\n        <img class="certona__atcproductimg" src="'+e.productimage+'" alt="'+e.productName+'" />\n      </a>\n      '+(e.configurableFlag?'<span class="product-imagelabel certona__customlabel large"> \x3c!-- change to global css --\x3eCUSTOM</span>':"")+"\n    </div>\n  "}}},function(e,t,r){"use strict";e.exports={render:function(e,t){return'\n    <div class="certona__productdescriptionwrapper">\n      <a class="" target="_top" href="'+t.host+e.canonicalURL+"?MERCH=REC-_-"+t.schemaId+"-_-"+e.recomendingOMSID+"-_-"+e.productId+'-_-N" data-product-id="'+e.productId+'">\n        '+e.description+"\n      </a>\n    </div>\n  "}}},function(e,t,r){"use strict";e.exports={render:function(e,t){return'\n    <div class="certona__productratingwrapper">\n      <a target="_top" class="reviews\n  \t'+(void 0===e.reviews?"not_rated":0===e.reviews?"not_rated":"")+'\n      " href="'+t.host+e.canonicalURL+"?MERCH=REC-_-"+t.schemaId+"-_-"+e.recomendingOMSID+"-_-"+e.productId+'-_-N">\n        <span class="stars" rel="'+e.rating+'" title=Rating '+e.rating+' out of 5" style="width:'+e.ratingPercentage+'%""></span>\n      </a>\n     '+(void 0===e.reviews?"":0===e.reviews?"":'<a target="_top" href="'+t.host+e.canonicalURL+"?MERCH=REC-_-"+t.schemaId+"-_-"+e.recomendingOMSID+'-_-{{productId}}-_-N#product-reviews">('+e.reviews+")</a>")+"\n    </div>\n  "}}},function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}var o=r(10),a=(n(o),r(11)),i=(n(a),r(12)),c=(n(i),r(3)),s=(n(c),r(4));n(s);e.exports={render:function(e){return"\n    "+e.contents.map(function(t){return'\n      <div class="certona__productpod">\n        <div class="certona__productimagewrapper">\n          <a href="'+e.host+t.canonicalURL+"?MERCH=REC-_-"+e.schemaId+"-_-"+t.recomendingOMSID+"-_-"+t.productId+'-_-N">\n            <img class="certona__productimg" src="'+t.contentId.imagePath+"\" />\n          </a>\n          <div class='product-title u__text-align--center'>"+t.name+"</div>\n        </div>\n      </div>\n    "}).join("")+"\n  "}}},function(e,t,r){"use strict";var n=r(2),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(n);e.exports={render:function(e){return'\n  <meta itemprop="name" content = '+e.schemaId+" >\n    <div class=\"grid isBound visually-similar\">\n      <div class='col__12-12'>\n        <div class='row-header'>\n          <div class='row-header__title'>\n            <h2 class=\"row-header__text "+(e.isMobile?"row-header__text--medium":"")+'">\n              More Like This\n            </h2>\n          </div>\n        </div>\n      <div '+(e.productImageURL?"class=visually-similar__wrapper":"")+">\n        "+(e.productImageURL?'<div class="col__4-12">\n              <div class="visually-similar__currentItem">\n                <div class="visually-similar__currentItem-imgWrapper">\n                  <img src="'+e.productImageURL+'"></img>\n                </div>\n                <div class="visually-similar__currentItem__label">Current Item</div>\n              </div>\n            </div>':"")+"\n      <div "+(e.productImageURL?"class=col__8-12":"")+'>\n        <div class="carousel__wrapper js-visually-similar">\n          '+e.products.map(function(t){return'\n            <div class="certona__productpod">\n              <div class="certona__productimagewrapper">\n                <a href="'+t.URL+(void 0!==e.curationId&&""!==e.curationId?"?curationId="+e.curationId:"")+'" data-itemid="'+t.productId+'">\n                  <img class="certona__productimg" src="'+t.imagePath+'" alt="'+t.name+'" data-index="'+t.productIndex+'" data-itemid="'+t.productId+'">\n                </a>\n              </div>\n              <div class="certona__productratingwrapper">\n                <a class="reviews" '+(void 0!==t.reviews?"":"not_rated")+'\n          \t\t\t  " href="'+t.canonicalURL+"?MERCH=REC-_-"+e.schemaId+"-_-"+t.recomendingOMSID+"-_-"+t.productId+"-_-N"+(void 0!==e.curationId&&""!==e.curationId?"&curationId="+e.curationId:"")+'">\n                  <span class="stars" rel="'+t.rating+'" title="Rating '+t.rating+' out of 5" style="width:'+t.ratingPercentage+'%""></span>\n                </a>\n                '+(void 0!==t.reviews?'<a href="'+t.canonicalURL+"?MERCH=REC-_-"+e.schemaId+"-_-"+t.recomendingOMSID+"-_-"+t.productId+"-_-N#product-reviews"+(void 0!==e.curationId&&""!==e.curationId?"&curationId="+e.curationId:"")+'">('+t.reviews+")</a>":"")+'\n              </div>\n              <div class="certona__productdescriptionwrapper">\n                <a class="" href="'+t.URL+(void 0!==e.curationId&&""!==e.curationId?"?curationId="+e.curationId:"")+'" data-itemid="'+t.productId+'">\n                  <span class="certona__brand" data-index="'+t.productIndex+'" data-itemid="'+t.productId+'">'+t.brand+'</span>\n                  <span data-index="'+t.productIndex+'" data-itemid="'+t.productId+'">'+t.name+'</span>\n                </a>\n              </div>\n              <div class="certona__productpricingwrapper">\n                <span class="u__normal u__text--alternate '+(t.mapAboveOriginalPrice?"":"u--hide")+'">\n                  Add to Cart to See Price\n                </span>\n                <div class="price '+(t.mapAboveOriginalPrice?"u--hide":"")+'">\n                '+(t.price.dollars?'<span class="price__format">$</span>'+t.price.dollars+'<span class="price__format">'+t.price.cents+"</span>":"")+"\n                </div>\n                "+(t.originalPrice?'<div class="price__special '+(t.mapAboveOriginalPrice?"u--hide":"")+'">\n                      Was&nbsp;<span class="u__strike">$'+t.originalPrice+"</span>\n                    </div>":"")+"\n              </div>\n              "+(e.isMobile?"":e.showATC?'<div class="certona__productbttnwrapper">\n                    '+(t.hidePriceFlag&&t.merchFlag?'<a class="js-visually-similar-atc bttn-outline bttn-outline--primary" href="javascript.open(\'/mycart/overlay#/add-to-cart/'+t.productId+"/1/ShipToHome/DirectShip/"+e.channel+'\')" data-quantity="1" data-item-id="'+t.productId+'">\n                          <span class="bttn__content">'+o.addToCartText+"</span>\n                        </a>":"")+"\n                  </div>":"")+"\n            </div>"}).join("")+"\n          </div>\x3c!-- carousel__wrapper --\x3e\n        </div>\n      </div>\x3c!-- col__12-12 --\x3e\n    </div>\x3c!-- visually-similar --\x3e\n  </div>"}}},function(e,t,r){"use strict";e.exports={render:function(e){return'\n  <meta itemprop="name" content = '+e.schemaId+" >\n  <div class='grid isBound'>\n  <div class='col__12-12'>\n    <div class='row-header'>\n        <div class='row-header__title'>\n          <h2 class=\"row-header__text\n          "+(e.isMobile?"row-header__text--medium":"")+"\n          \">Recommended Products For This Project\n            </h2>\n        </div>\n    </div>\n      <div class='carousel__wrapper'>\n\t\t"+e.products.map(function(t){return e.isMobile?'<div class="certona__productpod">\n\t\t   <div class="certona__productimagewrapper">\n\t\t      <a href="'+t.URL+'" data-itemid="'+t.productId+'">\n\t\t      \t<img class="certona__productimg" src="'+t.imagePath+'" alt="'+t.name+'" data-index="'+t.productIndex+'" data-itemid="'+t.productId+'">\n\t\t      </a>\n\t\t   </div>\n\t\t   <div class="certona__productdescriptionwrapper">\n\t\t      <a class="" href="'+t.URL+'" data-itemid="'+t.productId+'">\n\t\t\t      <span class="certona__brand" data-index="'+t.productIndex+'" data-itemid="'+t.productId+'">'+t.brand+'</span>\n\t\t\t      <span data-index="'+t.productIndex+'" data-itemid="'+t.productId+'">'+t.name+'</span>\n\t\t      </a>\n\t\t   </div>\n\t\t   <div class="certona__productratingwrapper">\n\t\t      <a class="reviews" href="'+t.ratingHref+'" data-index="'+t.productIndex+'" data-itemid="'+t.productId+'">\n\t\t      \t<span class="stars" rel="'+t.rating+'" title="Rating '+t.rating+' out of 5" style="width:'+t.ratingPercentage+'%" data-index="'+t.productIndex+'" data-itemid="'+t.productId+'"></span>\n\t\t      </a>\n\t\t      <a href="'+t.ratingHref+'" data-itemid="'+t.productId+'">('+t.reviewCount+')</a>\n\t\t   </div>\n\t\t   <div class="certona__productpricingwrapper">\n\t\t   '+(t.mapAboveOriginalPrice?'<span class="u__normal u__text--alternate ">'+t.pricingMessage+"</span>":'<div class="price">\n\t\t   <span class="price__format">$</span>'+t.price.dollars+'<span class="price__format">'+t.price.cents+"</span>"+(t.uom&&"each"!==t.uom?'<span class="price__unit">/'+t.uom+"</span>":"")+"\n\t\t      </div>\n\t\t      <div>"+(void 0!==t.originalPrice?'Was&nbsp;<span class="u__strike">'+t.originalPrice+"</span>"+(t.uom&&"each"!==t.uom?"/"+t.uom:""):"")+"</div>")+"\n\t\t   </div>\n\t\t</div>":'<div class="pod irgItem col-1-5 dynamic" data-component="product pod" data-itemid="'+t.productId+'" data-index="'+t.productIndex+'">\n   <div class="spad dynamic">\n      <div class="product-image" data-index="'+t.productIndex+'">\n\t      <a href="'+t.URL+'"  data-index="'+t.productIndex+'" data-itemid="'+t.productId+'">\n\t\t  <img src="'+t.imagePath+'" width="145" height="145" data-index="'+t.productIndex+'" data-itemid="'+t.productId+'"/> </a>\n\t  </div>\n      <div class="irgPricing">\n      '+(t.mapAboveOriginalPrice?'<div class="mapScenerioWrapper">\n\t\t\t<div class="mapMessage">'+t.pricingMessage+"</div>\n\t\t </div>":'<div class="pipOfferPrice">\n         \t<div>'+(void 0!==t.originalPrice?'Was&nbsp;<span class="u__strike">'+t.originalPrice+"</span>"+(t.uom&&"each"!==t.uom?"/"+t.uom:""):"")+'</div>\n            <div><span class="xlarge b">$'+t.price.dollars+"."+t.price.cents+"</span> "+(t.uom&&"each"!==t.uom?'/<span class="prodUom">'+t.uom+"</span>":"")+'</div>\n         </div>\n\t\t<div class="pipListPrice b">'+(void 0!==t.dollarOff?'<span class="savingsText">Save '+t.dollarOff+" ("+t.percentageOff+"%)</span>":"")+"</div>")+'\n      </div>\n      <a href="'+t.URL+'" class="pipDescription lineClamp--2lines" data-index="'+t.productIndex+'" data-itemid="'+t.productId+'">'+t.name+'</a>\n\t  <a href="'+t.ratingHref+'" target="_blank" class="reviews" data-index="'+t.productIndex+'" data-itemid="'+t.productId+'">\n\t\t<span class="stars" rel="'+t.rating+'" title="Rating '+t.rating+' out of 5" style="width:'+t.ratingPercentage+'%" data-index="'+t.productIndex+'" data-itemid="'+t.productId+'"></span>\n\t  </a>\n      <p class="productReviews b" #product-reviews"="" data-index="'+t.productIndex+'">('+t.reviewCount+')</p>\n      <div class="backOrder-wrapper"></div>\n\t  '+(t.multiATC?' <div class="addToCart-control-wrapper">\n\t\t\t<div class="checkbox-btn">\n\t\t\t\t<input class="checkbox-btn__input" type="checkbox" name="name'+t.productId+'" id="COLLECTIONS'+t.productId+'" tabindex="2"\n\t\t\t\tdata-itemid="'+t.productId+'" data-onlineitem="true" data-index="'+t.productIndex+'">\n\t\t\t\t<label class="checkbox-btn__label oneLine" for="COLLECTIONS'+t.productId+'">\n\t\t\t\t\t<p><span class="select_text">Select This Item</span></p>\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t</div>':'<div class="addToCart-control-wrapper"><div class="clear"></div>\n\t  \t<a class="irgAddToCart bttn-outline bttn-outline--primary" href="'+t.atcLink+'" data-index="'+t.productIndex+'" data-isAppliance="'+t.isAppliance+'" data-target-atc="atc" data-product-id="'+t.productId+'">\n\t  \t<span class="bttn__content">Add To Cart</span></a>\n\t  \t</div>')+"\n\t\t</div>\n\t\t</div>"}).join("")+"\n </div>\n </div></div>\n "+(e.isMobile?"":e.products[0].multiATC?' <div class="col__12-12 multiATC r b">\n\t\t<p><span class="selected-item-count">0</span> Item(s) Selected</p>\n\t\t<a class="multiATC_btn bttn-outline bttn-outline--primary disabled" data-target-atc="atc" data-multi-atc="true" href="#" data-itemids="">\n\t\t<span class="bttn__content">Add Items To Cart</span></a></div><div class="clearfloat"></div>':"")+"\n "}}},function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}var o=Object.assign||function(e){for(var t=1;arguments.length>t;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=r(0),i=function(e){return e&&e.__esModule?e:{default:e}}(a),c=r(15),s=n(c),d=r(5),l=n(d),u={},p=s.get(),m=l.getGlobalObject();p=p||window.digitalData,m.channel=l.getChannel(m),u.isTopSellersOnPage=function(e){return 0!==e.parents(".recommendations-content").length},u.isPIPPage=function(e){var t=null!==document.getElementById("pipContainer"),r=e&&"PIP"===e.page;return t||r||!1},u.isRVOnPage=function(e){return!!(0,i.default)('[id^="rv_"]').children().find(e).length},u.displayPosition=function(e){var t=e.parents(".carousel__item, .owl-item"),r=e.parents(".carousel__stage, .owl-stage"),n=void 0;return t.length&&r.length&&(n=r.children(".carousel__item, .owl-item").index(t)+1),n},u.certonaInOverlay=function(){return window.frameElement&&"IFRAME"===window.frameElement.nodeName},u.eventName=function(e,t){var r="recommendation cart addition";return t||(r=u.isRVOnPage(e)?"recently viewed pip load":"recommendation pip load"),r},u.sponsoredEventName=function(e,t){return t?"sponsored recommendation cart addition":"sponsored recommendation pip load"},u.getRecommendationType=function(e,t){var r="sp";return t||(r=u.isRVOnPage(e)?"rv":"rec"),r},u.getRecommendationVersion=function(e,t){return t?(0,i.default)("#"+l.pageType(e)).attr("pageid"):u.getRVThrottlePercentage(m.channel)},u.constructRecommendationDataObj=function(e,t,r){return{recommendationType:u.getRecommendationType(e,r),pageType:l.pageType(e),displayPosition:u.displayPosition(e),anchorProductSku:l.getSku(t,u.isPIPPage(t)),recommendationVersion:u.getRecommendationVersion(e,r)}},u.getRVThrottlePercentage=function(e){return"desktop"===e?"internal_throttle_"+m.desktopRVThrottle+"%":"internal_throttle_"+m.mobileRVThrottle+"%"},u.getSharedSection=function(e){var t="n/a";return!e&&u.certonaInOverlay()&&(t="atc"),t},u.constructStashDataObj=function(e,t){return{component:"product pod",item:[{index:u.displayPosition(e),productID:e.attr("data-item-id")}],pageType:u.certonaInOverlay()?"cart add overlay":p.page.pageInfo.pageType,section:t?"sponsored prod rec":"dyn prod rec",sharedSection:u.getSharedSection(t),target:"atc"}},e.exports={setStashAnalytics:function(e,t,r,n){var a={category:{primaryCategory:"stash"},eventInfo:{eventName:n?u.sponsoredEventName(e,t):u.eventName(e,t)},eventMode:"stash",stash:t?u.constructStashDataObj(e,n):{}};return a.stash.recommendation=u.constructRecommendationDataObj(e,r,n),n&&(a.stash.recommendation=o({},a.stash.recommendation,{strategy:"n/a",featureVersion:"n/a",interval:"n/a"})),l.log(r,a.stash),void 0!==p&&p.hasOwnProperty("event")&&p.event.push(a),u.certonaInOverlay()&&void 0!==window.parent.digitalData&&window.parent.digitalData.hasOwnProperty("event")&&window.parent.digitalData.event.push(a),a},setStashAnalyticsForSeeAll:function(e,t){var r={category:{primaryCategory:"stash"},eventInfo:{eventName:"category recommendation"},eventMode:"stash",stash:{recommendation:{categoryRecommendationType:"seo-pip",anchorProductSku:l.getSkuFromProducts(t,u.isPIPPage(t))}}};return l.log(t,r.stash),void 0!==p&&p.hasOwnProperty("event")&&p.event.push(r),u.certonaInOverlay()&&void 0!==window.parent.digitalData&&window.parent.digitalData.hasOwnProperty("event")&&window.parent.digitalData.event.push(r),r},setStashAnalyticsForVisuallySimilar:function(e,t){var r=(u.isPIPPage(t),{category:{primaryCategory:"stash"},eventInfo:{eventName:"recommendation cart addition"},eventMode:"stash",stash:{component:"product pod",item:[{index:u.displayPosition(e),productID:""+t.itemId}],pageType:window.digitalData.page.pageInfo.pageType,section:"dyn prod rec",sharedSection:"n/a",target:"atc",recommendation:{recommendationType:"vis sim",pageType:window.digitalData.page.pageInfo.pageType,displayPosition:u.displayPosition(e),anchorProductSku:t.anchorProductSku,strategy:"n/a",recommendationVersion:t.recommendationVersion,featureVersion:"n/a",interval:"n/a",ctype:"n/a",cseg:"n/a"}}});return l.log(t,r.stash),void 0!==p&&p.hasOwnProperty("event")&&p.event.push(r),r},privateMethods:u}},function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var r=0;t.length>r;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),c=function(e){return e&&e.__esModule?e:{default:e}}(i),s=r(14),d=n(s),l=r(5),u=n(l),p=r(6),m=n(p),h=u.getGlobalObject();h.channel=u.getChannel(h);var f=h.channel,v={blinds:"CONFIGURABLE_BLINDS",merchandise:"MERCHANDISE",appliance:"MAJOR_APPLIANCE"},g=function(e){return void 0!==e?e.filter(function(e,t){return!!(e.guid||e.id||e.imageGuid||e.catId)}):e},_=function(e){return e.canonicalURL||""},y=function(e){return-1!==e.schemaId.indexOf("myList-")||-1!==e.schemaId.indexOf("ShoppingList")||"wishlist"===e.schemaId.event};e.exports={Schema:function(){function e(t){var r=t.name,n=t.data,a=t.options,i=t.targetElm;o(this,e),this.currentSchemaData=null,this._schemaName=r,this._targetElm=i,this._schemaData=n,this._templateConfig={},this._isRVSchema=!1,this._isPCRSchema=!1,this._isCartSchema=!1,this.productionURL=u.getProductionURL(),this.minProducts=void 0!==a.minProducts?a.minProducts:0,this.defaults={imageWidth:300,showATC:!0,isCart:!1,isMobile:!1,callback:function(){return!0}},c.default.extend(this.defaults,a),this.pcrSchemaIds=["con1_home_rr","con1_homepro_rr"],this.templateConfig={default:{schema:"nofill",pod:"productspod",maxProducts:8},homepagehorizontal1_rr:{schema:"nofill",pod:"productspod",maxProducts:8},homepageeventhorizontal1_rr:{schema:"nofill",pod:"productspod",maxProducts:8},categorylevel1horizontal1_rr:{schema:"withfill",pod:"productspod",maxProducts:8},categorylevel2horizontal1_rr:{schema:"withfill",pod:"productspod",maxProducts:8},categorylevel3horizontal1_rr:{schema:"withfill",pod:"productspod",maxProducts:8},categorylevel4horizontal1_rr:{schema:"withfill",pod:"productspod",maxProducts:8},SearchPLPHorizontal1_rr:{schema:"withfill",pod:"productspod",maxProducts:8},NavPLPHorizontal1_rr:{schema:"withfill",pod:"productspod",maxProducts:8},mobileweb_navplp_rr:{schema:"nofill",pod:"productspod",maxProducts:8},mobileweb_search_rr:{schema:"nofill",pod:"productspod",maxProducts:8},nosearch2_rr:{schema:"nofill",pod:"productspod",maxProducts:8},SearchPLPHorizontal1:{schema:"withfill",pod:"productspod",maxProducts:8},nosearch3_rr:{schema:"nofill",pod:"productspod",maxProducts:8},PIPHorizontal1_rr:{schema:"nofill",pod:"productspod",maxProducts:16},PIPHorizontal2_rr:{schema:"nofill",pod:"productspod",maxProducts:16,minimal:!0},PIPHorizontal3_rr:{schema:"nofill",pod:"productspod",maxProducts:16,minimal:!0},pnf1_rr:{schema:"nofill",pod:"productspod",maxProducts:16,minimal:!0},product_rr:{schema:"withfill",pod:"productspod",maxProducts:8},subcat_rr:{schema:"withfill",pod:"productspod",maxProducts:8},con1_home_rr:{schema:"nofill",pod:"categoryrecspod",maxProducts:10},pers_category_recs:{schema:"nofill",pod:"internalCategoryrecspod",maxProducts:10},con1_homepro_rr:{schema:"nofill",pod:"categoryrecspod",maxProducts:10},atcmodal_rr:{schema:"atcnofill",pod:"atcproductpod",maxProducts:4},ma_atcmodal_rr:{schema:"atcnofill",pod:"atcproductpod",maxProducts:4},atc:{schema:"atcnofill",pod:"atcproductpod",maxProducts:4},ma_atc:{schema:"atcnofill",pod:"atcproductpod",maxProducts:4},cart_rr:{schema:"withfill",pod:"productspod",maxProducts:8},cartempty_rr:{schema:"withfill",pod:"productspod",maxProducts:8},thankyou1_rr:{schema:"nofill",pod:"productspod",maxProducts:8},instore_alt_rr:{schema:"withfill",pod:"productspod",maxProducts:8},"myAcct-productRecommendation":{schema:"withfill",pod:"productspod",maxProducts:8},"myList-productRecommendation":{schema:"withfill",pod:"productspod",maxProducts:8},eReceiptDetailsHorizontal1_rr:{schema:"withfill",pod:"productspod",maxProducts:8},eReceiptSummaryHorizontal1_rr:{schema:"withfill",pod:"productspod",maxProducts:8},MyAccountHorizontal1_rr:{schema:"withfill",pod:"productspod",maxProducts:8},OrderDetailsHorizontal1_rr:{schema:"withfill",pod:"productspod",maxProducts:8},OrderInfoHorizontal1_rr:{schema:"withfill",pod:"productspod",maxProducts:8},ShoppingListDetailsHorizontal1_rr:{schema:"withfill",pod:"productspod",maxProducts:8},TrackMyTruckHorizontal1_rr:{schema:"withfill",pod:"productspod",maxProducts:8},mobileweb_pip_rr:{schema:"nofill",pod:"productspod",maxProducts:8},rv_bica_pip_rr:{schema:"nofill",pod:"productspod",maxProducts:16},rv_gm_pip_rr:{schema:"nofill",pod:"productspod",maxProducts:16},rv_homepage_rr:{schema:"nofill",pod:"productspod",maxProducts:16},rv_categorypages_rr:{schema:"nofill",pod:"productspod",maxProducts:16},rv_search_plp_rr:{schema:"nofill",pod:"productspod",maxProducts:16},rv_mylist_rr:{schema:"nofill",pod:"productspod",maxProducts:16},rv_nav_plp_rr:{schema:"nofill",pod:"productspod",maxProducts:16},rv_maml_generic_rr:{schema:"nofill",pod:"productspod",maxProducts:16},rv_cart_rr:{schema:"nofill",pod:"productspod",maxProducts:16},rv_cartempty_rr:{schema:"nofill",pod:"productspod",maxProducts:16},rv_thankyou_rr:{schema:"nofill",pod:"productspod",maxProducts:16},rv_mobileweb_rr:{schema:"nofill",pod:"productspod",maxProducts:16},top_sellers_rv:{schema:"nofill",pod:"topsellerpod",maxProducts:16},topsellers:{schema:"topSellerInternal",pod:"topsellerpod",maxProducts:16},uts_visualrecs:{schema:"visuallySimilar",pod:"productspod",maxProducts:16},hp_sponsored:{schema:"nofill",pod:"productspod",maxProducts:16},pip_sponsored:{schema:"nofill",pod:"productspod",maxProducts:16},browse_sponsored:{schema:"nofill",pod:"productspod",maxProducts:16},search_sponsored:{schema:"nofill",pod:"productspod",maxProducts:16},cat_sponsored:{schema:"nofill",pod:"productspod",maxProducts:16},oc_sponsored:{schema:"nofill",pod:"productspod",maxProducts:16},storepage_sponsored:{schema:"nofill",pod:"productspod",maxProducts:16},thankyoupage_sponsored:{schema:"nofill",pod:"productspod",maxProducts:16}}}return a(e,[{key:"initialize",value:function(){this._templateConfig=this.templateConfig[this._schemaName]||this.templateConfig.default,c.default.extend(!0,this._templateConfig,this.getTemplateData()),this._templateConfig.schemaTemplate&&this._templateConfig.podTemplate&&this.renderSchema()}},{key:"getTemplateData",value:function(){var e={},t=this._templateConfig.schema,r=this._templateConfig.pod;return e.schemaTemplate=t&&d.templates[t],e.podTemplate=r&&d.templates[r],e.auroraCart=!0,e}},{key:"renderSchema",value:function(){var e=this.getSchemaData(),t=void 0,r=void 0,n=void 0!==this._targetElm?this._targetElm:"#"+this._schemaName;e&&e.products&&e.products.length>=this.minProducts&&(e.products.length>this._templateConfig.maxProducts&&(e.products=e.products.slice(0,this._templateConfig.maxProducts)),e.isRVSchema=this.isRVSchema(e.schemaId),e.auroraCart=this._templateConfig.auroraCart,e.channel=f,e.isMobile="mobileweb"===u.detectDevice(),e.productPartial=this._templateConfig.podTemplate,e.minimal=this._templateConfig.minimal,e.seeAllLink=this.defaults.seeAllLink,e.schemaId=this._schemaName,e.showATCButton=e.isMobile&&u.searchInGivenSchemas(this._schemaName,m.sponsoredSchemas)?!u.isMobileSchema(e.pageId):!(e.isRVSchema||e.minimal),t=this._templateConfig.schemaTemplate.render(e),r=document.querySelectorAll(n)[0],r&&(r.innerHTML=t),(0,c.default)(document).trigger({type:"templateBuilt:thd",schemaName:this._schemaName}))}},{key:"reduceSchema",value:function(e,t,r){var n=this._schemaName&&t.schemaId&&t.schemaId.toLowerCase()===this._schemaName.toLowerCase(),o=t.products||t.contents;return n&&o&&o.length?t:e}},{key:"getSchemaData",value:function(){var e=void 0;return u.searchInGivenSchemas(this._schemaName,m.sponsoredSchemas)||u.isPipAlternativerecs(this._schemaName,this.defaults.version)||u.searchInGivenSchemas(this._schemaName,m.FBR_Schemas)&&"model3"==this.defaults.productModel?this.currentSchemaData=this._schemaData:this.isInternalCategorySchema(this._schemaName)?(this.currentSchemaData=this._schemaData,this.currentSchemaData.schemaId="pers_category_recs",this.currentSchemaData.title="Categories That Might Interest You"):this.currentSchemaData=this.getCurrentSchema(),this.currentSchemaData&&(e=this.processSchemaData()),e}},{key:"getCurrentSchema",value:function(){return this._schemaData&&this._schemaData.schemas&&this._schemaData.schemas.reduce(this.reduceSchema.bind(this),null)}},{key:"isPCRSchema",value:function(e){return this.pcrSchemaIds.reduce(function(t,r,n){return e&&e.toLowerCase()===r.toLowerCase()||t},!1)}},{key:"isInternalCategorySchema",value:function(e){return e&&0===e.toLowerCase().indexOf("pers_category_recs")}},{key:"isRVSchema",value:function(e){return e&&0===e.toLowerCase().indexOf("rv_")}},{key:"isCartSchema",value:function(e){return e&&-1!==e.toLowerCase().indexOf("atcmodal")}},{key:"isFBRCategorySchema",value:function(e){return e}},{key:"processSchemaData",value:function(){this._isPCRSchema=this.isPCRSchema(this.currentSchemaData.schemaId),this._isRVSchema=this.isRVSchema(this.currentSchemaData.schemaId),this._isInternalRV=this.defaults.rvThrottle,this._isCartSchema=this.isCartSchema(this.currentSchemaData.schemaId),this._isFBRCategorySchema=this.isFBRCategorySchema(this.currentSchemaData.fbrItems);var e=void 0;e=g(this._isPCRSchema?this.currentSchemaData.contents:this._isFBRCategorySchema?this.currentSchemaData.fbrItems:this.isInternalCategorySchema(this.currentSchemaData.schemaId)?this.currentSchemaData.categoryRecommendations:this.currentSchemaData.products);var t={};return t.host=u.getHost(),u.searchInGivenSchemas(this._schemaName,m.sponsoredSchemas)&&(t.title=m.sponsoredProductsTitle),t.products=this._isPCRSchema?this.currentSchemaData.contents:this.getCustomizedProducts(e),c.default.extend(!0,{},this.currentSchemaData,t)}},{key:"getCustomizedProducts",value:function(e){return void 0!==e?e.map(this.mapProduct.bind(this)):e}},{key:"constructImagePath",value:function(e){return this.isInternalCategorySchema(this.currentSchemaData.schemaId)?e.catImage.replace("<SIZE>",this.defaults.imageWidth):e.imageURL.replace("<SIZE>",this.defaults.imageWidth)}},{key:"mapProduct",value:function(e,t){var r=e;return!r.productId&&r.id&&(r.productId=r.id),r.recomendingOMSID=this.defaults.products&&-1===this.defaults.products.indexOf(",")?this.defaults.products:"NA",r.brand=r.brand||"",u.searchInGivenSchemas(this._schemaName,m.FBR_Schemas)&&"model3"==this.defaults.productModel&&(r.brandName=r.brandName||"",r.productName=r.productLabel||"",r.rating=r.ratingsReviews.averageRating||"",r.reviews=r.ratingsReviews.totalReviews||"",r.price=r.itemPrice.specialPrice||"",r.uom=r.itemPrice.uom&&u.formatUOM(r.itemPrice.uom)||"",r.discountFlag=r.itemPrice.originalPrice>r.price,r.originalPrice=r.itemPrice.originalPrice),r.maxProducts=this._templateConfig.maxProduct,r.configurableFlag=r.itemType===v.blinds,r.merchFlag="MERCHANDISE"===r.itemType,r.applianceFlag="MAJOR_APPLIANCE"===r.itemType,r.podClass=r.configurableFlag&&"custom-blinds"||"",r.imageWidth=this.defaults.imageWidth,r.productimage=this.constructImagePath(r),r.canonicalURL=_(r),r.showATCFlag=!this._isCartSchema,r.cartModalFlag=this._isCartSchema,u.searchInGivenSchemas(this._schemaName,m.sponsoredSchemas)||u.searchInGivenSchemas(this._schemaName,m.FBR_Schemas)||u.isPipAlternativerecs(this._schemaName,this.defaults.version)||this.isInternalCategorySchema(this._schemaName)||(r.showATLFlag=y(this.currentSchemaData)),r.blindsNoATLFlag=r.blindsNoATCFlag=!r.configurableFlag,r.productNameShorten=r.productName||"",r.rating=r.rating&&parseFloat(r.rating).toFixed(1)||0,r.ratingPercentage=r.rating&&r.rating/5*100||0,r.description=r.brand+" "+(r.productName||""),r.price=u.constructPrice(r),r.dollarOff=r.dollarOff&&parseFloat(r.dollarOff).toFixed(2)||0,r.discountFlag=!r.configurableFlag&&(r.discountFlag||!!r.dollarOff),r.uom=r.uom&&u.formatUOM(r.uom)||"",r.hidePriceFlag=!r.hasOwnProperty("hidePrice"),r.isSponsoredSchema=u.searchInGivenSchemas(this._schemaName,m.sponsoredSchemas),r.onClickBeacon=r.onClickBeacon?r.onClickBeacon.replace("https:",""):"",r.onViewBeacon=r.onViewBeacon?r.onViewBeacon.replace("https:",""):"",r.isSponsoredSchema&&!r.productPage&&(r.productPage=""+(r.onClickBeacon+this.productionURL+r.canonicalURL)),r.onClickBeacon&&r.onClickBeacon.indexOf(!1)&&(r.onClickBeacon=r.onClickBeacon+m.PIQPixel),r.MAPFlag=r.hasOwnProperty("mapAboveOriginalPrice"),r.hideMAPPrice=r.mapAboveOriginalPrice||!1,r.MSTFlag=r.specialBuyPrice&&r.MSTFlag||!1,r.isRVSchema=this._isRVSchema,r.isMobile=this.defaults.isMobile||!1,r}}]),e}()}},function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.SchemeBuilder=void 0;var a=function(){function e(e,t){for(var r=0;t.length>r;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),c=function(e){return e&&e.__esModule?e:{default:e}}(i),s=r(1),d=n(s),l=r(7),u=r(9),p=n(u),m=r(8),h=n(m);t.SchemeBuilder=function(){function e(t){var r=t.storeId,n=t.anchor,a=t.key,i=t.model,c=t.endpoint,s=t.schemeName,l=t.certonaSchema,u=void 0===l?[]:l,p=t.minProducts;o(this,e),this.storeId=r||d.getStoreNum(),this.certonaSchema=u,this.anchor=n,this.endpoint=c,this.model=i,this.key=a,this.schemeName=s,this.minProducts=p||2}return a(e,[{key:"getProducts",value:function(e){l.logger.log("Querying for products"),this.get(e).then(this.buildSchemas.bind(this),this.handleFailure)}},{key:"buildSchemas",value:function(e){l.logger.log("Successfully retrieved products");var t=e.products,r=void 0===t?[]:t,n=e.metadata,o=void 0===n?{}:n,a={schemas:[{schemaId:o.apiName,title:o.title,version:o.version,products:r}]},i={};i=new l.schema.Schema({name:this.schemeName,data:a,options:this}),i.initialize(),(0,c.default)("#"+this.schemeName).attr({itemscope:" ",itemtype:"http://schema.org/Thing"}),p.init("#"+this.schemeName+" .carousel__wrapper",{onDragged:h.checkVisibility})}},{key:"handleFailure",value:function(e){l.logger.log(e)}},{key:"getURL",value:function(){return this.endpoint}},{key:"get",value:function(e){var t=c.default.Deferred();return c.default.ajax({url:this.getURL(),data:e,dataType:"json",contentType:"application/json",timeout:2e3,success:t.resolve,error:t.reject}),t.promise()}},{key:"buildScheme",value:function(){var e=this.storeId,t=this.anchor,r=this.model;this.getProducts({storeId:e,anchor:t,key:this.key||l.recommendationConfig.DEFAULT_ALT_API_KEY,model:r})}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.log=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"log",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";(""===r?window.location.href:r).indexOf("debug=true")>-1&&console[t](e)}},function(e,t){e.exports=o},function(e,t,r){"use strict";(function(t){e.exports=t.certonaResx=r(46)}).call(t,r(45))},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.privateMethods=t.isMobile=t.getSVOCID=t.getImagePath=t.decodeBase64=t.getPrivateMethods=t.filterInvalidParams=t.reMapSchemas=t.isSponsored=t.fixCommas=t.getCookieData=t.getUserIdFromUserSessionCookie=t.setCertonaHostProperty=t.getCertonaPodSelector=t.getHost=t.getLinks=void 0;var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=r(0),i=n(a),c=r(1),s=n(c),d=r(7),l={},u=d.helpers.getGlobalObject();u.channel=d.helpers.getChannel(u);l.arrayMove=function(e,t,r){var n=e[t];e.splice(t,1),e.splice(r,0,n)},l.arrayFilterDuplicates=function(e){return e.filter(function(e,t,r){return e&&r.indexOf(e)===t})},l.fixSchemaNames=function(e){var t=e;return t&&("string"!=typeof t&&(t=Array.isArray(t)?t.join():""),t=t.replace(/ /g,"")),t},l.fixMaxProducts=function(e,t){var r=e;return e&&"number"!=typeof e&&(r=isNaN(r)?t.maxProductValidation:+r),r},l.utf8_decode=function(e){var t="",r=0,n=void 0,o=void 0,a=void 0;for(n=o=a=0;e.length>r;)n=e.charCodeAt(r),128>n?(t+=String.fromCharCode(n),r++):n>191&&224>n?(o=e.charCodeAt(r+1),t+=String.fromCharCode((31&n)<<6|63&o),r+=2):(o=e.charCodeAt(r+1),a=e.charCodeAt(r+2),t+=String.fromCharCode((15&n)<<12|(63&o)<<6|63&a),r+=3);return t};var p=function(e){var t="",r=void 0;return e.schemas.forEach(function(e,n){(r=e.products||e.contents)&&r.length&&r.forEach(function(r,n){t+=(r.productId||r.contentId&&r.contentId.id)+"|"+e.schemaId+";"})}),t},m=function(){return d.recommendationConfig.certonaPodSelector},h=function(){return"//"+window.location.host},f=function(e){var t=[{hostName:"homedepotdev",resxEnv:"qa.res-x.com"},{hostName:"hd-qp",resxEnv:"thdqp.res-x.com"}];return t.forEach(function(t,r){e.indexOf(t.hostName)>-1&&(resx.host=t.resxEnv)}),resx.host},v=function(){return document.cookie.split(";").reduce(function(e,t,r){var n=t.trim();return 0===n.indexOf("WC_USERSESSION_")?n.substring(15,n.indexOf("=")):e},"")},g=function(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r="",n=void 0,o=void 0,a=void 0,i=void 0,c=void 0,s=void 0,d=void 0,u=0,p=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");p.length>u;)i=t.indexOf(p.charAt(u++)),c=t.indexOf(p.charAt(u++)),s=t.indexOf(p.charAt(u++)),d=t.indexOf(p.charAt(u++)),n=i<<2|c>>4,o=(15&c)<<4|s>>2,a=(3&s)<<6|d,r+=String.fromCharCode(n),64!==s&&(r+=String.fromCharCode(o)),64!==d&&(r+=String.fromCharCode(a));return r=l.utf8_decode(r)},_=function(){var e=s.default.readCookie("THD_USER"),t="";return e?function(e){var r=JSON.parse(g(e));return"object"===(void 0===r?"undefined":o(r))&&void 0!==r.svocCustomerAccountId&&(t=r.svocCustomerAccountId),t}(e):""},y=function(e){var t=d.helpers.pageType(e);return d.recommendationConfig.sponsoredSchemas.indexOf(t)>-1},I=function(e){var t=i.default.extend(!0,{},e);return d.helpers.initCookieManager(),t.sessionId=s.default.readCookie("RES_SESSIONID"),t.trackingId=s.default.readCookie("RES_TRACKINGID"),t.customerId=_(),""===t.storeId&&(t.storeId=s.default.getStoreNum()),"0"===t.storeId&&(t.storeId="8119"),t},w=function(e,t){var r=i.default.extend(!0,{},e);r.exItems=r.exItems.replace(/;/g,","),r.products=r.products.replace(/;/g,",");var n=r.certonaSchema,o=r.maxProducts||t.maxProducts;return r.certonaSchema=l.fixSchemaNames(n),r.maxProducts=l.fixMaxProducts(o,t),r},x=function(e){var t=i.default.extend(!0,{},e),r=l.arrayFilterDuplicates(t.certonaSchema.split(",")),n=r.reduce(function(e,t,r){return r&&-1!==t.indexOf("rv_")&&e.push(r),e},[]);return n.length&&n.forEach(function(e,t){l.arrayMove(r,e,0)}),t.certonaSchema=r.join(),t},b=function(e,t){var r=i.default.extend(!0,{},e);return Object.keys(r).reduce(function(e,n,o){var a=e;return r[n]&&-1!==Object.keys(t).indexOf(n)&&(a[n]=r[n]),a},{})},P=function(){return"mobile"===(window.THD_GLOBAL&&window.THD_GLOBAL.channel).trim().toLowerCase()},S=function(){return l},C=function(){return window.THD_GLOBAL&&window.THD_GLOBAL.imagePath};t.getLinks=p,t.getHost=h,t.getCertonaPodSelector=m,t.setCertonaHostProperty=f,t.getUserIdFromUserSessionCookie=v,t.getCookieData=I,t.fixCommas=w,t.isSponsored=y,t.reMapSchemas=x,t.filterInvalidParams=b,t.getPrivateMethods=S,t.decodeBase64=g,t.getImagePath=C,t.getSVOCID=_,t.isMobile=P,t.privateMethods=l},function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}var o=r(0),a=function(e){return e&&e.__esModule?e:{default:e}}(o),i=r(1),c=n(i),s=r(9),d=n(s),l=r(7),u=r(8),p=n(u),m=l.helpers.detectDevice(),h={},f={Desktop:"aGAQFG4j6QtVTSWqujfFYWeIU6BR5Mee",tablet:"aGAQFG4j6QtVTSWqujfFYWeIU6BR5Mee",mobileweb:"8Qg7Ztll8bnnEtlORRt7ReviHGrrnvo4",THDMobile_Consumer_iPhone:"iuNLedJoaSdzVVRmJkrR59OA8QZHIDL6",THDMobile_Consumer_Android:"wUuBD2fXGqWmKI1Y4bXJdcGfVNHnVCbU"},v={maxProducts:16,"keyw ord":"",products:"",exItems:"",certonaSchema:"",appId:m,customerId:"",sessionId:"",trackingId:"",storeId:"",levels:"",minProducts:0},g={};g.host=l.helpers.getHost(),g.service="thdrecommends/v1";var _=l.helpers.getGlobalObject();_.channel=l.helpers.getChannel(_);var y=function(){return g.host+"/"+g.service},I=function(e){var t=a.default.Deferred();return a.default.ajax({url:y(),data:e,dataType:"jsonp",jsonpCallback:"callback",contentType:"application/json",timeout:2e3,success:t.resolve,error:t.reject}),t.promise()},w=function(e,t){return{imagePath:void 0!==e.imageURL?e.imageURL.replace("<SIZE>",300):"",URL:t?e.canonicalURL:e.categoryURL,name:t?e.productName:e.categoryName,productId:e.productId,rating:e.rating,reviews:e.reviews,canonicalURL:e.canonicalURL,ratingPercentage:e.rating&&e.rating/5*100||0,recomendingOMSID:"NA",showRatings:t}},x=function(){return 0!==(0,a.default)("#topsellers_rp_plp").length||0!==(0,a.default)("#topsellers_rp_pip").length},b=function(e){l.logger.log("Failed to retrieve recommended top selling products",e)},P=function(){var e=[];return x()&&e.push("topsellers"),e=e.join(",")},S=function(e){var t=e.indexOf("rv_")>-1,r=e;return t||(r=0===(0,a.default)("#topsellers_rp_plp").length?"#topsellers_rp_pip":"#topsellers_rp_plp"),r},C=function(e){var t=P().split(","),r=0===(0,a.default)("#topsellers_rp_plp").length,n=e,o=void 0;l.logger.log("Successfully retrieved top selling products"),t.forEach(function(e,t){var i={};if(n.schemas[t].products){n.schemas[t].products=n.schemas[t].products.map(function(e){return w(e,r)}),o=S(e),i=new l.schema.Schema({name:e,data:n,options:h,targetElm:o}),i.initialize(),(0,a.default)(o).attr({itemscope:" ",itemtype:"http://schema.org/Thing"});d.init(o+" .carousel__wrapper",{onDragged:p.checkVisibility})}})},R=function(e){l.logger.log("Querying for top selling products"),I(e).then(C,b)},T={};e.exports={refresh:function(e,t){l.helpers.initCookieManager(),T={schema:"",key:"tRXWvUBGuAwEzFHScjLw9ktZ0Bw7a335",appId:m,version:"model1",storeId:c.getStoreNum(),maxProducts:12},h=a.default.extend(!0,{},v,t),T.schema=P(),T.storeId=e&&e.storeId||c.getStoreNum(),T.appId=e&&e.appId||l.helpers.detectDevice(),T.key=f[T.appId]||f.Desktop,T.schema.length>0&&T.storeId&&R(T)}}},function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.refresh=void 0;var o=r(0),a=function(e){return e&&e.__esModule?e:{default:e}}(o),i=r(1),c=n(i),s=r(9),d=n(s),l=r(7),u=n(l),p=r(8),m=n(p),h=void 0,f=["appid","schema","storeid","accountid","orderid","browserid","keyword","category","organicskus","viewedsku","event","eventskus","price","quantity","pagenum","key","callback","version"],v=u.recommendationConfig.nonModel2Categories,g={};g.host=u.helpers.getHost(),g.service="sponsored/v1";var _=u.helpers.getGlobalObject();_.channel=u.helpers.getChannel(_);var y=function(){return h},I=function(){return"#"+h},w=function(){return g.host+"/"+g.service},x=function(e){return"oc_sponsored"===e.schema},b=function(e){e.version="model2";var t=a.default.Deferred();return a.default.ajax({url:w(),dataType:"jsonp",data:e,contentType:"application/json;charset=UTF-8",timeout:5e3,success:t.resolve,error:t.reject}),t.promise()},P=function(e){x(e)&&b(Object.assign({},e)).then(null,S);var t=a.default.Deferred();return a.default.ajax({url:w(),dataType:"jsonp",data:e,contentType:"application/json;charset=UTF-8",timeout:5e3,success:t.resolve,error:t.reject}),t.promise()},S=function(e){u.logger.log("Failed to retrieve recommended sponsored products",e)},C=function(e){var t=y().split(","),r=void 0;u.logger.log("Successfully retrieved criteo products"),t.forEach(function(t,n){var o={};r=I(),o=new u.schema.Schema({name:t,data:e,options:{},targetElm:r}),o.initialize()})},R=function(e){if(e&&e.onLoadBeacon){(0,a.default)('<img style="display:none;" src="https:'+e.onLoadBeacon+'">').appendTo("body")}},T=function(e){if(e&&(R(e),(0,a.default)(I()).attr({pageid:e.pageId,class:"sponsored_schema",itemscope:" ",itemtype:"http://schema.org/Thing"}),e.products&&e.products.length)){C(e);d.init(".sponsored_schema .carousel__wrapper",{onDragged:m.checkVisibility})}},k=function(e){var t=!1;return e.schema&&u.helpers.searchInGivenSchemas(e.schema,u.recommendationConfig.sponsoredSchemas)&&e.key&&e.appid&&e.browserid&&(t=!0),t},O=function(e){var t=!1;return e.promoteCategories&&"cat_sponsored"!==e.schema&&(t=!0,e.promoteCategories=e.promoteCategories.toLowerCase(),e.promoteCategories.split(",").forEach(function(e){"string"==typeof e&&e&&(e=e.replace("&amp;","&"),v[e]&&(t=!1))})),t},D=function(e){var t=e.schema,r=void 0===t?"":t,n=e.certonaSchema,o=void 0===n?[]:n;if(""===r&&o.length>0){var a=!0,i=!1,c=void 0;try{for(var s,d=o[Symbol.iterator]();!(a=(s=d.next()).done);a=!0){var l=s.value;u.helpers.searchInGivenSchemas(l,u.recommendationConfig.sponsoredSchemas)&&(r=l)}}catch(e){i=!0,c=e}finally{try{!a&&d.return&&d.return()}finally{if(i)throw c}}}return r},M={};t.refresh=function(e,t){u.helpers.initCookieManager(),M=a.default.extend({},e),M.schema=D(M),M.hasOwnProperty("criteo")&&(M=a.default.extend(M,M.criteo)),M.version&&(M.criteo&&M.criteo.version?M.version=M.criteo.version:delete M.version),h=M.schema,u.recommendationConfig.PLP_Schemas.indexOf(h)>-1&&(M.category=e.itemid),u.recommendationConfig.pipSponsoredSchema===h&&(M.viewedsku=M.products);var r=u.helpers.detectDevice();M.appid=r?r.toLowerCase():"consumerApp","string"==typeof M.keyword&&M.keyword.indexOf("&#39;")>-1&&(M.keyword=M.keyword.split("&#39;").join("'")),M.browserid=M.browserid||u.helpers.getmcvisId(),M.key=M.key||"aGAQFG4j6QtVTSWqujfFYWeIU6BR5Mee",M.storeid=M.storeId||c.getStoreNum(),"true"===M.isKitchenAndBathEnabled&&(v.kitchen=!1,v.bath=!1),O(M)&&(M.version="model2"),"0"!==M.storeid&&M.storeid||(M.storeid="121"),M=Object.keys(M).filter(function(e){return f.indexOf(e)>-1}).reduce(function(e,t){return e[t]=M[t],e},{}),!k(M)||"desktop"!==M.appid&&"mobileweb"!==M.appid||(u.logger.log("Querying for sponsored products from sponsored products api"),P(M).then(T,S))}},function(e,t){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t){var r=function(){"use strict";function e(e){try{return parseInt(e,10)}catch(e){}}function t(e){try{if(void 0!==e&&null!==e&&"null"!==e&&""!==e)return!0}catch(e){}return!1}function n(){try{return resx.rrelem}catch(e){}return""}function o(e){try{var r,n,o=null;if(t(e))if(o=[],t(document.getElementById(e)))o[0]=e;else for(n=e.replace(/[,;]/g,".").split("."),r=0;n.length>r;r+=1)o[r]=""!==n[r]&&t(document.getElementById(n[r]))?n[r]:"";return o}catch(e){}return null}function a(){try{var e,r,a;if(void 0!==resx.rrelem&&void 0!==(a=o(n()))&&null!==a)for(e=0;a.length>e;e+=1)r=""!==a[e]?document.getElementById(a[e]):null,t(r)&&(r.style.visibility="visible")}catch(e){}}function i(e,t){try{j||(j=!0,A=e+"|"+(void 0!==t.number?t.number:"undefined")+"|"+(void 0!==t.name?t.name:"undefined")+"|"+(void 0!==t.description?t.description:"undefined"))}catch(e){}finally{a()}}function c(e){try{var t,r,n;if(document.cookie.length>0&&(t=document.cookie,-1!==(r=t.indexOf(e+"="))))return r+=e.length+1,n=t.indexOf(";",r),-1===n&&(n=t.length),decodeURIComponent(t.slice(r,n))}catch(e){i("",e)}return null}function s(e,r,n,o){try{var a=new Date;null!==n&&a.setTime(a.getTime()+3600*n*1e3),document.cookie=e+"="+encodeURIComponent(r)+(null!==n?"; expires="+a.toGMTString():"")+"; path=/"+(t(o)?"; domain="+o:"")}catch(e){i("",e)}}function d(){try{var r,a,i,c,s;if(a=void 0!==resx.rrec&&(!0===resx.rrec||"true"===resx.rrec)&&"1"===k&&void 0!==resx.rrelem&&null!==resx.rrelem&&!j){if(!S&&(a=!1,void 0!==(s=o(n()))&&null!==s))for(r=0;s.length>r;r+=1)if(t(s[r])){a=!0;break}if(a&&!t(resx.useitems)&&(a=!1,void 0!==resx.rrnum))for(i=resx.rrnum,i+="",i=i.replace(/,/g,";"),c=i.split(";"),r=0;c.length>r;r+=1)if(!isNaN(c[r])&&e(c[r])>0){a=!0;break}}return a}catch(e){}return!1}function l(e){try{var t,r="";for(e+="",t=e.length-1;t>=0;t-=1)r+=e.charAt(t);return r}catch(e){}return""}function u(){try{var e,t,r,n,o;return-1===navigator.userAgent.toLowerCase().indexOf("mac")?(o=Math.floor(1e15*Math.random()),o+=""):(r=Math.floor(1e6*Math.random()),e=new Date,t=e.getTime(),t+="",n=l(t),r+="",o=r+n.slice(0,11)),o}catch(e){i("guid",e)}return""}function p(e){try{P=!0;var r,n,o,i;if(!S){for(r=0;e.Resonance.Response.length>r;r+=1)n=!1,o=e.Resonance.Response[r].scheme,"yes"===e.Resonance.Response[r].display&&(n=!0,i=document.getElementById(o),t(i)&&(i.innerHTML=e.Resonance.Response[r].output)),"function"==typeof resonanceResponseLoaded&&resonanceResponseLoaded(o,n);"function"==typeof resonanceResponseLoadedAll&&resonanceResponseLoadedAll()}}catch(e){}finally{a()}}function m(){try{P||S||(2e3>b?(b+=10,window.setTimeout(r.checkCallback,10)):(S=!0,a()))}catch(e){a()}}function h(e){try{var r="",n="";return"boolean"==typeof e&&!0===e?r=t(resx.rrcall)?resx.rrcall:M:"string"==typeof e&&(r=e),r.length>0&&(n=r===M?"&cb=":"&ccb=",n+=r),(t(resx.useitems)?"&ui="+resx.useitems:"&no="+resx.rrnum)+(t(resx.exitemid)?"&ex="+resx.exitemid:"")+(t(resx.rrqs)?"&"+resx.rrqs:"")+n}catch(e){}return""}function f(){try{var e,r,n=window.location.hostname;if(t(n))return n.match(/(\d{1,3}\.){3}\d{1,3}/)||(e=n.split("."),e.length>1&&(n="."+e[e.length-2]+"."+e[e.length-1],r=/\.co\.\w{2}$|\.com\.\w{2}$|\.\w{2}\.com$/,n.toLowerCase().match(r)&&e.length>2&&(n="."+e[e.length-3]+n))),n}catch(e){i("gsd",e)}return null}function v(e){try{return decodeURI(window.location.search.replace(RegExp("^(?:.*[&\\?]"+encodeURI(e).replace(/[\.\+\*]/g,"\\$&")+"(?:\\=([^&]*))?)?.*$","i"),"$1"))}catch(e){}return null}function g(){try{var e,t,r="";for(e=0;51>e;e+=1)void 0!==resx["cv"+e]&&(t=resx["cv"+e],t+="",t=t.replace(/\+/g,"%2B"),r+="&cv"+e+"="+encodeURIComponent(t));return r}catch(e){i("gcv",e)}return""}function _(r){try{var n,o,l,p,m,h,g,_,y,I,w,x,L={callback:!1};if(void 0===r)r=L;else for(p=0;L.length>p;p+=1)void 0===r[p]&&(r[p]=L[p]);if(j=!1,A="",D="",O="",k="",R="",T="",C=!1,P=!1,S=!1,b=0,n=f(),g="RES_TRACKINGID",h="RES_SESSIONID",m="ResonanceSegment",D=v("resxtrack"),t(D)?(resx.sessionid="",resx.segment="",s(h,"",-1,n)):t(resx.trackingid)?D=resx.trackingid+"":(D=c(g),t(D)||(D=u())),O=t(resx.sessionid)?resx.sessionid+"":"",t(O)||(O=c(h),t(O)||(O=u())),k=t(resx.segment)?resx.segment+"":"",t(k)||(x=e(D),!isNaN(x)&&x>0&&(x+="",x=x.slice(1,6),x=e(x),_=e(resx.top1),y=e(resx.top2),I=e(resx.top3),w=1e5,isNaN(_)&&isNaN(y)&&isNaN(I)||(isNaN(_)&&(_=0),isNaN(y)&&(y=_),isNaN(I)&&(I=y),_>x?k="1":y>x?k="2":I>x?k="3":w>x&&(k="4")))),t(k)||(k=c(m)),isNaN(e(k))&&(k="1"),s(g,D,17520,n),t(c(g))||s(g,D,null,n),s(h,O,.5,n),t(c(h))||s(h,O,null,n),s(m,k,1440,n),t(c(m))||s(m,k,null,n),R=t(resx.pageid)?resx.pageid:u(),o=void 0!==resx.links?resx.links+"":"",t(o))for(l=o.replace(/\,/g,";").replace(/\|/g,"%7C").split(";",50),p=0;l.length>p;p+=1)T+=l[p]+";";("string"==typeof r.callback&&r.callback!==M||!1===r.callback||t(resx.rrcall)&&resx.rrcall!==M)&&(S=!0),C=d()&&t(D)&&t(R),C||a()}catch(e){i("pv",e)}}function y(e){try{var o,a,i,c,s,d,l;if("1"===k||"2"===k||"3"===k){if(C&&window.setTimeout(r.checkCallback,50),a="https:"===window.location.protocol.toLowerCase()?"https://":"http://",s="www.res-x.com",t(resx.host)&&(s=resx.host),i="appid="+(void 0!==resx.appid?resx.appid:"")+"&tk="+(t(D)?D:"")+"&ss="+(t(O)?O:"")+"&sg="+(t(k)?k:"")+"&pg="+(t(R)?R:"")+"&vr=5.7x&bx="+C,l="",void 0!==resx.rrelem&&null!==resx.rrelem&&null!==(d=n().replace(/[,;]/g,".").split(".")))for(o=0;d.length>o;o+=1)l+="&sc="+d[o];return i+=l+(void 0!==resx.event?"&ev="+resx.event:"")+(void 0!==resx.itemid?"&ei="+resx.itemid:"")+(void 0!==resx.qty?"&qty="+resx.qty:"")+(void 0!==resx.price?"&pr="+resx.price:"")+(void 0!==resx.shipping?"&sh="+resx.shipping:"")+(void 0!==resx.total?"&tt="+resx.total:"")+(void 0!==resx.currencycode?"&cc="+resx.currencycode:"")+(void 0!==resx.customerid?"&cu="+resx.customerid:"")+(void 0!==resx.transactionid?"&tr="+resx.transactionid:""),i+=(C?h(e):"")+g()+"&ur="+encodeURIComponent(window.location.href.slice(0,400))+"&plk="+(t(T)?T:"")+"&rf="+encodeURIComponent(document.referrer)+(!0===j?"&er="+j+"&em="+encodeURIComponent(A):""),c=a+s+"/ws/r2/Resonance.aspx?"+i,c.slice(0,2013)}}catch(e){}return""}function I(e){try{if(""!==e){var t=document.createElement("script"),r=document.getElementsByTagName("script")[0];t.type="text/javascript",t.async=!0,t.src=e,r.parentNode.insertBefore(t,r)}}catch(e){}}function w(e){var t,r={callback:!1};if(void 0===e)e=r;else for(t=0;r.length>t;t+=1)void 0===e[t]&&(e[t]=r[t]);return y(e.callback)}function x(){_({callback:!0}),I(y(!0))}var b,P,S,C,R,T,k,O,D,M="certonaResx.showResponse",A="",j=!1;return{checkCallback:function(){m()},showResponse:function(e){p(e)},getURL:function(e){return _(e),w(e)},run:function(){x()}}}();e.exports=r},function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function o(e){return e&&e.__esModule?e:{default:e}}var a=r(0),i=o(a),c=r(41),s=(o(c),r(48)),d=n(s),l=r(9),u=n(l),p=r(40),m=n(p),h=r(7),f=r(42),v=n(f),g=r(8),_=n(g),y={},I=void 0,w="aGAQFG4j6QtVTSWqujfFYWeIU6BR5Mee",x={},b={},P={},S={},C=void 0,R=void 0,T=v.getHost(),k=i.default.Deferred(),O=void 0,D=void 0,M=v.getCertonaPodSelector(),A=["atcmodal_rr","mw_atcmodal_rr"],j=void 0,L=[],N=h.helpers.getGlobalObject();N.channel=h.helpers.getChannel(N),I="desktop"===N.channel||"web"===N.channel?null===navigator.userAgent.match(/iPad/g)?"homedepot01":"homedepot11":"homedepot09",x={maxProducts:16,keyword:"",products:"",exItems:"",certonaSchema:"",appId:I,customerId:"",sessionId:"",trackingId:"",storeId:"",levels:"",version:"",productModel:""},P.getRequestParams=function(e){return b=i.default.extend(e,v.getCookieData(e)),b=i.default.extend(e,v.fixCommas(e,x)),b.certonaSchema&&(b=i.default.extend(e,v.reMapSchemas(e))),v.filterInvalidParams(e,x)},P.updateResx=function(e){resx.pageid=e.pageId,resx.trackingid=e.trackingId,resx.links=v.getLinks(e),resx.appid=I,b.customerId&&(resx.customerid=b.customerId),certonaResx&&certonaResx.run()},P.buildSchemas=function(e){var t=b.certonaSchema.split(","),r=[],n=void 0;return t.forEach(function(t,o){P.isInternalSchema(t)&&b.itemid?n=t.replace(t,"atc"):h.helpers.searchInGivenSchemas(t,h.recommendationConfig.FBR_Schemas)&&b.productModel?(e.title="Customers Also Considered",n=t):n=t;var a="#"+t,c=new h.schema.Schema({name:n,data:e,options:b,targetElm:a});c.initialize(),r.push(c),(0,i.default)(a).attr({itemscope:" ",itemtype:"http://schema.org/Thing"}),u.init(a+" .carousel__wrapper",{onDragged:_.checkVisibility})}),r},P.buildInternalCategorySchema=function(e){var t=b.thdSchema,r=[],n=void 0;return t.forEach(function(t,o){n=t;var a="#"+t,c=new h.schema.Schema({name:n,data:e,options:b,targetElm:a});c.initialize(),r.push(c),(0,i.default)(a).attr({itemscope:" ",itemtype:"http://schema.org/Thing"}),u.init(a+" .carousel__wrapper",{})}),r},P.atcExternalRequestUrl=function(){return d.set({setParms:{type:"json",key:w},url:T+"/recommendations/v1"})},P.atcInternalRequestUrlGM=function(){var e=b.itemid;return C=d.set({setParms:{version:"model1",key:w,appid:h.helpers.detectDevice(),storeid:b.storeId,showprice:!0,fulfillment:b.fulfillment,maxproducts:4,exitems:b.exItems},url:T+"/thdrecommends/v1/"+e+"/atc"})},P.internalCategoryRecs=function(e,t){return j=d.set({setParms:{appid:h.helpers.detectDevice(),mcvisid:h.helpers.getmcvisId(),version:b.version,maxproducts:16,key:w},url:T+"/thdrecommends/v1/category"}),i.default.ajax({url:j,type:"GET",dataType:"json",contentType:"application/json",timeout:1e4,success:function(t){k.resolve(t),e&&e(t)},error:function(e){k.reject(e),t&&t(e)}})},P.atcInternalRequestUrlMA=function(){return R=d.set({setParms:{version:"model1",key:w,appid:N.channel,storeid:b.storeId,showprice:!0,maxproducts:4,exitems:b.exItems},url:T+"/thdrecommends/v1/"+b.itemid+"/atc"})},P.pipInternalAlternativeUrl=function(e,t){return D=d.set({setParms:{appid:h.helpers.detectDevice(),storeid:b.storeId,version:b.version,maxproducts:16,key:w,itemid:b.itemid},url:T+"/thdrecommends/v1/product"}),i.default.ajax({url:D,type:"GET",dataType:"json",contentType:"application/json",timeout:1e4,success:function(t){k.resolve(t),e&&e(t)},error:function(e){k.reject(e),t&&t(e)}})},P.atcInternalRequestUrl=function(e){return"GM"===e?P.atcInternalRequestUrlGM():P.atcInternalRequestUrlMA()},P.getInternalCertona=function(e,t){return i.default.ajax({url:P.atcInternalRequestUrl(b.itemType),type:"GET",dataType:"jsonp",contentType:"application/json",timeout:1e4,success:function(t){k.resolve(t),e&&e(t)},error:function(e){k.reject(e),t&&t(e)}})},P.getExternalCertona=function(e,t){O=P.getRequestParams(b),O.products&&(O.products=P.filterMoreThan24(b.products)),O.exItems&&(O.exItems=P.filterMoreThan24(b.exItems)),O.version&&delete O.version;var r=JSON.stringify(O);return i.default.ajax({url:P.atcExternalRequestUrl(),type:"POST",contentType:"application/json",timeout:1e4,data:r,success:function(t){k.resolve(t),e&&e(t)},error:function(e){k.reject(e),t&&t(e)}})},P.isInternalSchema=function(e){return A.indexOf(e)>-1},P.getSchemaData=function(e,t){O=P.getRequestParams(b);var r=N.isPLP?"model4":"model3";if(O.certonaSchema){if(v.setCertonaHostProperty(T),h.helpers.isPipAlternativerecs(O.certonaSchema,O.version))return P.pipInternalAlternativeUrl();if(P.isInternalSchema(O.certonaSchema)&&b.itemid)return P.getInternalCertona();if(O.productModel===r&&h.helpers.searchInGivenSchemas(O.certonaSchema,h.recommendationConfig.FBR_Schemas))return P.internalFBRrecs(e,t);if(!P.isInternalSchema(O.certonaSchema))return P.getExternalCertona()}return k.reject("Invalid Schema!!"),t&&t("Invalid Schema!!"),k.promise()},P.certonaDataSuccess=function(e){P.buildSchemas(e),e&&e.schemas&&!P.isInternalSchema(b.certonaSchema)&&P.updateResx(e)},P.certonaDataFailure=function(e){h.logger.log("Certona failed to load with Response: ",e)},P.showLoadingButton=function(e){e.children().addClass("certona-atc-button__active").html('<span class="segment-spinner segment-spinner--bttn"></span>')},P.resetLoadingButton=function(){(0,i.default)(".js-certona-atc").children().removeClass("certona-atc-button__active").html("Add To Cart")},P.showAddToCart=function(e){var t=e.parents("#cartModalBtnContainer");t.children(".added-to-cart-label").addClass("certona-atc__hide"),t.children(".item-not-added-to-cart").addClass("certona-atc__hide"),P.resetLoadingButton(),t.children(".js-certona-atc").removeClass("certona-atc__hide")},P.showAddedToCart=function(e){var t=e.parents("#cartModalBtnContainer");t.children(".js-certona-atc").addClass("certona-atc__hide"),t.children(".added-to-cart-label").removeClass("certona-atc__hide"),(0,i.default)(".certona-atc__error").addClass("certona-atc__hide"),setTimeout(function(){P.showAddToCart(e)},5e3)},P.showItemNotAdded=function(e,t){var r=e.parents("#cartModalBtnContainer");r.children(".item-not-added-to-cart").removeClass("certona-atc__hide"),r.children(".js-certona-atc").addClass("certona-atc__hide");var n=void 0;n=t&&t.CartModel&&t.CartModel.errorModel?t.CartModel.errorModel[0].description:"An error occured adding the item to your cart.";var o='<div class="alert-inline alert-inline--danger"><span class="alert-inline__message"><span class="alert-inline__title">Error! </span> '+n+"</span></div>";window.top!==window.self&&(0,i.default)(".certona-atc__error").html(o).removeClass("certona-atc__hide"),setTimeout(function(){P.showAddToCart(e)},5e3)};var E=function(e,t,r){"success"===t&&P.showAddedToCart(e),"error"===t&&P.showItemNotAdded(e,r),"loading"===t&&P.showLoadingButton(e),"reset"===t&&P.resetLoadingButton()};P.filterMoreThan24=function(e){if(e){var t=e.split(",");t.length>24&&(t=t.splice(0,24)),e=""+t}return e},P.internalFBRrecs=function(e,t){var r=N.isPLP?"model4":"model3",n=d.set({setParms:{itemId:b.itemId,key:"2zSR74pj5Rq6zDtHENHkAScT4RWsl0pg",productModel:r},url:T+"/fbr/v1"});return i.default.ajax({url:n,type:"GET",dataType:"json",timeout:1e4,success:function(t){k.resolve(t),e&&e(t)},error:function(e){k.reject(e),t&&t(e)}})};var H=function(e,t,r){if(void 0!==window.certonaResx&&void 0===window.resx&&(window.resx={},window.certonaResx.getURL()),"string"==typeof e.certonaSchema||Array.isArray(e.certonaSchema)||Array.isArray(e.thdSchema)){var n=!1,o="";b=i.default.extend(!0,{},x,e),b.isMobile=v.isMobile(),t&&"function"==typeof t&&(b.callback=t);var a="string"==typeof b.certonaSchema?b.certonaSchema.split(","):b.certonaSchema;b.certonaSchema=a.filter(function(e){var t=e.indexOf("rv_")>-1;return t&&(n=!0,o="#"+e),!t});var c=P.getSchemaData(t,r);c.then(P.certonaDataSuccess,P.certonaDataFailure),b.thdSchema&&b.thdSchema.indexOf("pers_category_recs")>-1&&"model2"===b.version&&(c=P.internalCategoryRecs(),c.then(P.buildInternalCategorySchema,P.certonaDataFailure))}},U=function(){return P},F=function(){return S.options=b,S.defaults=x,S};(0,i.default)(document).on("click","#certonaAddToCartBtn",function(){if("mylistdetails"===(0,i.default)("#fromPage").val())return resx.event="addtocart_opr",resx.itemid=(0,i.default)(this.parentNode).children("input#catEntryId").val(),resx.pageid="",resx.links="",certonaResx.run(),!0}),(0,i.default)(document).on("click",".js-certona-atc",function(e){function t(e){s.off("success.thdrecs",t),E(n,"success")}function r(e){s.off("error.thdrecs",r),E(n,"error",e)}e.preventDefault();var n=(0,i.default)(e.currentTarget),o={itemId:n.data("item-id"),quantity:n.data("quantity"),onclickbeacon:n.data("onclickbeacon")},a=window.self!==window.top,c=N.channel;"web"===c&&(c="desktop");var s=m.addToCart(o,{channel:c,host:v.getHost(),hidden:a,open:!a});if(o&&o.onclickbeacon&&-1===L.indexOf(o.itemId)){!function(){var e=n.closest(".certona__productpod")[0],t=e.getAttribute("onview-beacon");e.getAttribute("data-hl-beacon")||((0,i.default)("<img style='display:none;' src='https:"+t+"'>").appendTo("body"),e.setAttribute("data-hl-beacon","sent"))}();(0,i.default)('<img class="onclickbeacon" style="display:none;" src="https:'+o.onclickbeacon+'">').appendTo("body"),L.push(o.itemId)}s.off("success.thdrecs",t),s.on("success.thdrecs",t),s.off("error.thdrecs",r),s.on("error.thdrecs",r),s.on("close.thdrecs",function(){E(n,"reset")}),h.recommendationAnalytics.setStashAnalytics(n,!0,b,v.isSponsored(n)),E(n,"loading"),s.open()}),(0,i.default)(document).on("click",".js-certona-atc-appliance",function(e){e.preventDefault();var t=(0,i.default)(e.currentTarget),r=N.channel;"web"===r&&(r="desktop");var n={itemId:t.data("item-id"),channel:r,host:v.getHost()};h.recommendationAnalytics.setStashAnalytics(t,!0,b),m.checkAvailability(n)}),(0,i.default)(document).on("click",M,function(e){e.preventDefault();var t=(0,i.default)(e.currentTarget);h.recommendationAnalytics.setStashAnalytics(t,!1,b,v.isSponsored(t)),window.top.location=t.attr("href")}),(0,i.default)(document).on("click",".certona-seeAll__link",function(e){var t=(0,i.default)(e.currentTarget);h.recommendationAnalytics.setStashAnalyticsForSeeAll(t,b)}),e.exports={certona:y,refresh:H,getPrivateData:F,updateATCButton:E,getPrivateMethods:U,privateMethods:P}},function(e,t){e.exports=a},function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}var o=r(0),a=function(e){return e&&e.__esModule?e:{default:e}}(o),i=r(1),c=n(i),s=r(9),d=n(s),l=r(50),u=n(l),p=r(7),m=r(8),h=n(m),f=void 0,v={schema:""},g=p.helpers.getGlobalObject(),_={},y=!1;g.channel=p.helpers.getChannel(g),_.getRVSchema=function(e){var t=!1;return("string"==typeof e||Array.isArray(e))&&("string"!=typeof e?(t=e.filter(function(e){return e.indexOf("rv_")>-1})[0],t=t||!1):e.indexOf("rv_")>-1&&(e=e.replace(/\s+/g,""),t=e.split(",").filter(function(e){return e.indexOf("rv_")>-1})[0])),t},_.handleFailure=function(e){return p.logger.log("Failed to retrieve recommended top selling products",e)},_.getDataFromAjax=function(e){var t=a.default.Deferred();return p.helpers.getRVPath(g.thdRecommendationsApiHost,f).then(function(r){a.default.ajax({url:r,data:e,contentType:"application/json",timeout:2e3,success:t.resolve,error:t.reject})}),t.promise()},_.buildSchemes=function(e){var t="#"+v.schema,r={};r=new p.schema.Schema({name:v.schema,data:e,options:f,targetElm:t}),r.initialize(),(0,a.default)(t).attr({itemscope:" ",itemtype:"http://schema.org/Thing"}),d.init(t+" .carousel__wrapper",{onDragged:h.checkVisibility})},_.cleanProducts=function(e){var t=e.slice(0);return t=t.filter(function(e){return void 0!==e.productId}),t.map(function(e){var t=e;return t.description=t.productName,t.id=e.productId,t}),t},_.processData=function(e){var t={};return e&&e.useractivity&&e.useractivity.rv&&(t={schemas:[{products:_.cleanProducts(e.useractivity.rv),schemaId:v.schema,title:"Recently Viewed Items"}]},u.setDataInStorage(e),_.buildSchemes(t)),t},_.getData=function(){var e={};return u.shouldLoadFromStorage()&&!y?(e=u.getDataFromStorage(),_.processData(e[0])):_.getDataFromAjax(_.getDataFromAjax).then(_.processData,_.handleFailure),e},e.exports={refresh:function(e){var t={};return f=void 0!==e?e:{},(0,a.default)(document).on("updateUserStatus",function(){u.expireDataInStorage()}),f.storeID=c.getStoreNum(),f.rvThrottle=u.checkThrottle(g.channel),(f.rvThrottle||f.certonaSchema)&&(f.rvThrottle=!0,p.helpers.initCookieManager(),(v.schema=_.getRVSchema(f.certonaSchema))&&(t=_.getData(v))),y=!0,t},getPrivateMethods:function(){return _}}},function(e,t){e.exports=i},function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=r(0),i=function(e){return e&&e.__esModule?e:{default:e}}(a),c=r(1),s=n(c),d=r(15),l=(n(d),r(9)),u=n(l),p=r(40),m=n(p),h=r(7),f=r(14),v=n(f),g=r(8),_=n(g),y=v.reorderTemplate||v.templates.reorderTemplate,I=(h.helpers.getGlobalObject(),void 0),w=void 0,x=[],b=window.digitalData||{},P="object"===("undefined"==typeof newrelic?"undefined":o(newrelic));b.content=b.content||{},b.content.module=b.content.module||[];var S=(h.helpers.detectDevice(),void 0),C=void 0,R={Desktop:"aGAQFG4j6QtVTSWqujfFYWeIU6BR5Mee",tablet:"aGAQFG4j6QtVTSWqujfFYWeIU6BR5Mee",mobileweb:"8Qg7Ztll8bnnEtlORRt7ReviHGrrnvo4",THDMobile_Consumer_iPhone:"iuNLedJoaSdzVVRmJkrR59OA8QZHIDL6",THDMobile_Consumer_Android:"wUuBD2fXGqWmKI1Y4bXJdcGfVNHnVCbU"},T={};T.host=h.helpers.getHost(),T.service="thdrecommends/v1/";var k=function(e,t){return T.host+"/"+(t?T.service+"reorder":T.service+e+"/reorder")},O=function(e,t,r){var n=i.default.Deferred();return i.default.ajax({url:k(t,r),data:e,contentType:"application/json",timeout:2e3,success:n.resolve,error:n.reject}),n.promise()},D=function(e){S=e},M=function(e){var t=e||{};return t.imagePath=e.imageURL.replace("<SIZE>",300),t.URL=t.canonicalURL,t.name=t.productName,t.productId=t.productId,t.recomendingOMSID="NA",t.ratingPercentage=t.rating&&t.rating/5*100||0,t.MAPFlag=t.hasOwnProperty("mapAboveOriginalPrice"),t.price=h.helpers.constructPrice(t),t.messageVersion=e.messageVersion,t.orderSource=e.orderSource,t},A=function(e){return void 0!==e.products||(h.logger.log(e.errorMessage),console.warn(e.errorMessage),!1)},j=function(e){e.forEach(function(e){e&&e.productId&&x.push(e)})},L=function(){return x},N={key:"",version:"model1",storeid:s.getStoreNum(),showprice:"true"},E=function(){var e=void 0,t=void 0,r=void 0;(0,i.default)(document).on("click",".js-reorder-atc",function(n){n.preventDefault();var o=(0,i.default)(n.currentTarget),a={itemId:o.data("item-id")},c=o.attr("data-product-interval"),s=L();i.default.each(s,function(n,o){a.itemId===o.productId&&(e=n+1,t=o.messageVersion,r=o.orderSource||"")});var d=window.self!==window.top,l="mobileweb"===h.helpers.detectDevice()?"mobile":"desktop",u=b.user?b.user.localization.storeNumber:"121",p={channel:l,host:h.helpers.getHost(),hidden:d,open:!d,localStoreId:u},f=m.addToCart(a,p),v={};I=(0,i.default)("#cust_reorder").find(".row-header__title").text(),v.category={primaryCategory:"stash"},v.eventInfo={eventName:"recommendation cart addition"},v.eventMode="stash",v.stash={component:"product pod",pageType:b.page.pageInfo.pageType,sharedSection:"n/a",section:"dyn prod rec",target:"atc",recommendation:{recommendationType:"reorder",pageType:b.page.pageInfo.pageType,displayPosition:e,anchorProductSku:"n/a",strategy:t,recommendationVersion:w,interval:c,featureVersion:r},item:[{index:e,productID:a.itemId}]},b.event.push(v);var g=function(e){console.log("reorder success"),G("success")},_=function(e){console.log("reorder fail"),G("failure")};f.off("success.thdrecs",g),f.on("success.thdrecs",g),f.off("error.thdrecs",_),f.on("error.thdrecs",_),console.log(f),f.open()}),(0,i.default)(document).on("click",".reorder-left",function(n){var o=(0,i.default)(n.currentTarget),a=o.find(".reorder__media--link").attr("data-product-interval"),c=L();I=(0,i.default)("#cust_reorder").find(".row-header__title").text();var s=o.find(".reorder__media--link").attr("data-product-id");i.default.each(c,function(n,o){s===""+o.productId&&(e=n+1,t=o.messageVersion,r=o.orderSource||"")});var d=b.page.pageInfo.pageType,l={},u="pip"===d?b.product[0].productInfo.sku:"n/a";l.category={primaryCategory:"stash"},l.eventInfo={eventName:"recommendation pip load"},l.eventMode="stash",l.stash={recommendation:{recommendationType:"reorder",pageType:b.page.pageInfo.pageType,displayPosition:e,anchorProductSku:u,strategy:t,recommendationVersion:w,interval:a,featureVersion:r}},void 0!==b&&b.hasOwnProperty("event")&&b.event.push(l)})},H=function(e){if(h.logger.log("Successfully retrieved customer ordered products"),w=e.version?e.version:"none",!A(e))return void q(0);var t=void 0!==e.schemaId?e.schemaId:"reorder",r=e.products.length;q(r);var n=h.helpers.getHost();D(r);var o=e.products.map(function(e){return M(e)});j(o);var a=e.title,c="mobileweb"===h.helpers.detectDevice(),s=y&&y.render({products:o,title:a,isMobile:c,schemaId:t,host:n,channel:c?"mobile":"desktop"});if((0,i.default)("#cust_reorder").attr({itemscope:" ",itemtype:"http://schema.org/Thing"}),s){(0,i.default)("#cust_reorder").html(s);u.init("#cust_reorder .carousel__wrapper",{onDragged:_.checkVisibility}),E()}V({status:"Success"})},U=function(){return 0!==(0,i.default)("#cust_reorder").length},F=function(e){return e&&e.svocid&&e.isB2BReorderEnabled},B=function(e){N.appid=N.appid.toLowerCase(),N.svocid=e.svocid,N.cseg=e.cseg.toLowerCase(),N.ctype="b2b"},q=function(e){P&&newrelic.addPageAction("reorderApiProductsReturned",{result:e})},V=function(e){P&&newrelic.addPageAction("thdRecommendationsAjaxResponseError",{result:e.status})},G=function(e){P&&newrelic.addPageAction("reorderAddToCartSuccess",{result:e})},z=function(e){V(e),h.logger.log("Failed to retrieve recommended products",e)},W=function(e,t,r){e&&t?(h.logger.log("Querying for Customer Ordered products"),O(e,t,r).then(H,z)):h.logger.log("No customer ID for data query")};e.exports={refresh:function(e){var t=e&&e.mcvisid||h.helpers.getmcvisId();if(N.storeid=e&&e.storeId||s.getStoreNum(),N.appid=e&&e.appId||h.helpers.detectDevice(),N.key=R[N.appId]||R.Desktop,U()){C=F(e);var r=t;C&&(r=e.svocid,B(e)),W(N,r,C),b.content.module.push({name:"reorder rec"})}}}},function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}var o=r(0),a=function(e){return e&&e.__esModule?e:{default:e}}(o),i=r(1),c=n(i),s=r(15),d=n(s),l=r(9),u=n(l),p=r(40),m=n(p),h=r(7),f=r(14),v=r(8),g=n(v),_=f.templates.irpgPod,y=h.helpers.detectDevice(),I=d.get()||{},w="mobileweb"===y,x={};x.items=[];var b={Desktop:"oHqWhmTIPN6dezWcCTtwXw0wzTyyqNpi",tablet:"aGAQFG4j6QtVTSWqujfFYWeIU6BR5Mee",mobileweb:"8Qg7Ztll8bnnEtlORRt7ReviHGrrnvo4",THDMobile_Consumer_iPhone:"iuNLedJoaSdzVVRmJkrR59OA8QZHIDL6",THDMobile_Consumer_Android:"wUuBD2fXGqWmKI1Y4bXJdcGfVNHnVCbU"},P={};P.host=h.helpers.getHost(),P.service="thdrecommends/v1/projectrecommendations";var S=function(){return"https://www.homedepot.com/"+P.service},C=function(e){var t=a.default.Deferred();return a.default.ajax({url:S(),data:e,type:"GET",dataType:"jsonp",contentType:"application/json",timeout:2e3,success:t.resolve,error:t.reject}),t.promise()},R=function(e){var t=!0;if(e){e.filter(function(e){return e.products?"MAJOR_APPLIANCES"===e.products[0].itemType:""}).length>0&&(t=!1)}return t},T=function(e){return e&&e.imageURL?e.imageURL.replace("<SIZE>",300):"https://images.homedepot-static.com/catalog/productImages/No_Image_300.jpg"},k=function(e,t,r){var n=e||{};return n.imagePath=T(e.products[0]),n.URL=e.products[0].canonicalURL,n.name=e.products[0].productName,n.brand=e.products[0].brand||"",n.productId=e.products[0].productId,n.rating=e.products[0].rating,n.ratingHref=e.products[0].canonicalURL+"#customer_reviews",n.ratingPercentage=e.products[0].rating&&e.products[0].rating/5*100||0,n.reviewCount=e.products[0].reviews||0,n.price=h.helpers.constructPrice(e.products[0]),n.originalPrice=e.products[0].originalPrice,n.dollarOff=e.products[0].dollarOff,n.percentageOff=e.products[0].percentageOff,n.mapAboveOriginalPrice=e.products[0].mapAboveOriginalPrice,n.pricingMessage=e.products[0].pricingMessage,n.uom=e.products[0].uom,n.multiATC=t,n.productIndex=r+1,n.isAppliance="MAJOR_APPLIANCES"===e.products[0].itemType||!1,n.atcLink="//mycart/overlay#/add-to-cart/"+e.products[0].productId+"/1/ShipToHome/DirectShip/desktop",n},O={keywords:"",key:"",version:"model3",show:"price",metadataversion:"model3",storeid:c.getStoreNum()},D=function(e){h.logger.log("Successfully retrieved customer ordered products");for(var t=h.helpers.getHost(),r=[],n=0;e.projects[0].projectDetails.plps.length>n;n++)e.projects[0].projectDetails.plps[n].products&&r.push(e.projects[0].projectDetails.plps[n]);var o=R(r),i=r.map(function(e,t){return!!e.products&&k(e,o,t)}),c=_.render({products:i,isMobile:w,host:t,channel:w?"mobile":"desktop"});(0,a.default)("#irpg_pods").attr({itemscope:" ",itemtype:"http://schema.org/Thing"}),(0,a.default)("#irpg_pods").html(c),u.init("#irpg_pods .carousel__wrapper",{onDragged:g.checkVisibility})},M=function(){return 0!==(0,a.default)("#irpg_pods").length},A=function(e){h.logger.log("Failed to retrieve recommended products",e)},j=function(e){e?(h.logger.log("Querying for Customer Ordered products"),C(e).then(D,A)):h.logger.log("No customer ID for data query")},L=function(e){var t={};t.category={primaryCategory:"stash"},t.eventInfo={eventName:"recommendation pip load"},t.eventMode="stash",t.stash={recommendation:{recommendationType:"pg item recs",pageType:"project guide",displayPosition:(0,a.default)(e.currentTarget).attr("data-index"),anchorProductSku:"n/a",strategy:"model3",recommendationVersion:"model3",featureversion:"n/a",interval:"n/a"}},void 0!==I&&I.hasOwnProperty("event")&&I.event.push(t)},N=function(e){var t={};t.category={primaryCategory:"stash"},t.eventInfo={eventName:"cart addition info"},t.eventMode="stash",t.stash={section:"dyn prod rec",pageType:"project guide",component:"product pod",sharedSection:"n/a",target:"atc",item:e},void 0!==I&&I.hasOwnProperty("event")&&I.event.push(t)},E=function(e){(0,a.default)(e).find(".multiATC").find(".selected-item-count").html("0"),(0,a.default)(e).find(".checkbox-hidden").prop("checked",!1),(0,a.default)(e).find(".checkbox-btn__input").attr("checked",!1),(0,a.default)(e).find(".checkbox-btn__label").find(".select_text").text("Select This Item"),(0,a.default)(e).find(".multiATC_btn").addClass("disabled")},H=function(){(0,a.default)(document).on("click",".checkbox-btn__input",function(e){var t=(0,a.default)(e.currentTarget),r=t.attr("data-itemid");if(t.prop("checked"))x.items.push(r),t.next("label").find(".select_text").text("Item Selected"),t.attr("data-onlineitem")&&(x.onlineItems+=","+r);else{var n=r;x.items=a.default.grep(x.items,function(e){return e!==n}),t.next("label").find(".select_text").text("Select This Item"),x.onlineItems.replace(","+r,"")}(0,a.default)("#irpg_pods .multiATC").find(".selected-item-count").html((0,a.default)(".checkbox-btn__input:checked","#irpg_pods").length),(0,a.default)("#irpg_pods [data-itemid="+r+"]").toggleClass("selected"),0===x.items.length?(0,a.default)("#irpg_pods").find(".multiATC_btn").addClass("disabled"):(0,a.default)("#irpg_pods").find(".multiATC_btn").removeClass("disabled")})},U=function(){(0,a.default)("#irpg_pods").on("click",".multiATC_btn",function(e){e.preventDefault();var t=(0,a.default)(".checkbox-btn__input:checked","#irpg_pods").map(function(e,t){return{item:(0,a.default)(t).attr("data-itemid"),position:(0,a.default)(t).attr("data-index")}});if(t.length>0){var r={CartRequest:{itemDetails:[]}},n=[];t.each(function(e,t){n.push({displayPosition:t.position,productInfo:{sku:t.item},recommendation:{recommendationType:"pg item recs",pageType:"project guide",anchorProductSku:"n/a",strategy:"model3",recommendationVersion:"model3",featureversion:"n/a",interval:"n/a"}}),r.CartRequest.itemDetails.push({itemId:t.item,quantity:1,fulfillmentMethod:""})}),N(n),e.preventDefault(),m.addToCart(r.CartRequest.itemDetails,{host:THD_GLOBAL.host,channel:w?"mobile":"desktop"}).on("success",function(e){E("#irpg_pods"),(0,a.default)(document).trigger({type:"cartUpdated"})}).on("error",function(e){console.log(e)})}})},F=function(){(0,a.default)("#irpg_pods").on("click",".irgAddToCart",function(e){var t=(0,a.default)(e.currentTarget).attr("data-isAppliance"),r={itemId:(0,a.default)(e.currentTarget).attr("data-product-id"),quantity:1,fulfillmentMethod:"true"===t?"DirectDelivery":""};e.preventDefault(),m.addToCart(r,{host:THD_GLOBAL.host,channel:w?"mobile":"desktop"}).on("success",function(e){console.log(e)}).on("error",function(e){console.log(e)})})};e.exports={refresh:function(e){var t=window.location.href;if(window.location.search){t=t.replace(window.location.search,"")}var r=t.substring(t.indexOf("/c/")+3);r=r.replace("#",""),O.keywords="https://www.homedepot.com/c/"+r,O.storeid=e&&e.storeId||c.getStoreNum(),O.appid=e&&e.appId||h.helpers.detectDevice(),O.key=b[O.appId]||b.Desktop,M()&&((0,a.default)(document).on("click","#irpg_pods .product-image a img",function(e){L(e)}),(0,a.default)(document).on("click","#irpg_pods a.pipDescription",function(e){L(e)}),(0,a.default)(document).on("click","#irpg_pods a.reviews",function(e){L(e)}),(0,a.default)(document).on("click","#irpg_pods .certona__productimagewrapper a img",function(e){L(e)}),(0,a.default)(document).on("click","#irpg_pods .certona__productdescriptionwrapper a span",function(e){L(e)}),j(O),H(),U(),F())}}},function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function o(e){return e&&e.__esModule?e:{default:e}}var a=r(0),i=o(a),c=r(1),s=n(c),d=r(9),l=n(d),u=r(40),p=o(u),m=r(7),h=r(14),f=r(8),v=n(f),g=h.templates.visuallySimilar,_=m.helpers.detectDevice(),y=void 0,I=void 0,w=void 0,x={minProducts:4},b=void 0,P={Desktop:"snIFEaDAqTYGuIp9H7pcKESfqB1SEGl4",tablet:"snIFEaDAqTYGuIp9H7pcKESfqB1SEGl4",mobileweb:""},S=m.helpers.getGlobalObject(),C={};C.host="//"+S.nonSecureHostName,C.service="/visualrecs/v1/similarproducts",S.channel=m.helpers.getChannel(S);var R=S.channel,T=function(){return"https:"+C.host+"/"+C.service},k=function(e){var t=i.default.Deferred();return i.default.ajax({url:T(),data:e,dataType:"jsonp",jsonpCallback:"callback",contentType:"application/json",timeout:"6000",success:t.resolve,error:t.reject}),t.promise()},O=function(e){m.logger.log("Failed to retrieve recommended visually similar products",e)},D=function(e){var t=0!==(0,i.default)("#uts_visualrecs").length,r=void 0,n="mobileweb"===m.helpers.detectDevice(),o=b.curationId,a=e.errorMessage;if("No Recommendations"!==a){m.logger.log("Successfully retrieved visually similar products");var c=e.products,s=void 0===c?[]:c;void 0!==s[0].similarProducts&&(s=s[0].similarProducts.map(function(e){return m.helpers.getTemplateElements(e,t)})),s.length>0&&s.map(function(e){var t=e;return("shop-the-look"===b.page||b.isStl)&&(t.URL=t.URL.replace(/^\/p/,"/collection/shop-the-look"),t.canonicalURL=t.canonicalURL.replace(/^\/p/,"/collection/shop-the-look")),t}),b.minProducts>s.length||(r=g.render({products:s,productImageURL:y,isMobile:n,channel:R,showATC:w,curationId:o,schemaId:I}),(0,i.default)("#uts_visualrecs").attr({itemscope:" ",itemtype:"http://schema.org/Thing"}),(0,i.default)("#uts_visualrecs").html(r),l.init("#uts_visualrecs .carousel__wrapper",{onDragged:v.checkVisibility}))}else m.logger.log(a);b.recommendationsVersion=e.version},M=function(e){m.logger.log("Querying for visually similar products"),k(e).then(D,O)},A=function(e){var t=e.certonaSchema;return("string"==typeof t||Array.isArray(t))&&t.indexOf("uts_visualrecs")>-1},j={},L=function(e){A(e)&&(m.helpers.initCookieManager(),j={schema:"uts_visualrecs",key:"",appid:_,version:"model1",columns:"itemid",itemids:"",showPrice:"",refine:"",storeId:s.getStoreNum(),maxResults:16},b=i.default.extend(!0,x,e),void 0!==e&&(y=e.productImageURL||"",j.itemids=e.products,j.showPrice=e.showPrice||"Y",j.storeId=e.storeId||s.getStoreNum(),j.appid=m.helpers.detectDevice(),j.refine=e.refine||"fullfillable",w=e.showATC||!1,I=e.schemaId||"uts_visualrecs"),j.key=P[j.appid]||P.Desktop,M(j))};(0,i.default)(document).on("click",".js-visually-similar a.js-visually-similar-atc",function(e){e.preventDefault();var t=(0,i.default)(e.currentTarget),r=window.self!==window.top,n={itemId:t.data("item-id"),quantity:t.data("quantity"),anchorProductSku:b.products,onclickbeacon:t.data("onclickbeacon"),recommendationVersion:"model1",page:"PIP"},o=p.default.addToCart(n,{channel:"web"===R?"desktop":R,host:m.helpers.getHost(),hidden:r,open:!r});m.recommendationAnalytics.setStashAnalyticsForVisuallySimilar(t,n),o.open()}),e.exports={refresh:L}},function(e,t,r){"use strict";var n=Object.assign||function(e){for(var t=1;arguments.length>t;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=r(7);e.exports={refresh:function(e){var t=n({},e,{anchor:e.products,schemeName:"pip_alternatives",endpoint:o.recommendationConfig.PIP_ALTERNATIVE_ENDPOINT});new o.schemeBuilder.SchemeBuilder(t).buildScheme()}}},function(e,t,r){e.exports=r(56)},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.refresh=void 0;var a=r(57),i=o(a),c=r(43),s=n(c),d=r(44),l=o(d),u=r(58),p=r(49),m=n(p),h=r(51),f=n(h),v=r(52),g=n(v),_=r(53),y=o(_),I=r(54),w=n(I);t.refresh=function(e,t,r,n){var o=e.certonaSchema,a=void 0===o?[]:o,c="string"==typeof a?a:a.join();i.localize().then(function(){s.default.refresh(r,e)}),l.refresh(e),m.default.refresh(e),u.main.refresh(e,t,n),f.default.refresh(r),g.default.refresh(e),y.refresh(e),c.indexOf("pip_alternatives")>-1&&w.default.refresh(e)}},function(e,t){e.exports=c},function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.certonaHelpers=t.main=t.resxclsx=void 0;var o=r(41),a=n(o),i=r(42),c=n(i),s=r(47),d=n(s);t.resxclsx=a,t.main=d,t.certonaHelpers=c}])});
//# sourceMappingURL=all.amd.js.map;
define('thirdpartyInit', [
    'jquery',
    'mustache',
    'utils.minicart',
    'localizationPopup',
    'Localizer',
    'global.modal',
    'global.gestureHandler',
    'global.dynamicRatings',
    'thd.moduleLoader',
    'thd-cart-throttle',
    'thd.certona'
], function load(
    $,
    mustache,
    miniCart,
    localizationPopup,
    Localizer,
    globalModal,
    gestureHandler,
    dynamicRatings,
    moduleLoader,
    thdCartThrottle,
    certona
) {
    var hfapp = {};
    hfapp.init = function() {
        return {
            localizationPopup: localizationPopup.init(),
            Localizer: Localizer.localize(),
            globalModal: globalModal.init(),
            gestureHandler: gestureHandler.init(),
            dynamicRatings: dynamicRatings.init(),
            moduleLoader: moduleLoader.init()
        }

    };
    
    hfapp.enableThrottleForCart = function(channel) {
    	headerCart.cartThrottle = thdCartThrottle.getThrottleForChannel(channel);
    };
    
    return hfapp;
});
(function closure(root, factory) {
  if (typeof define === 'function' && define.amd) {
    define('verification.constants',[
      'jquery',
      'account.device.utility'
    ], function load(jQuery, deviceUtility) {
      return factory(root, jQuery, deviceUtility);
    })
  } else {
    factory(root, jQuery, deviceUtility);
  }
}) (this, function factory(root, $, deviceUtility) {
  var URLS = {
    VERIFY_PHONE_URL: 'https://' + deviceUtility.getHostNameSecure() + '/customer/account/v1/',
    // different string query after the constant value
    SET_PASSWORD_URL: 'https://' + deviceUtility.getHostNameSecure() + '/customer/account/v1/'
  };

  var ERRORS = {
    INVALID_CODE: "This code is incorrect.",
    RESEND_PROMPT: "Looks like this code isn't working. Click the link below to resend your code and try a new one.",
    RESEND_INTERNAL_ERR: "There was an error sending your code. \n Please try again",
    SUBMIT_INTERNAL_ERR: "Were sorry. We could not verify your code at this time.",
    BANNER_INTERNAL_ERR: "We're sorry. We could not verify your phone at this time. Please try again later.",
    TWO_FACTOR_ERR: "Were sorry. We could not sign you in at this time",
    VALIDATION_FAILED_ERR: "Were sorry. We couldnt sign you in at this time. For assistance, call 800-466-3337.",
    SERVICE_FAIL_ERR: "We're sorry. We could not sign you in at this time. Please try again later.",
    SESSION_TIMEOUT: "Your session has timed out.",
    ACCOUNT_LOCKED: "Were sorry. Your account has been locked out due to too many sign in attempts. For assistance," +
    " please call 800-466-3337.",
    UNREGISTERED_ACCOUNT: "We're sorry. This email is not registered. Would you like to create an account?",
    REGISTER_PASSWORD_WEAK_ERR: 'Weak passwords cannot be saved. Please ensure that your password is more than 8 characters and is not a commonly used password.',
    DUPLICATE_PASSWORD: "Were sorry. You can't use your previous password. Please create a new password.",
    DUPLICATE_EMAIL_PASSWORD: "We're sorry. Your password cannot be the same as your email.",
    GENERIC_ERROR: "We're sorry. There was a temporary technical issue. Please try again later.",
    PASSWORD_RESET_BLOCK: "We're sorry. We cannot currently process your password reset request.",
    PHONE_BELONGS_TO_PRO: "Please try another phone number as this phone number is already registered with an account."
  };

  return {
    URLS: URLS,
    ERRORS: ERRORS
  }
});
/**
 * @Description: Helps to hold the utility methods for phone verification module
 **/
(function closure(root, factory) {
  if (typeof define === 'function' && define.amd) {
    define('verification.helper',[
      'jquery',
      'verification.constants',
      'password.meter',
      'auth.constants'
    ], function load(jQuery, constants, passwordMeter, authConstants) {
      return factory(root, jQuery, constants, passwordMeter, authConstants);
    });
  } else {
    // For non-AMD module, expose this to global (will also be useful for test cases)
    /*eslint-disable*/
    factory(root, jQuery, constants, passwordMeter, authConstants);
    /*eslint-enable*/
  }
})(this, function factory(root, $, CONSTANTS, passwordMeter, authConstants) {

  var generateHeaders = function(channelId, options) {
    var headers = {
      'Content-Type': 'application/json',
      'Accept': 'application/json',
      'channelId': channelId,
      'crossDomain': true,
      'xhrFields': { 'withCredentials': true }
    };

    if (options) {
      for (var key in options) {
        headers[key] = options[key];
      }
    }

    return headers;
  };

  var generateVerify2FactorRequest = function(authId, backendHost, customerId, email, deviceId, requestId, OTP, sentViaText) {
    return {
      "otpRequest": {
        "customerId": customerId,
        "authId": authId,
        "backendHost": backendHost,
        "loginId": email,
        "origin": sentViaText ? "2FATEXT" : "2FA",
        "otpChannel": "email",
        "otp": OTP,
        //possibly outdated fields
        "deviceId": deviceId,
        "requestId": requestId
      }
    };
  };

  var generateVerifyPhoneRequest = function(res, otp, phoneNumber, emailId, profileResp, twoFAOptIn, proBusinessName, zipCode) {
    var req = {
      "otpRequest": {
        "authId": res.authId,
        "backendHost": res.backendHostName,
        "loginId": emailId,
        "zipCode": zipCode,
        "phone": {
          "number": phoneNumber,
          "type": "MOBILE",
          "primaryFlag": "Y"
        },
        "otp": otp
      }
    };

    if (twoFAOptIn.twoFactorAuthOptIn) {
      req.otpRequest.twoFactorAuthOptIn = twoFAOptIn.twoFactorAuthOptIn;
      req.otpRequest.profileLastUpdateTimestamp = twoFAOptIn.lastModifiedDate || '';
      req.otpRequest.firstName = twoFAOptIn.firstName || '';
      req.otpRequest.lastName = twoFAOptIn.lastName || '';
      if (proBusinessName) req.otpRequest.businessName = proBusinessName;
    }

    if (profileResp.number) {
      req.otpRequest.phone.lastModifiedDate = profileResp.lastModifiedDate;
      req.otpRequest.phone.type = profileResp.type;
      req.otpRequest.phone.contactMethodEnumeration = profileResp.contactMethodEnumeration;
      req.otpRequest.phone.primaryFlag = profileResp.primaryFlag;
      req.otpRequest.phone.secondaryFlag = profileResp.secondaryFlag;

      return req;
    }

    return req;
  };

  var getErrorMessage = function(errorCode) {
    switch (errorCode) {
      case "AUTH_ERR_122": {
        return CONSTANTS.ERRORS.INVALID_CODE;
      }
      case "AUTH_ERR_125": {
        return CONSTANTS.ERRORS.VALIDATION_FAILED_ERR;
      }
      case "AUTH_ERR_104": {
        return CONSTANTS.ERRORS.RESEND_PROMPT;
      }
      case "AUTH_ERR_126":
      case "AUTH_ERR_127":
      case "AUTH_ERR_105": {
        return CONSTANTS.ERRORS.TWO_FACTOR_ERR;
      }
      case "AUTH_ERR_123": {
        return CONSTANTS.ERRORS.SESSION_TIMEOUT;
      }
      case "AUTH_ERR_124": {
        return CONSTANTS.ERRORS.ACCOUNT_LOCKED;
      }
      case "PASS_ERR_004": {
        return CONSTANTS.ERRORS.UNREGISTERED_ACCOUNT;
      }
      case "GEN_ERR_500": {
        return CONSTANTS.ERRORS.GENERIC_ERROR;
      }
      case "AUTH_ERR_116": {
        return CONSTANTS.ERRORS.DUPLICATE_PASSWORD;
      }
      case "PASS_ERR_018": {
        return CONSTANTS.ERRORS.PASSWORD_RESET_BLOCK;
      }
      case "UREG_ERR_224": {
        return CONSTANTS.ERRORS.PHONE_BELONGS_TO_PRO;
      }
      default:
        return CONSTANTS.ERRORS.SUBMIT_INTERNAL_ERR;
    }
  };

  var renderFormErrorMessage = function(errorText, $inputField) {
    var inputForm = ($inputField && $inputField.parent().hasClass('form-input')) ? $inputField.parent() : $('#form-input-verification');

    if (!inputForm.hasClass("form-input--error")) {
      if (inputForm.hasClass("form-input--success") || inputForm.hasClass("form-input--warning")) {
        inputForm
          .removeClass('form-input--success')
          .removeClass('form-input--warning')
          .addClass('form-input--error')
          .find($('.form-input-error__message'))
          .css({'visibility': 'visible'})
          .text(errorText);
        return;
      }
      if (inputForm.children().is($('error-messages'))) {
        inputForm.addClass("form-input--error");
        inputForm.find($('error-messages')).empty().append($('<div></div>').addClass('form-input-error__message').text(errorText));
      } else {
        inputForm.addClass("form-input--error").append($("<span></span>").addClass('form-input-error__message').text(errorText))
      }
    } else {
      if (inputForm.children().is($('error-messages'))) {
        inputForm.find($('error-messages')).empty().append($('<div></div>').addClass('form-input-error__message').text(errorText));
      } else {
        inputForm.find($('.form-input-error__message')).text(errorText)
      }

    }
  };

  var verificationSuccess = function(payload) {
    document.dispatchEvent(new CustomEvent("verificationSuccess", {detail: payload}));
  };

  var onSuccessHideLoader = function() {
    document.dispatchEvent(new CustomEvent("verificationDisplaySuccess"));
  };

  var onFailureHideLoader = function(error) {
    document.dispatchEvent(new CustomEvent("verificationDisplayFailure",{detail: error}));
  };


  var showResendSpinner = function() {
    $('#resend-code-spinner').attr('style', 'margin-left: 5px; visibility: visible;');
    $('.resend-code-link').attr('id', 'resend-code-disable');
  };

  var hideResendSpinner = function() {
    $('#resend-code-spinner').css('visibility', 'hidden');
  };

  var formatPhone = function(input) {
    return '(' + input.substr(0, 3) + ') ' + input.substr(3, 3) + '-' + input.substr(6);
  };

  var maskPhone = function(input) {
    var length = input.length;
  	return '--' + input.substr(length - 3);
	};

	var renderOnSuccessResendResponse = function ($verificationButton, $verifyOTP, successMessage) {
		$verifyOTP.length === 6 && $verificationButton.removeClass('disabled');
		var message =
			$('<span></span>')
				.append(
					$('<span></span>')
						.addClass('success-text--align-bottom')
						.text(typeof successMessage === 'string' ? successMessage : 'Code Resent'),
					$('<span></span>')
						.attr('id', 'resend-code-spinner')
						.css("visibility", "hidden")
						.addClass('segment-spinner segment-spinner--xsmall'));
		$('.resend__help-message')
			.empty()
			.addClass('resend__response-success success-text--display-flex')
			.prepend(
				$('<img>')
					.addClass('resend__response-image')
					.attr('src', "/account/dist/images/success.svg"),
				message
			)
	};

  var renderOnFailureResendResponse = function($verificationButton, $verifyOTP) {
    $verifyOTP.length === 6 && $verificationButton.removeClass('disabled');
    $('.resend__response-message')
      .append(
        $('<img>')
          .addClass('resend__response-image')
          .attr('src', "/account/dist/images/error.svg"),
        $('<div></div>')
          .addClass('resend__response-failure')
          .append(
            $('<span></span>').text(CONSTANTS.ERRORS.RESEND_INTERNAL_ERR)
          )
      )
  };

  var addMessageAndDataApplyMessage = function (div) {
    div.empty();
    div.append(
      $("<span></span>").text("Message and data rates may apply.").css({"padding-right": '1em'}),
      $("<span></span>").append(
        $("<a></a>")
          .addClass("u__default-link")
          .attr("href", "https://www.homedepot.com/c/PH_MyAccount")
          .attr("target", "_blank")
          .text("Terms of Use"),
        "&nbsp;|&nbsp;",
        $("<a></a>")
          .addClass("u__default-link")
          .attr("href", "https://www.homedepot.com/c/Privacy_Security")
          .attr("target", "_blank")
          .text("Privacy Policy")
      )
    );
  };

  var revertDisabledButton = function(button, buttonText) {
    button.removeClass('disabled');
    button.find('.bttn__content').empty().text(buttonText);
  };

  var disableButton = function(button, inputField, buttonText) {
    button.addClass('disabled');
    buttonText && button.find('.bttn__content').empty().text(buttonText);
    if (inputField && inputField.length) {
      inputField.on('keydown', function(e) { if (e.keyCode === 13) return false; });
      inputField.on('keyup', function(e) { if (e.keyCode === 13) return false; });
    }
  };

  var renderResetPasswordMethodOptions = function (isPhoneVerified, is2FAOptIn, inputs, eVoiceFeatureSwitch, isMobile) {
    var body = $("#password__bottom-body");
    body.empty();
    if (is2FAOptIn && inputs.phoneNumber) {
      if (eVoiceFeatureSwitch) {
        body.append(
          $('<p></p>')
            .addClass('bottom__method-message u__bold')
            .text("How should we send the verification code?"),
          $('<div></div>')
            .attr('id', 'password__bottom-radio-buttons')
            .append(
              $('<div></div>')
                .addClass('radio-btn__content-wrapper')
                .append(
                  $('<input>')
                    .addClass('radio-btn__input')
                    .attr('id', 'reset-password__btn-text')
                    .attr('type', 'radio')
                    .attr('name', 'reset-password__bottom')
                    .attr('value', 'sms'),
                  $('<label></label>')
                    .addClass('radio-btn__label')
                    .attr('for', 'reset-password__btn-text')
                    .append(
                      $('<span></span>').addClass('radio-btn'),
                      'Text: ',
                      $('<p/>').addClass('u__bold').append(maskPhone(inputs.phoneNumber))
                    )
                ),
              $('<div></div>')
                .addClass('radio-btn__content-wrapper')
                .append(
                  $('<input>')
                    .addClass('radio-btn__input')
                    .attr('id', 'reset-password__btn-phone')
                    .attr('type', 'radio')
                    .attr('name', 'reset-password__bottom')
                    .attr('value', 'phone'),
                  $('<label></label>')
                    .addClass('radio-btn__label')
                    .attr('for', 'reset-password__btn-phone')
                    .append(
                      $('<span></span>').addClass('radio-btn'),
                      'Phone Call: ',
                      $('<p/>').addClass('u__bold').append(maskPhone(inputs.phoneNumber))
                    )
                )
            )
        )
      } else {
        body.append(
          $('<div></div>').addClass('bottom__notify').append(
            "We'll text a verification code to&nbsp;",
            $('<span></span>').append(
              $('<span></span>').addClass('u__bold').append(maskPhone(inputs.phoneNumber), '&nbsp;'),
              "for you to enter shortly."
            )
          )
        )
      }
    } else {
      if (isPhoneVerified && inputs.phoneNumber) {
        body.append(
          $('<p></p>')
            .addClass('bottom__method-message u__bold')
            .text("How should we send the verification code?"),
          $('<div></div>')
            .attr('id', 'password__bottom-radio-buttons')
            .append(
              $('<div></div>')
                .addClass('radio-btn__content-wrapper')
                .append(
                  $('<input>')
                    .addClass('radio-btn__input')
                    .attr('id', 'reset-password__btn-text')
                    .attr('type', 'radio')
                    .attr('name', 'reset-password__bottom')
                    .attr('value', 'sms'),
                  $('<label></label>')
                    .addClass('radio-btn__label')
                    .attr('for', 'reset-password__btn-text')
                    .append(
                      $('<span></span>').addClass('radio-btn'),
                      'Text: ',
                      $('<p/>').addClass('u__bold').append(maskPhone(inputs.phoneNumber))
                    )
                ),
              eVoiceFeatureSwitch && (
                $('<div></div>')
                  .addClass('radio-btn__content-wrapper')
                  .append(
                    $('<input>')
                      .addClass('radio-btn__input')
                      .attr('id', 'reset-password__btn-phone')
                      .attr('type', 'radio')
                      .attr('name', 'reset-password__bottom')
                      .attr('value', 'phone'),
                    $('<label></label>')
                      .addClass('radio-btn__label')
                      .attr('for', 'reset-password__btn-phone')
                      .append(
                        $('<span></span>').addClass('radio-btn'),
                        'Phone Call: ',
                        $('<p/>').addClass('u__bold').append(maskPhone(inputs.phoneNumber))
                      )
                  )
              ),
              $('<div></div>')
                .addClass('radio-btn__content-wrapper')
                .append(
                  $('<input>')
                    .addClass('radio-btn__input')
                    .attr('id', 'reset-password__btn-email')
                    .attr('type', 'radio')
                    .attr('name', 'reset-password__bottom')
                    .attr('value', 'email'),
                  $('<label></label>')
                    .addClass('radio-btn__label')
                    .attr('for', 'reset-password__btn-email')
                    .append(
                      $('<span></span>').addClass('radio-btn'),
                      'Email: ',
                      $('<p/>').addClass('u__bold').append(inputs.emailId)
                    )
                )
            )
        )
      } else {
        body.append(
          $('<div></div>').addClass('body__p-top--small col__12-12 body__p-horizontal--none body__p-bottom--none').append(
            "We'll email a verification code to&nbsp;",
            $('<span></span>').addClass('u__bold').append(inputs.emailId, '&nbsp;'),
            "for you to enter shortly."
          )
        )
      }
    }


    if (inputs.flow === 'reset-password') {
      body.find(".bottom__method-message").removeClass("u__bold");
      body.prepend(
        $("<p></p>")
          .addClass("u__bold")
          .text("Before we can reset your password, we'll need to confirm who you are.")
      );
    }
    if (inputs.method) {
      var $bottomRadioButtons = $('input:radio[name=reset-password__bottom]');
      $bottomRadioButtons.filter('[value='+inputs.method+']').attr('checked', true);
      (inputs.method === 'sms' || inputs.method === 'phone') && addMessageAndDataApplyMessage($("#reset-password__footer-text"));
    }

    if (isMobile) {
      $('.bottom__notify').css({display: 'block'});
      $('#password__bottom-radio-buttons').css({'flex-direction': 'column'});
    }
  };

  var onClickShowPasswordLink = function ($passwordInputField, $link) {
    // similar logic with auth.registration.js line:513
    $link.on('click', function(event) {
      if ($passwordInputField.attr("type") !== 'text') {
        $link.text('Hide');
        $passwordInputField.attr('type', 'text');
      } else {
        $link.text('Show');
        $passwordInputField.attr('type', 'password');
      }
    });
  };

  var addPasswordInputFieldListener = function ($passwordInputField, emailId, $submitButton) {
    var $passwordInputWrapper = $passwordInputField.parent();
    var $resetPasswordInputFormMessage = $('.form-input-error__message');
    var $resetPasswordShowLink = $('.form-input__show-password');
    var isDirty = false;
    var message = '';

    $passwordInputField.on('keyup', function(e) {
      // The level will be from 0 to 2. (0 for weak, 1 for good and 2 for strong.)
      var validationLevel = passwordMeter.validatePassword($(this), emailId);
      $(this).data('strength', validationLevel);

      // remove existing form-input alerts
      $passwordInputWrapper.removeClass(function(i, className) {
        return (className.match(/(^|\s)form-input\S+/g) || []).join(' ');
      });

      var className, shouldButtonBeDisabled;
      switch ($(this).data('strength')) {
        case 0:
          className = 'form-input--error';
          message = 'Weak';
          shouldButtonBeDisabled = true;
          break;
        case 1:
          className = 'form-input--warning';
          message = 'Fair';
          shouldButtonBeDisabled = false;
          break;
        case 2:
          className = 'form-input--success';
          message = 'Strong';
          shouldButtonBeDisabled = false;
          break;
      }

      $passwordInputWrapper.addClass(className);
      $resetPasswordInputFormMessage.empty().text(message);
      isDirty = true;

      if (shouldButtonBeDisabled) {
        if (!$submitButton.hasClass('disabled')) {
          $submitButton.addClass('disabled');
          if (e.keyCode === 13) return false;
        }
      } else {
        revertDisabledButton($submitButton, 'Submit');
      }
    });

    $passwordInputField
      .on('focusout', function(e) {
        if ($(this).val() === emailId) {
          $passwordInputWrapper.addClass('form-input--error');
          $resetPasswordInputFormMessage.empty().text(CONSTANTS.ERRORS.DUPLICATE_EMAIL_PASSWORD);
          isDirty &&$resetPasswordShowLink.css({'margin-right': '2em'});
          return;
        }
        if ($passwordInputWrapper.hasClass('form-input--error')) {
          $resetPasswordInputFormMessage.empty().text(CONSTANTS.ERRORS.REGISTER_PASSWORD_WEAK_ERR);
          isDirty &&$resetPasswordShowLink.css({'margin-right': '2em'});
          return;
        }

        $resetPasswordInputFormMessage.css({'visibility': 'hidden'});
        if ($(this).val() || isDirty) $resetPasswordShowLink.css({'margin-right': '2em'});
      })
      .on('focus', function(e) {
        $resetPasswordInputFormMessage.css({'visibility': 'visible'});
        $resetPasswordShowLink.css({'margin-right': '0'});
      });
  };

  var validateEmailAddress = function (emailId) {
    var regex = /^([a-zA-Z0-9_.-])+@((([a-zA-Z0-9-])+\.){1,3})([a-zA-Z0-9]{2,6})$/;
    return regex.test($.trim(emailId));
  };

  var onResolveRedirect = function(customerType) {
    if (customerType === 'B2B' ) {
      return document.location.replace(authConstants.URLS.B2B_ACCOUNT_PROFILE_PATH);
    } else if (customerType === "B2X") {
      return document.location.replace(authConstants.URLS.B2X_ACCOUNT_PROFILE_PATH);
    }  else if (customerType == "MULTIPLE"){
			return document.location.replace(authConstants.URLS.B2B_ACCOUNT_SELECTOR_PATH);
		}
    var url = window.location.protocol + '//' + window.location.host + window.location.pathname;
    switch (url) {
      case authConstants.URLS.CHECKOUT_SIGNIN:
      case authConstants.URLS.CHECKOUT_SIGNIN_PERSISTENT_PATH:
      case authConstants.URLS.MYACCOUNT_CHECKOUT_SIGNIN_PATH:
        document.location.replace(authConstants.URLS.CHECKOUT_PATH);
        break;
      case authConstants.URLS.LOGON_PAGE_URL:
        document.location.replace(authConstants.URLS.ACCOUNT_PROFILE_PATH);
        break;
      default:
        document.location.reload();
        return;
    }
  };

  var onClickRPRadioButtons = function($submitButton, inputs, isPhoneVerified, is2FAOptIn, isMobile, evoiceSwitch) {
    $submitButton.addClass("disabled");
    var $resetPasswordBottomText = $("#reset-password__footer-text");

    // change the size of the submit button for disabled button
    $resetPasswordBottomText.removeClass("col__8-12").addClass("col__7-12");
    $submitButton.parent().removeClass("col__4-12").addClass("col__5-12");

    // onClick event handlers for the radio button groups
    var $topRadioButtons = $('input:radio[name=reset-password__top]');
    $topRadioButtons.on('click', function(event) {
      if (inputs.flow !== event.target.value) {
        inputs.flow = event.target.value;
        // remove message and data apply message
        $resetPasswordBottomText.empty();
        // remove existing alert message when clicked on a different option
        $('#reset-password__body .alert-inline').remove();
        // handle which radio button sets to display
        if (!is2FAOptIn && isPhoneVerified && inputs.method === null) inputs.method = 'sms'; // pre-select radio button
        renderResetPasswordMethodOptions(isPhoneVerified, is2FAOptIn, inputs, evoiceSwitch, isMobile); // 4th parameter is for e-voice switch
        isMobile && $('.bottom__notify').find('> span').css({'display': 'flex', 'flex-direction': 'column'});
      }

      revertDisabledButton($submitButton, "Send Code");

      // revert back the size of the submit button to normal
      $resetPasswordBottomText.removeClass("col__7-12").addClass("col__8-12");
      $submitButton.parent().removeClass("col__5-12").addClass("col__4-12");

      isMobile && $('#reset-password__footer-text').css({
        "display": "flex",
        "flex-direction": "column",
        "text-align": "center"
      }).find("> span").css({'line-height': '2em', "padding": "0"});

      // attach an onClick event handler on the radio button options
      var $bottomRadioButtons = $('input:radio[name=reset-password__bottom]');
      $bottomRadioButtons.on('click', function(event) {
        // remove existing alert message when clicked on a different option
        if (inputs.method !== event.target.value) $('#reset-password__body .alert-inline').remove();

        inputs.method = event.target.value;
        inputs.method === 'sms' || inputs.method === 'phone' ?
          addMessageAndDataApplyMessage($resetPasswordBottomText) :
          $resetPasswordBottomText.empty();

        isMobile && $('#reset-password__footer-text').css({
          "display": "flex",
          "flex-direction": "column",
          "text-align": "center"
        }).find("> span").css({'line-height': '2em', "padding": "0"});
      });
    });
  };

	var onClickOTPSignInRadioButtons = function($submitButton, inputs, isPhoneVerified, is2FAOptIn, isMobile) {
	  if (isPhoneVerified) {
			$submitButton.addClass('disabled');
    }
		var $resetPasswordBottomText = $("#otp-signin__footer-text");

	  // if (inputs.method !== 'sms') {
		 //  // change the size of the submit button for disabled button
		 //  $resetPasswordBottomText.removeClass("col__8-12").addClass("col__7-12");
		 //  $submitButton.parent().removeClass("col__4-12").addClass("col__5-12");
	  // }

		// onClick event handlers for the radio button groups
		var $topRadioButtons = $('input:radio[name=otp-signin]');
		$topRadioButtons.on('click', function(event) {
			// remove existing alert message when clicked on a different option
			if (inputs.method !== event.target.value) $('#otp-signin__body .alert-inline').remove();

			inputs.method = event.target.value;
			inputs.method === 'sms' || inputs.method === 'phone' ?
				addMessageAndDataApplyMessage($resetPasswordBottomText) :
				$resetPasswordBottomText.empty();

			revertDisabledButton($submitButton, "Send Code");

			// revert back the size of the submit button to normal
			$resetPasswordBottomText.removeClass("col__7-12").addClass("col__8-12");
			$submitButton.parent().removeClass("col__5-12").addClass("col__4-12");

			isMobile && $('#otp-signin__footer-text').css({
				"display": "flex",
				"flex-direction": "column",
				"text-align": "center"
			}).find("> span").css({'line-height': '2em', "padding": "0"});

		});
	};

  var getEmailInputRP = function(inputID) {
    if (inputID) {
      return $(inputID);
    } else if ($("#emailholder").length) {
      return $("#emailholder").find("input");
    } else {
      return $('.rp__email-input');
    }
  };

  var getHMAC = function() {
    try {
      return {
        env: $('#hat_env').length ? $('#hat_env').val() : ($("input[name=hat_env]").length ? $("input[name=hat_env]").val() : ''),
        envTS: $('#hat_env_ts').length ? $('#hat_env_ts').val() : ($("input[name=hat_env_ts]").length ? $("input[name=hat_env_ts]").val() : ''),
        envID: $('#hat_env_id').length ? $('#hat_env_id').val() : ($("input[name=hat_env_id]").length ? $("input[name=hat_env_id]").val() : ''),
        delay: '100000',
        isActive: $('#hat_env_active').length ? $('#hat_env_active').val() : ($("input[name=hat_env_active]").length ? "true" : "false")
      }
    } catch(exception) {
      console.warn("Failed at getting HMAC values! " + exception);
    }
  };

  var getOrigin = function (flow) {
    try {
      var targetPath = location.pathname && location.pathname.split('/')[1];

      var locations = {
        account: 'myAccount',
        order: 'O&P',
        mycart: 'Cart',
        SpecialBuy: 'SBOTD',
        list: 'myList',
        mycheckout: 'Checkout',
        p: 'PIP',
        l: 'SF',
        c: 'Collections'
      };

      var includes = function(str, substr) {
        return str.indexOf(substr) !== -1;
      };

      var parseOrigin = function(origin, flow) {
        return flow ? origin + '-' + flow : origin;
      };

      for (var loc in locations) {
        if (includes(targetPath, loc)) {
          return parseOrigin(locations[loc], flow);
        } else if (path === '/') {
          return parseOrigin('CPR', flow);
        } else {
          return parseOrigin('Others', flow);
        }
      }
    } catch(exception) {
      console.warn("Failed at getting origin values! " + exception);
    }

  };

  return {
    generateHeaders: generateHeaders,
    generateVerify2FactorRequest: generateVerify2FactorRequest,
    generateVerifyPhoneRequest: generateVerifyPhoneRequest,
    verificationSuccess: verificationSuccess,
    showResendSpinner: showResendSpinner,
    hideResendSpinner: hideResendSpinner,
    onSuccessHideLoader: onSuccessHideLoader,
    onFailureHideLoader: onFailureHideLoader,
    renderErrorMessage: renderFormErrorMessage,
    formatPhone: formatPhone,
    maskPhone: maskPhone,
    getErrorMessage: getErrorMessage,
    renderOnSuccessResendResponse: renderOnSuccessResendResponse,
    renderOnFailureResendResponse: renderOnFailureResendResponse,
    revertDisabledButton: revertDisabledButton,
    disableButton: disableButton,
    onClickShowPasswordLink: onClickShowPasswordLink,
    addPasswordInputFieldListener: addPasswordInputFieldListener,
    validateEmailAddress: validateEmailAddress,
    onResolveRedirect: onResolveRedirect,
    handleOnClickRPRadioButtons: onClickRPRadioButtons,
	  handleOnClickOTPSignInRadioButtons: onClickOTPSignInRadioButtons,
    getEmailInputRP: getEmailInputRP,
	  addMessageAndDataApplyMessage: addMessageAndDataApplyMessage,
    getHMAC: getHMAC,
    getOrigin: getOrigin
  }
})
;

/**
 * Phone Verification Analytics
 **/
(function closure(root, factory) {
	if (typeof define === 'function' && define.amd) {
		define('verification.analytics',[], function load() {
			return factory(root);
		});
	} else {
		// For non-AMD module, expose this to global (will also be useful for test cases)
		/*eslint-disable*/
		factory(root);
		/*eslint-enable*/
	}
})(this, function factory(root) {

	/**
	 * @Description: Helps to push the events info, when the digital data is present
	 *
	 * @Param: analyticsEventInfo
	 **/
	var pushEventInfo = function(analyticsEventInfo) {
		if (digitalData !== null && digitalData !== undefined && digitalData.event !== undefined) {
			digitalData.event.push(analyticsEventInfo);
		}
	};
	/**
	 * @Description: Function to push event information of opening on verify phone modal
	 */
	var openVerify2FAModal = function(type) {
		try {
			var thdAnalyticsEvent = {
				category: {
					primaryCategory: "overlay"
				},
				eventInfo: {
					eventName: "two factor authentication  code entry - " + type
				}
			};
			pushEventInfo(thdAnalyticsEvent);
		}
		catch (error) {
			//Suppress the error, so that functionality is not broken
			console.warn('DDO: Error in pushing the 2-factor auth rendering overlay event info');
		}
	};

	/**
	 * @Description: Function to push event information of opening on verify identity modal during registration
	 */
	var openVerifyIdentityModal = function() {
		try {
			var thdAnalyticsEvent = {
				category: {
					primaryCategory: "overlay"
				},
				eventInfo: {
                    eventName: "verify your identity - phone number already in use"
				}
			};
			pushEventInfo(thdAnalyticsEvent);
		}
		catch (error) {
			//Suppress the error, so that functionality is not broken
			console.warn('DDO: Error in pushing the verify your identity rendering overlay event info');
		}
	};

	/**
	 * @Description: Function to push event information of landing on verify phone flow on Mobile View
	 */
	var onLoadVerifyPhoneModalMW = function() {
		try {
			var thdAnalyticsEvent = {
				category: {
					primaryCategory: "verify your phone number - code entry",
					subCategory1: "verify your phone number - code entry",
					subCategory2: "verify your phone number - code entry"
				},
				pageInfo: {
					pageName: "verify your phone number - code entry",
					pageType: "maml:profile"
				}
			};
			pushEventInfo(thdAnalyticsEvent);
		}
		catch (error) {
			//Suppress the error, so that functionality is not broken
			console.warn('DDO: Error in pushing the verify phone overlay rendering event info in mobile web view');
		}
	};

	/**
	 * @Description: Function to push event information of verify phone flow on success
	 */
	var onSuccessVerifyPhoneFlow = function() {
		try {
			var thdAnalyticsEvent = {
				category: {
					primaryCategory: "button submission"
				},
				eventInfo: {
					eventName: "phone verification success"
				}
			};
			pushEventInfo(thdAnalyticsEvent);
		}
		catch (error) {
			//Suppress the error, so that functionality is not broken
			console.warn('DDO: Error in pushing the verify phone button event info');
		}
	};

	var onClickVerifyPhoneShowModal = function(origin, page, otpChannel) {
		try {
			var eventName = "verify your phone number - code entry - ";
			if (otpChannel === "sms") eventName = eventName + "text";
			if (otpChannel === "phone") eventName = eventName + "phone call";
			if (otpChannel === "email") eventName = eventName + "email";

			var thdAnalyticsEvent = {
				category: {
					primaryCategory: "overlay"
				},
				eventInfo: {
					eventName: eventName
				},
				myAccount: {
					settings: page + ": send verification code - " + origin
				}
			};
			pushEventInfo(thdAnalyticsEvent)
		}
		catch (error) {
			//Suppress the error, so that functionality is not broken
			console.warn('DDO: Error in pushing the verify phone flow to trigger');
		}
	};

	var onClickVerifyPhoneResend = function() {
		try {
			var thdAnalyticsEvent = {
				category: {
					primaryCategory: "button submission"
				},
				eventInfo: {
					eventName: "my account settings"
				},
				myAccount: {
					settings: "verify your phone number - resend code"
				}
			};
			pushEventInfo(thdAnalyticsEvent)
		}
		catch (error) {
			//Suppress the error, so that functionality is not broken
			console.warn('DDO: Error in pushing the verify phone resend code event');
		}
	};

	/**
	 * @Description: Function to push event information of sending a code on the verify identity modal
	 */
	var onClickVerifyIdentity = function() {
		try {
			var thdAnalyticsEvent = {
				category: {
					primaryCategory: "button submission"
				},
				eventInfo: {
					eventName: "my account settings"
				},
				myAccount: {
					settings: "verify your phone number - send code"
				}
			};
			pushEventInfo(thdAnalyticsEvent)
		}
		catch (error) {
			//Suppress the error, so that functionality is not broken
			console.warn('DDO: Error in pushing the verify phone send code event');
		}
	};


  /**
	 * @Description: Function to push event information of user initiating forgot password flow
   */
  var onClickForgotPassword = function() {
  	try {
      var thdAnalyticsEvent = {
      	category: { primaryCategory: "overlay" },
				eventInfo: { eventName: "reset password" }
			}
    }
		catch (exception) {
      //Suppress the error, so that functionality is not broken
      console.warn('DDO: Error in pushing the user initiating action for forgot password');
		}
		pushEventInfo(thdAnalyticsEvent);
	};

  /**
   * @Description: Function to push event information of chosen method for forgot password
   */
  var onSelectFlowMethodForgotPassword = function(flow, method) {
    try {
    	if (method === 'sms') method = 'text';
    	if (method === 'phone') method = 'phone call';
    	if (flow === 'set-password' || flow === 'reset-password') {
        	flow = 'reset password';
    	} else if (flow === 'otp') {
    		flow = 'otp verification';
    	}
      var thdAnalyticsEvent = {
        category: { primaryCategory: "overlay" },
        eventInfo: { eventName: flow + " code entry - " + method }
      }

    	if (flow === 'otp verification') {
    		thdAnalyticsEvent.myAccount = {
    			settings: "checkout sign-in: otp"
		    }
	    }
    }
    catch (exception) {
      //Suppress the error, so that functionality is not broken
      console.warn('DDO: Error in pushing the method for forgot password');
    }
    pushEventInfo(thdAnalyticsEvent);
  };

  /**
   * @Description: Function to push event information of chosen method for forgot password
   */
  var onLoadSetNewPasswordModal = function() {
    try {
      var thdAnalyticsEvent = {
        category: { primaryCategory: "overlay" },
        eventInfo: { eventName: "enter new password" }
      }
    }
    catch (exception) {
      //Suppress the error, so that functionality is not broken
      console.warn('DDO: Error in pushing the method for set password modal');
    }
    pushEventInfo(thdAnalyticsEvent);
  };

  /**
   * @Description: Function to push event information of entering email for reset password flow
   */
  var onLoadEnterEmailModal = function() {
  	try {
		var thdAnalyticsEvent = {
			category: { primaryCategory: "overlay" },
			eventInfo: { eventName: "reset password - enter your email" }
		}
	} catch (exception) {
		//Suppress the error, so that functionality is not broken
		console.warn('DDO: Error in pushing the method for enter meail modal');
	}
	  pushEventInfo(thdAnalyticsEvent);
  };

  /**
   * @Description: Function to push event information of chosen method for forgot password
   */
  var onSuccessForgotPasswordFlow = function() {
    try {
      var thdAnalyticsEvent = {
      	  category: { primaryCategory: "button submission" },
		  eventInfo: { eventName: "sign in success" },
		  eventMode: "stash"
      }
    }
    catch (exception) {
      //Suppress the error, so that functionality is not broken
      console.warn('DDO: Error in pushing the method for successfully signing in after forgot password flow');
    }
    pushEventInfo(thdAnalyticsEvent);
  };


	/**
	 * @Description: Function to push event information for a successful Sign-In
	 */
	var onSuccessSignInFlow = function() {
		try {
			var thdAnalyticsEvent = {
				category: { primaryCategory: "button submission" },
				eventInfo: { eventName: "sign in success" },
				eventMode: "stash"
			}
		}
		catch (exception) {
			//Suppress the error, so that functionality is not broken
			console.warn('DDO: Error in pushing the method for successfully signing in after otp signin flow');
		}
		pushEventInfo(thdAnalyticsEvent);
	};

	/**
	 * Helps to push the error event
	 *
	 * The parameter object should contain the following items
	 * errorType : string, - 'warning/error/info'
	 * displayType : string, - 'inline/page level'
	 * pageSection : string,  - 'add address of view all addresses' etc...
	 * errorMessage : string,  - Error message
	 * errorCode : string - Error code
	 *
	 * @Spec_Section : 4.3.1
	 *
	 */
	var setErrorEvent = function(params) {
		try {
			var thdAnalyticsEvent = {
				category: {
					primaryCategory: "error"
				},
				eventInfo: {
					eventName: "post page error",
					error: [{
						type: params.errorType,
						displayType: params.displayType,
						pageSection: params.pageSection,
						message: params.errorMessage,
						code: params.code ? params.code : "NA"
					}]
				}
			};
			pushEventInfo(thdAnalyticsEvent);
		}
		catch (err) {
			//Suppress the error, so that functionality is not broken
			console.warn('DDO: Error in pushing the error event info');
		}
	};

	return {
		onClickVerifyIdentity: onClickVerifyIdentity,
		openVerifyIdentityModal: openVerifyIdentityModal,
		openVerify2FAModal: openVerify2FAModal,
		onSuccessVerifyPhoneFlow: onSuccessVerifyPhoneFlow,
		onClickVerifyPhoneShowModal: onClickVerifyPhoneShowModal,
		onClickVerifyPhoneResend: onClickVerifyPhoneResend,
    onClickForgotPassword: onClickForgotPassword,
    onSelectFlowMethodForgotPassword: onSelectFlowMethodForgotPassword,
    onLoadSetNewPasswordModal: onLoadSetNewPasswordModal,
		onLoadEnterEmailModal: onLoadEnterEmailModal,
    onSuccessForgotPasswordFlow: onSuccessForgotPasswordFlow,
		onSuccessSignInFlow: onSuccessSignInFlow,
		setErrorEvent: setErrorEvent
	};
});
(function closure(root, factory) {
	if (typeof define === 'function' && define.amd) {
		define('verification.modal',[
			'jquery',
			'account.modal',
			'verification.helper',
			'verification.analytics',
			'account.utility',
		], function load(jQuery, modal, verificationHelper, verificationAnalytics, accountUtility) {
			return factory(root, jQuery, modal, verificationHelper, verificationAnalytics, accountUtility);
		})
	} else {
		factory(root, jQuery, modal, verificationHelper, verificationAnalytics, accountUtility);
	}
})(this, function factory(root, $, modal, verificationHelper, verificationAnalytics, accountUtility) {

	var generateVerificationTemplate = function (headerText, formattedInput, resendText, buttonText, cancelButtonText, body, footer) {
		window.$template = (
			$('<div></div>')
				.attr('id', 'verification-modal__content')
		);

		window.$header = (
			$('<header></header>')
				.attr('id', 'verification-overlay-header')
				.addClass('thd-overlay__header grid')
				.append(
					$('<div></div>')
						.addClass('col__10-12 correction')
						.append(
							$('<h2></h2>')
								.attr('id', 'verification-header__text')
								.addClass('u__husky thd-overlay__title')
								.text(headerText)
						),
					$('<div></div>')
						.addClass('col__2-12 u__text-align--right')
						.append(
							$('<button></button>')
								.addClass('thd-overlay__close--standAlone verification-svg-close')
								.html(
									'<svg class="" viewBox="0 0 32 32"><path d="M27.229' +
									' 8.391l-3.385-3.386-7.843 7.838-7.84-7.84-3.386 3.385 7.609 7.608-7.613 7.612 3.385 3.386' +
									' 7.843-7.838 7.84 7.841 3.387-3.386-7.61-7.608z"></path></svg>'
								)
						)
				)
		);

		window.$body = body ? body : (
			$('<div></div>')
				.attr('id', 'verification-overlay-body')
				.addClass('col__12-12')
				.append(
					$('<p></p>')
						.addClass('col__12-12')
						.html(formattedInput),
					$('<form></form>')
						.addClass('col__12-12 form-input')
						.attr('id', 'form-input-verification')
						.append(
							$('<label></label>')
								.addClass('form-input__label')
								.attr('for', 'verification-code')
								.attr('data-content', 'otp')
								.append(
									$('<span></span>')
										.addClass('form-input__label-content')
										.text('Verification Code')
								),
							$('<input/>')
								.addClass('form-input__field')
								.attr('id', 'verification-code')
								.attr('placeholder', 'Enter Code')
								.attr('type', 'text')
								.attr('maxlength', '6')
								.focus()
						),
					$('<span></span>')
						.addClass('col__12-12 resend__help-message')
						.text(resendText)
						.append(
							$('<a></a>')
								.addClass('resend-code-link u__default-link')
								.attr('id', 'resend-code')
								.text(' Resend Code'),
							$('<span></span>')
								.attr('id', 'resend-code-spinner')
								.css("visibility", "hidden")
								.addClass('segment-spinner segment-spinner--xsmall')
						),
					$('<span></span>').attr('id', 'resend__response-message').addClass('col__12-12')
				)
		);

		window.$footer = footer ? footer : (
			$('<footer></footer>')
				.addClass('verify-phone-footer')
				.addClass('grid')
				.append(
					$('<div></div>')
						.addClass('col__12-12')
						.append(
							$('<button></button>')
								.attr('id', 'verification-code-submit')
								.addClass('bttn bttn--primary disabled')
								.append(
									$('<span></span>').addClass('bttn__content')
										.text(buttonText ? buttonText : 'Verify')
								),
							$('<button></button>')
								.addClass('bttn-outline bttn-outline--primary')
								.attr('id', 'verification-cancel')
								.append(
									$('<span></span>').addClass('bttn__content').text(cancelButtonText ? cancelButtonText : 'Cancel')
								)
						)
				)
		);

		window.$template.append(window.$header, window.$body, window.$footer);
		return window.$template;
	};

	var generateResetPasswordTemplate = function (options) {
		var headerText = options.headerText,
			bodyText = options.bodyText,
			bodyClass = options.bodyClass,
			buttonText = options.buttonText,
			bodyContent = options.bodyContent,
			id = options.id,
			headerId = options.headerId,
			isBodyTextMedium = options.isBodyTextMedium,
			hideBottomPadding = options.hideBottomPadding,
			bodyId = options.bodyId,
			footerId = options.footerId,
			footerTextId = options.footerTextId,
			buttonId = options.buttonId;

		var template = (
			$('<div></div>')
				.attr('id', (id ? id : 'reset-password__content'))
		);

		var header = (
			$('<header></header>')
				.attr('id', (headerId ? headerId : 'reset-password__header'))
				.addClass('col__12-12')
				.addClass('u__border--bottom')
				.append(
					$('<div></div>')
						.addClass('col__10-12 correction')
						.append(
							$('<h2></h2>')
								.attr('id', 'verification-header__text')
								.addClass('u__husky thd-overlay__title')
								.text(headerText)
						),
					$('<div></div>')
						.addClass('col__2-12 u__text-align--right')
						.append(
							$('<button></button>')
								.addClass('thd-overlay__close--standAlone verification-svg-close')
								.html(
									'<svg class="" viewBox="0 0 32 32"><path d="M27.229' +
									' 8.391l-3.385-3.386-7.843 7.838-7.84-7.84-3.386 3.385 7.609 7.608-7.613 7.612 3.385 3.386' +
									' 7.843-7.838 7.84 7.841 3.387-3.386-7.61-7.608z"></path></svg>'
								)
						)
				)
		);

		var body = (
			$('<div></div>')
				.attr('id', (bodyId ? bodyId : 'reset-password__body'))
				.addClass('col__12-12')
				.addClass((bodyClass ? bodyClass : 'body__p-top-large body__p-bottom-large'))
				.append(
					bodyText && $('<p></p>').addClass('u__bold col__12-12' + (isBodyTextMedium ? ' u__medium' : '') + (hideBottomPadding ? ' body__p-bottom-none' : '')).text(bodyText),
					$('<p></p>')
						.addClass('col__12-12 verification__check-spam')
						.css({'display': 'none'}),
					bodyContent
				)
		);

		var footer = (
			$('<footer></footer>')
				.attr('id', (footerId ? footerId : 'reset-password__footer'))
				.addClass('col__12-12')
				.addClass('u__border--top')
				.append(
					$('<p></p>')
						.attr('id', (footerTextId ? footerTextId : 'reset-password__footer-text'))
						.addClass('col__8-12'),
					$('<div></div>')
						.addClass('col__4-12')
						.append(
							$('<button></button>')
								.attr('id', (buttonId ? buttonId : 'reset-password__submit'))
								.addClass('bttn bttn--primary')
								.append(
									$('<span></span>').addClass('bttn__content')
										.text(buttonText ? buttonText : 'Verify')
								)
						)
				)
		);

		template.append(header, body, footer);
		return template;
	};

	/* otpmedium is used for analytics to track if user selected phone or text to send OTP to.
		 This is mainly used for phone verification, 2FA Opt In overlays and registration.
		 evoiceSwitch is received from verification.service.js to show or hide the radio options on Verify your Identity modal.*/

	var renderTemplateModal = function (title, input, isMobile, temp, cancelCallback, cancelButtonText, otpMedium, evoiceSwitch) {
		var headerText, formattedInput, resendText, buttonText;
		buttonText = null;
		resendText = "Didn't receive your code?";
		if (title === 'verifyPhone') {
			headerText = 'Verify Your Phone Number';
			formattedInput = '<span>' +
				"We've sent you a verification code to " +
				verificationHelper.formatPhone(input) + '.' +
				'<br>' +
				'Please enter your verification code below.' +
				'</span>';
		} else if (title === "verify2FactorEmail") {
			headerText = 'Verify Your Identity';
			resendText = "It may take a minute to send your code. " + resendText;
			formattedInput = "For your security, please enter the verification code sent to your email at " +
				input + '.';
		} else if (title === 'verify2FactorText') {
			headerText = 'Verify Your Identity';
			resendText = "It may take a minute to send your code. " + resendText;
			formattedInput = "Please enter the verification code sent to your mobile device at " +
				verificationHelper.maskPhone(input) + '.';
		} else if (title === 'registrationVerifyIdentity') {
			headerText = 'Verify Your Identity';
			buttonText = 'Send Code';
			var verificationImg = "<svg class='u__center' width=\"68px\" height=\"110px\" viewBox=\"0 0 68 110\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n" +
				"    <title>Group</title>\n" +
				"    <desc>Created with Sketch.</desc>\n" +
				"    <defs></defs>\n" +
				"    <g id=\"Page-1\" stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n" +
				"        <g id=\"Register---Phone-Field-Copy-69\" transform=\"translate(-680.000000, -225.000000)\">\n" +
				"            <g id=\"Group\" transform=\"translate(681.000000, 226.000000)\">\n" +
				"                <path d=\"M0.0684034347,108.450533 L65.9315966,108.450533 L65.9315966,0 L0.0684034347,0 L0.0684034347,108.450533 Z M2.24887051,106.270066 L63.752116,106.270066 L63.752116,2.18046708 L2.24887051,2.18046708 L2.24887051,106.270066 Z M7.15138652,81.0238679 L58.8486135,81.0238679 L58.8486135,6.87154585 L7.15138652,6.87154585 L7.15138652,81.0238679 Z M9.33201801,78.8432364 L56.6681464,78.8432364 L56.6681464,9.05086202 L9.33201801,9.05086202 L9.33201801,78.8432364 Z M26.4290041,100.264328 L39.9394491,100.264328 L39.9394491,87.0884667 L26.4290041,87.0884667 L26.4290041,100.264328 Z M28.6096356,98.0836963 L37.7601329,98.0836963 L37.7601329,89.2689338 L28.6096356,89.2689338 L28.6096356,98.0836963 Z\" id=\"Fill-1\" stroke=\"#F16222\" fill=\"#F16222\"></path>\n" +
				"                <g id=\"Group-2\" transform=\"translate(15.000000, 31.000000)\">\n" +
				"                    <g id=\"Group-4\" stroke=\"#F16724\" stroke-width=\"2.5\">\n" +
				"                        <polygon id=\"Stroke-1\" points=\"0 22.5469729 3.30547381 22.5469729 3.30547381 30 11.6327251 22.5469729 36 22.5469729 36 0 0 0\"></polygon>\n" +
				"                    </g>\n" +
				"                    <g id=\"Form_Icons/Check\" transform=\"translate(12.000000, 5.526316)\" fill=\"#F96302\">\n" +
				"                        <polyline id=\"Imported-Layers-Copy-5\" points=\"-1.77635684e-15 5.69431232 2.18740202 3.31850258 5.22102626 6.4862489 11.3248162 0 13.6 2.3756663 5.25729293 11.2 -1.77635684e-15 5.69431232\"></polyline>\n" +
				"                    </g>\n" +
				"                </g>\n" +
				"            </g>\n" +
				"        </g>\n" +
				"    </g>\n" +
				"</svg>";

			formattedInput = verificationImg + "<div class='u__bold body__m-top--small body__m-bottom--xsmall'>Looks like the phone number you provided is already in use.</div>";
			formattedInput += "<div>For your security, we'll need to verify your identity. We'll send you a code to the following mobile number:</div>" +
				"<div class='body__m-top--small body__m-bottom--small'>" + verificationHelper.maskPhone(input) + "</div>";

			var evoiceHTML = "<div class='body__m-top-small'>How should we send the verification code?</div>" +
				"<div class='grid'>" +
				"<div class='radio-btn__content-wrapper col__1-3 body__p-right-none'>" +
				"<input class='radio-btn__input' name='selectPhoneOTPMedium' type='radio' value='sms' id='verify_by_text' checked>" +
				"<label class='radio-btn__label' for='verify_by_text' tabindex='0'>" +
				"<span class='radio-btn'></span>" +
				"Text" +
				" </label>" +
				"</div> " +
				"<div class='radio-btn__content-wrapper col__2-3 body__p-left-none'>" +
				"<input class='radio-btn__input' name='selectPhoneOTPMedium' type='radio' value='phone' id='verify_by_call'>" +
				"<label class='radio-btn__label' for='verify_by_call' tabindex='0'>" +
				"<span class='radio-btn'></span>" +
				"Phone Call" +
				"</label>" +
				"</div> " +
				"</div>";
			// if feature switch for evoice in registration is ON, then append that HTML in the modal.
			if (evoiceSwitch) {
				formattedInput = formattedInput + evoiceHTML;
			}
			//"<a id='skipVerify' class='u__default-link'>Skip For Now and Create My Account</a>"
		} else {
			headerText = 'Verify Your Email';
			formattedInput = '<span>' +
				"We've sent you a verification code to " +
				input + '.' +
				'<br>' +
				'Please enter your verification code below.' +
				'</span>';
		}

		var template = temp || generateVerificationTemplate(headerText, formattedInput, resendText, buttonText, cancelButtonText);

		showVerificationModal(template, isMobile, cancelCallback);

		// slightly different css properties for mobile web view
		if (isMobile) {
			$("#verification-header__text").removeClass("u__husky").css('font-size', '2');
			$("#verification-overlay-body").find("br").replaceWith(" ").css("padding", "15px 10px");
			$(".verify-phone-footer").find("div").css("padding", "20px");
			$('#verification-overlay-body').addClass('body__p-sides-small').addClass('body__p-updown-large')
		} else {
			$('#verification-overlay-body').addClass('body__p-sides-medium').addClass('body__p-updown-large');
		}

		if (title === 'verify2FactorEmail') {
			verificationAnalytics.openVerify2FAModal('email');
		} else if (title === 'verify2FactorText') {
			verificationAnalytics.openVerify2FAModal('text');
		} else if (title === 'registrationVerifyIdentity') {
			verificationAnalytics.openVerifyIdentityModal();
		}

		verifyCodeHandler();
	};

	var verifyCodeHandler = function () {
		$('#verification-code')
			.keydown(function (e) {
				// Allow: backspace, delete, tab, escape, enter and .
				if ($.inArray(e.keyCode, [46, 8, 9, 27, 110, 190]) !== -1 ||
					// Allow: Ctrl/cmd+A
					(e.keyCode === 65 && (e.ctrlKey === true || e.metaKey === true)) ||
					// Allow: Ctrl/cmd+C
					(e.keyCode === 67 && (e.ctrlKey === true || e.metaKey === true)) ||
					// Allow: Ctrl/cmd+X
					(e.keyCode === 88 && (e.ctrlKey === true || e.metaKey === true)) ||
					// Allow: Ctrl/cmd+V
					(e.keyCode === 86 && (e.ctrlKey === true || e.metaKey === true)) ||
					// Allow: home, end, left, right
					(e.keyCode >= 35 && e.keyCode <= 39)) {
					// let it happen, don't do anything
					return;
				}
				// Ensure that it is a number and stop the keypress
				if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
					e.preventDefault();
				}
			})
			.focus(function () {
				this.removeAttribute('placeholder');
			})
			.focusout(function () {
				this.placeholder = 'Enter Code';
			});
	};

	var renderResetPasswordTemplateModal = function (phase, isMobile, inputs) {
		var options = {};
		var body = null;
		if (phase === 'emailInputModal') {
			body = (
				$('<form></form>')
					.addClass('form-input col__12-12')
					.attr('id', 'form-input__email')
					.append(
						$('<label></label>')
							.addClass('form-input__label')
							.attr('for', 'validate__email-address')
							.attr('data-content', 'otp')
							.append(
								$('<span></span>')
									.addClass('form-input__label-content')
									.text('Email Address')
							),
						$('<input/>')
							.addClass('form-input__field')
							.attr('id', 'validate__email-address')
							.attr('placeholder', 'Enter Email Address')
							.attr('value', inputs.emailId)
							.attr('disabled', inputs.disabled)
							.attr('tabindex', '1')
							.focus()
					)
			);

			options = {
				headerText: 'Forgot Password',
				bodyText: 'First we need to know your email address.',
				buttonText: 'Continue',
				bodyContent: body
			};
		} else if (phase === 'emailInputOTPModal') {
			body = (
				$('<form></form>')
					.addClass('form-input col__12-12')
					.attr('id', 'form-input__email')
					.append(
						$('<label></label>')
							.addClass('form-input__label')
							.attr('for', 'validate__email-address')
							.attr('data-content', 'otp')
							.append(
								$('<span></span>')
									.addClass('form-input__label-content')
									.text('Email Address')
							),
						$('<input/>')
							.addClass('form-input__field')
							.attr('id', 'validate__email-address')
							.attr('placeholder', 'Enter Email Address')
							.attr('value', inputs.emailId)
							.attr('tabindex', '1')
							.focus()
					)
			);

			options = {
				headerText: 'Sign in with a One-Time-Code',
				bodyText: 'First we need to know your email address.',
				isBodyTextMedium: true,
				buttonText: 'Continue',
				bodyContent: body,
				bodyClass: 'body__p-bottom-large',
				buttonId: 'otp-signin__submit',
				footerTextId: 'otp-signin__footer-text',
				footerId: 'otp-signin__footer',
				bodyId: 'otp-signin__body',
				headerId: 'otp-signin__header',
				id: 'otp-signin'
			};
		} else if (phase === 'selectOTPSigninFlowMethodModal') {
			var bodyText = 'How would you like for us to send your One-Time-Code?';
			if (inputs.isPhoneVerified && inputs.is2FAOptIn && inputs.phoneNumber) {
					body = (
						$('<div></div>')
							.addClass('col__12-12')
							.append(
								$('<div></div>')
									.append(
										$('<div></div>').addClass('body__p-top--small body__p-sides-none body__p-horizontal--none body__p-bottom--none').append(
											"We'll text a verification code to&nbsp;",
											$('<span></span>').addClass('u__bold').append(inputs.phoneNumber, '&nbsp;'),
											"for you to enter shortly."
										)
									)
							)
					);
					bodyText = '';
			} else if (inputs.isPhoneVerified && inputs.phoneNumber) {
				body = (
					$('<div></div>')
						.addClass('col__12-12')
						.append(
							$('<div></div>')
								.attr('id', 'password__top-radio-buttons')
								.append(
									$('<div></div>')
										.addClass('radio-btn__content-wrapper')
										.addClass('u--paddingBottom')
										.append(
											$('<input>')
												.addClass('radio-btn__input')
												.attr('id', 'otp-text__radio-btn')
												.attr('type', 'radio')
												.attr('name', 'otp-signin')
												.attr('value', 'sms'),
											$('<label></label>')
												.addClass('radio-btn__label')
												.attr('for', 'otp-text__radio-btn')
												.append(
													$('<span></span>').addClass('radio-btn'),
													'Text:&nbsp;',
													$('<p/>').addClass('u__bold').append(verificationHelper.maskPhone(inputs.phoneNumber))
												)
										),
									$('<div></div>')
										.addClass('radio-btn__content-wrapper')
										.append(
											$('<input>')
												.addClass('radio-btn__input')
												.attr('id', 'otp-email__radio-btn')
												.attr('type', 'radio')
												.attr('name', 'otp-signin')
												.attr('value', 'email'),
											$('<label></label>')
												.addClass('radio-btn__label')
												.attr('for', 'otp-email__radio-btn')
												.append(
													$('<span></span>').addClass('radio-btn'),
													'Email:&nbsp;',
													$('<p/>').addClass('u__bold').append(inputs.emailId)
												)
										)
								)
						)
				);
			} else {
				body = (
					$('<div></div>')
						.addClass('col__12-12')
						.append(
							$('<div></div>')
								.append(
									$('<div></div>').addClass('body__p-top--small body__p-sides-none body__p-horizontal--none body__p-bottom--none').append(
										"We'll email a verification code to&nbsp;",
										$('<span></span>').addClass('u__bold').append(inputs.emailId, '&nbsp;'),
										"for you to enter shortly."
									)
								)
						)
				);
				bodyText = '';
			}

			options = {
				headerText: 'Sign in with a One-Time-Code',
				bodyText: bodyText,
				isBodyTextMedium: false,
				buttonText: 'Send Code',
				bodyContent: body,
				buttonId: 'otp-signin__submit',
				footerTextId: 'otp-signin__footer-text',
				footerId: 'otp-signin__footer',
				bodyId: 'otp-signin__body',
				headerId: 'otp-signin__header',
				id: 'otp-signin'
			};
		} else if (phase === 'selectFlowMethodModal') {
			body = (
				$('<div></div>')
					.addClass('col__12-12')
					.append(
						$('<div></div>')
							.attr('id', 'password__top-radio-buttons')
							.append(
								$('<div></div>')
									.addClass('radio-btn__content-wrapper')
									.append(
										$('<input>')
											.addClass('radio-btn__input')
											.attr('id', 'reset-password__radio-btn')
											.attr('type', 'radio')
											.attr('name', 'reset-password__top')
											.attr('value', 'reset-password'),
										$('<label></label>')
											.addClass('radio-btn__label')
											.attr('for', 'reset-password__radio-btn')
											.append(
												$('<span></span>').addClass('radio-btn'),
												'Reset Password'
											)
									),
								$('<div></div>')
									.addClass('radio-btn__content-wrapper')
									.append(
										$('<input>')
											.addClass('radio-btn__input')
											.attr('id', 'otp__radio-btn')
											.attr('type', 'radio')
											.attr('name', 'reset-password__top')
											.attr('value', 'otp'),
										$('<label></label>')
											.addClass('radio-btn__label')
											.attr('for', 'otp__radio-btn')
											.append(
												$('<span></span>').addClass('radio-btn'),
												'Sign in without your password using a one-time code.'
											)
									)
							),
						$('<div></div>').attr('id', 'password__bottom-body')
					)
			);

			options = {
				headerText: 'Forgot Password',
				bodyText: 'What would you like to do?',
				buttonText: 'Please Select an Option',
				bodyContent: body
			};
		} else if (phase === 'validateOTPModal') {
			body = (
				$('<form></form>')
					.addClass('col__5-12 form-input')
					.attr('id', 'form-input-verification')
					.append(
						$('<label></label>')
							.addClass('form-input__label')
							.attr('for', 'verification-code')
							.attr('data-content', 'otp')
							.append(
								$('<span></span>')
									.addClass('form-input__label-content')
									.text('Verification Code')
							),
						$('<input/>')
							.addClass('form-input__field')
							.attr('id', 'verification-code')
							.attr('placeholder', 'Enter Code')
							.attr('type', 'text')
							.attr('maxlength', '6')
							.attr('tabindex', '1')
							.focus()
					)
			);
			var text = '';
			if (inputs.method === 'sms') {
				text = "Please enter the verification code we texted to " + verificationHelper.maskPhone(inputs.phoneNumber) + ".";
			} else if (inputs.method === 'email') {
				text = "Please enter the verification code we emailed to " + inputs.emailId + ".";
			} else if (inputs.method === 'phone') {
				text = "We're calling you with a verification code at " + verificationHelper.maskPhone(inputs.phoneNumber) + ". Please enter the verification code below."
			}

			options = {
				headerText: 'Verification Code Entry',
				bodyText: text,
				buttonText: "Verify",
				bodyContent: body
			};
		} else if (phase === 'validateOTPSignInModal') {
			body = (
				$('<form></form>')
					.addClass('col__5-12 form-input')
					.attr('id', 'form-input-verification')
					.append(
						$('<label></label>')
							.addClass('form-input__label')
							.attr('for', 'verification-code')
							.attr('data-content', 'otp')
							.append(
								$('<span></span>')
									.addClass('form-input__label-content')
									.text(inputs.label ? inputs.label : 'One-Time-Code')
							),
						$('<input/>')
							.addClass('form-input__field')
							.attr('id', 'verification-code')
							.attr('placeholder', 'Enter Code')
							.attr('type', 'text')
							.attr('maxlength', '6')
							.attr('tabindex', '1')
							.focus()
					)
			);
			var text = '';
			if (inputs.method === 'sms') {
				text = "Please enter the one-time code we texted to " + verificationHelper.maskPhone(inputs.phoneNumber) + ".";
			} else if (inputs.method === 'email') {
				text = "Please enter the verification code we emailed to " + inputs.emailId + ".";
			}

			/**
			 * This modal is used for the sign in flow via OTP or for the verify OTP flow for set password.
			 * The headerText default is for the former and headerText is set for the latter.
			 */
			options = {
				headerText: inputs.headerText ? inputs.headerText : 'Sign in with a One-Time-Code',
				bodyText: text,
				isBodyTextMedium: true,
				buttonText: "Verify",
				bodyClass: 'col__12-12 body__p-bottom-jumbo',
				bodyContent: body,
				buttonId: 'otp-signin__submit',
				footerTextId: 'otp-signin__footer-text',
				footerId: 'otp-signin__footer',
				bodyId: 'otp-signin__body',
				headerId: 'otp-signin__header',
				id: 'otp-signin'
			};
		} else if (phase === 'resetPasswordModal') {
			body = (
				$('<form></form>')
					.attr('id', 'reset-password__body__create-form')
					.addClass('col__12-12')
					.append(
						$('<p></p>').text("Passwords are case sensitive and must be at least 8 characters"),
						$('<p></p>').text("Create a strong password by:"),
						$('<ul></ul>').append(
							$('<li></li>').text("Including numbers or symbols"),
							$('<li></li>').text("Mixing upper/lowercase"),
							$('<li></li>').text('Avoiding simple phrases like "password", "password123" or your email address')
						),
						$('<div></div>')
							.attr('id', 'reset-password__form-input')
							.addClass("form-input")
							.append(
								$('<label></label>').addClass('u__text--alternate form-input__show-password').text('Show'),
								$('<label></label>').addClass('form-input__label').attr('for', 'reset-password__pw-input').append(
									$('<span></span>').addClass('form-input__label-content').text('New Password')
								),
								$('<input/>')
									.addClass('form-input__field')
									.attr('id', 'reset-password__pw-input')
									.attr('type', 'password')
									.attr('tabindex', '1')
									.attr('maxlength', '30')
									.attr('min-length', '8')
								,
								$('<span></span>').addClass('form-input-error__message')
							)
					)
			);

			options = {
				headerText: "Reset Your Password",
				bodyText: "Create a new password.",
				buttonText: "Submit",
				bodyContent: body
			};
		} else if (phase === 'setPasswordModal') { // set password flow
			// TODO if otp then we need to set the body text prior to this call.
			body = (
				$('<div></div>').addClass('bottom__notify body__p-top--small col__12-12 body__p-horizontal--none body__p-bottom--none').append(
					"We'll email a verification code to&nbsp;",
					$('<span></span>').addClass('u__bold').append(inputs.emailId, '&nbsp;'),
					"for you to enter shortly."
				)
			);

			options = {
				headerText: 'Set Your Password',
				bodyText: "Looks like you haven't set a password yet. Before we set your password, we need to verify your" +
				" email address.",
				hideBottomPadding: inputs.hideBottomPadding,
				bodyClass: inputs.bodyClass,
				isBodyTextMedium: true,
				buttonText: "Send Code",
				bodyContent: body
			};
		}

		$('.account-modal__container').remove();
		var template = generateResetPasswordTemplate(options);
		showVerificationModal(template, isMobile, null, {width: "700px"});
		// change bottom button position for mobile web view
		if (isMobile) {
			$('#reset-password__footer').css({position: 'absolute', bottom: '40px', display: 'flex', 'flex-direction': 'column-reverse'});
			$('#reset-password__submit').parent().removeAttr('class').addClass('col__12-12');
			$('#reset-password__footer-text').removeAttr('class').addClass('col__12-12');
		}
	};

	var showVerificationModal = function ($content, isMobile, cancelCallback, options) {
		var defaultOptions = {
			"width": "400px",
			"background": "white",
			"max-height": "calc(100% - 100px)",
			"position": "fixed",
			"top": "50%",
			"left": "50%",
			"transform": "translate(-50%, -50%)"
		};
		var mobileOptions = {
			'width': "100vw",
			'height': "100vh",
			'max-height': 'none',
			'margin': '0px',
			'z-index': '100'
		};

		var modalOptions = isMobile ? $.extend({}, defaultOptions, mobileOptions) : $.extend({}, defaultOptions, options);

		$content.css(modalOptions);

		var documentHeight = $(document).height() + 'px';

		var $modalOverlay = $('<div />').addClass('account-modal__overlay').css('height', documentHeight);

		// var $newSpinner = $('<div></div>').attr('id', 'myAccount__spinner').append(
		//   '<svg enable-background="new 0 0 300 300" version="1.1" viewBox="0 0 300 300" xml:space="preserve" xmlns="http://www.w3.org/2000/svg">\n' +
		//   '<style type="text/css">\n' +
		//   '\t.st0{fill:none;stroke:#F06523;stroke-width:5;stroke-miterlimit:10;}\n' +
		//   '\t.st1{fill:none;stroke:#F26422;stroke-width:4;stroke-linejoin:round;stroke-miterlimit:10;}\n' +
		//   '\t.st2{fill:none;stroke:#F26422;stroke-width:4;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}\n' +
		//   '</style>\n' +
		//   '\t<rect class="st0 manifest-notebook" x="95.7" y="112.7" width="108.7" height="74.7"/>\n' +
		//   '\t<line class="st0 manifest-notebook" x1="151.3" x2="151.3" y1="112.7" y2="187.3"/>\n' +
		//   '\t<line class="st0 line1" x1="161" x2="196.3" y1="127" y2="127"/>\n' +
		//   '\t<line class="st0 line2" x1="161" x2="196.3" y1="141.7" y2="141.7"/>\n' +
		//   '\t<line class="st0 line3" x1="161" x2="196.3" y1="156.5" y2="156.5"/>\n' +
		//   '\t\t\t<circle class="st1 shrink-user" cx="123.9" cy="137.8" r="9.8"/>\n' +
		//   '\t\t\t<path class="st1 shrink-user" d="m107 164.5c0-9.3 7.5-16.8 16.8-16.8s16.8 7.5 16.8 16.8"/>\n' +
		//   '\t\t\t<path class="st2 shrink-user" d="m140.6 164.4c-9.3 8.8-24.2 8.9-33.6 0.2"/>\n' +
		//   '</svg>'
		// ).hide();

		var $loaderDiv = $('<div />').addClass('pre-loader').hide();
		$loaderDiv.append($('<div/>').addClass('segment-spinner'));
		var $loaderBackground = $('<div />').addClass('background-overlay').hide();

		var $modalContainer = $('<div />').addClass('account-modal__container')
			.html($modalOverlay)
			.append(
				$content.append($loaderDiv, $loaderBackground)
			);

		$('body').append($modalContainer);
		// isMobile ? $('myaccount-app').empty().append($modalContainer): $('body').append($modalContainer);

		$('.thd-overlay__close--standAlone').on('click', function (event) {
			if (cancelCallback) {
				cancelCallback()
			} else {
				event.preventDefault();
				$('.account-modal__container').remove();
			}
		});

		$('#verification-cancel').on('click', function (event) {
			event.preventDefault();
			if (cancelCallback) {
				cancelCallback()
			} else {
				event.preventDefault();
				$('.account-modal__container').remove();
			}
		});

		$('#verification-code').on('input', function (event) {
			var $verificationButton = $('#verification-code-submit');

			$('#form-input-verification').removeClass("form-input--error");
			$("span.form-input-error__message").remove();

			$(this).val().length === 6 ?
				$verificationButton.removeClass('disabled') :
				$verificationButton.addClass('disabled');
		});
	};

	var setOnSubmitListener = function (onClick, button, inputField) {
		var $verificationButton = button;
		$verificationButton && $verificationButton.off('click').on('click', function click() {
			if ($verificationButton.hasClass('disabled')) return false;

			showLoader();
			$verificationButton.addClass('disabled');
			$verificationButton
				.find('.bttn__content')
				.text("")
				.append(
					$('<span></span>').addClass('segment-spinner segment-spinner--bttn')
				);

			onClick();
		});


		inputField && inputField.keydown(function (e) {
			if ($verificationButton.hasClass('disabled')) return;

			if (e.keyCode === 13) {
				if ($verificationButton.hasClass('disabled')) return false;

				showLoader();
				$verificationButton.addClass('disabled');
				$verificationButton
					.find('.bttn__content')
					.text("")
					.append(
						$('<span></span>').addClass('segment-spinner segment-spinner--bttn')
					);

				onClick();
				return false;
			}
		});
	};

	var setResendCodeListener = function (ajax, analytics) {
		var $verificationButton = $('#verification-code-submit');
		$('#resend-code').off().on("click", function (event) {
			event.stopPropagation();
			(typeof analytics === 'function') && analytics();
			!$verificationButton.hasClass('disabled') && $verificationButton.addClass('disabled');

			ajax();
		});
	};

	var showLoader = function () {
		$('.account-modal__container .pre-loader').show();
		$('.account-modal__container .background-overlay').show();
	};

	var hideLoader = function () {
		$('.account-modal__container .pre-loader').hide();
		$('.account-modal__container .background-overlay').hide();
	};

	return {
		renderTemplateModal: renderTemplateModal,
		renderResetPasswordTemplateModal: renderResetPasswordTemplateModal,
		setOnSubmitListener: setOnSubmitListener,
		setResendCodeListener: setResendCodeListener,
		verifyCodeHandler: verifyCodeHandler,
		hideModal: function () {
			modal.hideModal();
		},
		showLoader: showLoader,
		hideLoader: hideLoader
	}
});
(function closure(root, factory) {
  if (typeof define === 'function' && define.amd) {
    define('verification.utility',[
      'jquery',
      'account.utility',
      'verification.constants',
      'verification.helper',
      'auth.constants'
    ], function load(jQuery, accountUtility, Constants, verifyPhoneHelper, accountConstants) {
      return factory(root, jQuery, accountUtility, Constants, verifyPhoneHelper, accountConstants);
    })
  } else {
    factory(root, jQuery, accountUtility, Constants, verifyPhoneHelper, accountConstants);
  }
})(this, function factory(root, $, accountUtility, Constants, verifyPhoneHelper, accountConstants) {
  var getVerifyPhoneOTP = function(phoneNumber, svocId, emailId, channelId, authorizationToken,otpChannel) {
    return accountUtility.triggerAJAXCall({
      url: Constants.URLS.VERIFY_PHONE_URL + svocId + '/getPhoneOTP?emailId=' + emailId + '&phoneNumber=' + phoneNumber + '&otpChannel=' + otpChannel,
      type: 'GET',
      headers: verifyPhoneHelper.generateHeaders(channelId),
      beforeSend: function(xhr) {
        xhr.setRequestHeader('Authorization', authorizationToken);
      },
			crossDomain : true,
			xhrFields: {
				withCredentials: true
			}
    })
  };

  var validateVerifyPhoneOTP = function(channelId, svocId, authorizationToken, verifyPhoneRequest) {
    return $.ajax({
      url: Constants.URLS.VERIFY_PHONE_URL + svocId + '/verifyPhoneOTP',
      type: 'POST',
      headers: verifyPhoneHelper.generateHeaders(channelId),
      beforeSend: function(xhr) {
        xhr.setRequestHeader('Authorization', authorizationToken);
      },
      xhrFields: {withCredentials: true},
      data: JSON.stringify(verifyPhoneRequest),
      dataType: 'json',
      contentType: 'application/json'
    });
  };

  var validateOTP = function(request, hmac, channelId) {
    var options = {
      'Cust-Acct-Client-Token': hmac.env,
      'Cust-Acct-Client-Timestamp': hmac.envTS,
      'Cust-Acct-Client-ID': hmac.envID,
      'Cust-Acct-Client-Delay-Token-Validation': "100000"
    };

    return $.ajax({
      url: accountConstants.URLS.VERIFY_OTP_PATH,
      headers: verifyPhoneHelper.generateHeaders(channelId, options),
      type: 'POST',
      data: JSON.stringify(request),
      crossDomain: true,
      xhrFields: {
        withCredentials: true
      }
    })
  };

  //Method to request OTP Code for resend feature
  var requestEmailOTP = function(emailId, channelId, hmac) {
    accountUtility.showLoader();

    var options = {
      'Cust-Acct-Client-Token': hmac.env,
      'Cust-Acct-Client-Timestamp': hmac.envTS,
      'Cust-Acct-Client-ID': hmac.envID,
      'Cust-Acct-Client-Delay-Token-Validation': "100000"
    };

    return $.ajax({
      url: accountConstants.URLS.REQUEST_OTP_PATH + emailId,
      headers: verifyPhoneHelper.generateHeaders(channelId, options),
      type: 'GET',
      crossDomain: true,
      xhrFields: {
        withCredentials: true
      }
    });
  };

  var mockAPICall = function(options) {
    var that = {
      done: function done(cb) {
        options.success && setTimeout(cb, options.timeout, options.resp);
        return that;
      },
      fail: function fail(cb) {
        !options.success && setTimeout(cb, options.timeout, options.resp);
        return that;
      }
    };
    return that;
  };

  var initiateResetPasswordFlow = function(req, emailId, hmac) {
    // success
    // return mockAPICall({
    //   success: true,
    //   timeout: 800,
    //   resp: {
    //     phoneNumber: "--544",
    //     isVerified: true,
    //     isEnabled: true
    //   }
    // });

    // failure
    // return mockAPICall({
    //   success: false,
    //   timeout: 800,
    //   resp: {
    //     errorText: 'Invalid Email',
    //     errorCode: "UREG_ERR_159"
    //   }
    // });

    // actual
    return createAPICall('checkCustomerPhoneStatus', 'GET', req, { emailId: emailId }, hmac);
  };

  var getVerifyResetPasswordOTP = function(req, inputs, hmac) {

	  // return mockAPICall({
		 //  success: true,
		 //  timeout: 800,
		 //  resp: {
			//   authId: "--544",
			//   otherId: false,
			//   thirdId: false
		 //  }
	  // });
	  // return mockAPICall({
     //        success: false,
     //        timeout: 3000,
     //        resp: {
     //          otp: '123456',
     //          errorCode: "AUTH_ERR_125"
     //        }
     //      });
    var data = {
      email: inputs.emailId,
      custId: inputs.hasOwnProperty('custId') ? inputs.custId : null,
      otpChannel: inputs.method,
      origin: inputs.origin
    };

    if (inputs.flow === 'set-password') {
      return createAPICall('setPasswordOTPEmail', 'GET', req, data, hmac);
    } else {
      return createAPICall('resetPasswordOTPEmail', 'GET', req, data, hmac);
    }

  };

  // WIP
  var requestSetPassword = function (req, hmac) {
    if (!req.password.length >= 8) {
      return mockAPICall({
        success: false,
        timeout: 100,
        resp: {
          error: 'Invalid password.'
        }
      });
    }

    var data = {
      "identity": {
        "logonId": req.emailId,
        "newPassword": req.password
      }
    };

    return createAPICall(req.svocId + '/profile/identity', 'PUT', req, data, hmac);
  };

  var createAPICall = function(url, type, req, data, hmac) {

    var isHMACActive = (hmac && hmac.env !== '') ? "true" : (
      $('#hat_env_active').length ? $('#hat_env_active').val() : ($("input[name=hat_env_active]").length ? "true" : "false")
    );
    var options = {};
    if (isHMACActive === "true") {
      if (hmac) {
        options = {
          'Cust-Acct-Client-Token': hmac.env,
          'Cust-Acct-Client-Timestamp': hmac.envTS,
          'Cust-Acct-Client-ID': hmac.envID,
          'Cust-Acct-Client-Delay-Token-Validation': hmac.delay || "100000"
        }
      } else {
        options = {
          'Cust-Acct-Client-Token': $('#hat_env').length ? $('#hat_env').val() : ($("input[name=hat_env]").length ? $("input[name=hat_env]").val() : ''),
          'Cust-Acct-Client-Timestamp': $('#hat_env_ts').length ? $('#hat_env_ts').val() : ($("input[name=hat_env_ts]").length ? $("input[name=hat_env_ts]").val() : ''),
          'Cust-Acct-Client-ID': $('#hat_env_id').length ? $('#hat_env_id').val() : ($("input[name=hat_env_id]").length ? $("input[name=hat_env_id]").val() : ''),
          'Cust-Acct-Client-Delay-Token-Validation': "100000"
        };
      }
    }
    if(url === 'resetPasswordOTPEmail'){
      options['Session-Id'] = window.tmxprofilesessionid;
    }
    var channelId = req.isMobile ? '2' : '1';
    var queryString = '';
    if (type === 'GET' && data) {
      for (var key in data) {
        switch (key) {
          case 'emailId':
          case 'email': {
            if (data[key] !== null) queryString = "email=" + data[key];
            break;
          }
          case 'custId': {
            if (data[key] !== null) queryString += "&custId=" + data[key];
            break;
          }
          case 'otpChannel': {
            if (data[key] !== null) queryString += "&otpChannel=" + data['otpChannel'];
            break;
          }
          case 'origin': {
            if (data[key] !== null) queryString += "&origin=" + data['origin'];
            break;
          }
        }
      }
    } else {
      data = JSON.stringify(data);
    }
    return $.ajax({
      url: Constants.URLS.SET_PASSWORD_URL + url,
      headers: verifyPhoneHelper.generateHeaders(channelId, options),
	    crossDomain: true,
	    xhrFields: { 'withCredentials': true },
      type: type,
      data: queryString === '' ? data : queryString,
      beforeSend: function(xhr) {
        xhr.setRequestHeader('Authorization', req.authId);
      }
    });
  };

  return {
    getVerifyEmailOTP: requestEmailOTP,
    getVerifyPhoneOTP: getVerifyPhoneOTP,
    validateVerifyPhoneOTP: validateVerifyPhoneOTP,
    validateOTP: validateOTP,
    setNewPassword: requestSetPassword,

    // mock API methods
    initiateResetPasswordFlow: initiateResetPasswordFlow,
    getVerifyResetPasswordOTP: getVerifyResetPasswordOTP
  }
});
(function closure(root, factory) {
  if (typeof define === 'function' && define.amd) {
    define('verification.service',[
      'jquery',
      'verification.modal',
      'cookie-utils',
      'verification.helper',
      'account.utility',
      'verification.utility',
      'verification.analytics',
      'verification.constants',
      'auth.constants',
      'auth.analytics',
      'auth.reg.validation'
    ], function load(jQuery, verificationModal, cookieUtils, verificationHelper, accountUtility, verificationUtil, verificationAnalytics, constants, authConstants, analytics, regValidation) {
      return factory(root, jQuery, verificationModal, cookieUtils, verificationHelper, accountUtility, verificationUtil, verificationAnalytics, constants, authConstants, analytics, regValidation);
    })
  } else {
    factory(root, jQuery, verificationModal, cookieUtils, verificationHelper, accountUtility, verificationUtil, verificationAnalytics, constants, authConstants, analytics, regValidation);
  }
})(this, function factory(root, $, verificationModal, cookieUtils, verificationHelper, accountUtility, verificationUtil, verificationAnalytics, CONSTANTS, authConstants, analytics, regValidation) {
  var phoneNumber = null,
    svocId = null,
    emailId = null,
    deviceId = null,
    requestId = null,
    channelId = null,
    authorizationToken = null,
    otpResponse = null,
    isMobile = false,
    page = null,
    profileResp = {},
    authID = '',
    backendHost = '',
    customerID = '',
    twoFactorSuccessCallback = null,
    $bannerPhoneInput = null,
    $resendResponseMessage = null,
    $verificationInput = null,
    $verifyOTP = '',
    $verificationButton = null,
    $verifyOTPInputField = null,
    proBusinessName = false,
    twoFAOptIn = {},
    cancelVerificationCallback = null,
    successVerificationCallback = null,
    cancelButtonText = null,
    otpChannel = '',
    signinEvoiceSwitch = false,
    whichFlow = '',
    hmac = {};

  var bindPhoneVerificationFlow = function () {
    /**
     * Description: Called when user initiates the verification flow
     */
    $(document).on('triggerVerification', function (event) {
      var payload = event.detail || event.originalEvent.detail;
      cancelVerificationCallback = payload.cancelCallback || null;
      successVerificationCallback = payload.successCallback || null;
      cancelButtonText = payload.cancelButtonText || null;
      phoneNumber = payload.phoneNumber;
      otpChannel = payload.otpChannel || 'sms';
      svocId = payload.svocId || cookieUtils.getSVOCID();
      emailId = payload.emailId;
      isMobile = payload.isMobile;
      whichFlow = payload.whichFlow || '';
      channelId = isMobile ? '2' : '1';
      authorizationToken = accountUtility.getAuthorizationToken();
      profileResp = payload.profilePhone || {};
      var isRegistration = payload.isRegistration || false;
      hmac = verificationHelper.getHMAC();

      twoFAOptIn = payload.twoFAOptIn || {};
      var zipCode = payload.zipCode || '';
      proBusinessName = payload.businessName || '';

      page = window.location.pathname.indexOf('profile') !== "-1" ? 'profile' : 'confirmation';
      verificationAnalytics.onClickVerifyPhoneShowModal(payload.origin, page, otpChannel);
      var startTime = new Date();
      verificationUtil.getVerifyPhoneOTP(phoneNumber, svocId, emailId, channelId, authorizationToken, otpChannel)
        .done(function (response, statusText, xhr) {
          $('.account-modal__container').remove(); // remove any pre-existing modals
          var loggingUrl = CONSTANTS.URLS.VERIFY_PHONE_URL + 'getPhoneOTP?emailId=' + emailId + '&phoneNumber=' + phoneNumber + '&otpChannel=' + otpChannel;
          var endTime = new Date();
          var jsonPayload = {};
          var loggingData = $.extend(true, {}, response);

          try {
            analytics.pushLoggingInfo(loggingUrl, jsonPayload, loggingData, xhr.status, "GET", startTime, endTime);
          } catch (e) {
            console.log(e);
          }
          otpResponse = response;
          verificationModal.renderTemplateModal('verifyPhone', phoneNumber, isMobile, null, cancelVerificationCallback, cancelButtonText, otpChannel);
          $bannerPhoneInput = $('#verify-phone-banner-input');
          $resendResponseMessage = $('#resend__response-message').css('display', 'none');
          $('.resend__help-message').remove();
          $verificationInput = $('#form-input-verification');
          $verificationButton = $('#verification-code-submit');
          $verifyOTP = $('#verification-code').val();

          verificationModal.setOnSubmitListener(onSubmitVerifyPhone, $verificationButton, $verificationInput);
          verificationModal.setResendCodeListener(onSubmitResendCode, verificationAnalytics.onClickVerifyPhoneResend);
          verificationHelper.onSuccessHideLoader();
        })
        .fail(function (error) {
          var loggingError = $.extend(true, {}, error);
          var loggingUrl = CONSTANTS.URLS.VERIFY_PHONE_URL + 'getPhoneOTP?emailId=' + emailId + '&phoneNumber=' + phoneNumber + '&otpChannel=' + otpChannel;
          var endTime = new Date();
          var jsonPayload = {};
          var errorCode = "";
          try {
            analytics.pushLoggingInfo(loggingUrl, jsonPayload, loggingError, loggingError.status, "POST", startTime, endTime);
          } catch (err) {
            console.log(err)
          }
          verificationHelper.onFailureHideLoader(error);
          // this implementation needs to be more elegant
          // instead of the naive approach, need to trigger angular validation from customer-ui
          if ($bannerPhoneInput) {
            $bannerPhoneInput.parent().addClass('form-input--error');
            $bannerPhoneInput.siblings()
                .addClass('form-input-error__message')
                .text(CONSTANTS.ERRORS.BANNER_INTERNAL_ERR);
          }
          /* This function is created to display error message in profile page in case a B2C user
             is trying to verify a phone number that already belongs to a Pro Customer.
          */
          try {
              if (whichFlow && (whichFlow === "personalPhoneVer" || whichFlow === "twoFAOtpIn" || whichFlow === "profileBanner")) {
                  errorCode = handleGetPhoneOTPErrorMessage(whichFlow, loggingError);
              }
              errorCode = errorCode !== "" ? errorCode : accountUtility.catchErrorCode(error);
              var analyticErrors = {
                  errorType: "error",
                  displayType: "inline",
                  pageSection: "verify phone",
                  errorMessage: errorCode === "UREG_ERR_224" ? CONSTANTS.ERRORS.PHONE_BELONGS_TO_PRO : CONSTANTS.ERRORS.BANNER_INTERNAL_ERR,
                  code: errorCode
              };

              verificationAnalytics.setErrorEvent(analyticErrors);
          }
          catch(e){
              console.log("Exception in displaying error and setting analytics",e);
          }

        });

      var onSubmitResendCode = function () {
        var startTime = new Date();
        verificationHelper.showResendSpinner();
        verificationUtil.getVerifyPhoneOTP(phoneNumber, svocId, emailId, channelId, authorizationToken)
          .done(function (data, statusText, xhr) {
            var loggingUrl = CONSTANTS.URLS.VERIFY_PHONE_URL + 'getPhoneOTP?emailId=' + emailId + '&phoneNumber=' + phoneNumber;
            var endTime = new Date();
            var jsonPayload = {};

            var loggingData = $.extend(true, {}, data);

            try {
              analytics.pushLoggingInfo(loggingUrl, jsonPayload, loggingData, xhr.status, "POST", startTime, endTime);
            } catch (err) {
              console.log(err)
            }
            otpResponse = data;
            verificationHelper.hideResendSpinner();
            verificationHelper.renderOnSuccessResendResponse($verificationButton, $verifyOTP);
          })
          .fail(function (error) {
            var loggingError = $.extend(true, {}, error);
            var loggingUrl = CONSTANTS.URLS.VERIFY_PHONE_URL + 'getPhoneOTP?emailId=' + emailId + '&phoneNumber=' + phoneNumber;
            var endTime = new Date();
            var jsonPayload = {};
            try {
              analytics.pushLoggingInfo(loggingUrl, jsonPayload, loggingError.responseJSON, loggingError.status, "POST", startTime, endTime);
            } catch (err) {
              console.log(err)
            }
            verificationHelper.hideResendSpinner();
            verificationHelper.renderOnFailureResendResponse($verificationButton, $verifyOTP);
          });
      };

      var onSubmitVerifyPhone = function () {
        $verifyOTP = $('#verification-code').val();
        var verifyPhoneRequest = verificationHelper.generateVerifyPhoneRequest(otpResponse, $verifyOTP, phoneNumber, emailId, profileResp, twoFAOptIn, proBusinessName, zipCode);
        var startTime = new Date();
        verificationUtil.validateVerifyPhoneOTP(channelId, svocId, authorizationToken, verifyPhoneRequest)
          .then(function (response, statusText, xhr) {
            var loggingUrl = CONSTANTS.URLS.VERIFY_PHONE_URL + 'verifyPhoneOTP';
            var endTime = new Date();

            var loggingData = $.extend(true, {}, response);
            var loggingPayload = $.extend(true, {}, verifyPhoneRequest);

            verificationHelper.onSuccessHideLoader();

            try {
              analytics.pushLoggingInfo(loggingUrl, loggingPayload, loggingData, xhr.status, "POST", startTime, endTime);
            } catch (err) {
              console.log(err)
            }
            if (response.phoneVerified) {
              verificationModal.hideModal();
              verificationAnalytics.onSuccessVerifyPhoneFlow();

              if (successVerificationCallback) {
                successVerificationCallback();
              }

              verificationHelper.verificationSuccess(response);

              $('#verification-alert').css('display', 'block');
            } else {
              $verificationButton.find('.bttn__content').text("Verify");
              $verificationButton.find('.segment-spinner').remove();
              verificationHelper.renderErrorMessage(CONSTANTS.ERRORS.SUBMIT_INTERNAL_ERR);
            }

          }, function (error) {
            verificationModal.hideLoader();
            verificationHelper.onFailureHideLoader();
            var loggingError = $.extend(true, {}, error);
            var loggingUrl = CONSTANTS.URLS.VERIFY_PHONE_URL + 'verifyPhoneOTP';
            var endTime = new Date();
            try {
              analytics.pushLoggingInfo(loggingUrl, verifyPhoneRequest, loggingError.responseJSON, loggingError.status, "POST", startTime, endTime);
            } catch (err) {
              console.log(err)
            }
            $('#verification-code-submit')
              .find('.bttn__content')
              .empty()
              .text("Verify");
            var errorCode = accountUtility.catchErrorCode(error);
            var errorMessage = accountUtility.catchErrorMessage(error);
            if (!(errorCode === "AUTH_ERR_125" || errorCode === "AUTH_ERR_104")) {
              $verificationButton.removeClass('disabled');
            }

            if (!(errorCode === "AUTH_ERR_125" && isRegistration)) {
              var errorText = errorMessage.indexOf('Bad request') === "-1" ? verificationHelper.getErrorMessage('') : verificationHelper.getErrorMessage(errorCode);
              verificationHelper.renderErrorMessage(errorText);

              var analyticErrors = {
                "errorType": "error",
                "displayType": "inline",
                "pageSection": "verify phone",
                "errorMessage": errorText,
                "code": errorCode
              };

              verificationAnalytics.setErrorEvent(analyticErrors)
            } else {
              $('#verification-code').off('input');
            }
          })
      };

      var handleGetPhoneOTPErrorMessage = function (whichFlow, errorObject) {
        try {
          if (errorObject) {
            var errorMessageDiv, errorMessageSpan, errorMessage;
            var errorCode = errorObject && errorObject.responseJSON && errorObject.responseJSON.errors && errorObject.responseJSON.errors[0].errorCode;
            switch (whichFlow) {
              case "personalPhoneVer" : {
                errorMessageDiv = $('#personalInfoPhoneVerErrDiv');
                break;
              }
              case "twoFAOtpIn" : {
                errorMessageDiv = $('#twoFactorOptInErrDiv');
                break;
              }
              case "profileBanner" :{
                errorMessageDiv = $('#profileBannerErrDiv');
                break;
              }
            }
            errorMessageSpan = errorMessageDiv ? errorMessageDiv.find('.u__text--danger') : '';
            errorMessage = errorCode && verificationHelper.getErrorMessage(errorCode);
            if(errorMessageSpan){
              errorMessageSpan.text(errorMessage);
              errorMessageDiv.removeClass('hide').show();
            }

            return errorCode;
          }
        }
        catch(e){
          console.log("Error in handleGetPhoneOTPErrorMessage", e);
        }
      };

    });
  };

  var bindTwoFactorAuthFlow = function () {
    $(document).on('triggerTwoFactorVerification', function (event) {
      var clickedResend = false;
      var payload = event.detail || event.originalEvent.detail;
      signinEvoiceSwitch = payload.signinEvoiceSwitch;
      emailId = payload.email;
      authID = payload.authID;
      backendHost = payload.backendHost;
      customerID = payload.customerID;
      deviceId = payload.deviceId;
      requestId = payload.requestId;

      var verify2FAViaText = payload.sentViaText;
      var phoneNumber = payload.phoneNumber;
      isMobile = payload.isMobile;
      hmac = payload.hat || verificationHelper.getHMAC();
      twoFactorSuccessCallback = payload.successCallback;
      var title = verify2FAViaText ? 'verify2FactorText' : 'verify2FactorEmail';
      var input2FA = verify2FAViaText ? phoneNumber : emailId;
      var requestObj = {};
      var customerType = "";

      channelId = isMobile ? '2' : '1';

      verificationModal.renderTemplateModal(title, input2FA, isMobile);
      $('#verification-legal').remove();

      $bannerPhoneInput = $('#verify-phone-banner-input');
      $resendResponseMessage = $('#resend__response-message');
      $verificationInput = $('#form-input-verification');
      $verificationButton = $('#verification-code-submit');
      $verifyOTPInputField = $('#verification-code');

      $resendResponseMessage.css('display', 'none');
      // generator and render the template

      var onSubmitVerifyEmail = function () {
        $verifyOTP = $verifyOTPInputField.val();
        var request = verificationHelper.generateVerify2FactorRequest(authID, backendHost, customerID, emailId, deviceId, requestId, $verifyOTP, verify2FAViaText);
        var startTime = new Date();
        var loggingUrl = authConstants.URLS.VERIFY_OTP_PATH;

        // add a sppiner logic
        verificationUtil.validateOTP(request, hmac, channelId)
          .then(function (response, statusText, xhr) {
            var customerType2FA = response.customerType;
            $('#customerType2FA').html(customerType2FA);
            var endTime = new Date();

            var loggingData = $.extend(true, {}, response);
            var loggingPayload = $.extend(true, {}, request);

            try {
              analytics.pushLoggingInfo(loggingUrl, loggingPayload, loggingData, xhr.status, "POST", startTime, endTime);
            } catch (err) {
              console.log(err)
            }
            twoFactorSuccessCallback();
          }, function (err) {
            verificationModal.hideLoader();
            var endTime = new Date();
            try {
              analytics.pushLoggingInfo(loggingUrl, request, err.responseJSON, err.status, "POST", startTime, endTime);
            } catch (err) {
              console.log(err)
            }
            var $verificationButtonText = $verificationButton.find('.bttn__content');
            $verificationButtonText.empty().text("Verify");
            var errorCode = accountUtility.catchErrorCode(err);
            var errorMessage = verificationHelper.getErrorMessage(errorCode);


            /**
             * 2FA with email where resend is shown and clicked
             * Then error comes up saying to click resend again aka either
             * AUTH_ERR_125 or AUTH_ERR_104
             */
            if (!verify2FAViaText &&
              ["AUTH_ERR_125", "AUTH_ERR_104"].indexOf(errorCode) >= 0) {
              errorCode = clickedResend ? 'AUTH_ERR_122' : 'AUTH_ERR_104';
              errorMessage = verificationHelper.getErrorMessage(errorCode);
            } else if (!clickedResend &&
              verify2FAViaText &&
              ["AUTH_ERR_125", "AUTH_ERR_104"].indexOf(errorCode) >= 0) {
              /**
               * 2FA with text where resend is not shown
               * Then error comes up saying to click resend aka either
               * AUTH_ERR_125 or AUTH_ERR_104
               */
              errorMessage = CONSTANTS.ERRORS.VALIDATION_FAILED_ERR;
            }

            verificationHelper.renderErrorMessage(errorMessage);
            var analyticErrors = {
              "errorType": "error",
              "displayType": "inline",
              "pageSection": "two factor authentication overlay",
              "errorMessage": errorMessage,
              "code": errorCode
            };

            verificationAnalytics.setErrorEvent(analyticErrors)
          });
      };

      var onSubmitResendEmail = function () {
        var startTime = new Date();
        verificationHelper.showResendSpinner();
        verificationUtil.getVerifyEmailOTP(emailId, channelId, hmac)
          .done(function (data, statusText, xhr) {
            var loggingUrl = authConstants.URLS.REQUEST_OTP_PATH + emailId;
            var endTime = new Date();
            var jsonPayload = {};

            var loggingData = $.extend(true, {}, data);

            try {
              analytics.pushLoggingInfo(loggingUrl, jsonPayload, loggingData, xhr.status, "GET", startTime, endTime);
            } catch (err) {
              console.log(err)
            }
            clickedResend = true;
            otpResponse = data;
            authID = data.authId;
            backendHost = data.backendHostName;
            verificationHelper.hideResendSpinner();
            var successMessage = "Code resent. It may take a minute to receive your code.";
            verificationHelper.renderOnSuccessResendResponse($verificationButton, $verifyOTP, successMessage);
          })
          .fail(function (error) {
            var loggingUrl = authConstants.URLS.REQUEST_OTP_PATH + emailId;
            var endTime = new Date();
            var jsonPayload = {};
            try {
              analytics.pushLoggingInfo(loggingUrl, jsonPayload, error.responseJSON, error.status, "GET", startTime, endTime);
            } catch (err) {
              console.log(err)
            }
            verificationHelper.hideResendSpinner();
            verificationHelper.renderOnFailureResendResponse($verificationButton, $verifyOTP);
          });
      };

      var onSubmitEvoice = function () {
        verificationHelper.showResendSpinner();

        var inputs = { emailId: emailId, flow: 'sign-in', method: 'phone', origin: verificationHelper.getOrigin('sign-in') };
        verificationUtil.getVerifyResetPasswordOTP({ isMobile: isMobile }, inputs, hmac)
          .done(function (resp) {
            verificationHelper.hideResendSpinner();
            verificationAnalytics.openVerify2FAModal("phone call");

            /** empty the input field value **/
            $verifyOTPInputField.val('');

            /** clear error messages on the input field **/
            $('.form-input-error__message').empty();
            $verifyOTPInputField.parent().removeClass('form-input--error');

            try {
              /** update request obj for e-voice **/
              requestObj = {
                otpRequest: {
                  customerId: resp.custId,
                  authId: resp.authId,
                  backendHost: resp.backendHostName,
                  loginId: inputs.emailId,
                  deviceId: deviceId,
                  requestId: requestId,
                  origin: verificationHelper.getOrigin(inputs.flow),
                  otpChannel: 'phone'
                }
              };

              /** hide the body text **/
              $("#verification-overlay-body").find('p.col__12-12').css('visibility', 'hidden');

              /** add success message for sign in modal **/
              $('.resend__help-message').empty().append(
                $("<div></div>").addClass('alert-inline alert-inline--success')
                  .append("<span></span>").addClass("alert-inline__message")
                  .html("We're calling you with a verification code at " + verificationHelper.maskPhone(phoneNumber) + ". Please enter the verification code below.")
              );
            } catch (exception) {
              console.warn("Failed at updating request object with the response of getOTP from onSubmit e-voice " + exception);
            }
          })
          .fail(function (error) {
            verificationHelper.hideResendSpinner();
            verificationHelper.renderOnFailureResendResponse($verificationButton, $verifyOTP);
          })
      };

      var onSubmitVerifyIdentity = function () {
        requestObj.otpRequest.otp = $verifyOTPInputField.val();
        verificationUtil.validateOTP(requestObj, hmac, channelId)
          .done(function (resp) {
            customerType = resp.customerType;
            verificationModal.hideLoader();
            try {
              $('.account-modal__container').remove();
              verificationHelper.onResolveRedirect(customerType);
            } catch (exception) {
              console.warn("Failed at validating signing in using otp code " + exception);
            }
          })
          .fail(function (error) {
            verificationModal.hideLoader();
            verificationHelper.revertDisabledButton($verificationButton, 'Submit');

            var errorCode = accountUtility.catchErrorCode(error);
            var errorText = verificationHelper.getErrorMessage(errorCode);

            var analyticErrors = {
              errorType: "error",
              displayType: "inline",
              pageSection: "enter new password",
              errorMessage: errorText,
              code: errorCode
            };

            verificationAnalytics.setErrorEvent(analyticErrors);
            verificationHelper.renderErrorMessage(errorText, $verifyOTPInputField);
          })
      };

      if (verify2FAViaText) {
        if (signinEvoiceSwitch) {
          $('.resend__help-message').empty().append(
            $('<a></a>')
              .addClass('resend-code-link u__default-link')
              .attr('id', 'resend-code')
              .text('Call Me With the Code Instead'),
            $('<span></span>')
              .attr('id', 'resend-code-spinner')
              .css("visibility", "hidden")
              .addClass('segment-spinner segment-spinner--xsmall')
          ).css({ 'padding-top': 10, 'padding-bottom': 0, 'display': 'block' });
        } else {
          $('.resend__help-message').empty();
        }

        requestObj = {
          otpRequest: {
            customerId: customerID,
            authId: authID,
            backendHost: backendHost,
            loginId: emailId,
            deviceId: deviceId,
            requestId: requestId,
            origin: '2FA SIGN IN',
            otpChannel: 'sms'
          }
        };

        /** e-voice leveraging resend code function **/
        verificationModal.setResendCodeListener(onSubmitEvoice);
        verificationModal.setOnSubmitListener(onSubmitVerifyIdentity, $verificationButton, $verificationInput);
      } else {
        verificationModal.setResendCodeListener(onSubmitResendEmail);
        verificationModal.setOnSubmitListener(onSubmitVerifyEmail, $verificationButton, $verificationInput);
      }

    })
  };

  var bindRegistrationVerifyIdentity = function () {
    $(document).on('triggerRegistrationVerifyIdentity', function (event) {
      var payload = event.detail || event.originalEvent.detail;
      var userOptedIn = payload.userOptedIn;
      var isMobile = payload.channelId === '2';
      var enableEvoiceRegistration = payload.enableEvoiceRegistration; // receiving this from auth.registration.js


      var successCallback = payload.successCallback;
      var cancelCallback = function () {
        $('.account-modal__container').remove();
        payload.successCallback();
      };

      if (!userOptedIn) {
        verificationModal.renderTemplateModal('registrationVerifyIdentity', payload.phoneNumber, isMobile, null, cancelCallback.bind(this), null, null, enableEvoiceRegistration);
        $('#verification-code-submit').removeClass('disabled');
        $('#verification-overlay-body .col__12-12').addClass("body__p-bottom-none");

        $('.verify-phone-footer .col__12-12')
          .append(
            $('<div></div>')
              .addClass('modal-legal-grid u__legal')
              .html("Message and data rates may apply.")
              .append(
                $('<div></div>').addClass('modal-legal-links').append(
                  $('<a></a>').addClass('modal-legal-terms u__default-link').attr('href', "https://www.homedepot.com/c/PH_MyAccount").attr('target', '_blank').html('Terms of Use'),
                  '|',
                  $('<a></a>').addClass('modal-legal-policy u__default-link').attr('href', "https://www.homedepot.com/c/Privacy_Security").attr('target', '_blank').html('Privacy Policy')
                ))
          );

        $('#verification-cancel').remove();
        $('#form-input-verification').remove();
        $('.resend__help-message').remove();
        $('#resend__response-message').remove();
        $("#skipVerify").off().on('click', function (event) {
          event.preventDefault();
          cancelCallback()
        });


        verificationModal.setOnSubmitListener(function () {
          verificationAnalytics.onClickVerifyIdentity();
          var phoneVerifyPayload = {
            emailId: payload.emailId,
            phoneNumber: payload.phoneNumber,
            isMobile: isMobile,
            cancelButtonText: "Skip for Now",
            cancelCallback: cancelCallback,
            successCallback: successCallback,
            isRegistration: true,
            otpChannel: enableEvoiceRegistration ? $("input[name='selectPhoneOTPMedium']:checked").val() : "sms"
          };

          var customEvent = new CustomEvent('triggerVerification', { detail: phoneVerifyPayload });
          document.dispatchEvent(customEvent);
        }, $('#verification-code-submit'));
      } else {
        var phoneVerifyPayload = {
          emailId: payload.emailId,
          phoneNumber: payload.phoneNumber,
          isMobile: isMobile,
          cancelButtonText: "Skip for Now",
          cancelCallback: cancelCallback,
          successCallback: successCallback,
          isRegistration: true,
          otpChannel: payload.otpChannel ? payload.otpChannel : 'sms'
        };

        var customEvent = new CustomEvent('triggerVerification', { detail: phoneVerifyPayload });
        document.dispatchEvent(customEvent);
      }
    });
  };

  /**
   * bind the new reset password flow
   *
   * state management using `inputs` object
   * emailId: string, phoneNumber: string, flow: string, method: string, custId: string
   * flow: reset-password, otp, sign-in
   * method: sms, phone, email
   */
  var bindResetPasswordFlow = function () {
    var $submitButton = null,
      $inputField = null,
      inputs = { emailId: null, phoneNumber: null, flow: null, method: null, custId: null },
      isPhoneVerified = false,
      is2FAOptIn = false,
      $resetPasswordBottomText = null,
      customerType = 'B2C',
      requestObj = {},
      evoiceSwitch = false;

    /**
     * attach an onclick event handler for set password link
     */
    $(document).on('click', '#new-set-password-link', function (event, evoiceSwitch) {
      initSetPassword(evoiceSwitch);
    });

    $(document).on('set-password', function (event) {
      var options = event.detail || event.originalEvent.detail;
      initSetPassword(options);
    });

    var initSetPassword = function (options) {
      // Check if the options are available, else default it
      if (typeof options === "string") {
        evoiceSwitch = options === "true";
        options = {
          disableEmailAddress: false, // Disable the email fields in verification screen
          forceEmailScreen: false // Force email verification screen
        };
      } else if (typeof options === "undefined") {
        options = {
          disableEmailAddress: false, // Disable the email fields in verification screen
          forceEmailScreen: false // Force email verification screen
        };
      }

      hmac = verificationHelper.getHMAC();
      isMobile = navigator.userAgent.indexOf("Mobi") > -1 && !(/ipad|xoom|sch-i800|playbook|tablet|kindle/i.test(navigator.userAgent.toLowerCase()));
      channelId = isMobile ? '2' : '1';
      $inputField = $('.rp__email-input');
      inputs.method = 'email';
      inputs.flow = 'set-password';

      if (options.emailAddress) {
        inputs.emailId = options.emailAddress;
      } else {
        inputs.emailId = $inputField.val();
      }
      inputs.disabled = options.disableEmailAddress || false;

      verificationModal.renderResetPasswordTemplateModal('setPasswordModal', isMobile, inputs);
      var $resetBodyDiv = $("#reset-password__body");
      isMobile ? (
        $resetBodyDiv.css({ 'display': 'flex', 'flex-direction': 'column' })
          .find('div.bottom__notify').css({ 'display': 'flex', 'flex-direction': 'column' })
      ) : (
        $resetBodyDiv
          .find('div.bottom__notify').css({ 'display': 'flex' })
      );

      $submitButton = $('#reset-password__submit');

      verificationModal.setOnSubmitListener(onSubmitSendOTPCode, $submitButton);
    }

    $(document).on('reset-password', function (event) {
      var options = event.detail || event.originalEvent.detail;
      initResetPassword(options);
    });

    var initResetPassword = function (options) {
      // Check if the options are available, else default it
      if (typeof options === "string") {
        evoiceSwitch = options === "true";
        options = {
          disableEmailAddress: false, // Disable the email fields in verification screen
          forceEmailScreen: false // Force email verification screen
        };
      } else if (typeof options === "undefined") {
        options = {
          disableEmailAddress: false, // Disable the email fields in verification screen
          forceEmailScreen: false // Force email verification screen
        };
      }

      hmac = verificationHelper.getHMAC();
      isMobile = navigator.userAgent.indexOf("Mobi") > -1 && !(/ipad|xoom|sch-i800|playbook|tablet|kindle/i.test(navigator.userAgent.toLowerCase()));
      channelId = isMobile ? '2' : '1';
      inputs.flow = null;
      inputs.method = null;
      $inputField = verificationHelper.getEmailInputRP();

      /**
       * See if email pre-poluation is required and email verification screen is required
       * If forceEmailScreen is false and emailAddress is there then do the verification and
       * go to next screen
       */
      if (options.emailAddress && options.emailAddress !== '' && !options.forceEmailScreen) {
        inputs.emailId = options.emailAddress;
      } else {
        // Fetch the email from the input from the page for pre-population
        inputs.emailId = $inputField.val();
      }

      inputs.disabled = options.disableEmailAddress || false;

      if (inputs.emailId === '' || !verificationHelper.validateEmailAddress(inputs.emailId)) {
        // If forcing the email verification screen, pre-polulate the email Address
        inputs.emailId = options.forceEmailScreen
          ? verificationHelper.validateEmailAddress(options.emailAddress) ? options.emailAddress : ''
          : ''; // empty the email input field

        // always render the new template modal for each phase at the top of the function.
        verificationModal.renderResetPasswordTemplateModal('emailInputModal', isMobile, inputs);

        // grab the DOM elements after mounting new modal
        $inputField = $('#validate__email-address');
        $submitButton = $('#reset-password__submit');
        if (inputs.emailId === '') {
          $submitButton.addClass("disabled");
        }
        $resetPasswordBottomText = $("#reset-password__footer-text");

        $inputField.on('keyup', function (e) {
          // remove the alert message.
          $('.form-input-error__message').empty();
          $inputField.parent().removeClass('form-input--error');

          if (!verificationHelper.validateEmailAddress(e.target.value)) {
            if (!$submitButton.hasClass('disabled')) $submitButton.addClass('disabled');
          } else {
            inputs.emailId = e.target.value;
            verificationHelper.revertDisabledButton($submitButton, "Continue");
          }
        });

        // attach an onSubmit event listener to the submit button grabbed above
        verificationModal.setOnSubmitListener(onSubmitForgotPassword, $submitButton, $inputField);

        // fire analytics
        verificationAnalytics.onLoadEnterEmailModal();
        return;
      }

      if (verificationHelper.validateEmailAddress(inputs.emailId)) {
        // TODO: show loader without a modal
        onSubmitForgotPassword();
      }
    }

    /**
     * attach an onclick event handler for reset password link
     */
    $(document).on('click', '#new-reset-password-link', function (event, evoiceSwitch) {
      if (!evoiceSwitch) {
	      var resetEVoiceSwitch = $('#resetPasswordEvoiceSwitch').val() === "true";
        if (resetEVoiceSwitch) {
          evoiceSwitch = "true";
        } else {
          evoiceSwitch = "false";
        }
      }
      initResetPassword(evoiceSwitch);
    });

    /**
     * initiate forgot password flow
     * instance 1: clicking the link in logon form.
     * instance 2: hitting submit button from phase 1 of reset password flow.
     */
    var onSubmitForgotPassword = function () {
      verificationUtil.initiateResetPasswordFlow({ isMobile: isMobile }, inputs.emailId, hmac)
        .done(function (resp) {
          try {
            verificationModal.hideLoader();

            if (resp.hasOwnProperty('phoneNumber')) {
              inputs.phoneNumber = resp.phoneNumber;
            } else {
              inputs.phoneNumber = '';
            }

            isPhoneVerified = resp.isVerified;
            is2FAOptIn = resp.isEnabled;
            // default inputs
            inputs.custId = resp.custID;
            inputs.method = !is2FAOptIn && !isPhoneVerified ? 'email' : 'sms';
            if (inputs.phoneNumber === '') inputs.method = 'email';

            verificationModal.renderResetPasswordTemplateModal('selectFlowMethodModal', isMobile, inputs);
            // success analytics
            verificationAnalytics.onClickForgotPassword();

            // initialize variables
            $submitButton = $('#reset-password__submit');
            verificationHelper.handleOnClickRPRadioButtons($submitButton, inputs, isPhoneVerified, is2FAOptIn, isMobile, evoiceSwitch);

            verificationModal.setOnSubmitListener(onSubmitSendOTPCode, $submitButton);
          } catch (exception) {
            console.warn("Failed at initiating Forgot Password Flow! " + exception);
          }
        })
        .fail(function (error) {
          verificationModal.hideLoader();

          var errorCode = accountUtility.catchErrorCode(error);
          var errorText = verificationHelper.getErrorMessage(errorCode);
          verificationHelper.renderErrorMessage(errorText, $inputField);

          $inputField.one("keyup", function (e) {
            $inputField.parent().removeClass('form-input--error');
            $inputField.parent().find($('.form-input-error__message')).remove();
          });

          var analyticErrors = {
            errorType: "error",
            displayType: "inline",
            pageSection: "reset password",
            errorMessage: errorText,
            code: errorCode
          };

          verificationAnalytics.setErrorEvent(analyticErrors);

          if ($submitButton) verificationHelper.revertDisabledButton($submitButton, "Continue");

          // for set password flow
          if (errorCode === "UREG_ERR_159") {
            verificationModal.renderResetPasswordTemplateModal('setPasswordModal', isMobile, inputs);
            $("#reset-password__body")
              .find('> p.u__bold').addClass('col__12-12').removeClass('col__11-12')
              .find('div.bottom__notify').css({ 'display': 'flex' });
            $submitButton = $('#reset-password__submit');

            inputs.method = 'email';
            inputs.flow = 'set-password';
            verificationModal.setOnSubmitListener(onSubmitSendOTPCode, $submitButton);
          }

          // fallback for `checkPhoneExist` endpoint
          if (errorCode === "GEN_ERR_500") {
            inputs.method = 'email';
            verificationModal.renderResetPasswordTemplateModal('selectFlowMethodModal', isMobile, inputs);
            // success analytics
            verificationAnalytics.onClickForgotPassword();

            // initialize variables
            $submitButton = $('#reset-password__submit');
            verificationHelper.handleOnClickRPRadioButtons($submitButton, inputs, false, false, isMobile);

            verificationModal.setOnSubmitListener(onSubmitSendOTPCode, $submitButton);
          }
        });

    };

    /**
     * Send OTP code depending on the chosen options
     * the three choices are sms, phone, and email
     */
    var onSubmitSendOTPCode = function () {
      // set origin
      inputs.origin = verificationHelper.getOrigin(inputs.flow);

      verificationUtil.getVerifyResetPasswordOTP({ isMobile: isMobile }, inputs, hmac)
        .done(function (resp) {
          verificationModal.hideLoader();
          requestObj = {};
          try {
            verificationModal.renderResetPasswordTemplateModal('validateOTPModal', isMobile, inputs);
            verificationModal.verifyCodeHandler(); // event handler for the verification code input field
            verificationAnalytics.onSelectFlowMethodForgotPassword(inputs.flow, inputs.method);

            $resetPasswordBottomText = $("#reset-password__footer-text");
            $inputField = $('#verification-code');
            $submitButton = $('#reset-password__submit');
            $submitButton.addClass('disabled'); // render the modal with a disabled button

            $inputField
              .on('blur', function (e) {
                // remove the alert message.
                $('.form-input-error__message').empty();
                $inputField.parent().removeClass('form-input--error');

                if ($inputField.val().length === 6) {
                  verificationHelper.revertDisabledButton($submitButton, "Verify");
                } else {
                  if (!$submitButton.hasClass('disabled')) $submitButton.addClass('disabled');
                }
              })
              .on('keyup', function (e) {
                // remove the alert message.
                $('.form-input-error__message').empty();
                $inputField.parent().removeClass('form-input--error');

                if ($inputField.val().length === 6) {
                  verificationHelper.revertDisabledButton($submitButton, "Verify");
                } else {
                  if (!$submitButton.hasClass('disabled')) $submitButton.addClass('disabled');
                }
              });

            inputs.method === 'email' && (
              $('.verification__check-spam')
                .text("If you don't see it in your inbox shortly, check your spam folder.")
                .css({ 'display': 'block' })
            );

            $('#reset-password__body').css({ "display": "flex", "flex-direction": "column" });
            $('#form-input-verification').css({ "padding": "10px 10px 0" });
            isMobile && $('#form-input-verification').addClass('col__12-12');

            requestObj = {
              otpRequest: {
                customerId: resp.custId,
                authId: resp.authId,
                backendHost: resp.backendHostName,
                loginId: inputs.emailId,
                origin: verificationHelper.getOrigin(inputs.flow),
                otpChannel : inputs.method
              }
            };

            if (inputs.flow === 'set-password') {
              $(".verification-svg-close").on("click", function (event) {
                document.location.reload();
              });
            }

            verificationModal.setOnSubmitListener(onSubmitVerifyOTP, $submitButton, $inputField);
          } catch (exception) {
            console.warn("Failed at getting Reset Password OTP phase! " + exception);
          }
        })
        .fail(function (error) {
          verificationModal.hideLoader();
          verificationHelper.revertDisabledButton($submitButton, "Send Code");
          $('#reset-password__body .alert-inline').remove(); // remove the existing message

          var errorCode = accountUtility.catchErrorCode(error);
          var errorText = verificationHelper.getErrorMessage(errorCode);

          // render error message at the top of the modal
          $('#reset-password__body').prepend(
            $('<div></div>').addClass('alert-inline alert-inline--danger col__12-12').append(
              $('<span></span>').addClass('alert-inline__message').append(
                $('<span></span>').addClass('alert-inline__title').html('Error!&nbsp;'),
                errorText
              )
            )
          );

          var analyticErrors = {
            errorType: "error",
            displayType: "inline",
            pageSection: "reset password send OTP - " + inputs.method,
            errorMessage: errorText,
            code: errorCode
          };

          verificationAnalytics.setErrorEvent(analyticErrors);
        });
    };

    /**
     * verify the otp input
     */
    var onSubmitVerifyOTP = function () {
      requestObj.otpRequest.otp = $inputField.val();
      verificationUtil.validateOTP(requestObj, hmac, channelId)
        .done(function (resp) {
          requestObj = {};
          verificationModal.hideLoader();
          try {
            customerType = resp.customerType; // for redirection
            if (inputs.flow === 'otp') {
              $('.account-modal__container').remove();
              verificationHelper.onResolveRedirect(customerType);
              // analytics for succesfully logging in after otp sign in
              verificationAnalytics.onSuccessForgotPasswordFlow();
              return; // terminate the code
            }

            verificationModal.renderResetPasswordTemplateModal('resetPasswordModal', isMobile, inputs);
            $('#reset-password__body').find('p.u__bold').addClass('col__12-12').removeClass('col__11-12');


            // for set password flow
            if (inputs.flow === 'set-password') {
              $('#verification-header__text').text('Set a Password');
              $('#reset-password__body').find('> p.u__bold').text('Create a password.');
            }
            // success analytics
            verificationAnalytics.onLoadSetNewPasswordModal();

            $('.form-input').css({ 'margin-bottom': '0' });
            $submitButton = $('#reset-password__submit');
            $inputField = $('#reset-password__pw-input');

            verificationHelper.disableButton($submitButton, $inputField);
            verificationHelper.addPasswordInputFieldListener($inputField, inputs.emailId, $submitButton);

            // for svg at the header of the modal body.
            $("#reset-password__body").prepend(
              '<svg viewBox="0 0 13 20" xmlns="http://www.w3.org/2000/svg" width="13px"' +
              ' height="20px"class="col__1-12 lock-svg">\n' +
              '    <g id="Modal-" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n' +
              '        <g id="Forgot-Password-Flows-Copy" transform="translate(-2920.000000, -246.000000)" fill="#F96302">\n' +
              '            <path d="M2931.95627,253.574392 L2931.95627,251.386276 C2931.95627,248.416221 2929.4232,246 2926.5,246 C2923.57495,246 2920.96423,248.416221 2920.96423,251.386276 L2920.96423,253.746175 C2920.35777,253.845677 2920,254.394818 2920,255.063175 L2920,264.817235 C2920,265.555994 2920.4345,266 2921.16207,266 L2931.91097,266 C2932.63945,266 2933,265.39923 2933,264.660471 L2933,255.063175 C2933,254.340374 2932.6524,253.606308 2931.95627,253.574392 L2931.95627,253.574392 Z M2926.57769,247.904762 C2928.41264,247.904762 2930.21429,249.420318 2930.21429,251.282877 L2930.21429,253.619048 L2922.78571,253.619048 L2922.78571,251.282877 C2922.78571,249.420318 2924.74089,247.904762 2926.57769,247.904762 L2926.57769,247.904762 Z M2925.52848,259.475369 C2925.07899,259.179559 2924.78028,258.681979 2924.78028,258.120489 C2924.78028,257.212975 2925.55043,256.47619 2926.50095,256.47619 C2927.44957,256.47619 2928.21781,257.212975 2928.21781,258.120489 C2928.21781,258.681979 2927.92292,259.179559 2927.47247,259.475369 L2928.35714,263.142857 L2924.64286,263.142857 L2925.52848,259.475369 Z" id="Locked-Copy"></path>\n' +
              '        </g>\n' +
              '    </g>\n' +
              '</svg>'
            ).find("> p.u__bold").removeClass("col__12-12").addClass("col__11-12");

            isMobile && $("#reset-password__body").find("svg.lock-svg").css({ "margin": "0" });

            $(".verification-svg-close").on("click", function (event) {
              verificationHelper.onResolveRedirect(customerType);
            });

            // build request object
            requestObj = {
              authId: resp.tokenId,
              svocId: resp.svocCustomerAccountId,
              emailId: inputs.emailId,
              isMobile: isMobile
            };

            verificationHelper.onClickShowPasswordLink($inputField, $('.form-input__show-password'));
            verificationModal.setOnSubmitListener(onSubmitResetPassword, $submitButton, $inputField);
          } catch (exception) {
            console.warn("Failed at Reset Password OTP submission phase! " + exception);
          }
        })
        .fail(function (error) {
          verificationModal.hideLoader();
          // TODO: fail scenario analytics
          verificationHelper.revertDisabledButton($submitButton, 'Verify');
          !$submitButton.hasClass('disabled') && $submitButton.addClass('disabled');

          var errorCode = accountUtility.catchErrorCode(error);
          if (errorCode === "AUTH_ERR_104") errorCode = "AUTH_ERR_125"; // No more resend prompt.
          var errorText = verificationHelper.getErrorMessage(errorCode);

          verificationHelper.renderErrorMessage(errorText, $inputField);

          var analyticErrors = {
            errorType: "error",
            displayType: "inline",
            pageSection: "reset password code entry - " + inputs.method,
            errorMessage: errorText,
            code: errorCode
          };

          verificationAnalytics.setErrorEvent(analyticErrors);
        });
    };

    /**
     * @Description: submit handler for set password modal
     */
    var onSubmitResetPassword = function () {
      requestObj.password = $inputField.val();
      verificationUtil.setNewPassword(requestObj, hmac)
        .done(function (resp) {
          verificationModal.hideLoader();
          try {
            $('.account-modal__container').remove();
            verificationHelper.onResolveRedirect(customerType);
            // successfully log in after setting new password
            verificationAnalytics.onSuccessForgotPasswordFlow();
          } catch (exception) {
            console.warn("Failed at validating setting New Password phase! " + exception);
          }
        })
        .fail(function (error) {
          verificationModal.hideLoader();
          verificationHelper.revertDisabledButton($submitButton, 'Submit');

          var errorCode = accountUtility.catchErrorCode(error);
          var errorText = verificationHelper.getErrorMessage(errorCode);

          var analyticErrors = {
            errorType: "error",
            displayType: "inline",
            pageSection: "enter new password",
            errorMessage: errorText,
            code: errorCode
          };

          verificationAnalytics.setErrorEvent(analyticErrors);
          verificationHelper.renderErrorMessage(errorText, $('#reset-password__pw-input'));
        });
    };
  };

  var bindOTPSignInFlow = function () {
    var $submitButton = null,
      $inputField = null,
      inputs = { emailId: null, phoneNumber: null, flow: null, method: null, custId: null },
      isPhoneVerified = false,
      is2FAOptIn = false,
      $resetPasswordBottomText = null,
      customerType = 'B2C',
      requestObj = {};

    /**
     * create a custom event that when fired will start the otp sign in flow
     */
    $(document).on('initiateOTPSignIn', function (event) {
	    hmac = verificationHelper.getHMAC();
      isMobile = navigator.userAgent.indexOf("Mobi") > -1 && !(/ipad|xoom|sch-i800|playbook|tablet|kindle/i.test(navigator.userAgent.toLowerCase()));
      hmac = verificationHelper.getHMAC();
      channelId = isMobile ? '2' : '1';
      inputs.flow = 'otp';
      inputs.method = null;
      $inputField = verificationHelper.getEmailInputRP("#loginValue");
      inputs.emailId = $inputField.val();

      if (inputs.emailId === '' || !verificationHelper.validateEmailAddress(inputs.emailId)) {
        inputs.emailId = ''; // empty the email input field
        // always render the new template modal for each phase at the top of the function.

        // Step 1. Render the email to be used to sign in with modal.
        verificationModal.renderResetPasswordTemplateModal('emailInputOTPModal', isMobile, inputs);

        // grab the DOM elements after mounting new modal
        $inputField = $('#validate__email-address');
        $submitButton = $('#otp-signin__submit');
        $submitButton.addClass("disabled");
        $resetPasswordBottomText = $("#otp-signin__footer-text");

        // Step 2. Set the alerts for the input field;
        $inputField.on('keyup', function (e) {
          // remove the alert message.
          $('.form-input-error__message').empty();
          $inputField.parent().removeClass('form-input--error');

          if (!verificationHelper.validateEmailAddress(e.target.value)) {
            if (!$submitButton.hasClass('disabled')) $submitButton.addClass('disabled');
          } else {
            inputs.emailId = e.target.value;
            verificationHelper.revertDisabledButton($submitButton, "Continue");
          }
        });

        // attach an onSubmit event listener to the submit button grabbed above
        verificationModal.setOnSubmitListener(onSubmitOTPSignIn, $submitButton, $inputField);
      }

      if (verificationHelper.validateEmailAddress(inputs.emailId)) {
        // TODO: show loader without a modal
        onSubmitOTPSignIn();
      }
    });

    /**
     * initiate the OTP Sign In Flow
     * instance 1: clicking the link in logon form.
     * instance 2: hitting submit button from phase 1 of reset password flow.
     */
    var onSubmitOTPSignIn = function () {
      verificationUtil.initiateResetPasswordFlow({ isMobile: isMobile }, inputs.emailId, hmac)
        .done(function (resp) {
          try {
            verificationModal.hideLoader();

            // default inputs
            inputs.custId = resp.custID;

            inputs.method = !isPhoneVerified ? 'email' : null;

            if (resp.hasOwnProperty('phoneNumber')) {
		          inputs.phoneNumber = resp.phoneNumber;
	          } else {
		          inputs.phoneNumber = '';
	          }

	          inputs.isPhoneVerified = resp.isVerified;
	          inputs.is2FAOptIn = resp.isEnabled;
	          isPhoneVerified = resp.isVerified;
	          is2FAOptIn = resp.isEnabled;
	          // default inputs
	          inputs.custId = resp.custID;
	          inputs.method = !is2FAOptIn && !isPhoneVerified ? 'email' : 'sms';
	          if (inputs.phoneNumber === '') inputs.method = 'email';


            verificationModal.renderResetPasswordTemplateModal('selectOTPSigninFlowMethodModal', isMobile, inputs);

            // add the message and data apply message if the option is sms
            var $resetPasswordBottomText = $("#otp-signin__footer-text");
            if (inputs.method === 'sms') {
              verificationHelper.addMessageAndDataApplyMessage($resetPasswordBottomText);
            }
            // success analytics
            //verificationAnalytics.onClickForgotPassword();

            // initialize variables
            $submitButton = $('#otp-signin__submit');
            verificationHelper.handleOnClickOTPSignInRadioButtons($submitButton, inputs, isPhoneVerified, is2FAOptIn, isMobile);
            if (isPhoneVerified && is2FAOptIn) {
	            $submitButton.removeClass('disabled');
            }

            verificationModal.setOnSubmitListener(onSubmitSendOTPCode, $submitButton);
          } catch (exception) {
            console.warn("Failed at initiating Forgot Password Flow! " + exception);
          }
        })
        .fail(function (error) {
          verificationModal.hideLoader();

          var errorCode = accountUtility.catchErrorCode(error);
          var errorText = verificationHelper.getErrorMessage(errorCode);
          verificationHelper.renderErrorMessage(errorText, $inputField);

          $inputField.one("keyup", function (e) {
            $inputField.parent().removeClass('form-input--error');
            $inputField.parent().find($('.form-input-error__message')).remove();
          });

          var analyticErrors = {
            errorType: "error",
            displayType: "inline",
            pageSection: "reset password",
            errorMessage: errorText,
            code: errorCode
          };

          verificationAnalytics.setErrorEvent(analyticErrors);

          if ($submitButton) verificationHelper.revertDisabledButton($submitButton, "Continue");

          // If the Customer needs to set their password fallback to this flow.
          if (errorCode === "UREG_ERR_159") {
            // Setting the body class and hide the bottom padding.
            inputs.bodyClass = 'body__p-bottom-large';
            inputs.hideBottomPadding = true;
            verificationModal.renderResetPasswordTemplateModal('setPasswordModal', isMobile, inputs);
            // Reinitialize them for future use.
            inputs.bodyClass = null;
            inputs.hideBottomPadding = null;

            $("#reset-password__body")
              .find('> p.u__bold').addClass('col__12-12').removeClass('col__11-12')
              .find('div.bottom__notify').css({ 'display': 'flex' });
            $submitButton = $('#reset-password__submit');

            inputs.method = 'email';
            inputs.flow = 'set-password';
            var onSubmitListener = function () {
              inputs.headerText = 'Verification Code Entry';
              inputs.label = 'Verification Code';
              onSubmitSendOTPCode().done(function () {
                inputs.headerText = null;
                inputs.label = null;
              })
            };
            verificationModal.setOnSubmitListener(onSubmitListener, $submitButton);
          }

          // If the CheckCustomerPhone Status endpoint fails, fall back to defaulting to email
          if (errorCode === "GEN_ERR_500") {
            inputs.method = 'email';
            verificationModal.renderResetPasswordTemplateModal('selectFlowMethodModal', isMobile, inputs);
            // success analytics
            verificationAnalytics.onClickForgotPassword();

            // initialize variables
            $submitButton = $('#otp-signin__submit');
            verificationHelper.handleOnClickOTPSignInRadioButtons($submitButton, inputs, false, false, isMobile);

            verificationModal.setOnSubmitListener(onSubmitSendOTPCode, $submitButton);
          }
        });

    };

    /**
     * Send OTP code depending on the chosen options
     * the three choices are sms, phone, and email
     */
    var onSubmitSendOTPCode = function () {
      // set origin
      inputs.origin = verificationHelper.getOrigin(inputs.flow);

      verificationUtil.getVerifyResetPasswordOTP({ isMobile: isMobile }, inputs, hmac)
        .done(function (resp) {
          verificationModal.hideLoader();
          requestObj = {};
          try {
            verificationModal.renderResetPasswordTemplateModal('validateOTPSignInModal', isMobile, inputs);
            verificationModal.verifyCodeHandler(); // event handler for the verification code input field
            verificationAnalytics.onSelectFlowMethodForgotPassword(inputs.flow, inputs.method);

            $resetPasswordBottomText = $("#otp-signin__footer-text");
            $inputField = $('#verification-code');
            $submitButton = $('#otp-signin__submit');
            $submitButton.addClass('disabled'); // render the modal with a disabled button

            $inputField
              .on('blur', function (e) {
                // remove the alert message.
                $('.form-input-error__message').empty();
                $inputField.parent().removeClass('form-input--error');

                if ($inputField.val().length === 6) {
                  verificationHelper.revertDisabledButton($submitButton, "Verify");
                } else {
                  if (!$submitButton.hasClass('disabled')) $submitButton.addClass('disabled');
                }
              })
              .on('keyup', function (e) {
                // remove the alert message.
                $('.form-input-error__message').empty();
                $inputField.parent().removeClass('form-input--error');

                if ($inputField.val().length === 6) {
                  verificationHelper.revertDisabledButton($submitButton, "Verify");
                } else {
                  if (!$submitButton.hasClass('disabled')) $submitButton.addClass('disabled');
                }
              });

            inputs.method === 'email' && (
              $('.verification__check-spam')
                .text("If you don't see it in your inbox shortly, check your spam folder.")
                .css({ 'display': 'block' })
            );

            $('#otp-signin__body').css({ "display": "flex", "flex-direction": "column" });
            $('#form-input-verification').css({ "padding": "10px 10px 0" });
            isMobile && $('#form-input-verification').addClass('col__12-12');

            requestObj = {
              otpRequest: {
                customerId: resp.custId,
                authId: resp.authId,
                backendHost: resp.backendHostName,
                loginId: inputs.emailId,
                origin: verificationHelper.getOrigin(inputs.flow),
                otpChannel : inputs.method
              }
            };

            verificationModal.setOnSubmitListener(onSubmitSignInViaOTP, $submitButton, $inputField);
          } catch (exception) {
            console.warn("Failed at getting Reset Password OTP phase! " + exception);
          }
        })
        .fail(function (error) {
          verificationModal.hideLoader();
          verificationHelper.revertDisabledButton($submitButton, "Send Code");
          $('#otp-signin__body .alert-inline').remove(); // remove the existing message

          var errorCode = accountUtility.catchErrorCode(error);
          var errorText = verificationHelper.getErrorMessage(errorCode);

          // render error message at the top of the modal
          $('#otp-signin__body').prepend(
            $('<div></div>').addClass('alert-inline alert-inline--danger col__12-12').append(
              $('<span></span>').addClass('alert-inline__message').append(
                $('<span></span>').addClass('alert-inline__title').html('Error!&nbsp;'),
                errorText
              )
            )
          );

          var analyticErrors = {
            errorType: "error",
            displayType: "inline",
            pageSection: "reset password code entry - " + inputs.method,
            errorMessage: errorText,
            code: errorCode
          };

          verificationAnalytics.setErrorEvent(analyticErrors);
        });
    };

    /**
     * Validate the given OTP code
     */
    var onSubmitSignInViaOTP = function () {
      requestObj.otpRequest.otp = $inputField.val();
      verificationUtil.validateOTP(requestObj, hmac, channelId)
        .done(function (resp) {
          requestObj = {};
          verificationModal.hideLoader();

          // Fire the sign-in success analytics
          // where the user has been successfully authenticated
          verificationAnalytics.onSuccessSignInFlow();
          // Step 1: redirect the user
          try {
            customerType = resp.customerType; // for redirection
            $('.account-modal__container').remove();
            verificationHelper.onResolveRedirect(customerType);
            return;
          } catch (exception) {
            console.warn("Failed at Reset Password OTP submission phase! " + exception);
          }
        })
        .fail(function (error) {
          verificationModal.hideLoader();
          // TODO: fail scenario analytics
          verificationHelper.revertDisabledButton($submitButton, 'Verify');
          !$submitButton.hasClass('disabled') && $submitButton.addClass('disabled');

          var errorCode = accountUtility.catchErrorCode(error);
          if (errorCode === "AUTH_ERR_104") errorCode = "AUTH_ERR_125"; // No more resend prompt.
          var errorText = verificationHelper.getErrorMessage(errorCode);

          verificationHelper.renderErrorMessage(errorText, $inputField);
        });
    };
  };

  return {

    init: function () {
      bindPhoneVerificationFlow();
      bindTwoFactorAuthFlow();
      bindRegistrationVerifyIdentity();
      bindResetPasswordFlow();
      bindOTPSignInFlow();
    }
  }
});
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define('new-relic',[],t):"object"==typeof exports?exports["ddo-new-relic"]=t():e["ddo-new-relic"]=t()}(window,function(){return function(e){var t={};function r(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(o,n,function(t){return e[t]}.bind(null,n));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){var o,n,i;n=[],void 0===(i="function"==typeof(o=function(){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return function(e,t,o){t&&r(e.prototype,t),o&&r(e,o)}(e,null,[{key:"init",value:function(){if(window.digitalData=window.digitalData||{},"object"===("undefined"==typeof newrelic?"undefined":t(newrelic))&&"function"==typeof newrelic.setCustomAttribute)try{e._setUpTracking(),e._initJSErrorTrackingPageAction(),e._validateB2BExperience()}catch(e){console.log("ERROR: ddoNewRelic failed to init",e),newrelic.setCustomAttribute("DDONewRelicError","init")}}},{key:"_setUpTracking",value:function(){e._isB2B=e._b2bSourceOfTruth(),e._isBeta=-1!==document.cookie.indexOf("HD_DC=beta"),e._initSharedCustomAttributes(),e._trackDuplicateCookies()}},{key:"_initJSErrorTrackingPageAction",value:function(){e._jsErrorHandlingSet=!1,"function"==typeof newrelic.setErrorHandler&&(newrelic.setErrorHandler(e._newRelicErrorHandler),e._jsErrorHandlingSet=!0)}},{key:"_newRelicErrorHandler",value:function(t){try{return"function"==typeof newrelic.addPageAction&&(newrelic.addPageAction("JSError",{errorType:t.name,errorMessage:t.message,errorStack:t.stack,errorB2b:e._isB2B,errorBeta:e._isBeta}),!0)}catch(e){return console.log("ERROR: while setting NR PageAction for JS error event. Error may be missing name, message or stack",e),newrelic.setCustomAttribute("DDONewRelicError","_newRelicErrorHandler"),!1}}},{key:"_validateB2BExperience",value:function(){var t=null!==document.querySelector(".Header3_b2b")||null!==document.querySelector(".header-b2b");t&&!e._isB2B?newrelic.setCustomAttribute("B2CSawB2B",!0):!t&&e._isB2B&&newrelic.setCustomAttribute("B2BSawB2C",!0)}},{key:"_b2bSourceOfTruth",value:function(){var t=e._getRawTHDCustomerCookieValue();if(""===t)return!1;var r=t.split("."),o=e._getRawJWTPayload(r),n=e._decodeRawJWTPayloadToObject(o);try{return"b2b"===n.c.toLowerCase()}catch(e){return!1}}},{key:"_getRawJWTPayload",value:function(e){try{return e.length>2?e[1].trim():e[0].trim()}catch(e){return""}}},{key:"_getRawTHDCustomerCookieValue",value:function(){for(var t=e._getCookies(),r=0;r<t.length;r++)if(-1!==t[r].indexOf("THD_CUSTOMER"))try{return t[r].split("=")[1].trim()}catch(e){break}return""}},{key:"_decodeRawJWTPayloadToObject",value:function(e){if(e)try{return JSON.parse(decodeURIComponent(window.atob(e)))}catch(e){console.log("ERROR: while decoding or parsing cookie, possibly malformed",e),newrelic.setCustomAttribute("DDONewRelicError","_decodeRawJWTPayloadToObject")}return{}}},{key:"_getCookies",value:function(){return document.cookie.split(/; */)}},{key:"_trackDuplicateCookies",value:function(){try{for(var t=[],r=[],o=e._getCookies(),n=0;n<o.length;n++){var i=o[n].split("=")[0];-1!==t.indexOf(i)?r.push(i):t.push(i)}if(0===r.length)return;if(1===r.length)return void newrelic.setCustomAttribute("duplicateCookies",r[0]);var u=r.shift();u+=r.reduce(function(e,t){return e+", "+t},""),newrelic.setCustomAttribute("duplicateCookies",u)}catch(e){console.log("ERROR: while tracking duplicate cookies",e),newrelic.setCustomAttribute("DDONewRelicError","_trackDuplicateCookies")}}},{key:"_initSharedCustomAttributes",value:function(){var t,r,o,n,i,u;newrelic.setCustomAttribute("isBeta",e._isBeta),newrelic.setCustomAttribute("isB2B",e._isB2B),(null===(t=window.digitalData.user)||void 0===t?void 0:null===(r=t.profile)||void 0===r?void 0:r.authenticationStatus)&&newrelic.setCustomAttribute("authenticationStatus",window.digitalData.user.profile.authenticationStatus),e._getKeysAndAssignCustomAttributes(null===(o=window.digitalData.page)||void 0===o?void 0:o.pageInfo),e._getKeysAndAssignCustomAttributes(null===(n=window.digitalData.user)||void 0===n?void 0:n.localization),e._getKeysAndAssignCustomAttributes(null===(i=window.digitalData.user)||void 0===i?void 0:null===(u=i.profile)||void 0===u?void 0:u.profileInfo)}},{key:"_getKeysAndAssignCustomAttributes",value:function(e){if(e&&"object"===t(e)){var r=Object.keys(e);r.forEach(function(r){"storeState"!==r&&"storeZip"!==r&&-1!==["string","number","boolean"].indexOf(t(e[r]))&&newrelic.setCustomAttribute(r,e[r])})}}}]),e}();e.exports=o})?o.apply(t,n):o)||(e.exports=i)}])});
//# sourceMappingURL=ddoNewRelic.umd.js.map;

//resxclsx.js v5.7 Copyright 2004-2016 Certona Corporation www.certona.com. All rights reserved.
/* istanbul ignore next */
var certonaResx=function(){"use strict";var e,n="certonaResx.showResponse",r="",t,i,s=false,c,o,f,a,l,u;function d(e){try{return parseInt(e,10)}catch(n){}}function x(e){try{var n;if(e!==undefined&&e!==null&&e!=="null"&&e!==""){n=true;return n}}catch(r){}return false}function p(){try{return resx.rrelem}catch(e){}return""}function m(e){try{var n=null,r,t;if(x(e)){n=[];if(x(document.getElementById(e))){n[0]=e}else{t=e.replace(/[,;]/g,".").split(".");for(r=0;r<t.length;r+=1){if(t[r]!==""&&x(document.getElementById(t[r]))){n[r]=t[r]}else{n[r]=""}}}}return n}catch(i){}return null}function h(){try{var e,n,r;if(resx.rrelem!==undefined){r=m(p());if(r!==undefined&&r!==null){for(e=0;e<r.length;e+=1){if(r[e]!==""){n=document.getElementById(r[e])}else{n=null}if(x(n)){n.style.visibility="visible"}}}}}catch(t){}}function g(e,n){try{if(!s){s=true;r=e+"|"+(n.number!==undefined?n.number:"undefined")+"|"+(n.name!==undefined?n.name:"undefined")+"|"+(n.description!==undefined?n.description:"undefined")}}catch(t){}finally{h()}}function y(e){try{var n,r,t;if(document.cookie.length>0){n=document.cookie;r=n.indexOf(e+"=");if(r!==-1){r+=e.length+1;t=n.indexOf(";",r);if(t===-1){t=n.length}return decodeURIComponent(n.slice(r,t))}}}catch(i){g("",i)}return null}function R(e,n,r,t){try{var i=new Date;if(r!==null){i.setTime(i.getTime()+r*3600*1e3)}document.cookie=e+"="+encodeURIComponent(n)+(r!==null?"; expires="+i.toGMTString():"")+"; path=/"+(x(t)?"; domain="+t:"")}catch(s){g("",s)}}function v(){try{var e,n,r,t,c;n=resx.rrec!==undefined&&(resx.rrec===true||resx.rrec==="true")&&a==="1"&&resx.rrelem!==undefined&&resx.rrelem!==null&&!s;if(n){if(!i){n=false;c=m(p());if(c!==undefined&&c!==null){for(e=0;e<c.length;e+=1){if(x(c[e])){n=true;break}}}}if(n){if(!x(resx.useitems)){n=false;if(resx.rrnum!==undefined){r=resx.rrnum;r+="";r=r.replace(/,/g,";");t=r.split(";");for(e=0;e<t.length;e+=1){if(!isNaN(t[e])&&d(t[e])>0){n=true;break}}}}}}return n}catch(o){}return false}function w(e){try{var n,r="";e+="";for(n=e.length-1;n>=0;n-=1){r+=e.charAt(n)}return r}catch(t){}return""}function k(){try{var e,n,r,t,i;if(navigator.userAgent.toLowerCase().indexOf("mac")===-1){i=Math.floor(Math.random()*1e15);i+=""}else{r=Math.floor(Math.random()*1e6);e=new Date;n=e.getTime();n+="";t=w(n);r+="";i=r+t.slice(0,11)}return i}catch(s){g("guid",s)}return""}function N(e){try{t=true;var n,r,s,c;if(!i){for(n=0;n<e.Resonance.Response.length;n+=1){r=false;s=e.Resonance.Response[n].scheme;if(e.Resonance.Response[n].display==="yes"){r=true;c=document.getElementById(s);if(x(c)){c.innerHTML=e.Resonance.Response[n].output}}if(typeof resonanceResponseLoaded==="function"){resonanceResponseLoaded(s,r)}}if(typeof resonanceResponseLoadedAll==="function"){resonanceResponseLoadedAll()}}}catch(o){}finally{h()}}function b(){try{if(!t&&!i){if(e<2e3){e=e+10;window.setTimeout(certonaResx.checkCallback,10)}else{i=true;h()}}}catch(n){h()}}function I(e){try{var r="",t="",i;if(typeof e==="boolean"&&e===true){if(x(resx.rrcall)){r=resx.rrcall}else{r=n}}else if(typeof e==="string"){r=e}if(r.length>0){if(r===n){t="&cb="}else{t="&ccb="}t+=r}i=(x(resx.useitems)?"&ui="+resx.useitems:"&no="+resx.rrnum)+(x(resx.exitemid)?"&ex="+resx.exitemid:"")+(x(resx.rrqs)?"&"+resx.rrqs:"")+t;return i}catch(s){}return""}function C(){try{var e,n,r=window.location.hostname;if(x(r)){if(!r.match(/(\d{1,3}\.){3}\d{1,3}/)){e=r.split(".");if(e.length>1){r="."+e[e.length-2]+"."+e[e.length-1];n=/\.co\.\w{2}$|\.com\.\w{2}$|\.\w{2}\.com$/;if(r.toLowerCase().match(n)&&e.length>2){r="."+e[e.length-3]+r}}}return r}}catch(t){g("gsd",t)}return null}function S(e){try{return decodeURI(window.location.search.replace(new RegExp("^(?:.*[&\\?]"+encodeURI(e).replace(/[\.\+\*]/g,"\\$&")+"(?:\\=([^&]*))?)?.*$","i"),"$1"))}catch(n){}return null}function E(){try{var e,n="",r;for(e=0;e<51;e+=1){if(resx["cv"+e]!==undefined){r=resx["cv"+e];r+="";r=r.replace(/\+/g,"%2B");n+="&cv"+e+"="+encodeURIComponent(r)}}return n}catch(t){g("gcv",t)}return""}function L(p){try{var m={callback:false},w,N,b,I,E,L,T,U,B,M,$,q;if(p===undefined){p=m}else{for(I=0;I<m.length;I+=1){if(p[I]===undefined){p[I]=m[I]}}}s=false;r="";u="";l="";a="";o="";f="";c=false;t=false;i=false;e=0;w=C();T="RES_TRACKINGID";L="RES_SESSIONID";E="ResonanceSegment";u=S("resxtrack");if(x(u)){resx.sessionid="";resx.segment="";R(L,"",-1,w)}else if(x(resx.trackingid)){u=String(resx.trackingid)}else{u=y(T);if(!x(u)){u=k()}}l=x(resx.sessionid)?String(resx.sessionid):"";if(!x(l)){l=y(L);if(!x(l)){l=k()}}a=x(resx.segment)?String(resx.segment):"";if(!x(a)){q=d(u);if(!isNaN(q)&&q>0){q=String(q);q=q.slice(1,6);q=d(q);U=d(resx.top1);B=d(resx.top2);M=d(resx.top3);$=1e5;if(!(isNaN(U)&&isNaN(B)&&isNaN(M))){if(isNaN(U)){U=0}if(isNaN(B)){B=U}if(isNaN(M)){M=B}if(q<U){a="1"}else if(q<B){a="2"}else if(q<M){a="3"}else if(q<$){a="4"}}}}if(!x(a)){a=y(E)}if(isNaN(d(a))){a="1"}R(T,u,17520,w);if(!x(y(T))){R(T,u,null,w)}R(L,l,.5,w);if(!x(y(L))){R(L,l,null,w)}R(E,a,1440,w);if(!x(y(E))){R(E,a,null,w)}if(x(resx.pageid)){o=resx.pageid}else{o=k()}N=resx.links!==undefined?String(resx.links):"";if(x(N)){b=N.replace(/\,/g,";").replace(/\|/g,"%7C").split(";",50);for(I=0;I<b.length;I+=1){f+=b[I]+";"}}if(typeof p.callback==="string"&&p.callback!==n||p.callback===false||x(resx.rrcall)&&resx.rrcall!==n){i=true}c=v()&&x(u)&&x(o);if(!c){h()}}catch(A){g("pv",A)}}function T(e){try{var n,t,i,d,m,h,g,y="5.7x";if(a==="1"||a==="2"||a==="3"){if(c){window.setTimeout(certonaResx.checkCallback,50)}t=window.location.protocol.toLowerCase()==="https:"?"https://":"http://";m="www.res-x.com";if(x(resx.host)){m=resx.host}i="appid="+(resx.appid!==undefined?resx.appid:"")+"&tk="+(x(u)?u:"")+"&ss="+(x(l)?l:"")+"&sg="+(x(a)?a:"")+"&pg="+(x(o)?o:"")+"&vr="+y+"&bx="+c;g="";if(resx.rrelem!==undefined&&resx.rrelem!==null){h=p().replace(/[,;]/g,".").split(".");if(h!==null){for(n=0;n<h.length;n+=1){g+="&sc="+h[n]}}}i+=g+(resx.event!==undefined?"&ev="+resx.event:"")+(resx.itemid!==undefined?"&ei="+resx.itemid:"")+(resx.qty!==undefined?"&qty="+resx.qty:"")+(resx.price!==undefined?"&pr="+resx.price:"")+(resx.shipping!==undefined?"&sh="+resx.shipping:"")+(resx.total!==undefined?"&tt="+resx.total:"")+(resx.currencycode!==undefined?"&cc="+resx.currencycode:"")+(resx.customerid!==undefined?"&cu="+resx.customerid:"")+(resx.transactionid!==undefined?"&tr="+resx.transactionid:"");i+=(c?I(e):"")+E()+"&ur="+encodeURIComponent(window.location.href.slice(0,400))+"&plk="+(x(f)?f:"")+"&rf="+encodeURIComponent(document.referrer)+(s===true?"&er="+s+"&em="+encodeURIComponent(r):"");d=t+m+"/ws/r2/Resonance.aspx"+"?"+i;return d.slice(0,2013)}}catch(R){}return""}function U(e){try{if(e!==""){var n=document.createElement("script"),r=document.getElementsByTagName("script")[0];n.type="text/javascript";n.async=true;n.src=e;r.parentNode.insertBefore(n,r)}}catch(t){}}function B(e){var n={callback:false},r;if(e===undefined){e=n}else{for(r=0;r<n.length;r+=1){if(e[r]===undefined){e[r]=n[r]}}}return T(e.callback)}function M(){L({callback:true});var e=T(true);U(e)}return{checkCallback:function(){b()},showResponse:function(e){N(e)},getURL:function(e){L(e);return B(e)},run:function(){M()}}}();

define("resxclsx", function(){});

/* Set up Javascript Module paths and dependencies.
 * Initialize load of JS
 * Initialize Cart
 */
//JQuery & Handlebars is loaded in the tabletmash/global.js
//just set up a mapping to the loaded versions
define('jquery', [],function() {
  return jQuery;
});
// define('handlebars', function() { return Handlebars; });
//Cart-specific dependencies
require.config({
  // appDir: '',
  waitSeconds: 45,
  paths: {
    //GLobal HFAPP DEPENDENCIES
    jquery: 'empty:',
    mustache: '../../node_modules/mustache/mustache',
    'jquery-fancybox': '../../node_modules/olt-global-scripts/desktop/lib/plugins/jquery.fancybox',
    'jquery-migrate': '../../node_modules/olt-global-scripts/desktop/lib/jquery-migrate-1.2.1',
    'jquery-imagesloaded': '../../node_modules/olt-global-scripts/desktop/lib/plugins/jquery.imagesloaded.min',
    hammer: '../../node_modules/olt-global-scripts/desktop/lib/hammer',

    //'handlebars': 'libs/handlebars.runtime.min-v1.1.2',
    hoverIntent: '../../node_modules/hfapp/scripts/lib/hoverIntent',
    Masonry: '../../node_modules/hfapp/scripts/lib/masonry.pkgd',
    'thd-overlay': '../../node_modules/thd-overlay/lib/thd-overlay',
    'thd-event-emitter': '../../node_modules/thd-event-emitter/dist/thd-event-emitter',

    // Header Modules
    window: '../../node_modules/hfapp/scripts/source/header/window',
    'cookie-utils': '../../node_modules/cookie-utils/dist/cookie-utils',
    'thd-online-common': '../../node_modules/thd-online-common/dist/thd-online-common',
    Localizer: '../../node_modules/thd-localizer/dist/localizer',
    'es6-promise': '../../node_modules/es6-promise/dist/es6-promise',
    localizationPopup: '../../node_modules/localization/scripts/lib/localizationPopup',
    'global.modal': '../../node_modules/olt-global-scripts/desktop/source/global-js/global.modal',
    'global.logging': '../../node_modules/olt-global-scripts/desktop/source/global-js/global.logging',
    // 'myaccountMylistpopup' : '',
    'global.namespace': '../../node_modules/olt-global-scripts/desktop/source/global-js/global.namespace',
    'global.gestureHandler':
      '../../node_modules/olt-global-scripts/desktop/source/global-js/global.gestureHandler',
    'global.utility': '../../node_modules/olt-global-scripts/desktop/source/global-js/global.utility',
    'utils.minicart': '../../node_modules/olt-global-scripts/desktop/source/utils-js/utils.minicart',
    'utils.url': '../../node_modules/olt-global-scripts/desktop/source/utils-js/utils.url',
    'jquery-fancybox': '../../node_modules/olt-global-scripts/desktop/lib/plugins/jquery.fancybox',
    'jquery-migrate': '../../node_modules/olt-global-scripts/desktop/lib/jquery-migrate-1.2.1',
    typeAheadV1: '../../node_modules/thd-typeahead/lib/typeAheadV1',
    typeAheadV2: '../../node_modules/thd-typeahead/lib/typeAheadV2',
    MobileTypeahead: '../../node_modules/thd-typeahead/lib/MobileTypeahead',
    'thd.search': '../../node_modules/olt-global-scripts/desktop/source/thd.search',
    digitalData: '../../node_modules/digital-data/global.digitalData',
    'new-relic': '../../node_modules/ddo-new-relic/dist/ddoNewRelic.umd',
    thdchatbot: '../../node_modules/THDChatbot/dist/build.chatbot.js',

    // myAccount
    'myAccount.popup': '../../node_modules/myaccount/scripts/myAccount.popup',
    'myAccount.myList': '../../node_modules/myaccount/scripts/myAccount.myList',
    'myAccount.PasswordMeter': '../../node_modules/myaccount/scripts/myAccount.PasswordMeter',
    'myAccount.resetPassword': '../../node_modules/myaccount/scripts/myAccount.resetPassword',
    'myAccount.signModal': '../../node_modules/myaccount/scripts/myAccount.signModal',
    'myAccount.securityQuestions': '../../node_modules/myaccount/scripts/myAccount.securityQuestions',
    'forms.radioButtons': '../../node_modules/olt-global-scripts/desktop/source/forms-js/forms.radioButtons',
    'forms.checkbox': '../../node_modules/olt-global-scripts/desktop/source/forms-js/forms.checkbox',
    'forms.selectBox': '../../node_modules/olt-global-scripts/desktop/source/forms-js/forms.selectBox',
    'utils.addToListModal': '../../node_modules/olt-global-scripts/desktop/source/utils-js/utils.addToListModal',
    'utils.clientRedirects':
      '../../node_modules/olt-global-scripts/desktop/source/utils-js/utils.clientRedirects',
    'utils.validate': '../../node_modules/olt-global-scripts/desktop/source/utils-js/utils.validate',
    'thd.moduleLoader': '../../node_modules/olt-global-scripts/desktop/source/thd.moduleLoader',
    'auth.analytics': '../../node_modules/account-global-ui/scripts/authentication/analytics/auth.analytics',

    // MCM MyList
    'account.list': '../../node_modules/account-global-ui/scripts/account.list',
    'account.modal': '../../node_modules/account-global-ui/scripts/utility/modal',
    'account.tooltip': '../../node_modules/account-global-ui/scripts/utility/tooltip',
    'account.utility': '../../node_modules/account-global-ui/scripts/utility/utility',

    'list.show': '../../node_modules/account-global-ui/scripts/list/display/list.show',
    'list.service': '../../node_modules/account-global-ui/scripts/list/list.service',
    'list.view': '../../node_modules/account-global-ui/scripts/list/list.view',
    'list.model': '../../node_modules/account-global-ui/scripts/list/model/list.model',
    'list.create': '../../node_modules/account-global-ui/scripts/list/create/list.create',
    'list.message': '../../node_modules/account-global-ui/scripts/list/utility/list.message',
    'list.helper': '../../node_modules/account-global-ui/scripts/list/utility/list.helper',
    'list.constants': '../../node_modules/account-global-ui/scripts/list/utility/list.constants',
    'list.analytics': '../../node_modules/account-global-ui/scripts/list/analytics/list.analytics',

    'auth.service': '../../node_modules/account-global-ui/scripts/authentication/auth.service',
    'auth.modal': '../../node_modules/account-global-ui/scripts/authentication/display/auth.modal',
    'auth.signin': '../../node_modules/account-global-ui/scripts/authentication/signin/auth.signin',
    'auth.constants': '../../node_modules/account-global-ui/scripts/authentication/utility/auth.constants',
    'auth.signin.validation':
      '../../node_modules/account-global-ui/scripts/authentication/signin/auth.validation',
    'auth.helper': '../../node_modules/account-global-ui/scripts/authentication/utility/auth.helper',
    'auth.reg.validation':
      '../../node_modules/account-global-ui/scripts/authentication/registeration/auth.reg.validation',
    'auth.registeration':
      '../../node_modules/account-global-ui/scripts/authentication/registeration/auth.registeration',
    'password.toggle': '../../node_modules/account-global-ui/scripts/library/myAccount.passwordToggle',
    'password.meter': '../../node_modules/account-global-ui/scripts/library/myAccount.passwordMeter',
    'account.device.utility': '../../node_modules/account-global-ui/scripts/utility/device.utility',
    'verification.service': '../../node_modules/account-global-ui/scripts/verification/verification.service',
    'verification.modal': '../../node_modules/account-global-ui/scripts/verification/display/verification.modal',
    'verification.constants':
      '../../node_modules/account-global-ui/scripts/verification/utilities/verification.constants',
    'verification.helper':
      '../../node_modules/account-global-ui/scripts/verification/utilities/verification.helper',
    'verification.analytics':
      '../../node_modules/account-global-ui/scripts/verification/analytics/verification.analytics',
    'verification.utility':
      '../../node_modules/account-global-ui/scripts/verification/utilities/verification.utility',

    'thd.recommendations': '../../node_modules/thd-recommendations-all/dist/all.amd',
    'thd-recommendations-core': '../../node_modules/thd-recommendations-core/dist/core.amd',
    'thd-recommendations-templates': '../../node_modules/thd-recommendations-templates/dist/templates.amd',
    'thd.certona': '../../node_modules/thd-recommendations-all/dist/all.amd',
    // 'thd.certona': '../../node_modules/thd-recommendations-all/dist/main.amd',

    'thd-recently-viewed': '../../node_modules/thd-recently-viewed/dist/main.amd',
    'thd-client-throttle': '../../node_modules/thd-client-throttle/dist/main.amd',

    owlCarousel: '../../node_modules/thd-carousel/scripts/lib/owl.carousel',
    'thd-carousel': '../../node_modules/thd-carousel/scripts/src/carousel',
    rv2: '../../node_modules/thd-certona/scripts/src/rv2',
    // 'resxclsx': '../../node_modules/olt-global-scripts/desktop/thirdpacrty/resxclsx',
    resxclsx: '../../node_modules/thd-recommendations-certona/modules/thirdparty/certona/resxclsx',
    'thd-cart-bindings': '../../node_modules/thd-cart-bindings/dist/thd-cart-bindings.amd',
    'thd-event-emitter': '../../node_modules/thd-event-emitter/dist/thd-event-emitter',
    'common.quantity': '../../node_modules/common-quantity/src/js/common.quantity',
    QuantityEmitter: '../../node_modules/common-quantity/src/js/QuantityEmitter',

    // monolith files
    'utils.array': '../../node_modules/olt-global-scripts/desktop/source/utils-js/utils.array',
    'utils.userInfo': '../../node_modules/olt-global-scripts/desktop/source/utils-js/utils.userInfo',
    'utils.captcha': '../../node_modules/olt-global-scripts/desktop/source/utils-js/utils.captcha',
    'utils.bopis': '../../node_modules/olt-global-scripts/desktop/source/utils-js/utils.bopis',
    'utils.collapsexpand': '../../node_modules/olt-global-scripts/desktop/source/utils-js/utils.collapsexpand',
    'utils.kiosk': '../../node_modules/olt-global-scripts/desktop/source/utils-js/utils.kiosk',
    'utils.lightbox': '../../node_modules/olt-global-scripts/desktop/source/utils-js/utils.lightbox',
    'utils.newWindow': '../../node_modules/olt-global-scripts/desktop/source/utils-js/utils.newWindow',
    'utils.position': '../../node_modules/olt-global-scripts/desktop/source/utils-js/utils.position',
    'utils.string': '../../node_modules/olt-global-scripts/desktop/source/utils-js/utils.string',
    'utils.cartMessages': '../../node_modules/olt-global-scripts/desktop/source/utils-js/utils.cartMessages',
    'global.gestureHandler':
      '../../node_modules/olt-global-scripts/desktop/source/global-js/global.gestureHandler',
    'global.dynamicRatings':
      '../../node_modules/olt-global-scripts/desktop/source/global-js/global.dynamicRatings',
    'utils.print': '../../node_modules/olt-global-scripts/desktop/source/utils-js/utils.print',
    'utils.flash': '../../node_modules/olt-global-scripts/desktop/source/utils-js/utils.flash',
    'utils.gallery': '../../node_modules/olt-global-scripts/desktop/source/utils-js/utils.gallery',
    'utils.popupLayers': '../../node_modules/olt-global-scripts/desktop/source/utils-js/utils.popupLayers',
    'utils.header': '../../node_modules/olt-global-scripts/desktop/source/utils-js/utils.header',
    'utils.onloadHandler': '../../node_modules/olt-global-scripts/desktop/source/utils-js/utils.onloadHandler',
    'utils.shame': '../../node_modules/olt-global-scripts/desktop/source/utils-js/utils.shame',
    'utils.includeJS': '../../node_modules/olt-global-scripts/desktop/source/utils-js/utils.includeJS',
    'global.setStore': '../../node_modules/olt-global-scripts/desktop/source/global-js/global.setStore',
    'global.podHeights': '../../node_modules/olt-global-scripts/desktop/source/global-js/global.podHeights',
    'global.lazyload': '../../node_modules/olt-global-scripts/desktop/source/global-js/global.lazyload',
    'global.documentDomain':
      '../../node_modules/olt-global-scripts/desktop/source/global-js/global.documentDomain',
    'global.lib': '../../node_modules/olt-global-scripts/desktop/source/global-js/global.lib',
    requireLib: '../../node_modules/requirejs/require',

    heroSlideShow: '../../node_modules/olt-global-scripts/desktop/widgets/heroSlideShow',
    thdTheme: '../../node_modules/olt-global-scripts/desktop/widgets/thdTheme',
    thdSlider: '../../node_modules/olt-global-scripts/desktop/widgets/thdSlider',
    thdSliderV2: '../../node_modules/olt-global-scripts/desktop/widgets/thdSliderV2',
    'thd.sliderV3': '../../node_modules/olt-global-scripts/desktop/widgets/thd.sliderV3',
    twentytwenty: '../../node_modules/olt-global-scripts/desktop/widgets/twentytwenty',
    'jquery.event.move': '../../node_modules/olt-global-scripts/desktop/lib/plugins/jquery.event.move',
    thdSilo: '../../node_modules/olt-global-scripts/desktop/widgets/thdSilo',
    relatedResourceWidget: '../../node_modules/olt-global-scripts/desktop/widgets/relatedResourceWidget',
    simpleAccordion: '../../node_modules/olt-global-scripts/desktop/widgets/simpleAccordion',
    'thd.collapse': '../../node_modules/olt-global-scripts/desktop/widgets/thd.collapse',
    thdSocialmedia: '../../node_modules/olt-global-scripts/desktop/widgets/thdSocialmedia',
    'thd.sbotd': '../../node_modules/olt-global-scripts/desktop/widgets/thd.sbotd',
    muteYTVideo: '../../node_modules/olt-global-scripts/desktop/widgets/muteYTVideo',
    videoPlayer: '../../node_modules/olt-global-scripts/desktop/source/videoPlayer',
    brightcove: '../../node_modules/olt-global-scripts/desktop/thirdparty/BrightcoveExperiences_all',
    bvapi: '../../node_modules/olt-global-scripts/desktop/thirdparty/bvapi',
    bvapi_dev: '../../node_modules/olt-global-scripts/desktop/thirdparty/bvapi_dev',
    'thd.moduleLoader': '../../node_modules/olt-global-scripts/desktop/source/thd.moduleLoader',
    lp: '../../node_modules/olt-global-scripts/desktop/thirdparty/liveperson/lp',
    'plugin.tooltip': '../../node_modules/global-tooltip/scripts/tooltip',
    'thd-cart-throttle': '../../node_modules/thd-cart-throttle/dist/thd-cart-throttle.amd',
    'thd-overlay': '../../node_modules/thd-overlay/lib/thd-overlay',
    'thd-event-emitter': '../../node_modules/thd-event-emitter/dist/thd-event-emitter',
    'thd-utils': '../../node_modules/thd-utils/lib/thd-utils',
  },
  shim: {
    jquery: {
      exports: 'jQuery',
    },
    'jquery-fancybox': {
      deps: ['jquery', 'jquery-migrate'],
    },
    'jquery-migrate': {
      deps: ['jquery'],
    },
    hoverIntent: {
      deps: ['jquery'],
    },
    'jquery.event.move': {
      deps: ['jquery'],
    },
    twentytwenty: {
      deps: ['jquery.event.move'],
    },
  },
});

require([
    'auth.service',
    'thirdpartyInit',
    'verification.service', 
    'new-relic',
    'resxclsx'
], function(myAccount, thirdpartyInit, verification, newRelic, resxclsx) {
  $(document).ready(function() {
    if(location.href.indexOf("mycheckout/checkout") === -1){ //TMX should only be initalized on checkout page
      myAccount.init();
    }
    thirdpartyInit.init();    
    verification.init();
    newRelic.init();
  });
});
define("thirdparty", function(){});

